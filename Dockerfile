FROM node:20-slim

ARG NEXT_PUBLIC_COPILOTKIT_RUNTIME_URL
ARG NEXT_PUBLIC_AGNO_COPILOT_API_KEY
ARG NEXT_PUBLIC_CREWAI_COPILOT_API_KEY
ARG NEXT_PUBLIC_LANGGRAPH_COPILOT_API_KEY
ARG NEXT_PUBLIC_LANGGRAPH_FASTAPI_COPILOT_API_KEY
ARG NEXT_PUBLIC_LANGGRAPH_TYPESCRIPT_COPILOT_API_KEY
ARG NEXT_PUBLIC_LLAMA_INDEX_COPILOT_API_KEY
ARG NEXT_PUBLIC_MASTRA_COPILOT_API_KEY
ARG NEXT_PUBLIC_PYDANTIC_AI_COPILOT_API_KEY

ENV NEXT_PUBLIC_COPILOTKIT_RUNTIME_URL=$NEXT_PUBLIC_COPILOTKIT_RUNTIME_URL
ENV NEXT_PUBLIC_AGNO_COPILOT_API_KEY=$NEXT_PUBLIC_AGNO_COPILOT_API_KEY
ENV NEXT_PUBLIC_CREWAI_COPILOT_API_KEY=$NEXT_PUBLIC_CREWAI_COPILOT_API_KEY
ENV NEXT_PUBLIC_LANGGRAPH_COPILOT_API_KEY=$NEXT_PUBLIC_LANGGRAPH_COPILOT_API_KEY
ENV NEXT_PUBLIC_LANGGRAPH_FASTAPI_COPILOT_API_KEY=$NEXT_PUBLIC_LANGGRAPH_FASTAPI_COPILOT_API_KEY
ENV NEXT_PUBLIC_LANGGRAPH_TYPESCRIPT_COPILOT_API_KEY=$NEXT_PUBLIC_LANGGRAPH_TYPESCRIPT_COPILOT_API_KEY
ENV NEXT_PUBLIC_LLAMA_INDEX_COPILOT_API_KEY=$NEXT_PUBLIC_LLAMA_INDEX_COPILOT_API_KEY
ENV NEXT_PUBLIC_MASTRA_COPILOT_API_KEY=$NEXT_PUBLIC_MASTRA_COPILOT_API_KEY
ENV NEXT_PUBLIC_PYDANTIC_AI_COPILOT_API_KEY=$NEXT_PUBLIC_PYDANTIC_AI_COPILOT_API_KEY

ENV PNPM_HOME="/pnpm"
ENV PATH="$PNPM_HOME:$PATH"
ENV NODE_ENV=production

RUN npm install -g pnpm
RUN npm install -g turbo

COPY . /app/ag-ui
WORKDIR /app/ag-ui

RUN pnpm install --frozen-lockfile
RUN pnpm run build

WORKDIR /app/ag-ui/apps/dojo

EXPOSE 3000
CMD ["pnpm", "run", "start"]