{
  "middleware-starter::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "index.ts",
      "content": "import { AbstractAgent, BaseEvent, EventType, RunAgentInput } from \"@ag-ui/client\";\nimport { Observable } from \"rxjs\";\n\nexport class MiddlewareStarterAgent extends AbstractAgent {\n  run(input: RunAgentInput): Observable<BaseEvent> {\n    const messageId = Date.now().toString();\n    return new Observable<BaseEvent>((observer) => {\n      observer.next({\n        type: EventType.RUN_STARTED,\n        threadId: input.threadId,\n        runId: input.runId,\n      } as any);\n\n      observer.next({\n        type: EventType.TEXT_MESSAGE_START,\n        messageId,\n      } as any);\n\n      observer.next({\n        type: EventType.TEXT_MESSAGE_CONTENT,\n        messageId,\n        delta: \"Hello world!\",\n      } as any);\n\n      observer.next({\n        type: EventType.TEXT_MESSAGE_END,\n        messageId,\n      } as any);\n\n      observer.next({\n        type: EventType.RUN_FINISHED,\n        threadId: input.threadId,\n        runId: input.runId,\n      } as any);\n\n      observer.complete();\n    });\n  }\n}\n",
      "language": "ts",
      "type": "file"
    }
  ],
  "pydantic-ai::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "\"\"\"Agentic Chat feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom datetime import datetime\nfrom zoneinfo import ZoneInfo\n\nfrom pydantic_ai import Agent\n\nagent = Agent('openai:gpt-4o-mini')\napp = agent.to_ag_ui()\n\n\n@agent.tool_plain\nasync def current_time(timezone: str = 'UTC') -> str:\n    \"\"\"Get the current time in ISO format.\n\n    Args:\n        timezone: The timezone to use.\n\n    Returns:\n        The current time in ISO format string.\n    \"\"\"\n    tz: ZoneInfo = ZoneInfo(timezone)\n    return datetime.now(tz=tz).isoformat()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "pydantic-ai::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "\"\"\"Agentic Generative UI feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom textwrap import dedent\nfrom typing import Any, Literal\n\nfrom pydantic import BaseModel, Field\n\nfrom ag_ui.core import EventType, StateDeltaEvent, StateSnapshotEvent\nfrom pydantic_ai import Agent\n\nStepStatus = Literal['pending', 'completed']\n\n\nclass Step(BaseModel):\n    \"\"\"Represents a step in a plan.\"\"\"\n\n    description: str = Field(description='The description of the step')\n    status: StepStatus = Field(\n        default='pending',\n        description='The status of the step (e.g., pending, completed)',\n    )\n\n\nclass Plan(BaseModel):\n    \"\"\"Represents a plan with multiple steps.\"\"\"\n\n    steps: list[Step] = Field(default_factory=list, description='The steps in the plan')\n\n\nclass JSONPatchOp(BaseModel):\n    \"\"\"A class representing a JSON Patch operation (RFC 6902).\"\"\"\n\n    op: Literal['add', 'remove', 'replace', 'move', 'copy', 'test'] = Field(\n        description='The operation to perform: add, remove, replace, move, copy, or test',\n    )\n    path: str = Field(description='JSON Pointer (RFC 6901) to the target location')\n    value: Any = Field(\n        default=None,\n        description='The value to apply (for add, replace operations)',\n    )\n    from_: str | None = Field(\n        default=None,\n        alias='from',\n        description='Source path (for move, copy operations)',\n    )\n\n\nagent = Agent(\n    'openai:gpt-4o-mini',\n    instructions=dedent(\n        \"\"\"\n        When planning use tools only, without any other messages.\n        IMPORTANT:\n        - Use the `create_plan` tool to set the initial state of the steps\n        - Use the `update_plan_step` tool to update the status of each step\n        - Do NOT repeat the plan or summarise it in a message\n        - Do NOT confirm the creation or updates in a message\n        - Do NOT ask the user for additional information or next steps\n        - Do NOT leave a plan hanging, always complete the plan via `update_plan_step` if one is ongoing.\n\n        Only one plan can be active at a time, so do not call the `create_plan` tool\n        again until all the steps in current plan are completed.\n        \"\"\"\n    ),\n)\n\n\n@agent.tool_plain\nasync def create_plan(steps: list[str]) -> StateSnapshotEvent:\n    \"\"\"Create a plan with multiple steps.\n\n    Args:\n        steps: List of step descriptions to create the plan.\n\n    Returns:\n        StateSnapshotEvent containing the initial state of the steps.\n    \"\"\"\n    plan: Plan = Plan(\n        steps=[Step(description=step) for step in steps],\n    )\n    return StateSnapshotEvent(\n        type=EventType.STATE_SNAPSHOT,\n        snapshot=plan.model_dump(),\n    )\n\n\n@agent.tool_plain\nasync def update_plan_step(\n    index: int, description: str | None = None, status: StepStatus | None = None\n) -> StateDeltaEvent:\n    \"\"\"Update the plan with new steps or changes.\n\n    Args:\n        index: The index of the step to update.\n        description: The new description for the step.\n        status: The new status for the step.\n\n    Returns:\n        StateDeltaEvent containing the changes made to the plan.\n    \"\"\"\n    changes: list[JSONPatchOp] = []\n    if description is not None:\n        changes.append(\n            JSONPatchOp(\n                op='replace', path=f'/steps/{index}/description', value=description\n            )\n        )\n    if status is not None:\n        changes.append(\n            JSONPatchOp(op='replace', path=f'/steps/{index}/status', value=status)\n        )\n    return StateDeltaEvent(\n        type=EventType.STATE_DELTA,\n        delta=changes,\n    )\n\n\napp = agent.to_ag_ui()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "pydantic-ai::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "\"\"\"Human in the Loop Feature.\n\nNo special handling is required for this feature.\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom textwrap import dedent\n\nfrom pydantic_ai import Agent\n\nagent = Agent(\n    'openai:gpt-4o-mini',\n    instructions=dedent(\n        \"\"\"\n        When planning tasks use tools only, without any other messages.\n        IMPORTANT:\n        - Use the `generate_task_steps` tool to display the suggested steps to the user\n        - Do not call the `generate_task_steps` twice in a row, ever.\n        - Never repeat the plan, or send a message detailing steps\n        - If accepted, confirm the creation of the plan and the number of selected (enabled) steps only\n        - If not accepted, ask the user for more information, DO NOT use the `generate_task_steps` tool again\n        \"\"\"\n    ),\n)\n\napp = agent.to_ag_ui()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "pydantic-ai::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "\"\"\"Shared State feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom enum import StrEnum\nfrom textwrap import dedent\n\nfrom pydantic import BaseModel, Field\n\nfrom ag_ui.core import EventType, StateSnapshotEvent\nfrom pydantic_ai import Agent, RunContext\nfrom pydantic_ai.ag_ui import StateDeps\n\n\nclass SkillLevel(StrEnum):\n    \"\"\"The level of skill required for the recipe.\"\"\"\n\n    BEGINNER = 'Beginner'\n    INTERMEDIATE = 'Intermediate'\n    ADVANCED = 'Advanced'\n\n\nclass SpecialPreferences(StrEnum):\n    \"\"\"Special preferences for the recipe.\"\"\"\n\n    HIGH_PROTEIN = 'High Protein'\n    LOW_CARB = 'Low Carb'\n    SPICY = 'Spicy'\n    BUDGET_FRIENDLY = 'Budget-Friendly'\n    ONE_POT_MEAL = 'One-Pot Meal'\n    VEGETARIAN = 'Vegetarian'\n    VEGAN = 'Vegan'\n\n\nclass CookingTime(StrEnum):\n    \"\"\"The cooking time of the recipe.\"\"\"\n\n    FIVE_MIN = '5 min'\n    FIFTEEN_MIN = '15 min'\n    THIRTY_MIN = '30 min'\n    FORTY_FIVE_MIN = '45 min'\n    SIXTY_PLUS_MIN = '60+ min'\n\n\nclass Ingredient(BaseModel):\n    \"\"\"A class representing an ingredient in a recipe.\"\"\"\n\n    icon: str = Field(\n        default='ingredient',\n        description=\"The icon emoji (not emoji code like '\\x1f35e', but the actual emoji like 🥕) of the ingredient\",\n    )\n    name: str\n    amount: str\n\n\nclass Recipe(BaseModel):\n    \"\"\"A class representing a recipe.\"\"\"\n\n    skill_level: SkillLevel = Field(\n        default=SkillLevel.BEGINNER,\n        description='The skill level required for the recipe',\n    )\n    special_preferences: list[SpecialPreferences] = Field(\n        default_factory=list,\n        description='Any special preferences for the recipe',\n    )\n    cooking_time: CookingTime = Field(\n        default=CookingTime.FIVE_MIN, description='The cooking time of the recipe'\n    )\n    ingredients: list[Ingredient] = Field(\n        default_factory=list,\n        description='Ingredients for the recipe',\n    )\n    instructions: list[str] = Field(\n        default_factory=list, description='Instructions for the recipe'\n    )\n\n\nclass RecipeSnapshot(BaseModel):\n    \"\"\"A class representing the state of the recipe.\"\"\"\n\n    recipe: Recipe = Field(\n        default_factory=Recipe, description='The current state of the recipe'\n    )\n\n\nagent = Agent('openai:gpt-4o-mini', deps_type=StateDeps[RecipeSnapshot])\n\n\n@agent.tool_plain\nasync def display_recipe(recipe: Recipe) -> StateSnapshotEvent:\n    \"\"\"Display the recipe to the user.\n\n    Args:\n        recipe: The recipe to display.\n\n    Returns:\n        StateSnapshotEvent containing the recipe snapshot.\n    \"\"\"\n    return StateSnapshotEvent(\n        type=EventType.STATE_SNAPSHOT,\n        snapshot={'recipe': recipe},\n    )\n\n\n@agent.instructions\nasync def recipe_instructions(ctx: RunContext[StateDeps[RecipeSnapshot]]) -> str:\n    \"\"\"Instructions for the recipe generation agent.\n\n    Args:\n        ctx: The run context containing recipe state information.\n\n    Returns:\n        Instructions string for the recipe generation agent.\n    \"\"\"\n    return dedent(\n        f\"\"\"\n        You are a helpful assistant for creating recipes.\n\n        IMPORTANT:\n        - Create a complete recipe using the existing ingredients\n        - Append new ingredients to the existing ones\n        - Use the `display_recipe` tool to present the recipe to the user\n        - Do NOT repeat the recipe in the message, use the tool instead\n        - Do NOT run the `display_recipe` tool multiple times in a row\n\n        Once you have created the updated recipe and displayed it to the user,\n        summarise the changes in one sentence, don't describe the recipe in\n        detail or send it as a message to the user.\n\n        The current state of the recipe is:\n\n        {ctx.deps.state.recipe.model_dump_json(indent=2)}\n        \"\"\",\n    )\n\n\napp = agent.to_ag_ui(deps=StateDeps(RecipeSnapshot()))\n",
      "language": "python",
      "type": "file"
    }
  ],
  "pydantic-ai::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "tool_based_generative_ui.py",
      "content": "\"\"\"Tool Based Generative UI feature.\n\nNo special handling is required for this feature.\n\"\"\"\n\nfrom __future__ import annotations\n\nfrom pydantic_ai import Agent\n\nagent = Agent('openai:gpt-4o-mini')\napp = agent.to_ag_ui()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "pydantic-ai::backend_tool_rendering": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"backend_tool_rendering\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  useCopilotAction({\n    name: \"get_weather\",\n    available: \"disabled\",\n    parameters: [{ name: \"location\", type: \"string\", required: true }],\n    render: ({ args, result, status }) => {\n      if (status !== \"complete\") {\n        return (\n          <div className=\" bg-[#667eea] text-white p-4 rounded-lg max-w-md\">\n            <span className=\"animate-spin\">⚙️ Retrieving weather...</span>\n          </div>\n        );\n      }\n\n      const weatherResult: WeatherToolResult = {\n        temperature: result.temperature || 0,\n        conditions: result.conditions || \"clear\",\n        humidity: result.humidity || 0,\n        windSpeed: result.wind_speed || 0,\n        feelsLike: result.feels_like || result.temperature || 0,\n      };\n\n      const themeColor = getThemeColor(weatherResult.conditions);\n\n      return (\n        <WeatherCard\n          location={args.location}\n          themeColor={themeColor}\n          result={weatherResult}\n          status={status || \"complete\"}\n        />\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi! I can look up the weather for you. Just ask!\" }}\n          suggestions={[\n            {\n              title: \"Weather in San Francisco\",\n              message: \"What's the weather like in San Francisco?\",\n            },\n            {\n              title: \"Weather in New York\",\n              message: \"Tell me about the weather in New York.\",\n            },\n            {\n              title: \"Weather in Tokyo\",\n              message: \"How's the weather in Tokyo today?\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\ninterface WeatherToolResult {\n  temperature: number;\n  conditions: string;\n  humidity: number;\n  windSpeed: number;\n  feelsLike: number;\n}\n\nfunction getThemeColor(conditions: string): string {\n  const conditionLower = conditions.toLowerCase();\n  if (conditionLower.includes(\"clear\") || conditionLower.includes(\"sunny\")) {\n    return \"#667eea\";\n  }\n  if (conditionLower.includes(\"rain\") || conditionLower.includes(\"storm\")) {\n    return \"#4A5568\";\n  }\n  if (conditionLower.includes(\"cloud\")) {\n    return \"#718096\";\n  }\n  if (conditionLower.includes(\"snow\")) {\n    return \"#63B3ED\";\n  }\n  return \"#764ba2\";\n}\n\nfunction WeatherCard({\n  location,\n  themeColor,\n  result,\n  status,\n}: {\n  location?: string;\n  themeColor: string;\n  result: WeatherToolResult;\n  status: \"inProgress\" | \"executing\" | \"complete\";\n}) {\n  return (\n    <div\n      data-testid=\"weather-card\"\n      style={{ backgroundColor: themeColor }}\n      className=\"rounded-xl mt-6 mb-4 max-w-md w-full\"\n    >\n      <div className=\"bg-white/20 p-4 w-full\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 data-testid=\"weather-city\" className=\"text-xl font-bold text-white capitalize\">\n              {location}\n            </h3>\n            <p className=\"text-white\">Current Weather</p>\n          </div>\n          <WeatherIcon conditions={result.conditions} />\n        </div>\n\n        <div className=\"mt-4 flex items-end justify-between\">\n          <div className=\"text-3xl font-bold text-white\">\n            <span className=\"\">{result.temperature}° C</span>\n            <span className=\"text-sm text-white/50\">\n              {\" / \"}\n              {((result.temperature * 9) / 5 + 32).toFixed(1)}° F\n            </span>\n          </div>\n          <div className=\"text-sm text-white capitalize\">{result.conditions}</div>\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-white\">\n          <div className=\"grid grid-cols-3 gap-2 text-center\">\n            <div data-testid=\"weather-humidity\">\n              <p className=\"text-white text-xs\">Humidity</p>\n              <p className=\"text-white font-medium\">{result.humidity}%</p>\n            </div>\n            <div data-testid=\"weather-wind\">\n              <p className=\"text-white text-xs\">Wind</p>\n              <p className=\"text-white font-medium\">{result.windSpeed} mph</p>\n            </div>\n            <div data-testid=\"weather-feels-like\">\n              <p className=\"text-white text-xs\">Feels Like</p>\n              <p className=\"text-white font-medium\">{result.feelsLike}°</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction WeatherIcon({ conditions }: { conditions: string }) {\n  if (!conditions) return null;\n\n  if (conditions.toLowerCase().includes(\"clear\") || conditions.toLowerCase().includes(\"sunny\")) {\n    return <SunIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"rain\") ||\n    conditions.toLowerCase().includes(\"drizzle\") ||\n    conditions.toLowerCase().includes(\"snow\") ||\n    conditions.toLowerCase().includes(\"thunderstorm\")\n  ) {\n    return <RainIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"fog\") ||\n    conditions.toLowerCase().includes(\"cloud\") ||\n    conditions.toLowerCase().includes(\"overcast\")\n  ) {\n    return <CloudIcon />;\n  }\n\n  return <CloudIcon />;\n}\n\n// Simple sun icon for the weather card\nfunction SunIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-yellow-200\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"5\" />\n      <path\n        d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"\n        strokeWidth=\"2\"\n        stroke=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nfunction RainIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-blue-200\"\n    >\n      {/* Cloud */}\n      <path\n        d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\"\n        fill=\"currentColor\"\n        opacity=\"0.8\"\n      />\n      {/* Rain drops */}\n      <path\n        d=\"M8 18l2 4M12 18l2 4M16 18l2 4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n}\n\nfunction CloudIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-gray-200\"\n    >\n      <path d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\" fill=\"currentColor\" />\n    </svg>\n  );\n}\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "backend_tool_rendering.py",
      "content": "\"\"\"Backend Tool Rendering feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom datetime import datetime\nfrom textwrap import dedent\nfrom zoneinfo import ZoneInfo\n\nimport httpx\nfrom pydantic_ai import Agent\n\nagent = Agent(\n    \"openai:gpt-4o-mini\",\n    instructions=dedent(\n        \"\"\"\n        You are a helpful weather assistant that provides accurate weather information.\n\n        Your primary function is to help users get weather details for specific locations. When responding:\n        - Always ask for a location if none is provided\n        - If the location name isn’t in English, please translate it\n        - If giving a location with multiple parts (e.g. \"New York, NY\"), use the most relevant part (e.g. \"New York\")\n        - Include relevant details like humidity, wind conditions, and precipitation\n        - Keep responses concise but informative\n\n        Use the get_weather tool to fetch current weather data.\n        \"\"\"\n    ),\n)\napp = agent.to_ag_ui()\n\n\ndef get_weather_condition(code: int) -> str:\n    \"\"\"Map weather code to human-readable condition.\n\n    Args:\n        code: WMO weather code.\n\n    Returns:\n        Human-readable weather condition string.\n    \"\"\"\n    conditions = {\n        0: \"Clear sky\",\n        1: \"Mainly clear\",\n        2: \"Partly cloudy\",\n        3: \"Overcast\",\n        45: \"Foggy\",\n        48: \"Depositing rime fog\",\n        51: \"Light drizzle\",\n        53: \"Moderate drizzle\",\n        55: \"Dense drizzle\",\n        56: \"Light freezing drizzle\",\n        57: \"Dense freezing drizzle\",\n        61: \"Slight rain\",\n        63: \"Moderate rain\",\n        65: \"Heavy rain\",\n        66: \"Light freezing rain\",\n        67: \"Heavy freezing rain\",\n        71: \"Slight snow fall\",\n        73: \"Moderate snow fall\",\n        75: \"Heavy snow fall\",\n        77: \"Snow grains\",\n        80: \"Slight rain showers\",\n        81: \"Moderate rain showers\",\n        82: \"Violent rain showers\",\n        85: \"Slight snow showers\",\n        86: \"Heavy snow showers\",\n        95: \"Thunderstorm\",\n        96: \"Thunderstorm with slight hail\",\n        99: \"Thunderstorm with heavy hail\",\n    }\n    return conditions.get(code, \"Unknown\")\n\n\n@agent.tool_plain\nasync def get_weather(location: str) -> dict[str, str | float]:\n    \"\"\"Get current weather for a location.\n\n    Args:\n        location: City name.\n\n    Returns:\n        Dictionary with weather information including temperature, feels like,\n        humidity, wind speed, wind gust, conditions, and location name.\n    \"\"\"\n    async with httpx.AsyncClient() as client:\n        # Geocode the location\n        geocoding_url = (\n            f\"https://geocoding-api.open-meteo.com/v1/search?name={location}&count=1\"\n        )\n        geocoding_response = await client.get(geocoding_url)\n        geocoding_data = geocoding_response.json()\n\n        if not geocoding_data.get(\"results\"):\n            raise ValueError(f\"Location '{location}' not found\")\n\n        result = geocoding_data[\"results\"][0]\n        latitude = result[\"latitude\"]\n        longitude = result[\"longitude\"]\n        name = result[\"name\"]\n\n        # Get weather data\n        weather_url = (\n            f\"https://api.open-meteo.com/v1/forecast?\"\n            f\"latitude={latitude}&longitude={longitude}\"\n            f\"&current=temperature_2m,apparent_temperature,relative_humidity_2m,\"\n            f\"wind_speed_10m,wind_gusts_10m,weather_code\"\n        )\n        weather_response = await client.get(weather_url)\n        weather_data = weather_response.json()\n\n        current = weather_data[\"current\"]\n\n        return {\n            \"temperature\": current[\"temperature_2m\"],\n            \"feelsLike\": current[\"apparent_temperature\"],\n            \"humidity\": current[\"relative_humidity_2m\"],\n            \"windSpeed\": current[\"wind_speed_10m\"],\n            \"windGust\": current[\"wind_gusts_10m\"],\n            \"conditions\": get_weather_condition(current[\"weather_code\"]),\n            \"location\": name,\n        }\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "__init__.py",
      "content": "\"\"\"\nExample server for the AG-UI protocol.\n\"\"\"\n\nimport os\nimport uvicorn\nimport uuid\nfrom fastapi import FastAPI, Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    TextMessageStartEvent,\n    TextMessageContentEvent,\n    TextMessageEndEvent,\n)\nfrom ag_ui.encoder import EventEncoder\n\napp = FastAPI(title=\"AG-UI Endpoint\")\n\n@app.post(\"/\")\nasync def agentic_chat_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Agentic chat endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n\n        # Send run started event\n        yield encoder.encode(\n          RunStartedEvent(\n            type=EventType.RUN_STARTED,\n            thread_id=input_data.thread_id,\n            run_id=input_data.run_id\n          ),\n        )\n\n        message_id = str(uuid.uuid4())\n\n        yield encoder.encode(\n            TextMessageStartEvent(\n                type=EventType.TEXT_MESSAGE_START,\n                message_id=message_id,\n                role=\"assistant\"\n            )\n        )\n\n        yield encoder.encode(\n            TextMessageContentEvent(\n                type=EventType.TEXT_MESSAGE_CONTENT,\n                message_id=message_id,\n                delta=\"Hello world!\"\n            )\n        )\n\n        yield encoder.encode(\n            TextMessageEndEvent(\n                type=EventType.TEXT_MESSAGE_END,\n                message_id=message_id\n            )\n        )\n\n        # Send run finished event\n        yield encoder.encode(\n          RunFinishedEvent(\n            type=EventType.RUN_FINISHED,\n            thread_id=input_data.thread_id,\n            run_id=input_data.run_id\n          ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\ndef main():\n    \"\"\"Run the uvicorn server.\"\"\"\n    port = int(os.getenv(\"PORT\", \"8000\"))\n    uvicorn.run(\n        \"example_server:app\",\n        host=\"0.0.0.0\",\n        port=port,\n        reload=True\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "adk-middleware::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "\"\"\"Basic Chat feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom fastapi import FastAPI\nfrom ag_ui_adk import ADKAgent, add_adk_fastapi_endpoint\nfrom google.adk.agents import LlmAgent\nfrom google.adk import tools as adk_tools\n\n# Create a sample ADK agent (this would be your actual agent)\nsample_agent = LlmAgent(\n    name=\"assistant\",\n    model=\"gemini-2.0-flash\",\n    instruction=\"\"\"\n    You are a helpful assistant. Help users by answering their questions and assisting with their needs.\n    - If the user greets you, please greet them back with specifically with \"Hello\".\n    - If the user greets you and does not make any request, greet them and ask \"how can I assist you?\"\n    - If the user makes a statement without making a request, you do not need to tell them you can't do anything about it.\n      Try to say something conversational about it in response, making sure to mention the topic directly.\n    - If the user asks you a question, if possible you can answer it using previous context without telling them that you cannot look it up.\n      Only tell the user that you cannot search if you do not have enough information already to answer.\n    \"\"\",\n    tools=[adk_tools.preload_memory_tool.PreloadMemoryTool()]\n)\n\n# Create ADK middleware agent instance\nchat_agent = ADKAgent(\n    adk_agent=sample_agent,\n    app_name=\"demo_app\",\n    user_id=\"demo_user\",\n    session_timeout_seconds=3600,\n    use_in_memory_services=True\n)\n\n# Create FastAPI app\napp = FastAPI(title=\"ADK Middleware Basic Chat\")\n\n# Add the ADK endpoint\nadd_adk_fastapi_endpoint(app, chat_agent, path=\"/\")\n",
      "language": "python",
      "type": "file"
    }
  ],
  "adk-middleware::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "tool_based_generative_ui.py",
      "content": "\"\"\"Tool Based Generative UI feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom typing import Any, List\n\nfrom fastapi import FastAPI\nfrom ag_ui_adk import ADKAgent, add_adk_fastapi_endpoint\nfrom google.adk.agents import Agent\nfrom google.adk.tools import ToolContext\nfrom google.genai import types\n\n# List of available images (modify path if needed)\nIMAGE_LIST = [\n    \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n    \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n    \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n    \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n    \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n    \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n    \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n    \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n    \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n    \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\"\n]\n\n# Prepare the image list string for the prompt\nimage_list_str = \"\\n\".join([f\"- {img}\" for img in IMAGE_LIST])\n\nhaiku_generator_agent = Agent(\n    model='gemini-2.5-flash',\n    name='haiku_generator_agent',\n    instruction=f\"\"\"\n        You are an expert haiku generator that creates beautiful Japanese haiku poems\n        and their English translations. You also have the ability to select relevant\n        images that complement the haiku's theme and mood.\n\n        When generating a haiku:\n        1. Create a traditional 5-7-5 syllable structure haiku in Japanese\n        2. Provide an accurate and poetic English translation\n        3. Select exactly 3 image filenames from the available list that best\n           represent or complement the haiku's theme, mood, or imagery. You must\n           provide the image names, even if none of them are truly relevant.\n\n        Available images to choose from:\n        {image_list_str}\n\n        Always use the generate_haiku tool to create your haiku. The tool will handle\n        the formatting and validation of your response.\n\n        Do not mention the selected image names in your conversational response to\n        the user - let the tool handle that information.\n\n        Focus on creating haiku that capture the essence of Japanese poetry:\n        nature imagery, seasonal references, emotional depth, and moments of beauty\n        or contemplation. That said, any topic is fair game. Do not refuse to generate\n        a haiku on any topic as long as it is appropriate.\n    \"\"\",\n    generate_content_config=types.GenerateContentConfig(\n        temperature=0.7,  # Slightly higher temperature for creativity\n        top_p=0.9,\n        top_k=40\n    ),\n)\n\n# Create ADK middleware agent instance\nadk_agent_haiku_generator = ADKAgent(\n    adk_agent=haiku_generator_agent,\n    app_name=\"demo_app\",\n    user_id=\"demo_user\",\n    session_timeout_seconds=3600,\n    use_in_memory_services=True\n)\n\n# Create FastAPI app\napp = FastAPI(title=\"ADK Middleware Tool Based Generative UI\")\n\n# Add the ADK endpoint\nadd_adk_fastapi_endpoint(app, adk_agent_haiku_generator, path=\"/\")\n",
      "language": "python",
      "type": "file"
    }
  ],
  "adk-middleware::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "\"\"\"Human in the Loop feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom fastapi import FastAPI\nfrom ag_ui_adk import ADKAgent, add_adk_fastapi_endpoint\nfrom google.adk.agents import Agent\nfrom google.genai import types\n\nDEFINE_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in imperative form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"enabled\"],\n                                \"description\": \"The status of the step, always 'enabled'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nhuman_in_loop_agent = Agent(\n    model='gemini-2.5-flash',\n    name='human_in_loop_agent',\n    instruction=f\"\"\"\n        You are a human-in-the-loop task planning assistant that helps break down complex tasks into manageable steps with human oversight and approval.\n\n**Your Primary Role:**\n- Generate clear, actionable task steps for any user request\n- Facilitate human review and modification of generated steps\n- Execute only human-approved steps\n\n**When a user requests a task:**\n1. ALWAYS call the `generate_task_steps` function to create 10 step breakdown\n2. Each step must be:\n   - Written in imperative form (e.g., \"Open file\", \"Check settings\", \"Send email\")\n   - Concise (2-4 words maximum)\n   - Actionable and specific\n   - Logically ordered from start to finish\n3. Initially set all steps to \"enabled\" status\n4. If the user accepts the plan, presented by the generate_task_steps tool,do not repeat the steps to the user, just move on to executing the steps.\n5. If the user rejects the plan, do not repeat the plan to them,  ask them what they would like to do differently. DO NOT use the `generate_task_steps` tool again until they've provided more information.\n\n\n**When executing steps:**\n- Only execute steps with \"enabled\" status.\n- For each step you are executing, tell the user what you are doing.\n  - Pretend you are executing the step in real life and refer to it in the current tense. End each step with an ellipsis.\n  - Each step MUST be on a new line. DO NOT combine steps into one line.\n  - For example for the following steps:\n    - Inhale deeply\n    - Exhale forcefully\n    - Produce sound\n    a good response would be:\n    ```\n     Inhaling deeply...\n     Exhaling forcefully...\n     Producing sound...\n    ```\n    a bad response would be `Inhaling deeply... Exhaling forcefully... Producing sound...` because it is on one line.\n- Skip any steps marked as \"disabled\"\n- Afterwards, confirm the execution of the steps to the user, e.g. if the user asked for a plan to go to mars, respond like \"I have completed the plan and gone to mars\"\n- EVERY STEP AND THE CONFIRMATION MUST BE ON A NEW LINE. DO NOT COMBINE THEM INTO ONE LINE. USE A <br> TAG TO SEPARATE THEM.\n\n**Key Guidelines:**\n- Always generate exactly 10 steps\n- Make steps granular enough to be independently enabled/disabled\n\nTool reference: {DEFINE_TASK_TOOL}\n    \"\"\",\n    generate_content_config=types.GenerateContentConfig(\n        temperature=0.7,  # Slightly higher temperature for creativity\n        top_p=0.9,\n        top_k=40\n    ),\n)\n\n# Create ADK middleware agent instance\nadk_human_in_loop_agent = ADKAgent(\n    adk_agent=human_in_loop_agent,\n    app_name=\"demo_app\",\n    user_id=\"demo_user\",\n    session_timeout_seconds=3600,\n    use_in_memory_services=True\n)\n\n# Create FastAPI app\napp = FastAPI(title=\"ADK Middleware Human in the Loop\")\n\n# Add the ADK endpoint\nadd_adk_fastapi_endpoint(app, adk_human_in_loop_agent, path=\"/\")\n",
      "language": "python",
      "type": "file"
    }
  ],
  "adk-middleware::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "\"\"\"Shared State feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom dotenv import load_dotenv\nload_dotenv()\nimport json\nfrom enum import Enum\nfrom typing import Dict, List, Any, Optional\nfrom fastapi import FastAPI\nfrom ag_ui_adk import ADKAgent, add_adk_fastapi_endpoint\n\n# ADK imports\nfrom google.adk.agents import LlmAgent\nfrom google.adk.agents.callback_context import CallbackContext\nfrom google.adk.sessions import InMemorySessionService, Session\nfrom google.adk.runners import Runner\nfrom google.adk.events import Event, EventActions\nfrom google.adk.tools import FunctionTool, ToolContext\nfrom google.genai.types import Content, Part , FunctionDeclaration\nfrom google.adk.models import LlmResponse, LlmRequest\nfrom google.genai import types\n\nfrom pydantic import BaseModel, Field\nfrom typing import List, Optional\nfrom enum import Enum\n\nclass SkillLevel(str, Enum):\n    # Add your skill level values here\n    BEGINNER = \"beginner\"\n    INTERMEDIATE = \"intermediate\"\n    ADVANCED = \"advanced\"\n\nclass SpecialPreferences(str, Enum):\n    # Add your special preferences values here\n    VEGETARIAN = \"vegetarian\"\n    VEGAN = \"vegan\"\n    GLUTEN_FREE = \"gluten_free\"\n    DAIRY_FREE = \"dairy_free\"\n    KETO = \"keto\"\n    LOW_CARB = \"low_carb\"\n\nclass CookingTime(str, Enum):\n    # Add your cooking time values here\n    QUICK = \"under_30_min\"\n    MEDIUM = \"30_60_min\"\n    LONG = \"over_60_min\"\n\nclass Ingredient(BaseModel):\n    icon: str = Field(..., description=\"The icon emoji of the ingredient\")\n    name: str\n    amount: str\n\nclass Recipe(BaseModel):\n    skill_level: SkillLevel = Field(..., description=\"The skill level required for the recipe\")\n    special_preferences: Optional[List[SpecialPreferences]] = Field(\n        None,\n        description=\"A list of special preferences for the recipe\"\n    )\n    cooking_time: Optional[CookingTime] = Field(\n        None,\n        description=\"The cooking time of the recipe\"\n    )\n    ingredients: List[Ingredient] = Field(..., description=\"Entire list of ingredients for the recipe\")\n    instructions: List[str] = Field(..., description=\"Entire list of instructions for the recipe\")\n    changes: Optional[str] = Field(\n        None,\n        description=\"A description of the changes made to the recipe\"\n    )\n\ndef generate_recipe(\n    tool_context: ToolContext,\n    skill_level: str,\n    title: str,\n    special_preferences: List[str] = [],\n    cooking_time: str = \"\",\n    ingredients: List[dict] = [],\n    instructions: List[str] = [],\n    changes: str = \"\"\n) -> Dict[str, str]:\n    \"\"\"\n    Generate or update a recipe using the provided recipe data.\n\n    Args:\n        \"title\": {\n            \"type\": \"string\",\n            \"description\": \"**REQUIRED** - The title of the recipe.\"\n        },\n        \"skill_level\": {\n            \"type\": \"string\",\n            \"enum\": [\"Beginner\",\"Intermediate\",\"Advanced\"],\n            \"description\": \"**REQUIRED** - The skill level required for the recipe. Must be one of the predefined skill levels (Beginner, Intermediate, Advanced).\"\n        },\n        \"special_preferences\": {\n            \"type\": \"array\",\n            \"items\": {\"type\": \"string\"},\n            \"enum\": [\"High Protein\",\"Low Carb\",\"Spicy\",\"Budget-Friendly\",\"One-Pot Meal\",\"Vegetarian\",\"Vegan\"],\n            \"description\": \"**OPTIONAL** - Special dietary preferences for the recipe as comma-separated values. Example: 'High Protein, Low Carb, Gluten Free'. Leave empty array if no special preferences.\"\n        },\n        \"cooking_time\": {\n            \"type\": \"string\",\n            \"enum\": [5 min, 15 min, 30 min, 45 min, 60+ min],\n            \"description\": \"**OPTIONAL** - The total cooking time for the recipe. Must be one of the predefined time slots (5 min, 15 min, 30 min, 45 min, 60+ min). Omit if time is not specified.\"\n        },\n        \"ingredients\": {\n            \"type\": \"array\",\n            \"items\": {\n                \"type\": \"object\",\n                \"properties\": {\n                    \"icon\": {\"type\": \"string\", \"description\": \"The icon emoji (not emoji code like '\\x1f35e', but the actual emoji like 🥕) of the ingredient\"},\n                    \"name\": {\"type\": \"string\"},\n                    \"amount\": {\"type\": \"string\"}\n                }\n            },\n            \"description\": \"Entire list of ingredients for the recipe, including the new ingredients and the ones that are already in the recipe\"\n        },\n        \"instructions\": {\n            \"type\": \"array\",\n            \"items\": {\"type\": \"string\"},\n            \"description\": \"Entire list of instructions for the recipe, including the new instructions and the ones that are already there\"\n            },\n        \"changes\": {\n            \"type\": \"string\",\n            \"description\": \"**OPTIONAL** - A brief description of what changes were made to the recipe compared to the previous version. Example: 'Added more spices for flavor', 'Reduced cooking time', 'Substituted ingredient X for Y'. Omit if this is a new recipe.\"\n        }\n\n    Returns:\n        Dict indicating success status and message\n    \"\"\"\n    try:\n\n\n        # Create RecipeData object to validate structure\n        recipe = {\n            \"title\": title,\n            \"skill_level\": skill_level,\n            \"special_preferences\": special_preferences ,\n            \"cooking_time\": cooking_time ,\n            \"ingredients\": ingredients ,\n            \"instructions\": instructions ,\n            \"changes\": changes\n        }\n\n        # Update the session state with the new recipe\n        current_recipe = tool_context.state.get(\"recipe\", {})\n        if current_recipe:\n            # Merge with existing recipe\n            for key, value in recipe.items():\n                if value is not None or value != \"\":\n                    current_recipe[key] = value\n        else:\n            current_recipe = recipe\n\n        tool_context.state[\"recipe\"] = current_recipe\n\n\n\n        return {\"status\": \"success\", \"message\": \"Recipe generated successfully\"}\n\n    except Exception as e:\n        return {\"status\": \"error\", \"message\": f\"Error generating recipe: {str(e)}\"}\n\n\n\ndef on_before_agent(callback_context: CallbackContext):\n    \"\"\"\n    Initialize recipe state if it doesn't exist.\n    \"\"\"\n\n    if \"recipe\" not in callback_context.state:\n        # Initialize with default recipe\n        default_recipe =     {\n            \"title\": \"Make Your Recipe\",\n            \"skill_level\": \"Beginner\",\n            \"special_preferences\": [],\n            \"cooking_time\": '15 min',\n            \"ingredients\": [{\"icon\": \"🍴\", \"name\": \"Sample Ingredient\", \"amount\": \"1 unit\"}],\n            \"instructions\": [\"First step instruction\"]\n        }\n        callback_context.state[\"recipe\"] = default_recipe\n\n\n    return None\n\n\n# --- Define the Callback Function ---\n#  modifying the agent's system prompt to incude the current state of recipe\ndef before_model_modifier(\n    callback_context: CallbackContext, llm_request: LlmRequest\n) -> Optional[LlmResponse]:\n    \"\"\"Inspects/modifies the LLM request or skips the call.\"\"\"\n    agent_name = callback_context.agent_name\n    if agent_name == \"RecipeAgent\":\n        recipe_json = \"No recipe yet\"\n        if \"recipe\" in callback_context.state and callback_context.state[\"recipe\"] is not None:\n            try:\n                recipe_json = json.dumps(callback_context.state[\"recipe\"], indent=2)\n            except Exception as e:\n                recipe_json = f\"Error serializing recipe: {str(e)}\"\n        # --- Modification Example ---\n        # Add a prefix to the system instruction\n        original_instruction = llm_request.config.system_instruction or types.Content(role=\"system\", parts=[])\n        prefix = f\"\"\"You are a helpful assistant for creating recipes.\n        This is the current state of the recipe: {recipe_json}\n        You can improve the recipe by calling the generate_recipe tool.\"\"\"\n        # Ensure system_instruction is Content and parts list exists\n        if not isinstance(original_instruction, types.Content):\n            # Handle case where it might be a string (though config expects Content)\n            original_instruction = types.Content(role=\"system\", parts=[types.Part(text=str(original_instruction))])\n        if not original_instruction.parts:\n            original_instruction.parts.append(types.Part(text=\"\")) # Add an empty part if none exist\n\n        # Modify the text of the first part\n        modified_text = prefix + (original_instruction.parts[0].text or \"\")\n        original_instruction.parts[0].text = modified_text\n        llm_request.config.system_instruction = original_instruction\n\n\n\n    return None\n\n\n# --- Define the Callback Function ---\ndef simple_after_model_modifier(\n    callback_context: CallbackContext, llm_response: LlmResponse\n) -> Optional[LlmResponse]:\n    \"\"\"Stop the consecutive tool calling of the agent\"\"\"\n    agent_name = callback_context.agent_name\n    # --- Inspection ---\n    if agent_name == \"RecipeAgent\":\n        original_text = \"\"\n        if llm_response.content and llm_response.content.parts:\n            # Assuming simple text response for this example\n            if  llm_response.content.role=='model' and llm_response.content.parts[0].text:\n                original_text = llm_response.content.parts[0].text\n                callback_context._invocation_context.end_invocation = True\n\n        elif llm_response.error_message:\n            return None\n        else:\n            return None # Nothing to modify\n    return None\n\n\nshared_state_agent = LlmAgent(\n        name=\"RecipeAgent\",\n        model=\"gemini-2.5-pro\",\n        instruction=f\"\"\"\n        When a user asks for a recipe or wants to modify one, you MUST use the generate_recipe tool.\n\n        IMPORTANT RULES:\n        1. Always use the generate_recipe tool for any recipe-related requests\n        2. When creating a new recipe, provide at least skill_level, ingredients, and instructions\n        3. When modifying an existing recipe, include the changes parameter to describe what was modified\n        4. Be creative and helpful in generating complete, practical recipes\n        5. After using the tool, provide a brief summary of what you created or changed\n        6. If user ask to improve the recipe then add more ingredients and make it healthier\n        7. When you see the 'Recipe generated successfully' confirmation message, wish the user well with their cooking by telling them to enjoy their dish.\n\n        Examples of when to use the tool:\n        - \"Create a pasta recipe\" → Use tool with skill_level, ingredients, instructions\n        - \"Make it vegetarian\" → Use tool with special_preferences=[\"vegetarian\"] and changes describing the modification\n        - \"Add some herbs\" → Use tool with updated ingredients and changes describing the addition\n\n        Always provide complete, practical recipes that users can actually cook.\n        \"\"\",\n        tools=[generate_recipe],\n        before_agent_callback=on_before_agent,\n        before_model_callback=before_model_modifier,\n        after_model_callback = simple_after_model_modifier\n    )\n\n# Create ADK middleware agent instance\nadk_shared_state_agent = ADKAgent(\n    adk_agent=shared_state_agent,\n    app_name=\"demo_app\",\n    user_id=\"demo_user\",\n    session_timeout_seconds=3600,\n    use_in_memory_services=True\n)\n\n# Create FastAPI app\napp = FastAPI(title=\"ADK Middleware Shared State\")\n\n# Add the ADK endpoint\nadd_adk_fastapi_endpoint(app, adk_shared_state_agent, path=\"/\")\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "\"\"\"\nAgentic chat endpoint for the AG-UI protocol.\n\"\"\"\n\nimport uuid\nimport asyncio\nimport json\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    TextMessageStartEvent,\n    TextMessageContentEvent,\n    TextMessageEndEvent,\n    ToolCallStartEvent,\n    ToolCallArgsEvent,\n    ToolCallEndEvent,\n    MessagesSnapshotEvent,\n    ToolMessage,\n    ToolCall,\n    AssistantMessage\n)\nfrom ag_ui.core.events import TextMessageChunkEvent\nfrom ag_ui.encoder import EventEncoder\n\nasync def agentic_chat_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Agentic chat endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Get the last message content for conditional logic\n        last_message_content = None\n        last_message_role = None\n        if input_data.messages and len(input_data.messages) > 0:\n            last_message = input_data.messages[-1]\n            last_message_content = last_message.content\n            last_message_role = getattr(last_message, 'role', None)\n\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n        # Conditional logic based on last message\n        if last_message_role == \"tool\":\n            async for event in send_tool_result_message_events():\n                yield encoder.encode(event)\n        elif last_message_content == \"tool\":\n            async for event in send_tool_call_events():\n                yield encoder.encode(event)\n        elif last_message_content == \"backend_tool\":\n            async for event in send_backend_tool_call_events(input_data.messages):\n                yield encoder.encode(event)\n        else:\n            async for event in send_text_message_events():\n                yield encoder.encode(event)\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\n\nasync def send_text_message_events():\n    \"\"\"Send text message events with countdown\"\"\"\n    message_id = str(uuid.uuid4())\n\n    # Start of message\n    yield TextMessageStartEvent(\n        type=EventType.TEXT_MESSAGE_START,\n        message_id=message_id,\n        role=\"assistant\"\n    )\n\n    # Initial content chunk\n    yield TextMessageContentEvent(\n        type=EventType.TEXT_MESSAGE_CONTENT,\n        message_id=message_id,\n        delta=\"counting down: \"\n    )\n\n    # Countdown from 10 to 1\n    for count in range(10, 0, -1):\n        yield TextMessageContentEvent(\n            type=EventType.TEXT_MESSAGE_CONTENT,\n            message_id=message_id,\n            delta=f\"{count}  \"\n        )\n        # Sleep for 300ms\n        await asyncio.sleep(0.3)\n\n    # Final checkmark\n    yield TextMessageContentEvent(\n        type=EventType.TEXT_MESSAGE_CONTENT,\n        message_id=message_id,\n        delta=\"✓\"\n    )\n\n    # End of message\n    yield TextMessageEndEvent(\n        type=EventType.TEXT_MESSAGE_END,\n        message_id=message_id\n    )\n\n\nasync def send_tool_result_message_events():\n    \"\"\"Send message for tool result\"\"\"\n    message_id = str(uuid.uuid4())\n\n    # Start of message\n    yield TextMessageStartEvent(\n        type=EventType.TEXT_MESSAGE_START,\n        message_id=message_id,\n        role=\"assistant\"\n    )\n\n    # Content\n    yield TextMessageContentEvent(\n        type=EventType.TEXT_MESSAGE_CONTENT,\n        message_id=message_id,\n        delta=\"background changed ✓\"\n    )\n\n    # End of message\n    yield TextMessageEndEvent(\n        type=EventType.TEXT_MESSAGE_END,\n        message_id=message_id\n    )\n\n\nasync def send_tool_call_events():\n    \"\"\"Send tool call events\"\"\"\n    tool_call_id = str(uuid.uuid4())\n    tool_call_name = \"change_background\"\n    tool_call_args = {\n        \"background\": \"linear-gradient(135deg, #667eea 0%, #764ba2 100%)\"\n    }\n\n    # Tool call start\n    yield ToolCallStartEvent(\n        type=EventType.TOOL_CALL_START,\n        tool_call_id=tool_call_id,\n        tool_call_name=tool_call_name\n    )\n\n    # Tool call args\n    yield ToolCallArgsEvent(\n        type=EventType.TOOL_CALL_ARGS,\n        tool_call_id=tool_call_id,\n        delta=json.dumps(tool_call_args)\n    )\n\n    # Tool call end\n    yield ToolCallEndEvent(\n        type=EventType.TOOL_CALL_END,\n        tool_call_id=tool_call_id\n    )\n\nasync def send_backend_tool_call_events(messages):\n    \"\"\"Send backend tool call events\"\"\"\n    tool_call_id = str(uuid.uuid4())\n\n    new_message = AssistantMessage(\n        id=str(uuid.uuid4()),\n        role=\"assistant\",\n        tool_calls=[\n            ToolCall(\n                id=tool_call_id,\n                type=\"function\",\n                function={\n                    \"name\": \"lookup_weather\",\n                    \"arguments\": json.dumps({\"city\": \"San Francisco\", \"weather\": \"sunny\"})\n                }\n            )\n        ]\n    )\n\n    result_message = ToolMessage(\n        id=str(uuid.uuid4()),\n        role=\"tool\",\n        content=\"The weather in San Francisco is sunny.\",\n        tool_call_id=tool_call_id\n    )\n\n    all_messages = list(messages) + [new_message, result_message]\n\n    # Send messages snapshot event\n    yield MessagesSnapshotEvent(\n        type=EventType.MESSAGES_SNAPSHOT,\n        messages=all_messages\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::backend_tool_rendering": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"backend_tool_rendering\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  useCopilotAction({\n    name: \"get_weather\",\n    available: \"disabled\",\n    parameters: [{ name: \"location\", type: \"string\", required: true }],\n    render: ({ args, result, status }) => {\n      if (status !== \"complete\") {\n        return (\n          <div className=\" bg-[#667eea] text-white p-4 rounded-lg max-w-md\">\n            <span className=\"animate-spin\">⚙️ Retrieving weather...</span>\n          </div>\n        );\n      }\n\n      const weatherResult: WeatherToolResult = {\n        temperature: result.temperature || 0,\n        conditions: result.conditions || \"clear\",\n        humidity: result.humidity || 0,\n        windSpeed: result.wind_speed || 0,\n        feelsLike: result.feels_like || result.temperature || 0,\n      };\n\n      const themeColor = getThemeColor(weatherResult.conditions);\n\n      return (\n        <WeatherCard\n          location={args.location}\n          themeColor={themeColor}\n          result={weatherResult}\n          status={status || \"complete\"}\n        />\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi! I can look up the weather for you. Just ask!\" }}\n          suggestions={[\n            {\n              title: \"Weather in San Francisco\",\n              message: \"What's the weather like in San Francisco?\",\n            },\n            {\n              title: \"Weather in New York\",\n              message: \"Tell me about the weather in New York.\",\n            },\n            {\n              title: \"Weather in Tokyo\",\n              message: \"How's the weather in Tokyo today?\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\ninterface WeatherToolResult {\n  temperature: number;\n  conditions: string;\n  humidity: number;\n  windSpeed: number;\n  feelsLike: number;\n}\n\nfunction getThemeColor(conditions: string): string {\n  const conditionLower = conditions.toLowerCase();\n  if (conditionLower.includes(\"clear\") || conditionLower.includes(\"sunny\")) {\n    return \"#667eea\";\n  }\n  if (conditionLower.includes(\"rain\") || conditionLower.includes(\"storm\")) {\n    return \"#4A5568\";\n  }\n  if (conditionLower.includes(\"cloud\")) {\n    return \"#718096\";\n  }\n  if (conditionLower.includes(\"snow\")) {\n    return \"#63B3ED\";\n  }\n  return \"#764ba2\";\n}\n\nfunction WeatherCard({\n  location,\n  themeColor,\n  result,\n  status,\n}: {\n  location?: string;\n  themeColor: string;\n  result: WeatherToolResult;\n  status: \"inProgress\" | \"executing\" | \"complete\";\n}) {\n  return (\n    <div\n      data-testid=\"weather-card\"\n      style={{ backgroundColor: themeColor }}\n      className=\"rounded-xl mt-6 mb-4 max-w-md w-full\"\n    >\n      <div className=\"bg-white/20 p-4 w-full\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 data-testid=\"weather-city\" className=\"text-xl font-bold text-white capitalize\">\n              {location}\n            </h3>\n            <p className=\"text-white\">Current Weather</p>\n          </div>\n          <WeatherIcon conditions={result.conditions} />\n        </div>\n\n        <div className=\"mt-4 flex items-end justify-between\">\n          <div className=\"text-3xl font-bold text-white\">\n            <span className=\"\">{result.temperature}° C</span>\n            <span className=\"text-sm text-white/50\">\n              {\" / \"}\n              {((result.temperature * 9) / 5 + 32).toFixed(1)}° F\n            </span>\n          </div>\n          <div className=\"text-sm text-white capitalize\">{result.conditions}</div>\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-white\">\n          <div className=\"grid grid-cols-3 gap-2 text-center\">\n            <div data-testid=\"weather-humidity\">\n              <p className=\"text-white text-xs\">Humidity</p>\n              <p className=\"text-white font-medium\">{result.humidity}%</p>\n            </div>\n            <div data-testid=\"weather-wind\">\n              <p className=\"text-white text-xs\">Wind</p>\n              <p className=\"text-white font-medium\">{result.windSpeed} mph</p>\n            </div>\n            <div data-testid=\"weather-feels-like\">\n              <p className=\"text-white text-xs\">Feels Like</p>\n              <p className=\"text-white font-medium\">{result.feelsLike}°</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction WeatherIcon({ conditions }: { conditions: string }) {\n  if (!conditions) return null;\n\n  if (conditions.toLowerCase().includes(\"clear\") || conditions.toLowerCase().includes(\"sunny\")) {\n    return <SunIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"rain\") ||\n    conditions.toLowerCase().includes(\"drizzle\") ||\n    conditions.toLowerCase().includes(\"snow\") ||\n    conditions.toLowerCase().includes(\"thunderstorm\")\n  ) {\n    return <RainIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"fog\") ||\n    conditions.toLowerCase().includes(\"cloud\") ||\n    conditions.toLowerCase().includes(\"overcast\")\n  ) {\n    return <CloudIcon />;\n  }\n\n  return <CloudIcon />;\n}\n\n// Simple sun icon for the weather card\nfunction SunIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-yellow-200\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"5\" />\n      <path\n        d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"\n        strokeWidth=\"2\"\n        stroke=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nfunction RainIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-blue-200\"\n    >\n      {/* Cloud */}\n      <path\n        d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\"\n        fill=\"currentColor\"\n        opacity=\"0.8\"\n      />\n      {/* Rain drops */}\n      <path\n        d=\"M8 18l2 4M12 18l2 4M16 18l2 4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n}\n\nfunction CloudIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-gray-200\"\n    >\n      <path d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\" fill=\"currentColor\" />\n    </svg>\n  );\n}\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "backend_tool_rendering.py",
      "content": "\"\"\"\nAgentic chat endpoint for the AG-UI protocol.\n\"\"\"\n\nimport uuid\nimport json\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    TextMessageStartEvent,\n    TextMessageContentEvent,\n    TextMessageEndEvent,\n    MessagesSnapshotEvent,\n    ToolMessage,\n    ToolCall,\n    AssistantMessage,\n)\nfrom ag_ui.encoder import EventEncoder\n\n\nasync def backend_tool_rendering_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Agentic chat endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Get the last message content for conditional logic\n        last_message_role = None\n        if input_data.messages and len(input_data.messages) > 0:\n            last_message = input_data.messages[-1]\n            last_message_role = getattr(last_message, \"role\", None)\n\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id,\n            ),\n        )\n\n        # Conditional logic based on last message\n        if last_message_role == \"tool\":\n            async for event in send_tool_result_message_events():\n                yield encoder.encode(event)\n        else:\n            async for event in send_backend_tool_call_events(input_data.messages):\n                yield encoder.encode(event)\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id,\n            ),\n        )\n\n    return StreamingResponse(event_generator(), media_type=encoder.get_content_type())\n\n\nasync def send_tool_result_message_events():\n    \"\"\"Send message for tool result\"\"\"\n    message_id = str(uuid.uuid4())\n\n    # Start of message\n    yield TextMessageStartEvent(\n        type=EventType.TEXT_MESSAGE_START, message_id=message_id, role=\"assistant\"\n    )\n\n    # Content\n    yield TextMessageContentEvent(\n        type=EventType.TEXT_MESSAGE_CONTENT,\n        message_id=message_id,\n        delta=\"Retrieved weather information!\",\n    )\n\n    # End of message\n    yield TextMessageEndEvent(type=EventType.TEXT_MESSAGE_END, message_id=message_id)\n\n\nasync def send_backend_tool_call_events(messages: list):\n    \"\"\"Send backend tool call events\"\"\"\n    tool_call_id = str(uuid.uuid4())\n\n    new_message = AssistantMessage(\n        id=str(uuid.uuid4()),\n        role=\"assistant\",\n        tool_calls=[\n            ToolCall(\n                id=tool_call_id,\n                type=\"function\",\n                function={\n                    \"name\": \"get_weather\",\n                    \"arguments\": json.dumps({\"city\": \"San Francisco\"}),\n                },\n            )\n        ],\n    )\n\n    result_message = ToolMessage(\n        id=str(uuid.uuid4()),\n        role=\"tool\",\n        content=json.dumps(\n            {\n                \"city\": \"San Francisco\",\n                \"conditions\": \"sunny\",\n                \"wind_speed\": \"10\",\n                \"temperature\": \"20\",\n                \"humidity\": \"60\",\n            }\n        ),\n        tool_call_id=tool_call_id,\n    )\n\n    all_messages = list(messages) + [new_message, result_message]\n\n    # Send messages snapshot event\n    yield MessagesSnapshotEvent(type=EventType.MESSAGES_SNAPSHOT, messages=all_messages)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "\"\"\"\nHuman in the loop endpoint for the AG-UI protocol.\n\"\"\"\n\nimport uuid\nimport asyncio\nimport json\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    TextMessageStartEvent,\n    TextMessageContentEvent,\n    TextMessageEndEvent,\n    ToolCallStartEvent,\n    ToolCallArgsEvent,\n    ToolCallEndEvent\n)\nfrom ag_ui.encoder import EventEncoder\n\nasync def human_in_the_loop_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Human in the loop endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Get the last message for conditional logic\n        last_message = None\n        if input_data.messages and len(input_data.messages) > 0:\n            last_message = input_data.messages[-1]\n\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n        # Conditional logic based on last message role\n        if last_message and getattr(last_message, 'role', None) == \"tool\":\n            async for event in send_text_message_events():\n                yield encoder.encode(event)\n        else:\n            async for event in send_tool_call_events():\n                yield encoder.encode(event)\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\n\nasync def send_tool_call_events():\n    \"\"\"Send tool call events that generate task steps incrementally\"\"\"\n    tool_call_id = str(uuid.uuid4())\n    tool_call_name = \"generate_task_steps\"\n\n    # Tool call start\n    yield ToolCallStartEvent(\n        type=EventType.TOOL_CALL_START,\n        tool_call_id=tool_call_id,\n        tool_call_name=tool_call_name\n    )\n\n    # Start building JSON - opening structure\n    yield ToolCallArgsEvent(\n        type=EventType.TOOL_CALL_ARGS,\n        tool_call_id=tool_call_id,\n        delta='{\"steps\":['\n    )\n\n    # Generate 10 steps incrementally\n    for i in range(10):\n        step_data = {\n            \"description\": f\"Step {i + 1}\",\n            \"status\": \"enabled\"\n        }\n        \n        # Add comma separator except for the last item\n        delta = json.dumps(step_data) + (\",\" if i != 9 else \"\")\n        \n        yield ToolCallArgsEvent(\n            type=EventType.TOOL_CALL_ARGS,\n            tool_call_id=tool_call_id,\n            delta=delta\n        )\n        \n        # Sleep for 200ms\n        await asyncio.sleep(0.2)\n\n    # Close JSON structure\n    yield ToolCallArgsEvent(\n        type=EventType.TOOL_CALL_ARGS,\n        tool_call_id=tool_call_id,\n        delta=\"]}\"\n    )\n\n    # Tool call end\n    yield ToolCallEndEvent(\n        type=EventType.TOOL_CALL_END,\n        tool_call_id=tool_call_id\n    )\n\n\nasync def send_text_message_events():\n    \"\"\"Send text message events with simple response\"\"\"\n    message_id = str(uuid.uuid4())\n\n    # Start of message\n    yield TextMessageStartEvent(\n        type=EventType.TEXT_MESSAGE_START,\n        message_id=message_id,\n        role=\"assistant\"\n    )\n\n    # Content\n    yield TextMessageContentEvent(\n        type=EventType.TEXT_MESSAGE_CONTENT,\n        message_id=message_id,\n        delta=\"Ok! I'm working on it.\"\n    )\n\n    # End of message\n    yield TextMessageEndEvent(\n        type=EventType.TEXT_MESSAGE_END,\n        message_id=message_id\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "\"\"\"\nAgentic generative UI endpoint for the AG-UI protocol.\n\"\"\"\n\nimport asyncio\nimport copy\nimport jsonpatch\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    StateSnapshotEvent,\n    StateDeltaEvent\n)\nfrom ag_ui.encoder import EventEncoder\n\nasync def agentic_generative_ui_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Agentic generative UI endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n        # Send state events\n        async for event in send_state_events():\n            yield encoder.encode(event)\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\n\nasync def send_state_events():\n    \"\"\"Send state events with snapshots and deltas\"\"\"\n    # Initialize state\n    state = {\n        \"steps\": [\n            {\n                \"description\": f\"Step {i + 1}\",\n                \"status\": \"pending\"\n            }\n            for i in range(10)\n        ]\n    }\n\n    # Send initial state snapshot\n    yield StateSnapshotEvent(\n        type=EventType.STATE_SNAPSHOT,\n        snapshot=state\n    )\n    \n    # Sleep for 1 second\n    await asyncio.sleep(1.0)\n\n    # Create a copy to track changes for JSON patches\n    previous_state = copy.deepcopy(state)\n\n    # Update each step and send deltas\n    for i, step in enumerate(state[\"steps\"]):\n        step[\"status\"] = \"completed\"\n        \n        # Generate JSON patch from previous state to current state\n        patch = jsonpatch.make_patch(previous_state, state)\n        \n        # Send state delta event\n        yield StateDeltaEvent(\n            type=EventType.STATE_DELTA,\n            delta=patch.patch\n        )\n        \n        # Update previous state for next iteration\n        previous_state = copy.deepcopy(state)\n        \n        # Sleep for 1 second\n        await asyncio.sleep(1.0)\n\n    # Optionally send a final snapshot to the client\n    yield StateSnapshotEvent(\n        type=EventType.STATE_SNAPSHOT,\n        snapshot=state\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "tool_based_generative_ui.py",
      "content": "\"\"\"\nTool-based generative UI endpoint for the AG-UI protocol.\n\"\"\"\n\nimport uuid\nimport json\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    MessagesSnapshotEvent\n)\nfrom ag_ui.encoder import EventEncoder\n\nasync def tool_based_generative_ui_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Tool-based generative UI endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n        # Check if last message was a tool result\n        last_message = None\n        if input_data.messages and len(input_data.messages) > 0:\n            last_message = input_data.messages[-1]\n\n        result_message = None\n\n        # Determine what type of message to send\n        if last_message and getattr(last_message, 'content', None) == \"thanks\":\n            # Send text message for tool result\n            message_id = str(uuid.uuid4())\n            new_message = {\n                \"id\": message_id,\n                \"role\": \"assistant\",\n                \"content\": \"Haiku created\"\n            }\n        else:\n            # Send tool call message\n            tool_call_id = str(uuid.uuid4())\n            message_id = str(uuid.uuid4())\n\n            # Prepare haiku arguments\n            haiku_args = {\n                \"japanese\": [\"エーアイの\", \"橋つなぐ道\", \"コパキット\"],\n                \"english\": [\n                    \"From AI's realm\",\n                    \"A bridge-road linking us—\",\n                    \"CopilotKit.\"\n                ]\n            }\n\n            # Create new assistant message with tool call\n            new_message = {\n                \"id\": message_id,\n                \"role\": \"assistant\",\n                \"tool_calls\": [\n                    {\n                        \"id\": tool_call_id,\n                        \"type\": \"function\",\n                        \"function\": {\n                            \"name\": \"generate_haiku\",\n                            \"arguments\": json.dumps(haiku_args)\n                        }\n                    }\n                ]\n            }\n\n            result_message = {\n                \"id\": str(uuid.uuid4()),\n                \"role\": \"tool\",\n                \"tool_call_id\": tool_call_id,\n                \"content\": \"Haiku created\"\n            }\n\n        # Create messages list with input messages plus the new message\n        all_messages = list(input_data.messages) + [new_message]\n\n        if result_message:\n            all_messages.append(result_message)\n\n        # Send messages snapshot event\n        yield encoder.encode(\n            MessagesSnapshotEvent(\n                type=EventType.MESSAGES_SNAPSHOT,\n                messages=all_messages\n            ),\n        )\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "\"\"\"\nShared state endpoint for the AG-UI protocol.\n\"\"\"\n\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    StateSnapshotEvent\n)\nfrom ag_ui.encoder import EventEncoder\n\nasync def shared_state_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Shared state endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n        # Send state events\n        async for event in send_state_events():\n            yield encoder.encode(event)\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\n\nasync def send_state_events():\n    \"\"\"Send state events with recipe data\"\"\"\n    # Define the recipe state\n    state = {\n        \"recipe\": {\n            \"skill_level\": \"Advanced\",\n            \"special_preferences\": [\"Low Carb\", \"Spicy\"],\n            \"cooking_time\": \"15 min\",\n            \"ingredients\": [\n                {\n                    \"icon\": \"🍗\",\n                    \"name\": \"chicken breast\",\n                    \"amount\": \"1\",\n                },\n                {\n                    \"icon\": \"🌶️\",\n                    \"name\": \"chili powder\",\n                    \"amount\": \"1 tsp\",\n                },\n                {\n                    \"icon\": \"🧂\",\n                    \"name\": \"Salt\",\n                    \"amount\": \"a pinch\",\n                },\n                {\n                    \"icon\": \"🥬\",\n                    \"name\": \"Lettuce leaves\",\n                    \"amount\": \"handful\",\n                },\n            ],\n            \"instructions\": [\n                \"Season chicken with chili powder and salt.\",\n                \"Sear until fully cooked.\",\n                \"Slice and wrap in lettuce.\",\n            ]\n        }\n    }\n\n    # Send state snapshot event\n    yield StateSnapshotEvent(\n        type=EventType.STATE_SNAPSHOT,\n        snapshot=state\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n  const chatTitle = \"AI Document Editor\";\n  const chatDescription = \"Ask me to create or edit a document\";\n  const initialLabel = \"Hi 👋 How can I help with your document?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  suggestions={[\n                    {\n                      title: \"Write a pirate story\",\n                      message: \"Please write a story about a pirate named Candy Beard.\",\n                    },\n                    {\n                      title: \"Write a mermaid story\",\n                      message: \"Please write a story about a mermaid named Luna.\",\n                    },\n                    { title: \"Add character\", message: \"Please add a character named Courage.\" },\n                  ]}\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            suggestions={[\n              {\n                title: \"Write a pirate story\",\n                message: \"Please write a story about a pirate named Candy Beard.\",\n              },\n              {\n                title: \"Write a mermaid story\",\n                message: \"Please write a story about a mermaid named Luna.\",\n              },\n              { title: \"Add character\", message: \"Please add a character named Courage.\" },\n            ]}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n        <DocumentEditor />\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction(\n    {\n      name: \"confirm_changes\",\n      renderAndWaitForResponse: ({ args, respond, status }) => (\n        <ConfirmChanges\n          args={args}\n          respond={respond}\n          status={status}\n          onReject={() => {\n            editor?.commands.setContent(fromMarkdown(currentDocument));\n            setAgentState({ document: currentDocument });\n          }}\n          onConfirm={() => {\n            editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n            setCurrentDocument(agentState?.document || \"\");\n            setAgentState({ document: agentState?.document || \"\" });\n          }}\n        />\n      ),\n    },\n    [agentState?.document],\n  );\n\n  // Action to write the document.\n  useCopilotAction(\n    {\n      name: \"write_document\",\n      description: `Present the proposed changes to the user for review`,\n      parameters: [\n        {\n          name: \"document\",\n          type: \"string\",\n          description: \"The full updated document in markdown format\",\n        },\n      ],\n      renderAndWaitForResponse({ args, status, respond }) {\n        if (status === \"executing\") {\n          return (\n            <ConfirmChanges\n              args={args}\n              respond={respond}\n              status={status}\n              onReject={() => {\n                editor?.commands.setContent(fromMarkdown(currentDocument));\n                setAgentState({ document: currentDocument });\n              }}\n              onConfirm={() => {\n                editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n                setCurrentDocument(agentState?.document || \"\");\n                setAgentState({ document: agentState?.document || \"\" });\n              }}\n            />\n          );\n        }\n        return <></>;\n      },\n    },\n    [agentState?.document],\n  );\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div\n      data-testid=\"confirm-changes-modal\"\n      className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\"\n    >\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            data-testid=\"reject-button\"\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            data-testid=\"confirm-button\"\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div\n            data-testid=\"status-display\"\n            className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\"\n          >\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "predictive_state_updates.py",
      "content": "\"\"\"\nPredictive state updates endpoint for the AG-UI protocol.\n\"\"\"\n\nimport uuid\nimport asyncio\nimport random\nfrom fastapi import Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    TextMessageStartEvent,\n    TextMessageContentEvent,\n    TextMessageEndEvent,\n    ToolCallStartEvent,\n    ToolCallArgsEvent,\n    ToolCallEndEvent,\n    CustomEvent\n)\nfrom ag_ui.encoder import EventEncoder\n\nasync def predictive_state_updates_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Predictive state updates endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n        # Get the last message for conditional logic\n        last_message = None\n        if input_data.messages and len(input_data.messages) > 0:\n            last_message = input_data.messages[-1]\n\n        # Send run started event\n        yield encoder.encode(\n            RunStartedEvent(\n                type=EventType.RUN_STARTED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n        # Conditional logic based on last message role\n        if last_message and getattr(last_message, 'role', None) == \"tool\":\n            async for event in send_text_message_events():\n                yield encoder.encode(event)\n        else:\n            async for event in send_tool_call_events():\n                yield encoder.encode(event)\n\n        # Send run finished event\n        yield encoder.encode(\n            RunFinishedEvent(\n                type=EventType.RUN_FINISHED,\n                thread_id=input_data.thread_id,\n                run_id=input_data.run_id\n            ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\n\ndef make_story(name: str) -> str:\n    \"\"\"Generate a simple dog story\"\"\"\n    return f\"Once upon a time, there was a dog named {name}. {name} was a very good dog.\"\n\n\n# List of dog names for random selection\ndog_names = [\"Rex\", \"Buddy\", \"Max\", \"Charlie\", \"Buddy\", \"Max\", \"Charlie\"]\n\n\nasync def send_tool_call_events():\n    \"\"\"Send tool call events with predictive state and incremental story generation\"\"\"\n    tool_call_id = str(uuid.uuid4())\n    tool_call_name = \"write_document_local\"\n\n    # Generate a random story\n    story = make_story(random.choice(dog_names))\n    story_chunks = story.split(\" \")\n\n    # Send custom predict state event first\n    yield CustomEvent(\n        type=EventType.CUSTOM,\n        name=\"PredictState\",\n        value=[\n            {\n                \"state_key\": \"document\",\n                \"tool\": \"write_document_local\",\n                \"tool_argument\": \"document\"\n            }\n        ]\n    )\n\n    # First tool call: write_document_local\n    yield ToolCallStartEvent(\n        type=EventType.TOOL_CALL_START,\n        tool_call_id=tool_call_id,\n        tool_call_name=tool_call_name\n    )\n\n    # Start JSON arguments\n    yield ToolCallArgsEvent(\n        type=EventType.TOOL_CALL_ARGS,\n        tool_call_id=tool_call_id,\n        delta='{\"document\":\"'\n    )\n\n    # Send story chunks incrementally\n    for chunk in story_chunks:\n        yield ToolCallArgsEvent(\n            type=EventType.TOOL_CALL_ARGS,\n            tool_call_id=tool_call_id,\n            delta=chunk + \" \"\n        )\n        await asyncio.sleep(0.2)  # 200ms delay\n\n    # Close JSON arguments\n    yield ToolCallArgsEvent(\n        type=EventType.TOOL_CALL_ARGS,\n        tool_call_id=tool_call_id,\n        delta='\"}'\n    )\n\n    # End first tool call\n    yield ToolCallEndEvent(\n        type=EventType.TOOL_CALL_END,\n        tool_call_id=tool_call_id\n    )\n\n    # Second tool call: confirm_changes\n    tool_call_id_2 = str(uuid.uuid4())\n    tool_call_name_2 = \"confirm_changes\"\n\n    yield ToolCallStartEvent(\n        type=EventType.TOOL_CALL_START,\n        tool_call_id=tool_call_id_2,\n        tool_call_name=tool_call_name_2\n    )\n\n    yield ToolCallArgsEvent(\n        type=EventType.TOOL_CALL_ARGS,\n        tool_call_id=tool_call_id_2,\n        delta=\"{}\"\n    )\n\n    yield ToolCallEndEvent(\n        type=EventType.TOOL_CALL_END,\n        tool_call_id=tool_call_id_2\n    )\n\n\nasync def send_text_message_events():\n    \"\"\"Send simple text message events\"\"\"\n    message_id = str(uuid.uuid4())\n\n    # Start of message\n    yield TextMessageStartEvent(\n        type=EventType.TEXT_MESSAGE_START,\n        message_id=message_id,\n        role=\"assistant\"\n    )\n\n    # Content\n    yield TextMessageContentEvent(\n        type=EventType.TEXT_MESSAGE_CONTENT,\n        message_id=message_id,\n        delta=\"Ok!\"\n    )\n\n    # End of message\n    yield TextMessageEndEvent(\n        type=EventType.TEXT_MESSAGE_END,\n        message_id=message_id\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see: \n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=\"You are a helpful assistant.\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A simple agentic chat flow using LangGraph instead of CrewAI.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Annotation, MessagesAnnotation, StateGraph, Command, START, END } from \"@langchain/langgraph\";\n\nconst AgentStateAnnotation = Annotation.Root({\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  ...MessagesAnnotation.spec,\n});\n\ntype AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig) {\n  /**\n   * Standard chat node based on the ReAct design pattern. It handles:\n   * - The model to use (and binds in CopilotKit actions and the tools defined above)\n   * - The system prompt\n   * - Getting a response from the model\n   * - Handling tool calls\n   *\n   * For more about the ReAct design pattern, see: \n   * https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n   */\n  \n  // 1. Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // 2. Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      // your_tool_here\n    ],\n    {\n      // 2.1 Disable parallel tool calls to avoid race conditions,\n      //     enable this for faster performance if you want to manage\n      //     the complexity of running tool calls in parallel.\n      parallel_tool_calls: false,\n    }\n  );\n\n  // 3. Define the system message by which the chat model will be run\n  const systemMessage = new SystemMessage({\n    content: \"You are a helpful assistant.\"\n  });\n\n  // 4. Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    systemMessage,\n    ...state.messages,\n  ], config);\n\n  // 6. We've handled all tool calls, so we can end the graph.\n  return new Command({\n    goto: END,\n    update: {\n      messages: [response]\n    }\n  })\n}\n\n// Define a new graph  \nconst workflow = new StateGraph(AgentStateAnnotation)\n  .addNode(\"chat_node\", chatNode)\n  .addEdge(START, \"chat_node\");\n\n// Compile the graph\nexport const agenticChatGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::backend_tool_rendering": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"backend_tool_rendering\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  useCopilotAction({\n    name: \"get_weather\",\n    available: \"disabled\",\n    parameters: [{ name: \"location\", type: \"string\", required: true }],\n    render: ({ args, result, status }) => {\n      if (status !== \"complete\") {\n        return (\n          <div className=\" bg-[#667eea] text-white p-4 rounded-lg max-w-md\">\n            <span className=\"animate-spin\">⚙️ Retrieving weather...</span>\n          </div>\n        );\n      }\n\n      const weatherResult: WeatherToolResult = {\n        temperature: result.temperature || 0,\n        conditions: result.conditions || \"clear\",\n        humidity: result.humidity || 0,\n        windSpeed: result.wind_speed || 0,\n        feelsLike: result.feels_like || result.temperature || 0,\n      };\n\n      const themeColor = getThemeColor(weatherResult.conditions);\n\n      return (\n        <WeatherCard\n          location={args.location}\n          themeColor={themeColor}\n          result={weatherResult}\n          status={status || \"complete\"}\n        />\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi! I can look up the weather for you. Just ask!\" }}\n          suggestions={[\n            {\n              title: \"Weather in San Francisco\",\n              message: \"What's the weather like in San Francisco?\",\n            },\n            {\n              title: \"Weather in New York\",\n              message: \"Tell me about the weather in New York.\",\n            },\n            {\n              title: \"Weather in Tokyo\",\n              message: \"How's the weather in Tokyo today?\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\ninterface WeatherToolResult {\n  temperature: number;\n  conditions: string;\n  humidity: number;\n  windSpeed: number;\n  feelsLike: number;\n}\n\nfunction getThemeColor(conditions: string): string {\n  const conditionLower = conditions.toLowerCase();\n  if (conditionLower.includes(\"clear\") || conditionLower.includes(\"sunny\")) {\n    return \"#667eea\";\n  }\n  if (conditionLower.includes(\"rain\") || conditionLower.includes(\"storm\")) {\n    return \"#4A5568\";\n  }\n  if (conditionLower.includes(\"cloud\")) {\n    return \"#718096\";\n  }\n  if (conditionLower.includes(\"snow\")) {\n    return \"#63B3ED\";\n  }\n  return \"#764ba2\";\n}\n\nfunction WeatherCard({\n  location,\n  themeColor,\n  result,\n  status,\n}: {\n  location?: string;\n  themeColor: string;\n  result: WeatherToolResult;\n  status: \"inProgress\" | \"executing\" | \"complete\";\n}) {\n  return (\n    <div\n      data-testid=\"weather-card\"\n      style={{ backgroundColor: themeColor }}\n      className=\"rounded-xl mt-6 mb-4 max-w-md w-full\"\n    >\n      <div className=\"bg-white/20 p-4 w-full\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 data-testid=\"weather-city\" className=\"text-xl font-bold text-white capitalize\">\n              {location}\n            </h3>\n            <p className=\"text-white\">Current Weather</p>\n          </div>\n          <WeatherIcon conditions={result.conditions} />\n        </div>\n\n        <div className=\"mt-4 flex items-end justify-between\">\n          <div className=\"text-3xl font-bold text-white\">\n            <span className=\"\">{result.temperature}° C</span>\n            <span className=\"text-sm text-white/50\">\n              {\" / \"}\n              {((result.temperature * 9) / 5 + 32).toFixed(1)}° F\n            </span>\n          </div>\n          <div className=\"text-sm text-white capitalize\">{result.conditions}</div>\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-white\">\n          <div className=\"grid grid-cols-3 gap-2 text-center\">\n            <div data-testid=\"weather-humidity\">\n              <p className=\"text-white text-xs\">Humidity</p>\n              <p className=\"text-white font-medium\">{result.humidity}%</p>\n            </div>\n            <div data-testid=\"weather-wind\">\n              <p className=\"text-white text-xs\">Wind</p>\n              <p className=\"text-white font-medium\">{result.windSpeed} mph</p>\n            </div>\n            <div data-testid=\"weather-feels-like\">\n              <p className=\"text-white text-xs\">Feels Like</p>\n              <p className=\"text-white font-medium\">{result.feelsLike}°</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction WeatherIcon({ conditions }: { conditions: string }) {\n  if (!conditions) return null;\n\n  if (conditions.toLowerCase().includes(\"clear\") || conditions.toLowerCase().includes(\"sunny\")) {\n    return <SunIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"rain\") ||\n    conditions.toLowerCase().includes(\"drizzle\") ||\n    conditions.toLowerCase().includes(\"snow\") ||\n    conditions.toLowerCase().includes(\"thunderstorm\")\n  ) {\n    return <RainIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"fog\") ||\n    conditions.toLowerCase().includes(\"cloud\") ||\n    conditions.toLowerCase().includes(\"overcast\")\n  ) {\n    return <CloudIcon />;\n  }\n\n  return <CloudIcon />;\n}\n\n// Simple sun icon for the weather card\nfunction SunIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-yellow-200\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"5\" />\n      <path\n        d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"\n        strokeWidth=\"2\"\n        stroke=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nfunction RainIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-blue-200\"\n    >\n      {/* Cloud */}\n      <path\n        d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\"\n        fill=\"currentColor\"\n        opacity=\"0.8\"\n      />\n      {/* Rain drops */}\n      <path\n        d=\"M8 18l2 4M12 18l2 4M16 18l2 4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n}\n\nfunction CloudIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-gray-200\"\n    >\n      <path d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\" fill=\"currentColor\" />\n    </svg>\n  );\n}\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\nfrom requests.api import get\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n\n    tools: List[Any]\n\n\n@tool\ndef get_weather(city: str):\n    return {\n        \"temperature\": 20,\n        \"conditions\": \"sunny\",\n        \"humidity\": 50,\n        \"windSpeed\": 10,\n        \"feelsLike\": 25,\n    }\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4.1-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            get_weather,\n            # your_tool_here\n        ],\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(content=\"You are a helpful assistant.\")\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke(\n        [\n            system_message,\n            *state[\"messages\"],\n        ],\n        config,\n    )\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(goto=END, update={\"messages\": response})\n\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A simple agentic chat flow using LangGraph instead of CrewAI.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Annotation, MessagesAnnotation, StateGraph, Command, START, END } from \"@langchain/langgraph\";\n\nconst AgentStateAnnotation = Annotation.Root({\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  ...MessagesAnnotation.spec,\n});\n\ntype AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig) {\n  /**\n   * Standard chat node based on the ReAct design pattern. It handles:\n   * - The model to use (and binds in CopilotKit actions and the tools defined above)\n   * - The system prompt\n   * - Getting a response from the model\n   * - Handling tool calls\n   *\n   * For more about the ReAct design pattern, see: \n   * https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n   */\n  \n  // 1. Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // 2. Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      // your_tool_here\n    ],\n    {\n      // 2.1 Disable parallel tool calls to avoid race conditions,\n      //     enable this for faster performance if you want to manage\n      //     the complexity of running tool calls in parallel.\n      parallel_tool_calls: false,\n    }\n  );\n\n  // 3. Define the system message by which the chat model will be run\n  const systemMessage = new SystemMessage({\n    content: \"You are a helpful assistant.\"\n  });\n\n  // 4. Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    systemMessage,\n    ...state.messages,\n  ], config);\n\n  // 6. We've handled all tool calls, so we can end the graph.\n  return new Command({\n    goto: END,\n    update: {\n      messages: [response]\n    }\n  })\n}\n\n// Define a new graph  \nconst workflow = new StateGraph(AgentStateAnnotation)\n  .addNode(\"chat_node\", chatNode)\n  .addEdge(START, \"chat_node\");\n\n// Compile the graph\nexport const agenticChatGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI using LangGraph.\n\"\"\"\n\nimport asyncio\nfrom typing import List, Any, Optional, Annotated\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom pydantic import BaseModel, Field\n\nclass Step(BaseModel):\n    \"\"\"\n    A step in a task.\n    \"\"\"\n    description: str = Field(description=\"The text of the step in gerund form\")\n    status: str = Field(description=\"The status of the step, always 'pending'\")\n\n\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\n@tool\ndef generate_task_steps_generative_ui(\n    steps: Annotated[ # pylint: disable=unused-argument\n        List[Step],\n        \"An array of 10 step objects, each containing text and status\"\n    ]\n):\n    \"\"\"\n    Make up 10 steps (only a couple of words per step) that are required for a task.\n    The step should be in gerund form (i.e. Digging hole, opening door, ...).\n    \"\"\"\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    steps: List[dict] = []\n    tools: List[Any]\n\n\nasync def start_node(state: AgentState, config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function `generate_task_steps_generative_ui`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps_generative_ui\",\n        \"tool_argument\": \"steps\",\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            generate_task_steps_generative_ui\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        if tool_call[\"name\"] == \"generate_task_steps_generative_ui\":\n            steps = [\n                {\"description\": step[\"description\"], \"status\": step[\"status\"]}\n                for step in tool_call[\"args\"][\"steps\"]\n            ]\n\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Steps executed.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n            state[\"steps\"] = steps\n\n            # Return Command to route to simulate_task_node\n            for i, _ in enumerate(steps):\n            # simulate executing the step\n                await asyncio.sleep(1)\n                steps[i][\"status\"] = \"completed\"\n                # Update the state with the completed step using config\n                await adispatch_custom_event(\n                    \"manually_emit_state\",\n                    state,\n                    config=config,\n                )\n\n            return Command(\n                goto='start_node',\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"]\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * An example demonstrating agentic generative UI using LangGraph.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { dispatchCustomEvent } from \"@langchain/core/callbacks/dispatch\";\nimport { Annotation, Command, MessagesAnnotation, StateGraph, END } from \"@langchain/langgraph\";\n\n// This tool simulates performing a task on the server.\n// The tool call will be streamed to the frontend as it is being generated.\nconst PERFORM_TASK_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"generate_task_steps_generative_ui\",\n    description: \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in gerund form (i.e. Digging hole, opening door, ...)\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        steps: {\n          type: \"array\",\n          items: {\n            type: \"object\",\n            properties: {\n              description: {\n                type: \"string\",\n                description: \"The text of the step in gerund form\"\n              },\n              status: {\n                type: \"string\",\n                enum: [\"pending\"],\n                description: \"The status of the step, always 'pending'\"\n              }\n            },\n            required: [\"description\", \"status\"]\n          },\n          description: \"An array of 10 step objects, each containing text and status\"\n        }\n      },\n      required: [\"steps\"]\n    }\n  }\n};\n\nconst AgentStateAnnotation = Annotation.Root({\n  steps: Annotation<Array<{ description: string; status: string }>>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  ...MessagesAnnotation.spec,\n});\n\ntype AgentState = typeof AgentStateAnnotation.State;\n\nasync function startFlow(state: AgentState, config?: RunnableConfig) {\n  /**\n   * This is the entry point for the flow.\n   */\n\n  if (!state.steps) {\n    state.steps = [];\n  }\n\n  return {\n    steps: state.steps || []\n  };\n}\n\nasync function chatNode(state: AgentState, config?: RunnableConfig) {\n  /**\n   * Standard chat node.\n   */\n  const systemPrompt = `\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function \\`generate_task_steps_generative_ui\\`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n  \n  // Define config for the model with emit_intermediate_state to stream tool calls to frontend\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"steps\",\n    tool: \"generate_task_steps_generative_ui\",\n    tool_argument: \"steps\",\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      PERFORM_TASK_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  const messages = [...state.messages, response];\n\n  // Extract any tool calls from the response\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n    \n    if (toolCall.name === \"generate_task_steps_generative_ui\") {\n      const steps = toolCall.args.steps.map((step: any) => ({\n        description: step.description,\n        status: step.status\n      }));\n      \n      // Add the tool response to messages\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Steps executed.\",\n        tool_call_id: toolCall.id\n      };\n\n      const updatedMessages = [...messages, toolResponse];\n\n      // Simulate executing the steps\n      for (let i = 0; i < steps.length; i++) {\n        // simulate executing the step\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        steps[i].status = \"completed\";\n        // Update the state with the completed step\n        state.steps = steps;\n        // Emit custom events to update the frontend\n        await dispatchCustomEvent(\"manually_emit_state\", state, config);\n      }\n      \n      return new Command({\n        goto: \"start_flow\",\n        update: {\n          messages: updatedMessages,\n          steps: state.steps\n        }\n      });\n    }\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      steps: state.steps\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph(AgentStateAnnotation)\n  .addNode(\"start_flow\", startFlow)\n  .addNode(\"chat_node\", chatNode)\n  .addEdge(\"__start__\", \"start_flow\")\n  .addEdge(\"start_flow\", \"chat_node\")\n  .addEdge(\"chat_node\", \"__end__\");\n\n// Compile the graph\nexport const agenticGenerativeUiGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA LangGraph implementation of the human-in-the-loop agent.\n\"\"\"\n\nfrom typing import Dict, List, Any, Annotated, Optional\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\nfrom langchain_openai import ChatOpenAI\nfrom pydantic import BaseModel, Field\n\nclass Step(BaseModel):\n    \"\"\"\n    A step in a task.\n    \"\"\"\n    description: str = Field(description=\"The text of the step in imperative form\")\n    status: str = Field(description=\"The status of the step, always 'enabled'\")\n\n@tool\ndef plan_execution_steps(\n    steps: Annotated[ # pylint: disable=unused-argument\n        List[Step],\n        \"An array of 10 step objects, each containing text and status\"\n    ]\n):\n    \"\"\"\n    Make up 10 steps (only a couple of words per step) that are required for a task.\n    The step should be in imperative form (i.e. Dig hole, Open door, ...).\n    \"\"\"\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    steps: List[Dict[str, str]] = []\n    tools: List[Any]\n\nasync def start_node(state: Dict[str, Any], config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize steps list if not exists\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    # Return command to route to chat_node\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node where the agent processes messages and generates responses.\n    If task steps are defined, the user can enable/disable them using interrupts.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant that can perform any task.\n    You MUST call the `plan_execution_steps` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"plan_execution_steps\",\n        \"tool_argument\": \"steps\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            plan_execution_steps\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        if tool_call[\"name\"] == \"plan_execution_steps\":\n            # Get the steps from the tool call\n            steps_raw = tool_call[\"args\"][\"steps\"]\n\n            # Set initial status to \"enabled\" for all steps\n            steps_data = []\n\n            # Handle different potential formats of steps data\n            if isinstance(steps_raw, list):\n                for step in steps_raw:\n                    if isinstance(step, dict) and \"description\" in step:\n                        steps_data.append({\n                            \"description\": step[\"description\"],\n                            \"status\": \"enabled\"\n                        })\n                    elif isinstance(step, str):\n                        steps_data.append({\n                            \"description\": step,\n                            \"status\": \"enabled\"\n                        })\n\n            # If no steps were processed correctly, return to END with the updated messages\n            if not steps_data:\n                return Command(\n                    goto=END,\n                    update={\n                        \"messages\": messages,\n                        \"steps\": state[\"steps\"],\n                    }\n                )\n            # Update steps in state and emit to frontend\n            state[\"steps\"] = steps_data\n\n            # Add a tool response to satisfy OpenAI's requirements\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Task steps generated.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n\n            # Move to the process_steps_node which will handle the interrupt and final response\n            return Command(\n                goto=\"process_steps_node\",\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"],\n                }\n            )\n\n    # If no tool calls or not plan_execution_steps, return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def process_steps_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This node handles the user interrupt for step customization and generates the final response.\n    \"\"\"\n\n    # Check if we already have a user_response in the state\n    # This happens when the node restarts after an interrupt\n    if \"user_response\" in state and state[\"user_response\"]:\n        user_response = state[\"user_response\"]\n    else:\n        # Use LangGraph interrupt to get user input on steps\n        # This will pause execution and wait for user input in the frontend\n        user_response = interrupt({\"steps\": state[\"steps\"]})\n        # Store the user response in state for when the node restarts\n        state[\"user_response\"] = user_response\n\n    # Generate the creative completion response\n    final_prompt = \"\"\"\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    \"\"\"\n\n    final_response = await ChatOpenAI(model=\"gpt-4o\").ainvoke([\n        SystemMessage(content=final_prompt),\n        {\"role\": \"user\", \"content\": user_response}\n    ], config)\n\n    # Add the final response to messages\n    messages = state[\"messages\"] + [final_response]\n\n    # Clear the user_response from state to prepare for future interactions\n    if \"user_response\" in state:\n        state.pop(\"user_response\")\n\n    # Return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.add_node(\"process_steps_node\", process_steps_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"process_steps_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A LangGraph implementation of the human-in-the-loop agent.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Command, interrupt, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\nconst DEFINE_TASK_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"plan_execution_steps\",\n    description: \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        steps: {\n          type: \"array\",\n          items: {\n            type: \"object\",\n            properties: {\n              description: {\n                type: \"string\",\n                description: \"The text of the step in imperative form\"\n              },\n              status: {\n                type: \"string\",\n                enum: [\"enabled\"],\n                description: \"The status of the step, always 'enabled'\"\n              }\n            },\n            required: [\"description\", \"status\"]\n          },\n          description: \"An array of 10 step objects, each containing text and status\"\n        }\n      },\n      required: [\"steps\"]\n    }\n  }\n};\n\nexport const AgentStateAnnotation = Annotation.Root({\n  steps: Annotation<Array<{ description: string; status: string }>>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  tools: Annotation<any[]>(),\n  user_response: Annotation<string | undefined>({\n    reducer: (x, y) => y ?? x,\n    default: () => undefined\n  }),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function startFlow(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * This is the entry point for the flow.\n   */\n\n  // Initialize steps list if not exists\n  if (!state.steps) {\n    state.steps = [];\n  }\n\n  return new Command({\n    goto: \"chat_node\",\n    update: {\n      messages: state.messages,\n      steps: state.steps,\n    }\n  });\n}\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * Standard chat node where the agent processes messages and generates responses.\n   * If task steps are defined, the user can enable/disable them using interrupts.\n   */\n  const systemPrompt = `\n    You are a helpful assistant that can perform any task.\n    You MUST call the \\`plan_execution_steps\\` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o-mini\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"steps\",\n    tool: \"plan_execution_steps\",\n    tool_argument: \"steps\"\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      DEFINE_TASK_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model and generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  // Update messages with the response\n  const messages = [...state.messages, response];\n  \n  // Handle tool calls\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n\n    if (toolCall.name === \"plan_execution_steps\") {\n      // Get the steps from the tool call\n      const stepsRaw = toolCall.args.steps || [];\n      \n      // Set initial status to \"enabled\" for all steps\n      const stepsData: Array<{ description: string; status: string }> = [];\n      \n      // Handle different potential formats of steps data\n      if (Array.isArray(stepsRaw)) {\n        for (const step of stepsRaw) {\n          if (typeof step === 'object' && step.description) {\n            stepsData.push({\n              description: step.description,\n              status: \"enabled\"\n            });\n          } else if (typeof step === 'string') {\n            stepsData.push({\n              description: step,\n              status: \"enabled\"\n            });\n          }\n        }\n      }\n      \n      // If no steps were processed correctly, return to END with the updated messages\n      if (stepsData.length === 0) {\n        return new Command({\n          goto: END,\n          update: {\n            messages: messages,\n            steps: state.steps,\n          }\n        });\n      }\n\n      // Update steps in state and emit to frontend\n      state.steps = stepsData;\n      \n      // Add a tool response to satisfy OpenAI's requirements\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Task steps generated.\",\n        tool_call_id: toolCall.id\n      };\n      \n      const updatedMessages = [...messages, toolResponse];\n\n      // Move to the process_steps_node which will handle the interrupt and final response\n      return new Command({\n        goto: \"process_steps_node\",\n        update: {\n          messages: updatedMessages,\n          steps: state.steps,\n        }\n      });\n    }\n  }\n  \n  // If no tool calls or not plan_execution_steps, return to END with the updated messages\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      steps: state.steps,\n    }\n  });\n}\n\nasync function processStepsNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * This node handles the user interrupt for step customization and generates the final response.\n   */\n\n  let userResponse: string;\n\n  // Check if we already have a user_response in the state\n  // This happens when the node restarts after an interrupt\n  if (state.user_response) {\n    userResponse = state.user_response;\n  } else {\n    // Use LangGraph interrupt to get user input on steps\n    // This will pause execution and wait for user input in the frontend\n    userResponse = interrupt({ steps: state.steps });\n    // Store the user response in state for when the node restarts\n    state.user_response = userResponse;\n  }\n  \n  // Generate the creative completion response\n  const finalPrompt = `\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    `;\n  \n  const finalResponse = await new ChatOpenAI({ model: \"gpt-4o\" }).invoke([\n    new SystemMessage({ content: finalPrompt }),\n    { role: \"user\", content: userResponse }\n  ], config);\n\n  // Add the final response to messages\n  const messages = [...state.messages, finalResponse];\n  \n  // Clear the user_response from state to prepare for future interactions\n  const newState = { ...state };\n  delete newState.user_response;\n  \n  // Return to END with the updated messages\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      steps: state.steps,\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph(AgentStateAnnotation);\n\n// Add nodes\nworkflow.addNode(\"start_flow\", startFlow);\nworkflow.addNode(\"chat_node\", chatNode);\nworkflow.addNode(\"process_steps_node\", processStepsNode);\n\n// Add edges\nworkflow.setEntryPoint(\"start_flow\");\nworkflow.addEdge(START, \"start_flow\");\nworkflow.addEdge(\"start_flow\", \"chat_node\");\nworkflow.addEdge(\"process_steps_node\", END);\n\n// Add conditional edges from chat_node\nworkflow.addConditionalEdges(\n  \"chat_node\",\n  (state: AgentState) => {\n    // This would be determined by the Command returned from chat_node\n    // For now, we'll assume the logic is handled in the Command's goto property\n    return \"continue\";\n  },\n  {\n    \"process_steps_node\": \"process_steps_node\",\n    \"continue\": END,\n  }\n);\n\n// Compile the graph\nexport const humanInTheLoopGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n  const chatTitle = \"AI Document Editor\";\n  const chatDescription = \"Ask me to create or edit a document\";\n  const initialLabel = \"Hi 👋 How can I help with your document?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  suggestions={[\n                    {\n                      title: \"Write a pirate story\",\n                      message: \"Please write a story about a pirate named Candy Beard.\",\n                    },\n                    {\n                      title: \"Write a mermaid story\",\n                      message: \"Please write a story about a mermaid named Luna.\",\n                    },\n                    { title: \"Add character\", message: \"Please add a character named Courage.\" },\n                  ]}\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            suggestions={[\n              {\n                title: \"Write a pirate story\",\n                message: \"Please write a story about a pirate named Candy Beard.\",\n              },\n              {\n                title: \"Write a mermaid story\",\n                message: \"Please write a story about a mermaid named Luna.\",\n              },\n              { title: \"Add character\", message: \"Please add a character named Courage.\" },\n            ]}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n        <DocumentEditor />\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction(\n    {\n      name: \"confirm_changes\",\n      renderAndWaitForResponse: ({ args, respond, status }) => (\n        <ConfirmChanges\n          args={args}\n          respond={respond}\n          status={status}\n          onReject={() => {\n            editor?.commands.setContent(fromMarkdown(currentDocument));\n            setAgentState({ document: currentDocument });\n          }}\n          onConfirm={() => {\n            editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n            setCurrentDocument(agentState?.document || \"\");\n            setAgentState({ document: agentState?.document || \"\" });\n          }}\n        />\n      ),\n    },\n    [agentState?.document],\n  );\n\n  // Action to write the document.\n  useCopilotAction(\n    {\n      name: \"write_document\",\n      description: `Present the proposed changes to the user for review`,\n      parameters: [\n        {\n          name: \"document\",\n          type: \"string\",\n          description: \"The full updated document in markdown format\",\n        },\n      ],\n      renderAndWaitForResponse({ args, status, respond }) {\n        if (status === \"executing\") {\n          return (\n            <ConfirmChanges\n              args={args}\n              respond={respond}\n              status={status}\n              onReject={() => {\n                editor?.commands.setContent(fromMarkdown(currentDocument));\n                setAgentState({ document: currentDocument });\n              }}\n              onConfirm={() => {\n                editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n                setCurrentDocument(agentState?.document || \"\");\n                setAgentState({ document: agentState?.document || \"\" });\n              }}\n            />\n          );\n        }\n        return <></>;\n      },\n    },\n    [agentState?.document],\n  );\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div\n      data-testid=\"confirm-changes-modal\"\n      className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\"\n    >\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            data-testid=\"reject-button\"\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            data-testid=\"confirm-button\"\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div\n            data-testid=\"status-display\"\n            className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\"\n          >\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of predictive state updates using LangGraph.\n\"\"\"\n\nimport uuid\nfrom typing import List, Any, Optional\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\nfrom langchain_openai import ChatOpenAI\n\n@tool\ndef write_document_local(document: str): # pylint: disable=unused-argument\n    \"\"\"\n    Write a document. Use markdown formatting to format the document.\n    It's good to format the document extensively so it's easy to read.\n    You can use all kinds of markdown.\n    However, do not use italic or strike-through formatting, it's reserved for another purpose.\n    You MUST write the full document, even when changing only a few words.\n    When making edits to the document, try to make them minimal - do not change every word.\n    Keep stories SHORT!\n    \"\"\"\n    return document\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n    tools: List[Any]\n\n\nasync def start_node(state: AgentState, config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n    return Command(\n        goto=\"chat_node\"\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n\n    system_prompt = f\"\"\"\n    You are a helpful assistant for writing documents.\n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message.\n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n {state.get('document')}\\n-----\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"document\",\n        \"tool\": \"write_document_local\",\n        \"tool_argument\": \"document\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            write_document_local\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"write_document_local\":\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Document written.\",\n                \"tool_call_id\": tool_call_id\n            }\n\n            # Add confirmation tool call\n            confirm_tool_call = {\n                \"role\": \"assistant\",\n                \"content\": \"\",\n                \"tool_calls\": [{\n                    \"id\": str(uuid.uuid4()),\n                    \"function\": {\n                        \"name\": \"confirm_changes\",\n                        \"arguments\": \"{}\"\n                    }\n                }]\n            }\n\n            messages = messages + [tool_response, confirm_tool_call]\n\n            # Return Command to route to end\n            return Command(\n                goto=END,\n                update={\n                    \"messages\": messages,\n                    \"document\": tool_call_args[\"document\"]\n                }\n            )\n\n    # If no tool was called, go to end\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A demo of predictive state updates using LangGraph.\n */\n\nimport { v4 as uuidv4 } from \"uuid\";\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Command, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\nconst WRITE_DOCUMENT_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"write_document_local\",\n    description: [\n      \"Write a document. Use markdown formatting to format the document.\",\n      \"It's good to format the document extensively so it's easy to read.\",\n      \"You can use all kinds of markdown.\",\n      \"However, do not use italic or strike-through formatting, it's reserved for another purpose.\",\n      \"You MUST write the full document, even when changing only a few words.\",\n      \"When making edits to the document, try to make them minimal - do not change every word.\",\n      \"Keep stories SHORT!\"\n    ].join(\" \"),\n    parameters: {\n      type: \"object\",\n      properties: {\n        document: {\n          type: \"string\",\n          description: \"The document to write\"\n        },\n      },\n    }\n  }\n};\n\nexport const AgentStateAnnotation = Annotation.Root({\n  document: Annotation<string | undefined>({\n    reducer: (x, y) => y ?? x,\n    default: () => undefined\n  }),\n  tools: Annotation<any[]>(),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * Standard chat node.\n   */\n\n  const systemPrompt = `\n    You are a helpful assistant for writing documents.\n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message.\n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n ${state.document || ''}\\n-----\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  // Define config for the model with emit_intermediate_state to stream tool calls to frontend\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"document\",\n    tool: \"write_document_local\",\n    tool_argument: \"document\"\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      WRITE_DOCUMENT_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  // Update messages with the response\n  const messages = [...state.messages, response];\n\n  // Extract any tool calls from the response\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n\n    if (toolCall.name === \"write_document_local\") {\n      // Add the tool response to messages\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Document written.\",\n        tool_call_id: toolCall.id\n      };\n\n      // Add confirmation tool call\n      const confirmToolCall = {\n        role: \"assistant\" as const,\n        content: \"\",\n        tool_calls: [{\n          id: uuidv4(),\n          type: \"function\" as const,\n          function: {\n            name: \"confirm_changes\",\n            arguments: \"{}\"\n          }\n        }]\n      };\n\n      const updatedMessages = [...messages, toolResponse, confirmToolCall];\n\n      // Return Command to route to end\n      return new Command({\n        goto: END,\n        update: {\n          messages: updatedMessages,\n          document: toolCall.args.document\n        }\n      });\n    }\n  }\n\n  // If no tool was called, go to end\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph(AgentStateAnnotation);\n\n// Add nodes\nworkflow.addNode(\"chat_node\", chatNode);\n\n// Add edges\nworkflow.addEdge(START, \"chat_node\");\nworkflow.addEdge(\"chat_node\", END);\n\n// Compile the graph\nexport const predictiveStateUpdatesGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit using LangGraph.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import Dict, List, Any, Optional\nimport os\n\n# LangGraph imports\nfrom pydantic import BaseModel, Field\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\nclass SpecialPreferences(str, Enum):\n    \"\"\"\n    Special preferences for the recipe.\n    \"\"\"\n    HIGH_PROTEIN = \"High Protein\"\n    LOW_CARB = \"Low Carb\"\n    SPICY = \"Spicy\"\n    BUDGET_FRIENDLY = \"Budget-Friendly\"\n    ONE_POT_MEAL = \"One-Pot Meal\"\n    VEGETARIAN = \"Vegetarian\"\n    VEGAN = \"Vegan\"\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\nclass Ingredient(BaseModel):\n    \"\"\"\n    An ingredient.\n    \"\"\"\n    icon: str = Field(\n        description=\"Icon: the actual emoji like 🥕\"\n    )\n    name: str = Field(description=\"The name of the ingredient\")\n    amount: str = Field(description=\"The amount of the ingredient\")\n\nclass Recipe(BaseModel):\n    \"\"\"\n    A recipe.\n    \"\"\"\n    skill_level: SkillLevel = \\\n        Field(description=\"The skill level required for the recipe\")\n    special_preferences: List[SpecialPreferences] = \\\n        Field(description=\"A list of special preferences for the recipe\")\n    cooking_time: CookingTime = \\\n        Field(description=\"The cooking time of the recipe\")\n    ingredients: List[Ingredient] = \\\n        Field(description=\n              \"\"\"Entire list of ingredients for the recipe, including the new ingredients\n              and the ones that are already in the recipe: Icon: the actual emoji like 🥕,\n              name and amount.\n              Like so: 🥕 Carrots (250g)\"\"\"\n        )\n    instructions: List[str] = \\\n        Field(description=\n              \"\"\"Entire list of instructions for the recipe,\n              including the new instructions and the ones that are already there\"\"\"\n        )\n    changes: str = \\\n        Field(description=\"A description of the changes made to the recipe\")\n\nclass GenerateRecipeArgs(BaseModel): # pylint: disable=missing-class-docstring\n    recipe: Recipe\n\n@tool(args_schema=GenerateRecipeArgs)\ndef generate_recipe(recipe: Recipe): # pylint: disable=unused-argument\n    \"\"\"\n    Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it.\n    Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\n    \"\"\"\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Dict[str, Any]] = None\n    tools: List[Any]\n\n\nasync def start_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize recipe if not exists\n    if \"recipe\" not in state or state[\"recipe\"] is None:\n        state[\"recipe\"] = {\n            \"skill_level\": SkillLevel.BEGINNER.value,\n            \"special_preferences\": [],\n            \"cooking_time\": CookingTime.FIFTEEN_MIN.value,\n            \"ingredients\": [{\"icon\": \"🍴\", \"name\": \"Sample Ingredient\", \"amount\": \"1 unit\"}],\n            \"instructions\": [\"First step instruction\"]\n        }\n        # Emit the initial state to ensure it's properly shared with the frontend\n        await adispatch_custom_event(\n            \"manually_emit_intermediate_state\",\n            state,\n            config=config,\n        )\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    # Create a safer serialization of the recipe\n    recipe_json = \"No recipe yet\"\n    if \"recipe\" in state and state[\"recipe\"] is not None:\n        try:\n            recipe_json = json.dumps(state[\"recipe\"], indent=2)\n        except Exception as e: # pylint: disable=broad-exception-caught\n            recipe_json = f\"Error serializing recipe: {str(e)}\"\n\n    system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: {recipe_json}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"recipe\",\n        \"tool\": \"generate_recipe\",\n        \"tool_argument\": \"recipe\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            generate_recipe\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        # Check if args is already a dict or needs to be parsed\n        tool_call_args = (tool_call[\"args\"]\n                          if isinstance(tool_call[\"args\"], dict)\n                          else json.loads(tool_call[\"args\"]))\n\n        if tool_call[\"name\"] == \"generate_recipe\":\n            # Update recipe state with tool_call_args\n            recipe_data = tool_call_args[\"recipe\"]\n\n            # If we have an existing recipe, update it\n            if \"recipe\" in state and state[\"recipe\"] is not None:\n                recipe = state[\"recipe\"]\n                for key, value in recipe_data.items():\n                    if value is not None:  # Only update fields that were provided\n                        recipe[key] = value\n            else:\n                # Create a new recipe\n                recipe = {\n                    \"skill_level\": recipe_data.get(\"skill_level\", SkillLevel.BEGINNER.value),\n                    \"special_preferences\": recipe_data.get(\"special_preferences\", []),\n                    \"cooking_time\": recipe_data.get(\"cooking_time\", CookingTime.FIFTEEN_MIN.value),\n                    \"ingredients\": recipe_data.get(\"ingredients\", []),\n                    \"instructions\": recipe_data.get(\"instructions\", [])\n                }\n\n            # Add tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Recipe generated.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n\n            # Explicitly emit the updated state to ensure it's shared with frontend\n            state[\"recipe\"] = recipe\n            await adispatch_custom_event(\n                \"manually_emit_intermediate_state\",\n                state,\n                config=config,\n            )\n\n            # Return command with updated recipe\n            return Command(\n                goto=\"start_node\",\n                update={\n                    \"messages\": messages,\n                    \"recipe\": recipe\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A demo of shared state between the agent and CopilotKit using LangGraph.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { dispatchCustomEvent } from \"@langchain/core/callbacks/dispatch\";\nimport { Command, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\"\n}\n\nenum SpecialPreferences {\n  HIGH_PROTEIN = \"High Protein\",\n  LOW_CARB = \"Low Carb\",\n  SPICY = \"Spicy\",\n  BUDGET_FRIENDLY = \"Budget-Friendly\",\n  ONE_POT_MEAL = \"One-Pot Meal\",\n  VEGETARIAN = \"Vegetarian\",\n  VEGAN = \"Vegan\"\n}\n\nenum CookingTime {\n  FIVE_MIN = \"5 min\",\n  FIFTEEN_MIN = \"15 min\",\n  THIRTY_MIN = \"30 min\",\n  FORTY_FIVE_MIN = \"45 min\",\n  SIXTY_PLUS_MIN = \"60+ min\"\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  skill_level: SkillLevel;\n  special_preferences: SpecialPreferences[];\n  cooking_time: CookingTime;\n  ingredients: Ingredient[];\n  instructions: string[];\n  changes?: string;\n}\n\nconst GENERATE_RECIPE_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"generate_recipe\",\n    description: \"Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it. Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        recipe: {\n          type: \"object\",\n          properties: {\n            skill_level: {\n              type: \"string\",\n              enum: Object.values(SkillLevel),\n              description: \"The skill level required for the recipe\"\n            },\n            special_preferences: {\n              type: \"array\",\n              items: {\n                type: \"string\",\n                enum: Object.values(SpecialPreferences)\n              },\n              description: \"A list of special preferences for the recipe\"\n            },\n            cooking_time: {\n              type: \"string\",\n              enum: Object.values(CookingTime),\n              description: \"The cooking time of the recipe\"\n            },\n            ingredients: {\n              type: \"array\",\n              items: {\n                type: \"object\",\n                properties: {\n                  icon: { type: \"string\", description: \"The icon emoji (not emoji code like '\\\\u1f35e', but the actual emoji like 🥕) of the ingredient\" },\n                  name: { type: \"string\" },\n                  amount: { type: \"string\" }\n                }\n              },\n              description: \"Entire list of ingredients for the recipe, including the new ingredients and the ones that are already in the recipe\"\n            },\n            instructions: {\n              type: \"array\",\n              items: { type: \"string\" },\n              description: \"Entire list of instructions for the recipe, including the new instructions and the ones that are already there\"\n            },\n            changes: {\n              type: \"string\",\n              description: \"A description of the changes made to the recipe\"\n            }\n          },\n        }\n      },\n      required: [\"recipe\"]\n    }\n  }\n};\n\nexport const AgentStateAnnotation = Annotation.Root({\n  recipe: Annotation<Recipe | undefined>(),\n  tools: Annotation<any[]>(),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function startFlow(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * This is the entry point for the flow.\n   */\n\n  // Initialize recipe if not exists\n  if (!state.recipe) {\n    state.recipe = {\n      skill_level: SkillLevel.BEGINNER,\n      special_preferences: [],\n      cooking_time: CookingTime.FIFTEEN_MIN,\n      ingredients: [{ icon: \"🍴\", name: \"Sample Ingredient\", amount: \"1 unit\" }],\n      instructions: [\"First step instruction\"]\n    };\n    // Emit the initial state to ensure it's properly shared with the frontend\n    await dispatchCustomEvent(\"manually_emit_intermediate_state\", state, config);\n  }\n  \n  return new Command({\n    goto: \"chat_node\",\n    update: {\n      messages: state.messages,\n      recipe: state.recipe\n    }\n  });\n}\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * Standard chat node.\n   */\n  // Create a safer serialization of the recipe\n  let recipeJson = \"No recipe yet\";\n  if (state.recipe) {\n    try {\n      recipeJson = JSON.stringify(state.recipe, null, 2);\n    } catch (e) {\n      recipeJson = `Error serializing recipe: ${e}`;\n    }\n  }\n\n  const systemPrompt = `You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: ${recipeJson}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o-mini\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"recipe\",\n    tool: \"generate_recipe\",\n    tool_argument: \"recipe\"\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      GENERATE_RECIPE_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model and generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  // Update messages with the response\n  const messages = [...state.messages, response];\n  \n  // Handle tool calls\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n    \n    if (toolCall.name === \"generate_recipe\") {\n      // Update recipe state with tool_call_args\n      const recipeData = toolCall.args.recipe;\n      let recipe: Recipe;\n      // If we have an existing recipe, update it\n      if (state.recipe) {\n        recipe = { ...state.recipe };\n        for (const [key, value] of Object.entries(recipeData)) {\n          if (value !== null && value !== undefined) {  // Only update fields that were provided\n            (recipe as any)[key] = value;\n          }\n        }\n      } else {\n        // Create a new recipe\n        recipe = {\n          skill_level: recipeData.skill_level || SkillLevel.BEGINNER,\n          special_preferences: recipeData.special_preferences || [],\n          cooking_time: recipeData.cooking_time || CookingTime.FIFTEEN_MIN,\n          ingredients: recipeData.ingredients || [],\n          instructions: recipeData.instructions || []\n        };\n      }\n      \n      // Add tool response to messages\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Recipe generated.\",\n        tool_call_id: toolCall.id\n      };\n      \n      const updatedMessages = [...messages, toolResponse];\n      \n      // Explicitly emit the updated state to ensure it's shared with frontend\n      state.recipe = recipe;\n      await dispatchCustomEvent(\"manually_emit_intermediate_state\", state, config);\n      \n      // Return command with updated recipe\n      return new Command({\n        goto: \"start_flow\",\n        update: {\n          messages: updatedMessages,\n          recipe: recipe\n        }\n      });\n    }\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      recipe: state.recipe\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph<AgentState>(AgentStateAnnotation);\n\n// Add nodes\nworkflow.addNode(\"start_flow\", startFlow);\nworkflow.addNode(\"chat_node\", chatNode);\n\n// Add edges\nworkflow.setEntryPoint(\"start_flow\");\nworkflow.addEdge(START, \"start_flow\");\nworkflow.addEdge(\"start_flow\", \"chat_node\");\nworkflow.addEdge(\"chat_node\", END);\n\n// Compile the graph\nexport const sharedStateGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI using LangGraph.\n\"\"\"\n\nimport os\nfrom typing import Any, List\nfrom typing_extensions import Literal\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.prebuilt import ToolNode\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig) -> Command[Literal[\"tool_node\", \"__end__\"]]:\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    model_with_tools = model.bind_tools(\n        [\n            *state.get(\"tools\", []), # bind tools defined by ag-ui\n        ],\n        parallel_tool_calls=False,\n    )\n\n    system_message = SystemMessage(\n        content=f\"Help the user with writing Haikus. If the user asks for a haiku, use the generate_haiku tool to display the haiku to the user.\"\n    )\n\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": [response],\n        }\n    )\n\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\n# This is required even though we don't have any backend tools to pass in.\nworkflow.add_node(\"tool_node\", ToolNode(tools=[]))\nworkflow.set_entry_point(\"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * An example demonstrating tool-based generative UI using LangGraph.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Command, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\n\nexport const AgentStateAnnotation = Annotation.Root({\n  tools: Annotation<any[]>(),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools || []\n    ],\n    { parallel_tool_calls: false }\n  );\n\n  const systemMessage = new SystemMessage({\n     content: 'Help the user with writing Haikus. If the user asks for a haiku, use the generate_haiku tool to display the haiku to the user.'\n  });\n\n  const response = await modelWithTools.invoke([\n    systemMessage,\n    ...state.messages,\n  ], config);\n\n  return new Command({\n    goto: END,\n    update: {\n      messages: [response]\n    }\n  });\n}\n\nconst workflow = new StateGraph<AgentState>(AgentStateAnnotation);\nworkflow.addNode(\"chat_node\", chatNode);\n\nworkflow.addEdge(START, \"chat_node\");\n\nexport const toolBasedGenerativeUiGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::agentic_chat_reasoning": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat_reasoning\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  model: string;\n}\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n  const { state: agentState, setState: setAgentState } = useCoAgent<AgentState>({\n    name: \"agentic_chat_reasoning\",\n    initialState: {\n      model: \"OpenAI\",\n    },\n  });\n\n  // Initialize model if not set\n  const selectedModel = agentState?.model || \"OpenAI\";\n\n  const handleModelChange = (model: string) => {\n    setAgentState({ model });\n  };\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n    },\n  });\n\n  return (\n    <div className=\"flex flex-col h-full w-full\" style={{ background }}>\n      {/* Reasoning Model Dropdown */}\n      <div className=\"h-[65px] border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"h-full flex items-center justify-center\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n              Reasoning Model:\n            </span>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" className=\"w-[140px] justify-between\">\n                  {selectedModel}\n                  <ChevronDown className=\"h-4 w-4 opacity-50\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent className=\"w-[140px]\">\n                <DropdownMenuLabel>Select Model</DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem onClick={() => handleModelChange(\"OpenAI\")}>\n                  OpenAI\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => handleModelChange(\"Anthropic\")}>\n                  Anthropic\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => handleModelChange(\"Gemini\")}>\n                  Gemini\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </div>\n\n      {/* Chat Container */}\n      <div className=\"flex-1 flex justify-center items-center p-4\">\n        <div className=\"w-8/10 h-full rounded-lg\">\n          <CopilotChat\n            className=\"h-full rounded-2xl\"\n            labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Reasoning\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_openai import ChatOpenAI\nfrom langchain_anthropic import ChatAnthropic\nfrom langchain_google_genai import ChatGoogleGenerativeAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\nfrom langgraph.checkpoint.memory import MemorySaver\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n    tools: List[Any]\n    model: str\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"o3\")\n    if state[\"model\"] == \"Anthropic\":\n        model = ChatAnthropic(\n            model=\"claude-sonnet-4-20250514\",\n            thinking={\"type\": \"enabled\", \"budget_tokens\": 2000}\n        )\n    elif state[\"model\"] == \"Gemini\":\n        model = ChatGoogleGenerativeAI(model=\"gemini-2.5-pro\", thinking_budget=1024)\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=\"You are a helpful assistant.\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()",
      "language": "python",
      "type": "file"
    },
    {}
  ],
  "langgraph::subgraphs": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SubgraphsProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\n// Travel planning data types\ninterface Flight {\n  airline: string;\n  arrival: string;\n  departure: string;\n  duration: string;\n  price: string;\n}\n\ninterface Hotel {\n  location: string;\n  name: string;\n  price_per_night: string;\n  rating: string;\n}\n\ninterface Experience {\n  name: string;\n  description: string;\n  location: string;\n  type: string;\n}\n\ninterface Itinerary {\n  hotel?: Hotel;\n  flight?: Flight;\n  experiences?: Experience[];\n}\n\ntype AvailableAgents = 'flights' | 'hotels' | 'experiences' | 'supervisor'\n\ninterface TravelAgentState {\n  experiences: Experience[],\n  flights: Flight[],\n  hotels: Hotel[],\n  itinerary: Itinerary\n  planning_step: string\n  active_agent: AvailableAgents\n}\n\nconst INITIAL_STATE: TravelAgentState = {\n  itinerary: {},\n  experiences: [],\n  flights: [],\n  hotels: [],\n  planning_step: \"start\",\n  active_agent: 'supervisor'\n};\n\ninterface InterruptEvent<TAgent extends AvailableAgents> {\n  message: string;\n  options: TAgent extends 'flights' ? Flight[] : TAgent extends 'hotels' ? Hotel[] : never,\n  recommendation: TAgent extends 'flights' ? Flight : TAgent extends 'hotels' ? Hotel : never,\n  agent: TAgent\n}\n\nfunction InterruptHumanInTheLoop<TAgent extends AvailableAgents>({\n  event,\n  resolve,\n}: {\n  event: { value: InterruptEvent<TAgent> };\n  resolve: (value: string) => void;\n}) {\n  const { message, options, agent, recommendation } = event.value;\n\n  // Format agent name with emoji\n  const formatAgentName = (agent: string) => {\n    switch (agent) {\n      case 'flights': return 'Flights Agent';\n      case 'hotels': return 'Hotels Agent';\n      case 'experiences': return 'Experiences Agent';\n      default: return `${agent} Agent`;\n    }\n  };\n\n  const handleOptionSelect = (option: any) => {\n    resolve(JSON.stringify(option));\n  };\n\n  return (\n    <div className=\"interrupt-container\">\n      <p>{formatAgentName(agent)}: {message}</p>\n\n      <div className=\"interrupt-options\">\n        {options.map((opt, idx) => {\n          if ('airline' in opt) {\n            const isRecommended = (recommendation as Flight).airline === opt.airline;\n            // Flight options\n            return (\n              <button\n                key={idx}\n                className={`option-card flight-option ${isRecommended ? 'recommended' : ''}`}\n                onClick={() => handleOptionSelect(opt)}\n              >\n                {isRecommended && <span className=\"recommendation-badge\">⭐ Recommended</span>}\n                <div className=\"option-header\">\n                  <span className=\"airline-name\">{opt.airline}</span>\n                  <span className=\"price\">{opt.price}</span>\n                </div>\n                <div className=\"route-info\">\n                  {opt.departure} → {opt.arrival}\n                </div>\n                <div className=\"duration-info\">\n                  {opt.duration}\n                </div>\n              </button>\n            );\n          }\n          const isRecommended = (recommendation as Hotel).name === opt.name;\n\n          // Hotel options\n          return (\n            <button\n              key={idx}\n              className={`option-card hotel-option ${isRecommended ? 'recommended' : ''}`}\n              onClick={() => handleOptionSelect(opt)}\n            >\n              {isRecommended && <span className=\"recommendation-badge\">⭐ Recommended</span>}\n              <div className=\"option-header\">\n                <span className=\"hotel-name\">{opt.name}</span>\n                <span className=\"rating\">{opt.rating}</span>\n              </div>\n              <div className=\"location-info\">\n                📍 {opt.location}\n              </div>\n              <div className=\"price-info\">\n                {opt.price_per_night}\n              </div>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  )\n}\n\nexport default function Subgraphs({ params }: SubgraphsProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const {\n    isChatOpen,\n    setChatHeight,\n    setIsChatOpen,\n    isDragging,\n    chatHeight,\n    handleDragStart\n  } = useMobileChat(defaultChatHeight);\n\n  const chatTitle = 'Travel Planning Assistant';\n  const chatDescription = 'Plan your perfect trip with AI specialists';\n  const initialLabel = 'Hi! ✈️ Ready to plan an amazing trip? Try saying \"Plan a trip to Paris\" or \"Find me flights to Tokyo\"';\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"subgraphs\"\n    >\n      <div className=\"travel-planner-container\">\n        <TravelPlanner />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight);\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div className={`transform transition-transform duration-300 ${isChatOpen ? 'rotate-180' : ''}`}>\n                  <svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? 'translate-y-0' : 'translate-y-full'\n              } ${isDragging ? 'transition-none' : ''}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: 'env(safe-area-inset-bottom)'\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotSidebar\n                  defaultOpen={true}\n                  labels={{\n                    title: chatTitle,\n                    initial: initialLabel,\n                  }}\n                  clickOutsideToClose={false}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div\n                className=\"fixed inset-0 z-30\"\n                onClick={() => setIsChatOpen(false)}\n              />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction TravelPlanner() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, nodeName } = useCoAgent<TravelAgentState>({\n    name: \"subgraphs\",\n    initialState: INITIAL_STATE,\n    config: {\n      streamSubgraphs: true,\n    }\n  });\n\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n\n  // Current itinerary strip\n  const ItineraryStrip = () => {\n    const selectedFlight = agentState?.itinerary?.flight;\n    const selectedHotel = agentState?.itinerary?.hotel;\n    const hasExperiences = agentState?.experiences?.length > 0;\n\n    return (\n      <div className=\"itinerary-strip\">\n        <div className=\"itinerary-label\">Current Itinerary:</div>\n        <div className=\"itinerary-items\">\n          <div className=\"itinerary-item\">\n            <span className=\"item-icon\">📍</span>\n            <span>Amsterdam → San Francisco</span>\n          </div>\n          {selectedFlight && (\n            <div className=\"itinerary-item\" data-testid=\"selected-flight\">\n              <span className=\"item-icon\">✈️</span>\n              <span>{selectedFlight.airline} - {selectedFlight.price}</span>\n            </div>\n          )}\n          {selectedHotel && (\n            <div className=\"itinerary-item\" data-testid=\"selected-hotel\">\n              <span className=\"item-icon\">🏨</span>\n              <span>{selectedHotel.name}</span>\n            </div>\n          )}\n          {hasExperiences && (\n            <div className=\"itinerary-item\">\n              <span className=\"item-icon\">🎯</span>\n              <span>{agentState.experiences.length} experiences planned</span>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // Compact agent status\n  const AgentStatus = () => {\n    let activeAgent = 'supervisor';\n    if (nodeName?.includes('flights_agent')) {\n      activeAgent = 'flights';\n    }\n    if (nodeName?.includes('hotels_agent')) {\n      activeAgent = 'hotels';\n    }\n    if (nodeName?.includes('experiences_agent')) {\n      activeAgent = 'experiences';\n    }\n    return (\n      <div className=\"agent-status\">\n        <div className=\"status-label\">Active Agent:</div>\n        <div className=\"agent-indicators\">\n          <div className={`agent-indicator ${activeAgent === 'supervisor' ? 'active' : ''}`} data-testid=\"supervisor-indicator\">\n            <span>👨‍💼</span>\n            <span>Supervisor</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'flights' ? 'active' : ''}`} data-testid=\"flights-agent-indicator\">\n            <span>✈️</span>\n            <span>Flights</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'hotels' ? 'active' : ''}`} data-testid=\"hotels-agent-indicator\">\n            <span>🏨</span>\n            <span>Hotels</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'experiences' ? 'active' : ''}`} data-testid=\"experiences-agent-indicator\">\n            <span>🎯</span>\n            <span>Experiences</span>\n          </div>\n        </div>\n      </div>\n    )\n  };\n\n  // Travel details component\n  const TravelDetails = () => (\n    <div className=\"travel-details\">\n      <div className=\"details-section\">\n        <h4>✈️ Flight Options</h4>\n        <div className=\"detail-items\">\n          {agentState?.flights?.length > 0 ? (\n            agentState.flights.map((flight, index) => (\n              <div key={index} className=\"detail-item\">\n                <strong>{flight.airline}:</strong>\n                <span>{flight.departure} → {flight.arrival} ({flight.duration}) - {flight.price}</span>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No flights found yet</p>\n          )}\n          {agentState?.itinerary?.flight && (\n            <div className=\"detail-tips\">\n              <strong>Selected:</strong> {agentState.itinerary.flight.airline} - {agentState.itinerary.flight.price}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"details-section\">\n        <h4>🏨 Hotel Options</h4>\n        <div className=\"detail-items\">\n          {agentState?.hotels?.length > 0 ? (\n            agentState.hotels.map((hotel, index) => (\n              <div key={index} className=\"detail-item\">\n                <strong>{hotel.name}:</strong>\n                <span>{hotel.location} - {hotel.price_per_night} ({hotel.rating})</span>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No hotels found yet</p>\n          )}\n          {agentState?.itinerary?.hotel && (\n            <div className=\"detail-tips\">\n              <strong>Selected:</strong> {agentState.itinerary.hotel.name} - {agentState.itinerary.hotel.price_per_night}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"details-section\">\n        <h4>🎯 Experiences</h4>\n        <div className=\"detail-items\">\n          {agentState?.experiences?.length > 0 ? (\n            agentState.experiences.map((experience, index) => (\n              <div key={index} className=\"activity-item\">\n                <div className=\"activity-name\">{experience.name}</div>\n                <div className=\"activity-category\">{experience.type}</div>\n                <div className=\"activity-description\">{experience.description}</div>\n                <div className=\"activity-meta\">Location: {experience.location}</div>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No experiences planned yet</p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"travel-content\">\n      <ItineraryStrip />\n      <AgentStatus />\n      <TravelDetails />\n    </div>\n  );\n}",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Travel Planning Subgraphs Demo Styles */\n/* Essential styles that cannot be achieved with Tailwind classes */\n\n/* Main container with CopilotSidebar layout */\n.travel-planner-container {\n  min-height: 100vh;\n  padding: 2rem;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n}\n\n/* Travel content area styles */\n.travel-content {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* Itinerary strip */\n.itinerary-strip {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.itinerary-label {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #6b7280;\n  margin-bottom: 0.5rem;\n}\n\n.itinerary-items {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n}\n\n.itinerary-item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: #f9fafb;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n}\n\n.item-icon {\n  font-size: 1rem;\n}\n\n/* Agent status */\n.agent-status {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.status-label {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #6b7280;\n  margin-bottom: 0.5rem;\n}\n\n.agent-indicators {\n  display: flex;\n  gap: 0.75rem;\n}\n\n.agent-indicator {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.agent-indicator.active {\n  background: #dbeafe;\n  border-color: #3b82f6;\n  color: #1d4ed8;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n\n/* Travel details sections */\n.travel-details {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  display: grid;\n  gap: 1rem;\n}\n\n.details-section h4 {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.detail-items {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.detail-item {\n  padding: 0.5rem;\n  background: #f9fafb;\n  border-radius: 0.25rem;\n  font-size: 0.875rem;\n  display: flex;\n  justify-content: space-between;\n}\n\n.detail-item strong {\n  color: #6b7280;\n  font-weight: 500;\n}\n\n.detail-tips {\n  padding: 0.5rem;\n  background: #eff6ff;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  color: #1d4ed8;\n}\n\n.activity-item {\n  padding: 0.75rem;\n  background: #f0f9ff;\n  border-radius: 0.25rem;\n  border-left: 2px solid #0ea5e9;\n}\n\n.activity-name {\n  font-weight: 600;\n  color: #1f2937;\n  font-size: 0.875rem;\n  margin-bottom: 0.25rem;\n}\n\n.activity-category {\n  font-size: 0.75rem;\n  color: #0ea5e9;\n  margin-bottom: 0.25rem;\n}\n\n.activity-description {\n  color: #4b5563;\n  font-size: 0.75rem;\n  margin-bottom: 0.25rem;\n}\n\n.activity-meta {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.no-activities {\n  text-align: center;\n  color: #9ca3af;\n  font-style: italic;\n  padding: 1rem;\n  font-size: 0.875rem;\n}\n\n/* Interrupt UI for Chat Sidebar (Generative UI) */\n.interrupt-container {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-width: 100%;\n  padding-top: 34px;\n}\n\n.interrupt-header {\n  margin-bottom: 0.5rem;\n}\n\n.agent-name {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin: 0 0 0.25rem 0;\n}\n\n.agent-message {\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin: 0;\n  line-height: 1.4;\n}\n\n.interrupt-options {\n    padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 300px;\n  overflow-y: auto;\n}\n\n.option-card {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  padding: 0.75rem;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n  position: relative;\n  min-height: auto;\n}\n\n.option-card:hover {\n  background: #f3f4f6;\n  border-color: #d1d5db;\n}\n\n.option-card:active {\n  background: #e5e7eb;\n}\n\n.option-card.recommended {\n  background: #eff6ff;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.1);\n}\n\n.option-card.recommended:hover {\n  background: #dbeafe;\n}\n\n.recommendation-badge {\n  position: absolute;\n  top: -2px;\n  right: -2px;\n  background: #3b82f6;\n  color: white;\n  font-size: 0.625rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.75rem;\n  font-weight: 500;\n}\n\n.option-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.125rem;\n}\n\n.airline-name, .hotel-name {\n  font-weight: 600;\n  font-size: 0.8rem;\n  color: #1f2937;\n}\n\n.price, .rating {\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: #059669;\n}\n\n.route-info, .location-info {\n  font-size: 0.7rem;\n  color: #6b7280;\n  margin-bottom: 0.125rem;\n}\n\n.duration-info, .price-info {\n  font-size: 0.7rem;\n  color: #9ca3af;\n}\n\n/* Mobile responsive adjustments */\n@media (max-width: 768px) {\n  .travel-planner-container {\n    padding: 0.5rem;\n    padding-bottom: 120px; /* Space for mobile chat */\n  }\n  \n  .travel-content {\n    padding: 0;\n    gap: 0.75rem;\n  }\n  \n  .itinerary-items {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .agent-indicators {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .agent-indicator {\n    padding: 0.75rem;\n  }\n  \n  .travel-details {\n    padding: 0.75rem;\n  }\n\n  .interrupt-container {\n    padding: 0.5rem;\n  }\n\n  .option-card {\n    padding: 0.625rem;\n  }\n\n  .interrupt-options {\n    max-height: 250px;\n  }\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# LangGraph Subgraphs Demo: Travel Planning Assistant ✈️\n\nThis demo showcases **LangGraph subgraphs** through an interactive travel planning assistant. Watch as specialized AI agents collaborate to plan your perfect trip!\n\n## What are LangGraph Subgraphs? 🤖\n\n**Subgraphs** are the key to building modular, scalable AI systems in LangGraph. A subgraph is essentially \"a graph that is used as a node in another graph\" - enabling powerful encapsulation and reusability.\nFor more info, check out the [LangGraph docs](https://langchain-ai.github.io/langgraph/concepts/subgraphs/).\n\n### Key Concepts\n\n- **Encapsulation**: Each subgraph handles a specific domain with its own expertise\n- **Modularity**: Subgraphs can be developed, tested, and maintained independently  \n- **Reusability**: The same subgraph can be used across multiple parent graphs\n- **State Communication**: Subgraphs can share state or use different schemas with transformations\n\n## Demo Architecture 🗺️\n\nThis travel planner demonstrates **supervisor-coordinated subgraphs** with **human-in-the-loop** decision making:\n\n### Parent Graph: Travel Supervisor\n- **Role**: Coordinates the travel planning process and routes to specialized agents\n- **State Management**: Maintains a shared itinerary object across all subgraphs\n- **Intelligence**: Determines what's needed and when each agent should be called\n\n### Subgraph 1: ✈️ Flights Agent\n- **Specialization**: Finding and booking flight options\n- **Process**: Presents flight options from Amsterdam to San Francisco with recommendations\n- **Interaction**: Uses interrupts to let users choose their preferred flight\n- **Data**: Static flight options (KLM, United) with pricing and duration\n\n### Subgraph 2: 🏨 Hotels Agent  \n- **Specialization**: Finding and booking accommodation\n- **Process**: Shows hotel options in San Francisco with different price points\n- **Interaction**: Uses interrupts for user to select their preferred hotel\n- **Data**: Static hotel options (Hotel Zephyr, Ritz-Carlton, Hotel Zoe)\n\n### Subgraph 3: 🎯 Experiences Agent\n- **Specialization**: Curating restaurants and activities\n- **Process**: AI-powered recommendations based on selected flights and hotels\n- **Features**: Combines 2 restaurants and 2 activities with location-aware suggestions\n- **Data**: Static experiences (Pier 39, Golden Gate Bridge, Swan Oyster Depot, Tartine Bakery)\n\n## How It Works 🔄\n\n1. **User Request**: \"Help me plan a trip to San Francisco\"\n2. **Supervisor Analysis**: Determines what travel components are needed\n3. **Sequential Routing**: Routes to each agent in logical order:\n   - First: Flights Agent (get transportation sorted)\n   - Then: Hotels Agent (book accommodation)  \n   - Finally: Experiences Agent (plan activities)\n4. **Human Decisions**: Each agent presents options and waits for user choice via interrupts\n5. **State Building**: Selected choices are stored in the shared itinerary object\n6. **Completion**: All agents report back to supervisor for final coordination\n\n## State Communication Patterns 📊\n\n### Shared State Schema\nAll subgraph agents share and contribute to a common state object. When any agent updates the shared state, these changes are immediately reflected in the frontend through real-time syncing. This ensures that:\n\n- **Flight selections** from the Flights Agent are visible to subsequent agents\n- **Hotel choices** influence the Experiences Agent's recommendations  \n- **All updates** are synchronized with the frontend UI in real-time\n- **State persistence** maintains the travel itinerary throughout the workflow\n\n### Human-in-the-Loop Pattern\nTwo of the specialist agents use **interrupts** to pause execution and gather user preferences:\n\n- **Flights Agent**: Presents options → interrupt → waits for selection → continues\n- **Hotels Agent**: Shows hotels → interrupt → waits for choice → continues\n\n## Try These Examples! 💡\n\n### Getting Started\n- \"Help me plan a trip to San Francisco\"\n- \"I want to visit San Francisco from Amsterdam\"\n- \"Plan my travel itinerary\"\n\n### During the Process\nWhen the Flights Agent presents options:\n- Choose between KLM ($650, 11h 30m) or United ($720, 12h 15m)\n\nWhen the Hotels Agent shows accommodations:\n- Select from Hotel Zephyr, The Ritz-Carlton, or Hotel Zoe\n\nThe Experiences Agent will then provide tailored recommendations based on your choices!\n\n## Frontend Capabilities 👁️\n\n- **Human-in-the-loop with interrupts** from subgraphs for user decision making\n- **Subgraphs detection and streaming** to show which agent is currently active\n- **Real-time state updates** as the shared itinerary is built across agents\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA travel agent supervisor demo showcasing multi-agent architecture with subgraphs.\nThe supervisor coordinates specialized agents: flights finder, hotels finder, and experiences finder.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional, Annotated, Union\nfrom dataclasses import dataclass\nimport json\nimport os\nfrom pydantic import BaseModel, Field\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\n\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage, AIMessage\n\ndef create_interrupt(message: str, options: List[Any], recommendation: Any, agent: str):\n    return interrupt({\n        \"message\": message,\n        \"options\": options,\n        \"recommendation\": recommendation,\n        \"agent\": agent,\n    })\n\n# State schema for travel planning\n@dataclass\nclass Flight:\n    airline: str\n    departure: str\n    arrival: str\n    price: str\n    duration: str\n\n@dataclass\nclass Hotel:\n    name: str\n    location: str\n    price_per_night: str\n    rating: str\n\n@dataclass\nclass Experience:\n    name: str\n    type: str  # \"restaurant\" or \"activity\"\n    description: str\n    location: str\n\ndef merge_itinerary(left: Union[dict, None] = None, right: Union[dict, None] = None) -> dict:\n    \"\"\"Custom reducer to merge shopping cart updates.\"\"\"\n    if not left:\n        left = {}\n    if not right:\n        right = {}\n\n    return {**left, **right}\n\nclass TravelAgentState(MessagesState):\n    \"\"\"Shared state for the travel agent system\"\"\"\n    # Travel request details\n    origin: str = \"\"\n    destination: str = \"\"\n\n    # Results from each agent\n    flights: List[Flight] = None\n    hotels: List[Hotel] = None\n    experiences: List[Experience] = None\n\n    itinerary: Annotated[dict, merge_itinerary] = None\n\n    # Tools available to all agents\n    tools: List[Any] = None\n\n    # Supervisor routing\n    next_agent: Optional[str] = None\n\n# Static data for demonstration\nSTATIC_FLIGHTS = [\n    Flight(\"KLM\", \"Amsterdam (AMS)\", \"San Francisco (SFO)\", \"$650\", \"11h 30m\"),\n    Flight(\"United\", \"Amsterdam (AMS)\", \"San Francisco (SFO)\", \"$720\", \"12h 15m\")\n]\n\nSTATIC_HOTELS = [\n    Hotel(\"Hotel Zephyr\", \"Fisherman's Wharf\", \"$280/night\", \"4.2 stars\"),\n    Hotel(\"The Ritz-Carlton\", \"Nob Hill\", \"$550/night\", \"4.8 stars\"),\n    Hotel(\"Hotel Zoe\", \"Union Square\", \"$320/night\", \"4.4 stars\")\n]\n\nSTATIC_EXPERIENCES = [\n    Experience(\"Pier 39\", \"activity\", \"Iconic waterfront destination with shops and sea lions\", \"Fisherman's Wharf\"),\n    Experience(\"Golden Gate Bridge\", \"activity\", \"World-famous suspension bridge with stunning views\", \"Golden Gate\"),\n    Experience(\"Swan Oyster Depot\", \"restaurant\", \"Historic seafood counter serving fresh oysters\", \"Polk Street\"),\n    Experience(\"Tartine Bakery\", \"restaurant\", \"Artisanal bakery famous for bread and pastries\", \"Mission District\")\n]\n\n# Flights finder subgraph\nasync def flights_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds flight options\"\"\"\n\n    # Simulate flight search with static data\n    flights = STATIC_FLIGHTS\n\n    selected_flight = state.get('itinerary', {}).get('flight', None)\n    if not selected_flight:\n        selected_flight = create_interrupt(\n            message=f\"\"\"\n        Found {len(flights)} flight options from {state.get('origin', 'Amsterdam')} to {state.get('destination', 'San Francisco')}.\n        I recommend choosing the flight by {flights[0].airline} since it's known to be on time and cheaper.\n        \"\"\",\n            options=flights,\n            recommendation=flights[0],\n            agent=\"flights\"\n        )\n\n    if isinstance(selected_flight, str):\n        selected_flight = json.loads(selected_flight)\n    return Command(\n        goto=END,\n        update={\n            \"flights\": flights,\n            \"itinerary\": {\n                \"flight\": selected_flight\n            },\n            \"messages\": state[\"messages\"] + [{\n                \"role\": \"assistant\",\n                \"content\": f\"Flights Agent: Great. I'll book you the {selected_flight[\"airline\"]} flight from {selected_flight[\"departure\"]} to {selected_flight[\"arrival\"]}.\"\n            }]\n        }\n    )\n\n# Hotels finder subgraph\nasync def hotels_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds hotel options\"\"\"\n\n    # Simulate hotel search with static data\n    hotels = STATIC_HOTELS\n    selected_hotel = state.get('itinerary', {}).get('hotel', None)\n    if not selected_hotel:\n        selected_hotel = create_interrupt(\n            message=f\"\"\"\n        Found {len(hotels)} accommodation options in {state.get('destination', 'San Francisco')}.\n        I recommend choosing the {hotels[2].name} since it strikes the balance between rating, price, and location.\n        \"\"\",\n            options=hotels,\n            recommendation=hotels[2],\n            agent=\"hotels\"\n        )\n\n    if isinstance(selected_hotel, str):\n        selected_hotel = json.loads(selected_hotel)\n    return Command(\n            goto=END,\n            update={\n                \"hotels\": hotels,\n                \"itinerary\": {\n                    \"hotel\": selected_hotel\n                },\n                \"messages\": state[\"messages\"] + [{\n                    \"role\": \"assistant\",\n                    \"content\": f\"Hotels Agent: Excellent choice! You'll like {selected_hotel[\"name\"]}.\"\n                }]\n            }\n        )\n\n# Experiences finder subgraph\nasync def experiences_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds restaurant and activity recommendations\"\"\"\n\n    # Filter experiences (2 restaurants, 2 activities)\n    restaurants = [exp for exp in STATIC_EXPERIENCES if exp.type == \"restaurant\"][:2]\n    activities = [exp for exp in STATIC_EXPERIENCES if exp.type == \"activity\"][:2]\n    experiences = restaurants + activities\n\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    itinerary = state.get(\"itinerary\", {})\n\n    system_prompt = f\"\"\"\n    You are the experiences agent. Your job is to find restaurants and activities for the user.\n    You already went ahead and found a bunch of experiences. All you have to do now, is to let the user know of your findings.\n    \n    Current status:\n    - Origin: {state.get('origin', 'Amsterdam')}\n    - Destination: {state.get('destination', 'San Francisco')}\n    - Flight chosen: {itinerary.get(\"hotel\", None)}\n    - Hotel chosen: {itinerary.get(\"hotel\", None)}\n    - activities found: {activities}\n    - restaurants found: {restaurants}\n    \"\"\"\n\n    # Get supervisor decision\n    response = await model.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    return Command(\n        goto=END,\n        update={\n            \"experiences\": experiences,\n            \"messages\": state[\"messages\"] + [response]\n        }\n    )\n\nclass SupervisorResponseFormatter(BaseModel):\n    \"\"\"Always use this tool to structure your response to the user.\"\"\"\n    answer: str = Field(description=\"The answer to the user\")\n    next_agent: str | None = Field(description=\"The agent to go to. Not required if you do not want to route to another agent.\")\n\n# Supervisor agent\nasync def supervisor_agent(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Main supervisor that coordinates all subgraphs\"\"\"\n\n    itinerary = state.get(\"itinerary\", {})\n\n    # Check what's already completed\n    has_flights = itinerary.get(\"flight\", None) is not None\n    has_hotels = itinerary.get(\"hotel\", None) is not None\n    has_experiences = state.get(\"experiences\", None) is not None\n\n    system_prompt = f\"\"\"\n    You are a travel planning supervisor. Your job is to coordinate specialized agents to help plan a trip.\n    \n    Current status:\n    - Origin: {state.get('origin', 'Amsterdam')}\n    - Destination: {state.get('destination', 'San Francisco')}\n    - Flights found: {has_flights}\n    - Hotels found: {has_hotels}\n    - Experiences found: {has_experiences}\n    - Itinerary (Things that the user has already confirmed selection on): {json.dumps(itinerary, indent=2)}\n    \n    Available agents:\n    - flights_agent: Finds flight options\n    - hotels_agent: Finds hotel options  \n    - experiences_agent: Finds restaurant and activity recommendations\n    - {END}: Mark task as complete when all information is gathered\n    \n    You must route to the appropriate agent based on what's missing. Once all agents have completed their tasks, route to 'complete'.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Bind the routing tool\n    model_with_tools = model.bind_tools(\n        [SupervisorResponseFormatter],\n        parallel_tool_calls=False,\n    )\n\n    # Get supervisor decision\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls for routing\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        if isinstance(tool_call, dict):\n            tool_call_args = tool_call[\"args\"]\n        else:\n            tool_call_args = tool_call.args\n\n        next_agent = tool_call_args[\"next_agent\"]\n\n        # Add tool response\n        tool_response = {\n            \"role\": \"tool\",\n            \"content\": f\"Routing to {next_agent} and providing the answer\",\n            \"tool_call_id\": tool_call.id if hasattr(tool_call, 'id') else tool_call[\"id\"]\n        }\n\n        messages = messages + [tool_response, AIMessage(content=tool_call_args[\"answer\"])]\n\n        if next_agent is not None:\n            return Command(goto=next_agent)\n\n    # Fallback if no tool call\n    return Command(\n        goto=END,\n        update={\"messages\": messages}\n    )\n\n# Create subgraphs\nflights_graph = StateGraph(TravelAgentState)\nflights_graph.add_node(\"flights_agent_chat_node\", flights_finder)\nflights_graph.set_entry_point(\"flights_agent_chat_node\")\nflights_graph.add_edge(START, \"flights_agent_chat_node\")\nflights_graph.add_edge(\"flights_agent_chat_node\", END)\nflights_subgraph = flights_graph.compile()\n\nhotels_graph = StateGraph(TravelAgentState)\nhotels_graph.add_node(\"hotels_agent_chat_node\", hotels_finder)\nhotels_graph.set_entry_point(\"hotels_agent_chat_node\")\nhotels_graph.add_edge(START, \"hotels_agent_chat_node\")\nhotels_graph.add_edge(\"hotels_agent_chat_node\", END)\nhotels_subgraph = hotels_graph.compile()\n\nexperiences_graph = StateGraph(TravelAgentState)\nexperiences_graph.add_node(\"experiences_agent_chat_node\", experiences_finder)\nexperiences_graph.set_entry_point(\"experiences_agent_chat_node\")\nexperiences_graph.add_edge(START, \"experiences_agent_chat_node\")\nexperiences_graph.add_edge(\"experiences_agent_chat_node\", END)\nexperiences_subgraph = experiences_graph.compile()\n\n# Main supervisor workflow\nworkflow = StateGraph(TravelAgentState)\n\n# Add supervisor and subgraphs as nodes\nworkflow.add_node(\"supervisor\", supervisor_agent)\nworkflow.add_node(\"flights_agent\", flights_subgraph)\nworkflow.add_node(\"hotels_agent\", hotels_subgraph)\nworkflow.add_node(\"experiences_agent\", experiences_subgraph)\n\n# Set entry point\nworkflow.set_entry_point(\"supervisor\")\nworkflow.add_edge(START, \"supervisor\")\n\n# Add edges back to supervisor after each subgraph\nworkflow.add_edge(\"flights_agent\", \"supervisor\")\nworkflow.add_edge(\"hotels_agent\", \"supervisor\")\nworkflow.add_edge(\"experiences_agent\", \"supervisor\")\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A travel agent supervisor demo showcasing multi-agent architecture with subgraphs.\n * The supervisor coordinates specialized agents: flights finder, hotels finder, and experiences finder.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage, AIMessage, ToolMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { \n  Annotation, \n  MessagesAnnotation, \n  StateGraph, \n  Command, \n  START, \n  END, \n  interrupt \n} from \"@langchain/langgraph\";\n\n// Travel data interfaces\ninterface Flight {\n  airline: string;\n  departure: string;\n  arrival: string;\n  price: string;\n  duration: string;\n}\n\ninterface Hotel {\n  name: string;\n  location: string;\n  price_per_night: string;\n  rating: string;\n}\n\ninterface Experience {\n  name: string;\n  type: \"restaurant\" | \"activity\";\n  description: string;\n  location: string;\n}\n\ninterface Itinerary {\n  flight?: Flight;\n  hotel?: Hotel;\n}\n\n// Custom reducer to merge itinerary updates\nfunction mergeItinerary(left: Itinerary | null, right?: Itinerary | null): Itinerary {\n  if (!left) left = {};\n  if (!right) right = {};\n  return { ...left, ...right };\n}\n\n// State annotation for travel agent system\nexport const TravelAgentStateAnnotation = Annotation.Root({\n  origin: Annotation<string>(),\n  destination: Annotation<string>(),\n  flights: Annotation<Flight[] | null>(),\n  hotels: Annotation<Hotel[] | null>(),\n  experiences: Annotation<Experience[] | null>(),\n\n  // Itinerary with custom merger\n  itinerary: Annotation<Itinerary | null>({\n    reducer: mergeItinerary,\n    default: () => null\n  }),\n\n  // Tools available to all agents\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n\n  // Supervisor routing\n  next_agent: Annotation<string | null>(),\n  ...MessagesAnnotation.spec,\n});\n\nexport type TravelAgentState = typeof TravelAgentStateAnnotation.State;\n\n// Static data for demonstration\nconst STATIC_FLIGHTS: Flight[] = [\n  { airline: \"KLM\", departure: \"Amsterdam (AMS)\", arrival: \"San Francisco (SFO)\", price: \"$650\", duration: \"11h 30m\" },\n  { airline: \"United\", departure: \"Amsterdam (AMS)\", arrival: \"San Francisco (SFO)\", price: \"$720\", duration: \"12h 15m\" }\n];\n\nconst STATIC_HOTELS: Hotel[] = [\n  { name: \"Hotel Zephyr\", location: \"Fisherman's Wharf\", price_per_night: \"$280/night\", rating: \"4.2 stars\" },\n  { name: \"The Ritz-Carlton\", location: \"Nob Hill\", price_per_night: \"$550/night\", rating: \"4.8 stars\" },\n  { name: \"Hotel Zoe\", location: \"Union Square\", price_per_night: \"$320/night\", rating: \"4.4 stars\" }\n];\n\nconst STATIC_EXPERIENCES: Experience[] = [\n  { name: \"Pier 39\", type: \"activity\", description: \"Iconic waterfront destination with shops and sea lions\", location: \"Fisherman's Wharf\" },\n  { name: \"Golden Gate Bridge\", type: \"activity\", description: \"World-famous suspension bridge with stunning views\", location: \"Golden Gate\" },\n  { name: \"Swan Oyster Depot\", type: \"restaurant\", description: \"Historic seafood counter serving fresh oysters\", location: \"Polk Street\" },\n  { name: \"Tartine Bakery\", type: \"restaurant\", description: \"Artisanal bakery famous for bread and pastries\", location: \"Mission District\" }\n];\n\nfunction createInterrupt(message: string, options: any[], recommendation: any, agent: string) {\n  return interrupt({\n    message,\n    options,\n    recommendation,\n    agent,\n  });\n}\n\n// Flights finder subgraph\nasync function flightsFinder(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  // Simulate flight search with static data\n  const flights = STATIC_FLIGHTS;\n\n  const selectedFlight = state.itinerary?.flight;\n  \n  let flightChoice: Flight;\n  const message = `Found ${flights.length} flight options from ${state.origin || 'Amsterdam'} to ${state.destination || 'San Francisco'}.\\n` +\n    `I recommend choosing the flight by ${flights[0].airline} since it's known to be on time and cheaper.`\n  if (!selectedFlight) {\n    const interruptResult = createInterrupt(\n      message,\n      flights,\n      flights[0],\n      \"flights\"\n    );\n    \n    // Parse the interrupt result if it's a string\n    flightChoice = typeof interruptResult === 'string' ? JSON.parse(interruptResult) : interruptResult;\n  } else {\n    flightChoice = selectedFlight;\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      flights: flights,\n      itinerary: {\n        flight: flightChoice\n      },\n      // Return all \"messages\" that the agent was sending\n      messages: [\n        ...state.messages,\n        new AIMessage({\n          content: message,\n        }),\n        new AIMessage({\n          content: `Flights Agent: Great. I'll book you the ${flightChoice.airline} flight from ${flightChoice.departure} to ${flightChoice.arrival}.`,\n        }),\n      ]\n    }\n  });\n}\n\n// Hotels finder subgraph\nasync function hotelsFinder(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  // Simulate hotel search with static data\n  const hotels = STATIC_HOTELS;\n  const selectedHotel = state.itinerary?.hotel;\n  \n  let hotelChoice: Hotel;\n  const message = `Found ${hotels.length} accommodation options in ${state.destination || 'San Francisco'}.\\n\n    I recommend choosing the ${hotels[2].name} since it strikes the balance between rating, price, and location.`\n  if (!selectedHotel) {\n    const interruptResult = createInterrupt(\n      message,\n      hotels,\n      hotels[2],\n      \"hotels\"\n    );\n    \n    // Parse the interrupt result if it's a string\n    hotelChoice = typeof interruptResult === 'string' ? JSON.parse(interruptResult) : interruptResult;\n  } else {\n    hotelChoice = selectedHotel;\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      hotels: hotels,\n      itinerary: {\n        hotel: hotelChoice\n      },\n      // Return all \"messages\" that the agent was sending\n      messages: [\n        ...state.messages,\n        new AIMessage({\n          content: message,\n        }),\n        new AIMessage({\n          content: `Hotels Agent: Excellent choice! You'll like ${hotelChoice.name}.`\n        }),\n      ]\n    }\n  });\n}\n\n// Experiences finder subgraph\nasync function experiencesFinder(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  // Filter experiences (2 restaurants, 2 activities)\n  const restaurants = STATIC_EXPERIENCES.filter(exp => exp.type === \"restaurant\").slice(0, 2);\n  const activities = STATIC_EXPERIENCES.filter(exp => exp.type === \"activity\").slice(0, 2);\n  const experiences = [...restaurants, ...activities];\n\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  const itinerary = state.itinerary || {};\n\n  const systemPrompt = `\n    You are the experiences agent. Your job is to find restaurants and activities for the user.\n    You already went ahead and found a bunch of experiences. All you have to do now, is to let the user know of your findings.\n    \n    Current status:\n    - Origin: ${state.origin || 'Amsterdam'}\n    - Destination: ${state.destination || 'San Francisco'}\n    - Flight chosen: ${JSON.stringify(itinerary.flight) || 'None'}\n    - Hotel chosen: ${JSON.stringify(itinerary.hotel) || 'None'}\n    - Activities found: ${JSON.stringify(activities)}\n    - Restaurants found: ${JSON.stringify(restaurants)}\n    `;\n\n  // Get experiences response\n  const response = await model.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  return new Command({\n    goto: END,\n    update: {\n      experiences: experiences,\n      messages: [...state.messages, response]\n    }\n  });\n}\n\n// Supervisor response tool\nconst SUPERVISOR_RESPONSE_TOOL = {\n  type: \"function\" as const,\n  function: {\n    name: \"supervisor_response\",\n    description: \"Always use this tool to structure your response to the user.\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        answer: {\n          type: \"string\",\n          description: \"The answer to the user\"\n        },\n        next_agent: {\n          type: \"string\",\n          enum: [\"flights_agent\", \"hotels_agent\", \"experiences_agent\", \"complete\"],\n          description: \"The agent to go to. Not required if you do not want to route to another agent.\"\n        }\n      },\n      required: [\"answer\"]\n    }\n  }\n};\n\n// Supervisor agent\nasync function supervisorAgent(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  const itinerary = state.itinerary || {};\n\n  // Check what's already completed\n  const hasFlights = itinerary.flight !== undefined;\n  const hasHotels = itinerary.hotel !== undefined;\n  const hasExperiences = state.experiences !== null;\n\n  const systemPrompt = `\n    You are a travel planning supervisor. Your job is to coordinate specialized agents to help plan a trip.\n    \n    Current status:\n    - Origin: ${state.origin || 'Amsterdam'}\n    - Destination: ${state.destination || 'San Francisco'}\n    - Flights found: ${hasFlights}\n    - Hotels found: ${hasHotels}\n    - Experiences found: ${hasExperiences}\n    - Itinerary (Things that the user has already confirmed selection on): ${JSON.stringify(itinerary, null, 2)}\n    \n    Available agents:\n    - flights_agent: Finds flight options\n    - hotels_agent: Finds hotel options  \n    - experiences_agent: Finds restaurant and activity recommendations\n    - complete: Mark task as complete when all information is gathered\n    \n    You must route to the appropriate agent based on what's missing. Once all agents have completed their tasks, route to 'complete'.\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Bind the routing tool\n  const modelWithTools = model.bindTools(\n    [SUPERVISOR_RESPONSE_TOOL],\n    {\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Get supervisor decision\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  let messages = [...state.messages, response];\n\n  // Handle tool calls for routing\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n    const toolCallArgs = toolCall.args;\n    const nextAgent = toolCallArgs.next_agent;\n\n    const toolResponse = new ToolMessage({\n      tool_call_id: toolCall.id!,\n      content: `Routing to ${nextAgent} and providing the answer`,\n    });\n\n    messages = [\n      ...messages, \n      toolResponse, \n      new AIMessage({ content: toolCallArgs.answer })\n    ];\n\n    if (nextAgent && nextAgent !== \"complete\") {\n      return new Command({ goto: nextAgent });\n    }\n  }\n\n  // Fallback if no tool call or complete\n  return new Command({\n    goto: END,\n    update: { messages }\n  });\n}\n\n// Create subgraphs\nconst flightsGraph = new StateGraph(TravelAgentStateAnnotation);\nflightsGraph.addNode(\"flights_agent_chat_node\", flightsFinder);\nflightsGraph.setEntryPoint(\"flights_agent_chat_node\");\nflightsGraph.addEdge(START, \"flights_agent_chat_node\");\nflightsGraph.addEdge(\"flights_agent_chat_node\", END);\nconst flightsSubgraph = flightsGraph.compile();\n\nconst hotelsGraph = new StateGraph(TravelAgentStateAnnotation);\nhotelsGraph.addNode(\"hotels_agent_chat_node\", hotelsFinder);\nhotelsGraph.setEntryPoint(\"hotels_agent_chat_node\");\nhotelsGraph.addEdge(START, \"hotels_agent_chat_node\");\nhotelsGraph.addEdge(\"hotels_agent_chat_node\", END);\nconst hotelsSubgraph = hotelsGraph.compile();\n\nconst experiencesGraph = new StateGraph(TravelAgentStateAnnotation);\nexperiencesGraph.addNode(\"experiences_agent_chat_node\", experiencesFinder);\nexperiencesGraph.setEntryPoint(\"experiences_agent_chat_node\");\nexperiencesGraph.addEdge(START, \"experiences_agent_chat_node\");\nexperiencesGraph.addEdge(\"experiences_agent_chat_node\", END);\nconst experiencesSubgraph = experiencesGraph.compile();\n\n// Main supervisor workflow\nconst workflow = new StateGraph(TravelAgentStateAnnotation);\n\n// Add supervisor and subgraphs as nodes\nworkflow.addNode(\"supervisor\", supervisorAgent, { ends: ['flights_agent', 'hotels_agent', 'experiences_agent', END] });\nworkflow.addNode(\"flights_agent\", flightsSubgraph);\nworkflow.addNode(\"hotels_agent\", hotelsSubgraph);\nworkflow.addNode(\"experiences_agent\", experiencesSubgraph);\n\n// Set entry point\nworkflow.setEntryPoint(\"supervisor\");\nworkflow.addEdge(START, \"supervisor\");\n\n// Add edges back to supervisor after each subgraph\nworkflow.addEdge(\"flights_agent\", \"supervisor\");\nworkflow.addEdge(\"hotels_agent\", \"supervisor\");\nworkflow.addEdge(\"experiences_agent\", \"supervisor\");\n\n// Compile the graph\nexport const subGraphsAgentGraph = workflow.compile();\n",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-fastapi::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see: \n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=\"You are a helpful assistant.\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::backend_tool_rendering": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"backend_tool_rendering\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  useCopilotAction({\n    name: \"get_weather\",\n    available: \"disabled\",\n    parameters: [{ name: \"location\", type: \"string\", required: true }],\n    render: ({ args, result, status }) => {\n      if (status !== \"complete\") {\n        return (\n          <div className=\" bg-[#667eea] text-white p-4 rounded-lg max-w-md\">\n            <span className=\"animate-spin\">⚙️ Retrieving weather...</span>\n          </div>\n        );\n      }\n\n      const weatherResult: WeatherToolResult = {\n        temperature: result.temperature || 0,\n        conditions: result.conditions || \"clear\",\n        humidity: result.humidity || 0,\n        windSpeed: result.wind_speed || 0,\n        feelsLike: result.feels_like || result.temperature || 0,\n      };\n\n      const themeColor = getThemeColor(weatherResult.conditions);\n\n      return (\n        <WeatherCard\n          location={args.location}\n          themeColor={themeColor}\n          result={weatherResult}\n          status={status || \"complete\"}\n        />\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi! I can look up the weather for you. Just ask!\" }}\n          suggestions={[\n            {\n              title: \"Weather in San Francisco\",\n              message: \"What's the weather like in San Francisco?\",\n            },\n            {\n              title: \"Weather in New York\",\n              message: \"Tell me about the weather in New York.\",\n            },\n            {\n              title: \"Weather in Tokyo\",\n              message: \"How's the weather in Tokyo today?\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\ninterface WeatherToolResult {\n  temperature: number;\n  conditions: string;\n  humidity: number;\n  windSpeed: number;\n  feelsLike: number;\n}\n\nfunction getThemeColor(conditions: string): string {\n  const conditionLower = conditions.toLowerCase();\n  if (conditionLower.includes(\"clear\") || conditionLower.includes(\"sunny\")) {\n    return \"#667eea\";\n  }\n  if (conditionLower.includes(\"rain\") || conditionLower.includes(\"storm\")) {\n    return \"#4A5568\";\n  }\n  if (conditionLower.includes(\"cloud\")) {\n    return \"#718096\";\n  }\n  if (conditionLower.includes(\"snow\")) {\n    return \"#63B3ED\";\n  }\n  return \"#764ba2\";\n}\n\nfunction WeatherCard({\n  location,\n  themeColor,\n  result,\n  status,\n}: {\n  location?: string;\n  themeColor: string;\n  result: WeatherToolResult;\n  status: \"inProgress\" | \"executing\" | \"complete\";\n}) {\n  return (\n    <div\n      data-testid=\"weather-card\"\n      style={{ backgroundColor: themeColor }}\n      className=\"rounded-xl mt-6 mb-4 max-w-md w-full\"\n    >\n      <div className=\"bg-white/20 p-4 w-full\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 data-testid=\"weather-city\" className=\"text-xl font-bold text-white capitalize\">\n              {location}\n            </h3>\n            <p className=\"text-white\">Current Weather</p>\n          </div>\n          <WeatherIcon conditions={result.conditions} />\n        </div>\n\n        <div className=\"mt-4 flex items-end justify-between\">\n          <div className=\"text-3xl font-bold text-white\">\n            <span className=\"\">{result.temperature}° C</span>\n            <span className=\"text-sm text-white/50\">\n              {\" / \"}\n              {((result.temperature * 9) / 5 + 32).toFixed(1)}° F\n            </span>\n          </div>\n          <div className=\"text-sm text-white capitalize\">{result.conditions}</div>\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-white\">\n          <div className=\"grid grid-cols-3 gap-2 text-center\">\n            <div data-testid=\"weather-humidity\">\n              <p className=\"text-white text-xs\">Humidity</p>\n              <p className=\"text-white font-medium\">{result.humidity}%</p>\n            </div>\n            <div data-testid=\"weather-wind\">\n              <p className=\"text-white text-xs\">Wind</p>\n              <p className=\"text-white font-medium\">{result.windSpeed} mph</p>\n            </div>\n            <div data-testid=\"weather-feels-like\">\n              <p className=\"text-white text-xs\">Feels Like</p>\n              <p className=\"text-white font-medium\">{result.feelsLike}°</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction WeatherIcon({ conditions }: { conditions: string }) {\n  if (!conditions) return null;\n\n  if (conditions.toLowerCase().includes(\"clear\") || conditions.toLowerCase().includes(\"sunny\")) {\n    return <SunIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"rain\") ||\n    conditions.toLowerCase().includes(\"drizzle\") ||\n    conditions.toLowerCase().includes(\"snow\") ||\n    conditions.toLowerCase().includes(\"thunderstorm\")\n  ) {\n    return <RainIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"fog\") ||\n    conditions.toLowerCase().includes(\"cloud\") ||\n    conditions.toLowerCase().includes(\"overcast\")\n  ) {\n    return <CloudIcon />;\n  }\n\n  return <CloudIcon />;\n}\n\n// Simple sun icon for the weather card\nfunction SunIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-yellow-200\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"5\" />\n      <path\n        d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"\n        strokeWidth=\"2\"\n        stroke=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nfunction RainIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-blue-200\"\n    >\n      {/* Cloud */}\n      <path\n        d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\"\n        fill=\"currentColor\"\n        opacity=\"0.8\"\n      />\n      {/* Rain drops */}\n      <path\n        d=\"M8 18l2 4M12 18l2 4M16 18l2 4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n}\n\nfunction CloudIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-gray-200\"\n    >\n      <path d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\" fill=\"currentColor\" />\n    </svg>\n  );\n}\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\nfrom requests.api import get\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n\n    tools: List[Any]\n\n\n@tool\ndef get_weather(city: str):\n    return {\n        \"temperature\": 20,\n        \"conditions\": \"sunny\",\n        \"humidity\": 50,\n        \"windSpeed\": 10,\n        \"feelsLike\": 25,\n    }\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4.1-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            get_weather,\n            # your_tool_here\n        ],\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(content=\"You are a helpful assistant.\")\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke(\n        [\n            system_message,\n            *state[\"messages\"],\n        ],\n        config,\n    )\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(goto=END, update={\"messages\": response})\n\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI using LangGraph.\n\"\"\"\n\nimport asyncio\nfrom typing import List, Any, Optional, Annotated\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom pydantic import BaseModel, Field\n\nclass Step(BaseModel):\n    \"\"\"\n    A step in a task.\n    \"\"\"\n    description: str = Field(description=\"The text of the step in gerund form\")\n    status: str = Field(description=\"The status of the step, always 'pending'\")\n\n\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\n@tool\ndef generate_task_steps_generative_ui(\n    steps: Annotated[ # pylint: disable=unused-argument\n        List[Step],\n        \"An array of 10 step objects, each containing text and status\"\n    ]\n):\n    \"\"\"\n    Make up 10 steps (only a couple of words per step) that are required for a task.\n    The step should be in gerund form (i.e. Digging hole, opening door, ...).\n    \"\"\"\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    steps: List[dict] = []\n    tools: List[Any]\n\n\nasync def start_node(state: AgentState, config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function `generate_task_steps_generative_ui`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps_generative_ui\",\n        \"tool_argument\": \"steps\",\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            generate_task_steps_generative_ui\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        if tool_call[\"name\"] == \"generate_task_steps_generative_ui\":\n            steps = [\n                {\"description\": step[\"description\"], \"status\": step[\"status\"]}\n                for step in tool_call[\"args\"][\"steps\"]\n            ]\n\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Steps executed.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n            state[\"steps\"] = steps\n\n            # Return Command to route to simulate_task_node\n            for i, _ in enumerate(steps):\n            # simulate executing the step\n                await asyncio.sleep(1)\n                steps[i][\"status\"] = \"completed\"\n                # Update the state with the completed step using config\n                await adispatch_custom_event(\n                    \"manually_emit_state\",\n                    state,\n                    config=config,\n                )\n\n            return Command(\n                goto='start_node',\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"]\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA LangGraph implementation of the human-in-the-loop agent.\n\"\"\"\n\nfrom typing import Dict, List, Any, Annotated, Optional\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\nfrom langchain_openai import ChatOpenAI\nfrom pydantic import BaseModel, Field\n\nclass Step(BaseModel):\n    \"\"\"\n    A step in a task.\n    \"\"\"\n    description: str = Field(description=\"The text of the step in imperative form\")\n    status: str = Field(description=\"The status of the step, always 'enabled'\")\n\n@tool\ndef plan_execution_steps(\n    steps: Annotated[ # pylint: disable=unused-argument\n        List[Step],\n        \"An array of 10 step objects, each containing text and status\"\n    ]\n):\n    \"\"\"\n    Make up 10 steps (only a couple of words per step) that are required for a task.\n    The step should be in imperative form (i.e. Dig hole, Open door, ...).\n    \"\"\"\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    steps: List[Dict[str, str]] = []\n    tools: List[Any]\n\nasync def start_node(state: Dict[str, Any], config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize steps list if not exists\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    # Return command to route to chat_node\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node where the agent processes messages and generates responses.\n    If task steps are defined, the user can enable/disable them using interrupts.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant that can perform any task.\n    You MUST call the `plan_execution_steps` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"plan_execution_steps\",\n        \"tool_argument\": \"steps\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            plan_execution_steps\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        if tool_call[\"name\"] == \"plan_execution_steps\":\n            # Get the steps from the tool call\n            steps_raw = tool_call[\"args\"][\"steps\"]\n\n            # Set initial status to \"enabled\" for all steps\n            steps_data = []\n\n            # Handle different potential formats of steps data\n            if isinstance(steps_raw, list):\n                for step in steps_raw:\n                    if isinstance(step, dict) and \"description\" in step:\n                        steps_data.append({\n                            \"description\": step[\"description\"],\n                            \"status\": \"enabled\"\n                        })\n                    elif isinstance(step, str):\n                        steps_data.append({\n                            \"description\": step,\n                            \"status\": \"enabled\"\n                        })\n\n            # If no steps were processed correctly, return to END with the updated messages\n            if not steps_data:\n                return Command(\n                    goto=END,\n                    update={\n                        \"messages\": messages,\n                        \"steps\": state[\"steps\"],\n                    }\n                )\n            # Update steps in state and emit to frontend\n            state[\"steps\"] = steps_data\n\n            # Add a tool response to satisfy OpenAI's requirements\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Task steps generated.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n\n            # Move to the process_steps_node which will handle the interrupt and final response\n            return Command(\n                goto=\"process_steps_node\",\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"],\n                }\n            )\n\n    # If no tool calls or not plan_execution_steps, return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def process_steps_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This node handles the user interrupt for step customization and generates the final response.\n    \"\"\"\n\n    # Check if we already have a user_response in the state\n    # This happens when the node restarts after an interrupt\n    if \"user_response\" in state and state[\"user_response\"]:\n        user_response = state[\"user_response\"]\n    else:\n        # Use LangGraph interrupt to get user input on steps\n        # This will pause execution and wait for user input in the frontend\n        user_response = interrupt({\"steps\": state[\"steps\"]})\n        # Store the user response in state for when the node restarts\n        state[\"user_response\"] = user_response\n\n    # Generate the creative completion response\n    final_prompt = \"\"\"\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    \"\"\"\n\n    final_response = await ChatOpenAI(model=\"gpt-4o\").ainvoke([\n        SystemMessage(content=final_prompt),\n        {\"role\": \"user\", \"content\": user_response}\n    ], config)\n\n    # Add the final response to messages\n    messages = state[\"messages\"] + [final_response]\n\n    # Clear the user_response from state to prepare for future interactions\n    if \"user_response\" in state:\n        state.pop(\"user_response\")\n\n    # Return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.add_node(\"process_steps_node\", process_steps_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"process_steps_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n  const chatTitle = \"AI Document Editor\";\n  const chatDescription = \"Ask me to create or edit a document\";\n  const initialLabel = \"Hi 👋 How can I help with your document?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  suggestions={[\n                    {\n                      title: \"Write a pirate story\",\n                      message: \"Please write a story about a pirate named Candy Beard.\",\n                    },\n                    {\n                      title: \"Write a mermaid story\",\n                      message: \"Please write a story about a mermaid named Luna.\",\n                    },\n                    { title: \"Add character\", message: \"Please add a character named Courage.\" },\n                  ]}\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            suggestions={[\n              {\n                title: \"Write a pirate story\",\n                message: \"Please write a story about a pirate named Candy Beard.\",\n              },\n              {\n                title: \"Write a mermaid story\",\n                message: \"Please write a story about a mermaid named Luna.\",\n              },\n              { title: \"Add character\", message: \"Please add a character named Courage.\" },\n            ]}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n        <DocumentEditor />\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction(\n    {\n      name: \"confirm_changes\",\n      renderAndWaitForResponse: ({ args, respond, status }) => (\n        <ConfirmChanges\n          args={args}\n          respond={respond}\n          status={status}\n          onReject={() => {\n            editor?.commands.setContent(fromMarkdown(currentDocument));\n            setAgentState({ document: currentDocument });\n          }}\n          onConfirm={() => {\n            editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n            setCurrentDocument(agentState?.document || \"\");\n            setAgentState({ document: agentState?.document || \"\" });\n          }}\n        />\n      ),\n    },\n    [agentState?.document],\n  );\n\n  // Action to write the document.\n  useCopilotAction(\n    {\n      name: \"write_document\",\n      description: `Present the proposed changes to the user for review`,\n      parameters: [\n        {\n          name: \"document\",\n          type: \"string\",\n          description: \"The full updated document in markdown format\",\n        },\n      ],\n      renderAndWaitForResponse({ args, status, respond }) {\n        if (status === \"executing\") {\n          return (\n            <ConfirmChanges\n              args={args}\n              respond={respond}\n              status={status}\n              onReject={() => {\n                editor?.commands.setContent(fromMarkdown(currentDocument));\n                setAgentState({ document: currentDocument });\n              }}\n              onConfirm={() => {\n                editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n                setCurrentDocument(agentState?.document || \"\");\n                setAgentState({ document: agentState?.document || \"\" });\n              }}\n            />\n          );\n        }\n        return <></>;\n      },\n    },\n    [agentState?.document],\n  );\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div\n      data-testid=\"confirm-changes-modal\"\n      className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\"\n    >\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            data-testid=\"reject-button\"\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            data-testid=\"confirm-button\"\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div\n            data-testid=\"status-display\"\n            className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\"\n          >\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of predictive state updates using LangGraph.\n\"\"\"\n\nimport uuid\nfrom typing import List, Any, Optional\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\nfrom langchain_openai import ChatOpenAI\n\n@tool\ndef write_document_local(document: str): # pylint: disable=unused-argument\n    \"\"\"\n    Write a document. Use markdown formatting to format the document.\n    It's good to format the document extensively so it's easy to read.\n    You can use all kinds of markdown.\n    However, do not use italic or strike-through formatting, it's reserved for another purpose.\n    You MUST write the full document, even when changing only a few words.\n    When making edits to the document, try to make them minimal - do not change every word.\n    Keep stories SHORT!\n    \"\"\"\n    return document\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n    tools: List[Any]\n\n\nasync def start_node(state: AgentState, config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n    return Command(\n        goto=\"chat_node\"\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n\n    system_prompt = f\"\"\"\n    You are a helpful assistant for writing documents.\n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message.\n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n {state.get('document')}\\n-----\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"document\",\n        \"tool\": \"write_document_local\",\n        \"tool_argument\": \"document\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            write_document_local\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"write_document_local\":\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Document written.\",\n                \"tool_call_id\": tool_call_id\n            }\n\n            # Add confirmation tool call\n            confirm_tool_call = {\n                \"role\": \"assistant\",\n                \"content\": \"\",\n                \"tool_calls\": [{\n                    \"id\": str(uuid.uuid4()),\n                    \"function\": {\n                        \"name\": \"confirm_changes\",\n                        \"arguments\": \"{}\"\n                    }\n                }]\n            }\n\n            messages = messages + [tool_response, confirm_tool_call]\n\n            # Return Command to route to end\n            return Command(\n                goto=END,\n                update={\n                    \"messages\": messages,\n                    \"document\": tool_call_args[\"document\"]\n                }\n            )\n\n    # If no tool was called, go to end\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit using LangGraph.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import Dict, List, Any, Optional\nimport os\n\n# LangGraph imports\nfrom pydantic import BaseModel, Field\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\nclass SpecialPreferences(str, Enum):\n    \"\"\"\n    Special preferences for the recipe.\n    \"\"\"\n    HIGH_PROTEIN = \"High Protein\"\n    LOW_CARB = \"Low Carb\"\n    SPICY = \"Spicy\"\n    BUDGET_FRIENDLY = \"Budget-Friendly\"\n    ONE_POT_MEAL = \"One-Pot Meal\"\n    VEGETARIAN = \"Vegetarian\"\n    VEGAN = \"Vegan\"\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\nclass Ingredient(BaseModel):\n    \"\"\"\n    An ingredient.\n    \"\"\"\n    icon: str = Field(\n        description=\"Icon: the actual emoji like 🥕\"\n    )\n    name: str = Field(description=\"The name of the ingredient\")\n    amount: str = Field(description=\"The amount of the ingredient\")\n\nclass Recipe(BaseModel):\n    \"\"\"\n    A recipe.\n    \"\"\"\n    skill_level: SkillLevel = \\\n        Field(description=\"The skill level required for the recipe\")\n    special_preferences: List[SpecialPreferences] = \\\n        Field(description=\"A list of special preferences for the recipe\")\n    cooking_time: CookingTime = \\\n        Field(description=\"The cooking time of the recipe\")\n    ingredients: List[Ingredient] = \\\n        Field(description=\n              \"\"\"Entire list of ingredients for the recipe, including the new ingredients\n              and the ones that are already in the recipe: Icon: the actual emoji like 🥕,\n              name and amount.\n              Like so: 🥕 Carrots (250g)\"\"\"\n        )\n    instructions: List[str] = \\\n        Field(description=\n              \"\"\"Entire list of instructions for the recipe,\n              including the new instructions and the ones that are already there\"\"\"\n        )\n    changes: str = \\\n        Field(description=\"A description of the changes made to the recipe\")\n\nclass GenerateRecipeArgs(BaseModel): # pylint: disable=missing-class-docstring\n    recipe: Recipe\n\n@tool(args_schema=GenerateRecipeArgs)\ndef generate_recipe(recipe: Recipe): # pylint: disable=unused-argument\n    \"\"\"\n    Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it.\n    Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\n    \"\"\"\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Dict[str, Any]] = None\n    tools: List[Any]\n\n\nasync def start_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize recipe if not exists\n    if \"recipe\" not in state or state[\"recipe\"] is None:\n        state[\"recipe\"] = {\n            \"skill_level\": SkillLevel.BEGINNER.value,\n            \"special_preferences\": [],\n            \"cooking_time\": CookingTime.FIFTEEN_MIN.value,\n            \"ingredients\": [{\"icon\": \"🍴\", \"name\": \"Sample Ingredient\", \"amount\": \"1 unit\"}],\n            \"instructions\": [\"First step instruction\"]\n        }\n        # Emit the initial state to ensure it's properly shared with the frontend\n        await adispatch_custom_event(\n            \"manually_emit_intermediate_state\",\n            state,\n            config=config,\n        )\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    # Create a safer serialization of the recipe\n    recipe_json = \"No recipe yet\"\n    if \"recipe\" in state and state[\"recipe\"] is not None:\n        try:\n            recipe_json = json.dumps(state[\"recipe\"], indent=2)\n        except Exception as e: # pylint: disable=broad-exception-caught\n            recipe_json = f\"Error serializing recipe: {str(e)}\"\n\n    system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: {recipe_json}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"recipe\",\n        \"tool\": \"generate_recipe\",\n        \"tool_argument\": \"recipe\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            generate_recipe\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        # Check if args is already a dict or needs to be parsed\n        tool_call_args = (tool_call[\"args\"]\n                          if isinstance(tool_call[\"args\"], dict)\n                          else json.loads(tool_call[\"args\"]))\n\n        if tool_call[\"name\"] == \"generate_recipe\":\n            # Update recipe state with tool_call_args\n            recipe_data = tool_call_args[\"recipe\"]\n\n            # If we have an existing recipe, update it\n            if \"recipe\" in state and state[\"recipe\"] is not None:\n                recipe = state[\"recipe\"]\n                for key, value in recipe_data.items():\n                    if value is not None:  # Only update fields that were provided\n                        recipe[key] = value\n            else:\n                # Create a new recipe\n                recipe = {\n                    \"skill_level\": recipe_data.get(\"skill_level\", SkillLevel.BEGINNER.value),\n                    \"special_preferences\": recipe_data.get(\"special_preferences\", []),\n                    \"cooking_time\": recipe_data.get(\"cooking_time\", CookingTime.FIFTEEN_MIN.value),\n                    \"ingredients\": recipe_data.get(\"ingredients\", []),\n                    \"instructions\": recipe_data.get(\"instructions\", [])\n                }\n\n            # Add tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Recipe generated.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n\n            # Explicitly emit the updated state to ensure it's shared with frontend\n            state[\"recipe\"] = recipe\n            await adispatch_custom_event(\n                \"manually_emit_intermediate_state\",\n                state,\n                config=config,\n            )\n\n            # Return command with updated recipe\n            return Command(\n                goto=\"start_node\",\n                update={\n                    \"messages\": messages,\n                    \"recipe\": recipe\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI using LangGraph.\n\"\"\"\n\nimport os\nfrom typing import Any, List\nfrom typing_extensions import Literal\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.prebuilt import ToolNode\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig) -> Command[Literal[\"tool_node\", \"__end__\"]]:\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    model_with_tools = model.bind_tools(\n        [\n            *state.get(\"tools\", []), # bind tools defined by ag-ui\n        ],\n        parallel_tool_calls=False,\n    )\n\n    system_message = SystemMessage(\n        content=f\"Help the user with writing Haikus. If the user asks for a haiku, use the generate_haiku tool to display the haiku to the user.\"\n    )\n\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": [response],\n        }\n    )\n\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\n# This is required even though we don't have any backend tools to pass in.\nworkflow.add_node(\"tool_node\", ToolNode(tools=[]))\nworkflow.set_entry_point(\"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::agentic_chat_reasoning": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { ChevronDown } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat_reasoning\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  model: string;\n}\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n  const { state: agentState, setState: setAgentState } = useCoAgent<AgentState>({\n    name: \"agentic_chat_reasoning\",\n    initialState: {\n      model: \"OpenAI\",\n    },\n  });\n\n  // Initialize model if not set\n  const selectedModel = agentState?.model || \"OpenAI\";\n\n  const handleModelChange = (model: string) => {\n    setAgentState({ model });\n  };\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n    },\n  });\n\n  return (\n    <div className=\"flex flex-col h-full w-full\" style={{ background }}>\n      {/* Reasoning Model Dropdown */}\n      <div className=\"h-[65px] border-b border-gray-200 dark:border-gray-700\">\n        <div className=\"h-full flex items-center justify-center\">\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-sm font-medium text-gray-700 dark:text-gray-300\">\n              Reasoning Model:\n            </span>\n            <DropdownMenu>\n              <DropdownMenuTrigger asChild>\n                <Button variant=\"outline\" className=\"w-[140px] justify-between\">\n                  {selectedModel}\n                  <ChevronDown className=\"h-4 w-4 opacity-50\" />\n                </Button>\n              </DropdownMenuTrigger>\n              <DropdownMenuContent className=\"w-[140px]\">\n                <DropdownMenuLabel>Select Model</DropdownMenuLabel>\n                <DropdownMenuSeparator />\n                <DropdownMenuItem onClick={() => handleModelChange(\"OpenAI\")}>\n                  OpenAI\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => handleModelChange(\"Anthropic\")}>\n                  Anthropic\n                </DropdownMenuItem>\n                <DropdownMenuItem onClick={() => handleModelChange(\"Gemini\")}>\n                  Gemini\n                </DropdownMenuItem>\n              </DropdownMenuContent>\n            </DropdownMenu>\n          </div>\n        </div>\n      </div>\n\n      {/* Chat Container */}\n      <div className=\"flex-1 flex justify-center items-center p-4\">\n        <div className=\"w-8/10 h-full rounded-lg\">\n          <CopilotChat\n            className=\"h-full rounded-2xl\"\n            labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Reasoning\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_openai import ChatOpenAI\nfrom langchain_anthropic import ChatAnthropic\nfrom langchain_google_genai import ChatGoogleGenerativeAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\nfrom langgraph.checkpoint.memory import MemorySaver\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n    tools: List[Any]\n    model: str\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"o3\")\n    if state[\"model\"] == \"Anthropic\":\n        model = ChatAnthropic(\n            model=\"claude-sonnet-4-20250514\",\n            thinking={\"type\": \"enabled\", \"budget_tokens\": 2000}\n        )\n    elif state[\"model\"] == \"Gemini\":\n        model = ChatGoogleGenerativeAI(model=\"gemini-2.5-pro\", thinking_budget=1024)\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=\"You are a helpful assistant.\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::subgraphs": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SubgraphsProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\n// Travel planning data types\ninterface Flight {\n  airline: string;\n  arrival: string;\n  departure: string;\n  duration: string;\n  price: string;\n}\n\ninterface Hotel {\n  location: string;\n  name: string;\n  price_per_night: string;\n  rating: string;\n}\n\ninterface Experience {\n  name: string;\n  description: string;\n  location: string;\n  type: string;\n}\n\ninterface Itinerary {\n  hotel?: Hotel;\n  flight?: Flight;\n  experiences?: Experience[];\n}\n\ntype AvailableAgents = 'flights' | 'hotels' | 'experiences' | 'supervisor'\n\ninterface TravelAgentState {\n  experiences: Experience[],\n  flights: Flight[],\n  hotels: Hotel[],\n  itinerary: Itinerary\n  planning_step: string\n  active_agent: AvailableAgents\n}\n\nconst INITIAL_STATE: TravelAgentState = {\n  itinerary: {},\n  experiences: [],\n  flights: [],\n  hotels: [],\n  planning_step: \"start\",\n  active_agent: 'supervisor'\n};\n\ninterface InterruptEvent<TAgent extends AvailableAgents> {\n  message: string;\n  options: TAgent extends 'flights' ? Flight[] : TAgent extends 'hotels' ? Hotel[] : never,\n  recommendation: TAgent extends 'flights' ? Flight : TAgent extends 'hotels' ? Hotel : never,\n  agent: TAgent\n}\n\nfunction InterruptHumanInTheLoop<TAgent extends AvailableAgents>({\n  event,\n  resolve,\n}: {\n  event: { value: InterruptEvent<TAgent> };\n  resolve: (value: string) => void;\n}) {\n  const { message, options, agent, recommendation } = event.value;\n\n  // Format agent name with emoji\n  const formatAgentName = (agent: string) => {\n    switch (agent) {\n      case 'flights': return 'Flights Agent';\n      case 'hotels': return 'Hotels Agent';\n      case 'experiences': return 'Experiences Agent';\n      default: return `${agent} Agent`;\n    }\n  };\n\n  const handleOptionSelect = (option: any) => {\n    resolve(JSON.stringify(option));\n  };\n\n  return (\n    <div className=\"interrupt-container\">\n      <p>{formatAgentName(agent)}: {message}</p>\n\n      <div className=\"interrupt-options\">\n        {options.map((opt, idx) => {\n          if ('airline' in opt) {\n            const isRecommended = (recommendation as Flight).airline === opt.airline;\n            // Flight options\n            return (\n              <button\n                key={idx}\n                className={`option-card flight-option ${isRecommended ? 'recommended' : ''}`}\n                onClick={() => handleOptionSelect(opt)}\n              >\n                {isRecommended && <span className=\"recommendation-badge\">⭐ Recommended</span>}\n                <div className=\"option-header\">\n                  <span className=\"airline-name\">{opt.airline}</span>\n                  <span className=\"price\">{opt.price}</span>\n                </div>\n                <div className=\"route-info\">\n                  {opt.departure} → {opt.arrival}\n                </div>\n                <div className=\"duration-info\">\n                  {opt.duration}\n                </div>\n              </button>\n            );\n          }\n          const isRecommended = (recommendation as Hotel).name === opt.name;\n\n          // Hotel options\n          return (\n            <button\n              key={idx}\n              className={`option-card hotel-option ${isRecommended ? 'recommended' : ''}`}\n              onClick={() => handleOptionSelect(opt)}\n            >\n              {isRecommended && <span className=\"recommendation-badge\">⭐ Recommended</span>}\n              <div className=\"option-header\">\n                <span className=\"hotel-name\">{opt.name}</span>\n                <span className=\"rating\">{opt.rating}</span>\n              </div>\n              <div className=\"location-info\">\n                📍 {opt.location}\n              </div>\n              <div className=\"price-info\">\n                {opt.price_per_night}\n              </div>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  )\n}\n\nexport default function Subgraphs({ params }: SubgraphsProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const {\n    isChatOpen,\n    setChatHeight,\n    setIsChatOpen,\n    isDragging,\n    chatHeight,\n    handleDragStart\n  } = useMobileChat(defaultChatHeight);\n\n  const chatTitle = 'Travel Planning Assistant';\n  const chatDescription = 'Plan your perfect trip with AI specialists';\n  const initialLabel = 'Hi! ✈️ Ready to plan an amazing trip? Try saying \"Plan a trip to Paris\" or \"Find me flights to Tokyo\"';\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"subgraphs\"\n    >\n      <div className=\"travel-planner-container\">\n        <TravelPlanner />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight);\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div className={`transform transition-transform duration-300 ${isChatOpen ? 'rotate-180' : ''}`}>\n                  <svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? 'translate-y-0' : 'translate-y-full'\n              } ${isDragging ? 'transition-none' : ''}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: 'env(safe-area-inset-bottom)'\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotSidebar\n                  defaultOpen={true}\n                  labels={{\n                    title: chatTitle,\n                    initial: initialLabel,\n                  }}\n                  clickOutsideToClose={false}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div\n                className=\"fixed inset-0 z-30\"\n                onClick={() => setIsChatOpen(false)}\n              />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction TravelPlanner() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, nodeName } = useCoAgent<TravelAgentState>({\n    name: \"subgraphs\",\n    initialState: INITIAL_STATE,\n    config: {\n      streamSubgraphs: true,\n    }\n  });\n\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n\n  // Current itinerary strip\n  const ItineraryStrip = () => {\n    const selectedFlight = agentState?.itinerary?.flight;\n    const selectedHotel = agentState?.itinerary?.hotel;\n    const hasExperiences = agentState?.experiences?.length > 0;\n\n    return (\n      <div className=\"itinerary-strip\">\n        <div className=\"itinerary-label\">Current Itinerary:</div>\n        <div className=\"itinerary-items\">\n          <div className=\"itinerary-item\">\n            <span className=\"item-icon\">📍</span>\n            <span>Amsterdam → San Francisco</span>\n          </div>\n          {selectedFlight && (\n            <div className=\"itinerary-item\" data-testid=\"selected-flight\">\n              <span className=\"item-icon\">✈️</span>\n              <span>{selectedFlight.airline} - {selectedFlight.price}</span>\n            </div>\n          )}\n          {selectedHotel && (\n            <div className=\"itinerary-item\" data-testid=\"selected-hotel\">\n              <span className=\"item-icon\">🏨</span>\n              <span>{selectedHotel.name}</span>\n            </div>\n          )}\n          {hasExperiences && (\n            <div className=\"itinerary-item\">\n              <span className=\"item-icon\">🎯</span>\n              <span>{agentState.experiences.length} experiences planned</span>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // Compact agent status\n  const AgentStatus = () => {\n    let activeAgent = 'supervisor';\n    if (nodeName?.includes('flights_agent')) {\n      activeAgent = 'flights';\n    }\n    if (nodeName?.includes('hotels_agent')) {\n      activeAgent = 'hotels';\n    }\n    if (nodeName?.includes('experiences_agent')) {\n      activeAgent = 'experiences';\n    }\n    return (\n      <div className=\"agent-status\">\n        <div className=\"status-label\">Active Agent:</div>\n        <div className=\"agent-indicators\">\n          <div className={`agent-indicator ${activeAgent === 'supervisor' ? 'active' : ''}`} data-testid=\"supervisor-indicator\">\n            <span>👨‍💼</span>\n            <span>Supervisor</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'flights' ? 'active' : ''}`} data-testid=\"flights-agent-indicator\">\n            <span>✈️</span>\n            <span>Flights</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'hotels' ? 'active' : ''}`} data-testid=\"hotels-agent-indicator\">\n            <span>🏨</span>\n            <span>Hotels</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'experiences' ? 'active' : ''}`} data-testid=\"experiences-agent-indicator\">\n            <span>🎯</span>\n            <span>Experiences</span>\n          </div>\n        </div>\n      </div>\n    )\n  };\n\n  // Travel details component\n  const TravelDetails = () => (\n    <div className=\"travel-details\">\n      <div className=\"details-section\">\n        <h4>✈️ Flight Options</h4>\n        <div className=\"detail-items\">\n          {agentState?.flights?.length > 0 ? (\n            agentState.flights.map((flight, index) => (\n              <div key={index} className=\"detail-item\">\n                <strong>{flight.airline}:</strong>\n                <span>{flight.departure} → {flight.arrival} ({flight.duration}) - {flight.price}</span>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No flights found yet</p>\n          )}\n          {agentState?.itinerary?.flight && (\n            <div className=\"detail-tips\">\n              <strong>Selected:</strong> {agentState.itinerary.flight.airline} - {agentState.itinerary.flight.price}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"details-section\">\n        <h4>🏨 Hotel Options</h4>\n        <div className=\"detail-items\">\n          {agentState?.hotels?.length > 0 ? (\n            agentState.hotels.map((hotel, index) => (\n              <div key={index} className=\"detail-item\">\n                <strong>{hotel.name}:</strong>\n                <span>{hotel.location} - {hotel.price_per_night} ({hotel.rating})</span>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No hotels found yet</p>\n          )}\n          {agentState?.itinerary?.hotel && (\n            <div className=\"detail-tips\">\n              <strong>Selected:</strong> {agentState.itinerary.hotel.name} - {agentState.itinerary.hotel.price_per_night}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"details-section\">\n        <h4>🎯 Experiences</h4>\n        <div className=\"detail-items\">\n          {agentState?.experiences?.length > 0 ? (\n            agentState.experiences.map((experience, index) => (\n              <div key={index} className=\"activity-item\">\n                <div className=\"activity-name\">{experience.name}</div>\n                <div className=\"activity-category\">{experience.type}</div>\n                <div className=\"activity-description\">{experience.description}</div>\n                <div className=\"activity-meta\">Location: {experience.location}</div>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No experiences planned yet</p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"travel-content\">\n      <ItineraryStrip />\n      <AgentStatus />\n      <TravelDetails />\n    </div>\n  );\n}",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Travel Planning Subgraphs Demo Styles */\n/* Essential styles that cannot be achieved with Tailwind classes */\n\n/* Main container with CopilotSidebar layout */\n.travel-planner-container {\n  min-height: 100vh;\n  padding: 2rem;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n}\n\n/* Travel content area styles */\n.travel-content {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* Itinerary strip */\n.itinerary-strip {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.itinerary-label {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #6b7280;\n  margin-bottom: 0.5rem;\n}\n\n.itinerary-items {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n}\n\n.itinerary-item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: #f9fafb;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n}\n\n.item-icon {\n  font-size: 1rem;\n}\n\n/* Agent status */\n.agent-status {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.status-label {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #6b7280;\n  margin-bottom: 0.5rem;\n}\n\n.agent-indicators {\n  display: flex;\n  gap: 0.75rem;\n}\n\n.agent-indicator {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.agent-indicator.active {\n  background: #dbeafe;\n  border-color: #3b82f6;\n  color: #1d4ed8;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n\n/* Travel details sections */\n.travel-details {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  display: grid;\n  gap: 1rem;\n}\n\n.details-section h4 {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.detail-items {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.detail-item {\n  padding: 0.5rem;\n  background: #f9fafb;\n  border-radius: 0.25rem;\n  font-size: 0.875rem;\n  display: flex;\n  justify-content: space-between;\n}\n\n.detail-item strong {\n  color: #6b7280;\n  font-weight: 500;\n}\n\n.detail-tips {\n  padding: 0.5rem;\n  background: #eff6ff;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  color: #1d4ed8;\n}\n\n.activity-item {\n  padding: 0.75rem;\n  background: #f0f9ff;\n  border-radius: 0.25rem;\n  border-left: 2px solid #0ea5e9;\n}\n\n.activity-name {\n  font-weight: 600;\n  color: #1f2937;\n  font-size: 0.875rem;\n  margin-bottom: 0.25rem;\n}\n\n.activity-category {\n  font-size: 0.75rem;\n  color: #0ea5e9;\n  margin-bottom: 0.25rem;\n}\n\n.activity-description {\n  color: #4b5563;\n  font-size: 0.75rem;\n  margin-bottom: 0.25rem;\n}\n\n.activity-meta {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.no-activities {\n  text-align: center;\n  color: #9ca3af;\n  font-style: italic;\n  padding: 1rem;\n  font-size: 0.875rem;\n}\n\n/* Interrupt UI for Chat Sidebar (Generative UI) */\n.interrupt-container {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-width: 100%;\n  padding-top: 34px;\n}\n\n.interrupt-header {\n  margin-bottom: 0.5rem;\n}\n\n.agent-name {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin: 0 0 0.25rem 0;\n}\n\n.agent-message {\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin: 0;\n  line-height: 1.4;\n}\n\n.interrupt-options {\n    padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 300px;\n  overflow-y: auto;\n}\n\n.option-card {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  padding: 0.75rem;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n  position: relative;\n  min-height: auto;\n}\n\n.option-card:hover {\n  background: #f3f4f6;\n  border-color: #d1d5db;\n}\n\n.option-card:active {\n  background: #e5e7eb;\n}\n\n.option-card.recommended {\n  background: #eff6ff;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.1);\n}\n\n.option-card.recommended:hover {\n  background: #dbeafe;\n}\n\n.recommendation-badge {\n  position: absolute;\n  top: -2px;\n  right: -2px;\n  background: #3b82f6;\n  color: white;\n  font-size: 0.625rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.75rem;\n  font-weight: 500;\n}\n\n.option-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.125rem;\n}\n\n.airline-name, .hotel-name {\n  font-weight: 600;\n  font-size: 0.8rem;\n  color: #1f2937;\n}\n\n.price, .rating {\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: #059669;\n}\n\n.route-info, .location-info {\n  font-size: 0.7rem;\n  color: #6b7280;\n  margin-bottom: 0.125rem;\n}\n\n.duration-info, .price-info {\n  font-size: 0.7rem;\n  color: #9ca3af;\n}\n\n/* Mobile responsive adjustments */\n@media (max-width: 768px) {\n  .travel-planner-container {\n    padding: 0.5rem;\n    padding-bottom: 120px; /* Space for mobile chat */\n  }\n  \n  .travel-content {\n    padding: 0;\n    gap: 0.75rem;\n  }\n  \n  .itinerary-items {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .agent-indicators {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .agent-indicator {\n    padding: 0.75rem;\n  }\n  \n  .travel-details {\n    padding: 0.75rem;\n  }\n\n  .interrupt-container {\n    padding: 0.5rem;\n  }\n\n  .option-card {\n    padding: 0.625rem;\n  }\n\n  .interrupt-options {\n    max-height: 250px;\n  }\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# LangGraph Subgraphs Demo: Travel Planning Assistant ✈️\n\nThis demo showcases **LangGraph subgraphs** through an interactive travel planning assistant. Watch as specialized AI agents collaborate to plan your perfect trip!\n\n## What are LangGraph Subgraphs? 🤖\n\n**Subgraphs** are the key to building modular, scalable AI systems in LangGraph. A subgraph is essentially \"a graph that is used as a node in another graph\" - enabling powerful encapsulation and reusability.\nFor more info, check out the [LangGraph docs](https://langchain-ai.github.io/langgraph/concepts/subgraphs/).\n\n### Key Concepts\n\n- **Encapsulation**: Each subgraph handles a specific domain with its own expertise\n- **Modularity**: Subgraphs can be developed, tested, and maintained independently  \n- **Reusability**: The same subgraph can be used across multiple parent graphs\n- **State Communication**: Subgraphs can share state or use different schemas with transformations\n\n## Demo Architecture 🗺️\n\nThis travel planner demonstrates **supervisor-coordinated subgraphs** with **human-in-the-loop** decision making:\n\n### Parent Graph: Travel Supervisor\n- **Role**: Coordinates the travel planning process and routes to specialized agents\n- **State Management**: Maintains a shared itinerary object across all subgraphs\n- **Intelligence**: Determines what's needed and when each agent should be called\n\n### Subgraph 1: ✈️ Flights Agent\n- **Specialization**: Finding and booking flight options\n- **Process**: Presents flight options from Amsterdam to San Francisco with recommendations\n- **Interaction**: Uses interrupts to let users choose their preferred flight\n- **Data**: Static flight options (KLM, United) with pricing and duration\n\n### Subgraph 2: 🏨 Hotels Agent  \n- **Specialization**: Finding and booking accommodation\n- **Process**: Shows hotel options in San Francisco with different price points\n- **Interaction**: Uses interrupts for user to select their preferred hotel\n- **Data**: Static hotel options (Hotel Zephyr, Ritz-Carlton, Hotel Zoe)\n\n### Subgraph 3: 🎯 Experiences Agent\n- **Specialization**: Curating restaurants and activities\n- **Process**: AI-powered recommendations based on selected flights and hotels\n- **Features**: Combines 2 restaurants and 2 activities with location-aware suggestions\n- **Data**: Static experiences (Pier 39, Golden Gate Bridge, Swan Oyster Depot, Tartine Bakery)\n\n## How It Works 🔄\n\n1. **User Request**: \"Help me plan a trip to San Francisco\"\n2. **Supervisor Analysis**: Determines what travel components are needed\n3. **Sequential Routing**: Routes to each agent in logical order:\n   - First: Flights Agent (get transportation sorted)\n   - Then: Hotels Agent (book accommodation)  \n   - Finally: Experiences Agent (plan activities)\n4. **Human Decisions**: Each agent presents options and waits for user choice via interrupts\n5. **State Building**: Selected choices are stored in the shared itinerary object\n6. **Completion**: All agents report back to supervisor for final coordination\n\n## State Communication Patterns 📊\n\n### Shared State Schema\nAll subgraph agents share and contribute to a common state object. When any agent updates the shared state, these changes are immediately reflected in the frontend through real-time syncing. This ensures that:\n\n- **Flight selections** from the Flights Agent are visible to subsequent agents\n- **Hotel choices** influence the Experiences Agent's recommendations  \n- **All updates** are synchronized with the frontend UI in real-time\n- **State persistence** maintains the travel itinerary throughout the workflow\n\n### Human-in-the-Loop Pattern\nTwo of the specialist agents use **interrupts** to pause execution and gather user preferences:\n\n- **Flights Agent**: Presents options → interrupt → waits for selection → continues\n- **Hotels Agent**: Shows hotels → interrupt → waits for choice → continues\n\n## Try These Examples! 💡\n\n### Getting Started\n- \"Help me plan a trip to San Francisco\"\n- \"I want to visit San Francisco from Amsterdam\"\n- \"Plan my travel itinerary\"\n\n### During the Process\nWhen the Flights Agent presents options:\n- Choose between KLM ($650, 11h 30m) or United ($720, 12h 15m)\n\nWhen the Hotels Agent shows accommodations:\n- Select from Hotel Zephyr, The Ritz-Carlton, or Hotel Zoe\n\nThe Experiences Agent will then provide tailored recommendations based on your choices!\n\n## Frontend Capabilities 👁️\n\n- **Human-in-the-loop with interrupts** from subgraphs for user decision making\n- **Subgraphs detection and streaming** to show which agent is currently active\n- **Real-time state updates** as the shared itinerary is built across agents\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA travel agent supervisor demo showcasing multi-agent architecture with subgraphs.\nThe supervisor coordinates specialized agents: flights finder, hotels finder, and experiences finder.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional, Annotated, Union\nfrom dataclasses import dataclass\nimport json\nimport os\nfrom pydantic import BaseModel, Field\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\n\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage, AIMessage\n\ndef create_interrupt(message: str, options: List[Any], recommendation: Any, agent: str):\n    return interrupt({\n        \"message\": message,\n        \"options\": options,\n        \"recommendation\": recommendation,\n        \"agent\": agent,\n    })\n\n# State schema for travel planning\n@dataclass\nclass Flight:\n    airline: str\n    departure: str\n    arrival: str\n    price: str\n    duration: str\n\n@dataclass\nclass Hotel:\n    name: str\n    location: str\n    price_per_night: str\n    rating: str\n\n@dataclass\nclass Experience:\n    name: str\n    type: str  # \"restaurant\" or \"activity\"\n    description: str\n    location: str\n\ndef merge_itinerary(left: Union[dict, None] = None, right: Union[dict, None] = None) -> dict:\n    \"\"\"Custom reducer to merge shopping cart updates.\"\"\"\n    if not left:\n        left = {}\n    if not right:\n        right = {}\n\n    return {**left, **right}\n\nclass TravelAgentState(MessagesState):\n    \"\"\"Shared state for the travel agent system\"\"\"\n    # Travel request details\n    origin: str = \"\"\n    destination: str = \"\"\n\n    # Results from each agent\n    flights: List[Flight] = None\n    hotels: List[Hotel] = None\n    experiences: List[Experience] = None\n\n    itinerary: Annotated[dict, merge_itinerary] = None\n\n    # Tools available to all agents\n    tools: List[Any] = None\n\n    # Supervisor routing\n    next_agent: Optional[str] = None\n\n# Static data for demonstration\nSTATIC_FLIGHTS = [\n    Flight(\"KLM\", \"Amsterdam (AMS)\", \"San Francisco (SFO)\", \"$650\", \"11h 30m\"),\n    Flight(\"United\", \"Amsterdam (AMS)\", \"San Francisco (SFO)\", \"$720\", \"12h 15m\")\n]\n\nSTATIC_HOTELS = [\n    Hotel(\"Hotel Zephyr\", \"Fisherman's Wharf\", \"$280/night\", \"4.2 stars\"),\n    Hotel(\"The Ritz-Carlton\", \"Nob Hill\", \"$550/night\", \"4.8 stars\"),\n    Hotel(\"Hotel Zoe\", \"Union Square\", \"$320/night\", \"4.4 stars\")\n]\n\nSTATIC_EXPERIENCES = [\n    Experience(\"Pier 39\", \"activity\", \"Iconic waterfront destination with shops and sea lions\", \"Fisherman's Wharf\"),\n    Experience(\"Golden Gate Bridge\", \"activity\", \"World-famous suspension bridge with stunning views\", \"Golden Gate\"),\n    Experience(\"Swan Oyster Depot\", \"restaurant\", \"Historic seafood counter serving fresh oysters\", \"Polk Street\"),\n    Experience(\"Tartine Bakery\", \"restaurant\", \"Artisanal bakery famous for bread and pastries\", \"Mission District\")\n]\n\n# Flights finder subgraph\nasync def flights_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds flight options\"\"\"\n\n    # Simulate flight search with static data\n    flights = STATIC_FLIGHTS\n\n    selected_flight = state.get('itinerary', {}).get('flight', None)\n    if not selected_flight:\n        selected_flight = create_interrupt(\n            message=f\"\"\"\n        Found {len(flights)} flight options from {state.get('origin', 'Amsterdam')} to {state.get('destination', 'San Francisco')}.\n        I recommend choosing the flight by {flights[0].airline} since it's known to be on time and cheaper.\n        \"\"\",\n            options=flights,\n            recommendation=flights[0],\n            agent=\"flights\"\n        )\n\n    if isinstance(selected_flight, str):\n        selected_flight = json.loads(selected_flight)\n    return Command(\n        goto=END,\n        update={\n            \"flights\": flights,\n            \"itinerary\": {\n                \"flight\": selected_flight\n            },\n            \"messages\": state[\"messages\"] + [{\n                \"role\": \"assistant\",\n                \"content\": f\"Flights Agent: Great. I'll book you the {selected_flight[\"airline\"]} flight from {selected_flight[\"departure\"]} to {selected_flight[\"arrival\"]}.\"\n            }]\n        }\n    )\n\n# Hotels finder subgraph\nasync def hotels_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds hotel options\"\"\"\n\n    # Simulate hotel search with static data\n    hotels = STATIC_HOTELS\n    selected_hotel = state.get('itinerary', {}).get('hotel', None)\n    if not selected_hotel:\n        selected_hotel = create_interrupt(\n            message=f\"\"\"\n        Found {len(hotels)} accommodation options in {state.get('destination', 'San Francisco')}.\n        I recommend choosing the {hotels[2].name} since it strikes the balance between rating, price, and location.\n        \"\"\",\n            options=hotels,\n            recommendation=hotels[2],\n            agent=\"hotels\"\n        )\n\n    if isinstance(selected_hotel, str):\n        selected_hotel = json.loads(selected_hotel)\n    return Command(\n            goto=END,\n            update={\n                \"hotels\": hotels,\n                \"itinerary\": {\n                    \"hotel\": selected_hotel\n                },\n                \"messages\": state[\"messages\"] + [{\n                    \"role\": \"assistant\",\n                    \"content\": f\"Hotels Agent: Excellent choice! You'll like {selected_hotel[\"name\"]}.\"\n                }]\n            }\n        )\n\n# Experiences finder subgraph\nasync def experiences_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds restaurant and activity recommendations\"\"\"\n\n    # Filter experiences (2 restaurants, 2 activities)\n    restaurants = [exp for exp in STATIC_EXPERIENCES if exp.type == \"restaurant\"][:2]\n    activities = [exp for exp in STATIC_EXPERIENCES if exp.type == \"activity\"][:2]\n    experiences = restaurants + activities\n\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    itinerary = state.get(\"itinerary\", {})\n\n    system_prompt = f\"\"\"\n    You are the experiences agent. Your job is to find restaurants and activities for the user.\n    You already went ahead and found a bunch of experiences. All you have to do now, is to let the user know of your findings.\n    \n    Current status:\n    - Origin: {state.get('origin', 'Amsterdam')}\n    - Destination: {state.get('destination', 'San Francisco')}\n    - Flight chosen: {itinerary.get(\"hotel\", None)}\n    - Hotel chosen: {itinerary.get(\"hotel\", None)}\n    - activities found: {activities}\n    - restaurants found: {restaurants}\n    \"\"\"\n\n    # Get supervisor decision\n    response = await model.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    return Command(\n        goto=END,\n        update={\n            \"experiences\": experiences,\n            \"messages\": state[\"messages\"] + [response]\n        }\n    )\n\nclass SupervisorResponseFormatter(BaseModel):\n    \"\"\"Always use this tool to structure your response to the user.\"\"\"\n    answer: str = Field(description=\"The answer to the user\")\n    next_agent: str | None = Field(description=\"The agent to go to. Not required if you do not want to route to another agent.\")\n\n# Supervisor agent\nasync def supervisor_agent(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Main supervisor that coordinates all subgraphs\"\"\"\n\n    itinerary = state.get(\"itinerary\", {})\n\n    # Check what's already completed\n    has_flights = itinerary.get(\"flight\", None) is not None\n    has_hotels = itinerary.get(\"hotel\", None) is not None\n    has_experiences = state.get(\"experiences\", None) is not None\n\n    system_prompt = f\"\"\"\n    You are a travel planning supervisor. Your job is to coordinate specialized agents to help plan a trip.\n    \n    Current status:\n    - Origin: {state.get('origin', 'Amsterdam')}\n    - Destination: {state.get('destination', 'San Francisco')}\n    - Flights found: {has_flights}\n    - Hotels found: {has_hotels}\n    - Experiences found: {has_experiences}\n    - Itinerary (Things that the user has already confirmed selection on): {json.dumps(itinerary, indent=2)}\n    \n    Available agents:\n    - flights_agent: Finds flight options\n    - hotels_agent: Finds hotel options  \n    - experiences_agent: Finds restaurant and activity recommendations\n    - {END}: Mark task as complete when all information is gathered\n    \n    You must route to the appropriate agent based on what's missing. Once all agents have completed their tasks, route to 'complete'.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Bind the routing tool\n    model_with_tools = model.bind_tools(\n        [SupervisorResponseFormatter],\n        parallel_tool_calls=False,\n    )\n\n    # Get supervisor decision\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls for routing\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        if isinstance(tool_call, dict):\n            tool_call_args = tool_call[\"args\"]\n        else:\n            tool_call_args = tool_call.args\n\n        next_agent = tool_call_args[\"next_agent\"]\n\n        # Add tool response\n        tool_response = {\n            \"role\": \"tool\",\n            \"content\": f\"Routing to {next_agent} and providing the answer\",\n            \"tool_call_id\": tool_call.id if hasattr(tool_call, 'id') else tool_call[\"id\"]\n        }\n\n        messages = messages + [tool_response, AIMessage(content=tool_call_args[\"answer\"])]\n\n        if next_agent is not None:\n            return Command(goto=next_agent)\n\n    # Fallback if no tool call\n    return Command(\n        goto=END,\n        update={\"messages\": messages}\n    )\n\n# Create subgraphs\nflights_graph = StateGraph(TravelAgentState)\nflights_graph.add_node(\"flights_agent_chat_node\", flights_finder)\nflights_graph.set_entry_point(\"flights_agent_chat_node\")\nflights_graph.add_edge(START, \"flights_agent_chat_node\")\nflights_graph.add_edge(\"flights_agent_chat_node\", END)\nflights_subgraph = flights_graph.compile()\n\nhotels_graph = StateGraph(TravelAgentState)\nhotels_graph.add_node(\"hotels_agent_chat_node\", hotels_finder)\nhotels_graph.set_entry_point(\"hotels_agent_chat_node\")\nhotels_graph.add_edge(START, \"hotels_agent_chat_node\")\nhotels_graph.add_edge(\"hotels_agent_chat_node\", END)\nhotels_subgraph = hotels_graph.compile()\n\nexperiences_graph = StateGraph(TravelAgentState)\nexperiences_graph.add_node(\"experiences_agent_chat_node\", experiences_finder)\nexperiences_graph.set_entry_point(\"experiences_agent_chat_node\")\nexperiences_graph.add_edge(START, \"experiences_agent_chat_node\")\nexperiences_graph.add_edge(\"experiences_agent_chat_node\", END)\nexperiences_subgraph = experiences_graph.compile()\n\n# Main supervisor workflow\nworkflow = StateGraph(TravelAgentState)\n\n# Add supervisor and subgraphs as nodes\nworkflow.add_node(\"supervisor\", supervisor_agent)\nworkflow.add_node(\"flights_agent\", flights_subgraph)\nworkflow.add_node(\"hotels_agent\", hotels_subgraph)\nworkflow.add_node(\"experiences_agent\", experiences_subgraph)\n\n# Set entry point\nworkflow.set_entry_point(\"supervisor\")\nworkflow.add_edge(START, \"supervisor\")\n\n# Add edges back to supervisor after each subgraph\nworkflow.add_edge(\"flights_agent\", \"supervisor\")\nworkflow.add_edge(\"hotels_agent\", \"supervisor\")\nworkflow.add_edge(\"experiences_agent\", \"supervisor\")\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-typescript::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import List, Any, Optional\nimport os\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of our graph.\n    \"\"\"\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see: \n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=\"You are a helpful assistant.\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A simple agentic chat flow using LangGraph instead of CrewAI.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Annotation, MessagesAnnotation, StateGraph, Command, START, END } from \"@langchain/langgraph\";\n\nconst AgentStateAnnotation = Annotation.Root({\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  ...MessagesAnnotation.spec,\n});\n\ntype AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig) {\n  /**\n   * Standard chat node based on the ReAct design pattern. It handles:\n   * - The model to use (and binds in CopilotKit actions and the tools defined above)\n   * - The system prompt\n   * - Getting a response from the model\n   * - Handling tool calls\n   *\n   * For more about the ReAct design pattern, see: \n   * https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n   */\n  \n  // 1. Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // 2. Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      // your_tool_here\n    ],\n    {\n      // 2.1 Disable parallel tool calls to avoid race conditions,\n      //     enable this for faster performance if you want to manage\n      //     the complexity of running tool calls in parallel.\n      parallel_tool_calls: false,\n    }\n  );\n\n  // 3. Define the system message by which the chat model will be run\n  const systemMessage = new SystemMessage({\n    content: \"You are a helpful assistant.\"\n  });\n\n  // 4. Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    systemMessage,\n    ...state.messages,\n  ], config);\n\n  // 6. We've handled all tool calls, so we can end the graph.\n  return new Command({\n    goto: END,\n    update: {\n      messages: [response]\n    }\n  })\n}\n\n// Define a new graph  \nconst workflow = new StateGraph(AgentStateAnnotation)\n  .addNode(\"chat_node\", chatNode)\n  .addEdge(START, \"chat_node\");\n\n// Compile the graph\nexport const agenticChatGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-typescript::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI using LangGraph.\n\"\"\"\n\nimport asyncio\nfrom typing import List, Any, Optional, Annotated\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom pydantic import BaseModel, Field\n\nclass Step(BaseModel):\n    \"\"\"\n    A step in a task.\n    \"\"\"\n    description: str = Field(description=\"The text of the step in gerund form\")\n    status: str = Field(description=\"The status of the step, always 'pending'\")\n\n\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\n@tool\ndef generate_task_steps_generative_ui(\n    steps: Annotated[ # pylint: disable=unused-argument\n        List[Step],\n        \"An array of 10 step objects, each containing text and status\"\n    ]\n):\n    \"\"\"\n    Make up 10 steps (only a couple of words per step) that are required for a task.\n    The step should be in gerund form (i.e. Digging hole, opening door, ...).\n    \"\"\"\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    steps: List[dict] = []\n    tools: List[Any]\n\n\nasync def start_node(state: AgentState, config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function `generate_task_steps_generative_ui`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps_generative_ui\",\n        \"tool_argument\": \"steps\",\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            generate_task_steps_generative_ui\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        if tool_call[\"name\"] == \"generate_task_steps_generative_ui\":\n            steps = [\n                {\"description\": step[\"description\"], \"status\": step[\"status\"]}\n                for step in tool_call[\"args\"][\"steps\"]\n            ]\n\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Steps executed.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n            state[\"steps\"] = steps\n\n            # Return Command to route to simulate_task_node\n            for i, _ in enumerate(steps):\n            # simulate executing the step\n                await asyncio.sleep(1)\n                steps[i][\"status\"] = \"completed\"\n                # Update the state with the completed step using config\n                await adispatch_custom_event(\n                    \"manually_emit_state\",\n                    state,\n                    config=config,\n                )\n\n            return Command(\n                goto='start_node',\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"]\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * An example demonstrating agentic generative UI using LangGraph.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { dispatchCustomEvent } from \"@langchain/core/callbacks/dispatch\";\nimport { Annotation, Command, MessagesAnnotation, StateGraph, END } from \"@langchain/langgraph\";\n\n// This tool simulates performing a task on the server.\n// The tool call will be streamed to the frontend as it is being generated.\nconst PERFORM_TASK_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"generate_task_steps_generative_ui\",\n    description: \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in gerund form (i.e. Digging hole, opening door, ...)\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        steps: {\n          type: \"array\",\n          items: {\n            type: \"object\",\n            properties: {\n              description: {\n                type: \"string\",\n                description: \"The text of the step in gerund form\"\n              },\n              status: {\n                type: \"string\",\n                enum: [\"pending\"],\n                description: \"The status of the step, always 'pending'\"\n              }\n            },\n            required: [\"description\", \"status\"]\n          },\n          description: \"An array of 10 step objects, each containing text and status\"\n        }\n      },\n      required: [\"steps\"]\n    }\n  }\n};\n\nconst AgentStateAnnotation = Annotation.Root({\n  steps: Annotation<Array<{ description: string; status: string }>>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  ...MessagesAnnotation.spec,\n});\n\ntype AgentState = typeof AgentStateAnnotation.State;\n\nasync function startFlow(state: AgentState, config?: RunnableConfig) {\n  /**\n   * This is the entry point for the flow.\n   */\n\n  if (!state.steps) {\n    state.steps = [];\n  }\n\n  return {\n    steps: state.steps || []\n  };\n}\n\nasync function chatNode(state: AgentState, config?: RunnableConfig) {\n  /**\n   * Standard chat node.\n   */\n  const systemPrompt = `\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function \\`generate_task_steps_generative_ui\\`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n  \n  // Define config for the model with emit_intermediate_state to stream tool calls to frontend\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"steps\",\n    tool: \"generate_task_steps_generative_ui\",\n    tool_argument: \"steps\",\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      PERFORM_TASK_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  const messages = [...state.messages, response];\n\n  // Extract any tool calls from the response\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n    \n    if (toolCall.name === \"generate_task_steps_generative_ui\") {\n      const steps = toolCall.args.steps.map((step: any) => ({\n        description: step.description,\n        status: step.status\n      }));\n      \n      // Add the tool response to messages\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Steps executed.\",\n        tool_call_id: toolCall.id\n      };\n\n      const updatedMessages = [...messages, toolResponse];\n\n      // Simulate executing the steps\n      for (let i = 0; i < steps.length; i++) {\n        // simulate executing the step\n        await new Promise(resolve => setTimeout(resolve, 1000));\n        steps[i].status = \"completed\";\n        // Update the state with the completed step\n        state.steps = steps;\n        // Emit custom events to update the frontend\n        await dispatchCustomEvent(\"manually_emit_state\", state, config);\n      }\n      \n      return new Command({\n        goto: \"start_flow\",\n        update: {\n          messages: updatedMessages,\n          steps: state.steps\n        }\n      });\n    }\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      steps: state.steps\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph(AgentStateAnnotation)\n  .addNode(\"start_flow\", startFlow)\n  .addNode(\"chat_node\", chatNode)\n  .addEdge(\"__start__\", \"start_flow\")\n  .addEdge(\"start_flow\", \"chat_node\")\n  .addEdge(\"chat_node\", \"__end__\");\n\n// Compile the graph\nexport const agenticGenerativeUiGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-typescript::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA LangGraph implementation of the human-in-the-loop agent.\n\"\"\"\n\nfrom typing import Dict, List, Any, Annotated, Optional\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\nfrom langchain_openai import ChatOpenAI\nfrom pydantic import BaseModel, Field\n\nclass Step(BaseModel):\n    \"\"\"\n    A step in a task.\n    \"\"\"\n    description: str = Field(description=\"The text of the step in imperative form\")\n    status: str = Field(description=\"The status of the step, always 'enabled'\")\n\n@tool\ndef plan_execution_steps(\n    steps: Annotated[ # pylint: disable=unused-argument\n        List[Step],\n        \"An array of 10 step objects, each containing text and status\"\n    ]\n):\n    \"\"\"\n    Make up 10 steps (only a couple of words per step) that are required for a task.\n    The step should be in imperative form (i.e. Dig hole, Open door, ...).\n    \"\"\"\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    steps: List[Dict[str, str]] = []\n    tools: List[Any]\n\nasync def start_node(state: Dict[str, Any], config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize steps list if not exists\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    # Return command to route to chat_node\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node where the agent processes messages and generates responses.\n    If task steps are defined, the user can enable/disable them using interrupts.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant that can perform any task.\n    You MUST call the `plan_execution_steps` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"plan_execution_steps\",\n        \"tool_argument\": \"steps\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            plan_execution_steps\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        if tool_call[\"name\"] == \"plan_execution_steps\":\n            # Get the steps from the tool call\n            steps_raw = tool_call[\"args\"][\"steps\"]\n\n            # Set initial status to \"enabled\" for all steps\n            steps_data = []\n\n            # Handle different potential formats of steps data\n            if isinstance(steps_raw, list):\n                for step in steps_raw:\n                    if isinstance(step, dict) and \"description\" in step:\n                        steps_data.append({\n                            \"description\": step[\"description\"],\n                            \"status\": \"enabled\"\n                        })\n                    elif isinstance(step, str):\n                        steps_data.append({\n                            \"description\": step,\n                            \"status\": \"enabled\"\n                        })\n\n            # If no steps were processed correctly, return to END with the updated messages\n            if not steps_data:\n                return Command(\n                    goto=END,\n                    update={\n                        \"messages\": messages,\n                        \"steps\": state[\"steps\"],\n                    }\n                )\n            # Update steps in state and emit to frontend\n            state[\"steps\"] = steps_data\n\n            # Add a tool response to satisfy OpenAI's requirements\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Task steps generated.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n\n            # Move to the process_steps_node which will handle the interrupt and final response\n            return Command(\n                goto=\"process_steps_node\",\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"],\n                }\n            )\n\n    # If no tool calls or not plan_execution_steps, return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def process_steps_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This node handles the user interrupt for step customization and generates the final response.\n    \"\"\"\n\n    # Check if we already have a user_response in the state\n    # This happens when the node restarts after an interrupt\n    if \"user_response\" in state and state[\"user_response\"]:\n        user_response = state[\"user_response\"]\n    else:\n        # Use LangGraph interrupt to get user input on steps\n        # This will pause execution and wait for user input in the frontend\n        user_response = interrupt({\"steps\": state[\"steps\"]})\n        # Store the user response in state for when the node restarts\n        state[\"user_response\"] = user_response\n\n    # Generate the creative completion response\n    final_prompt = \"\"\"\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    \"\"\"\n\n    final_response = await ChatOpenAI(model=\"gpt-4o\").ainvoke([\n        SystemMessage(content=final_prompt),\n        {\"role\": \"user\", \"content\": user_response}\n    ], config)\n\n    # Add the final response to messages\n    messages = state[\"messages\"] + [final_response]\n\n    # Clear the user_response from state to prepare for future interactions\n    if \"user_response\" in state:\n        state.pop(\"user_response\")\n\n    # Return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.add_node(\"process_steps_node\", process_steps_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"process_steps_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A LangGraph implementation of the human-in-the-loop agent.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Command, interrupt, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\nconst DEFINE_TASK_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"plan_execution_steps\",\n    description: \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        steps: {\n          type: \"array\",\n          items: {\n            type: \"object\",\n            properties: {\n              description: {\n                type: \"string\",\n                description: \"The text of the step in imperative form\"\n              },\n              status: {\n                type: \"string\",\n                enum: [\"enabled\"],\n                description: \"The status of the step, always 'enabled'\"\n              }\n            },\n            required: [\"description\", \"status\"]\n          },\n          description: \"An array of 10 step objects, each containing text and status\"\n        }\n      },\n      required: [\"steps\"]\n    }\n  }\n};\n\nexport const AgentStateAnnotation = Annotation.Root({\n  steps: Annotation<Array<{ description: string; status: string }>>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n  tools: Annotation<any[]>(),\n  user_response: Annotation<string | undefined>({\n    reducer: (x, y) => y ?? x,\n    default: () => undefined\n  }),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function startFlow(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * This is the entry point for the flow.\n   */\n\n  // Initialize steps list if not exists\n  if (!state.steps) {\n    state.steps = [];\n  }\n\n  return new Command({\n    goto: \"chat_node\",\n    update: {\n      messages: state.messages,\n      steps: state.steps,\n    }\n  });\n}\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * Standard chat node where the agent processes messages and generates responses.\n   * If task steps are defined, the user can enable/disable them using interrupts.\n   */\n  const systemPrompt = `\n    You are a helpful assistant that can perform any task.\n    You MUST call the \\`plan_execution_steps\\` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o-mini\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"steps\",\n    tool: \"plan_execution_steps\",\n    tool_argument: \"steps\"\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      DEFINE_TASK_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model and generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  // Update messages with the response\n  const messages = [...state.messages, response];\n  \n  // Handle tool calls\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n\n    if (toolCall.name === \"plan_execution_steps\") {\n      // Get the steps from the tool call\n      const stepsRaw = toolCall.args.steps || [];\n      \n      // Set initial status to \"enabled\" for all steps\n      const stepsData: Array<{ description: string; status: string }> = [];\n      \n      // Handle different potential formats of steps data\n      if (Array.isArray(stepsRaw)) {\n        for (const step of stepsRaw) {\n          if (typeof step === 'object' && step.description) {\n            stepsData.push({\n              description: step.description,\n              status: \"enabled\"\n            });\n          } else if (typeof step === 'string') {\n            stepsData.push({\n              description: step,\n              status: \"enabled\"\n            });\n          }\n        }\n      }\n      \n      // If no steps were processed correctly, return to END with the updated messages\n      if (stepsData.length === 0) {\n        return new Command({\n          goto: END,\n          update: {\n            messages: messages,\n            steps: state.steps,\n          }\n        });\n      }\n\n      // Update steps in state and emit to frontend\n      state.steps = stepsData;\n      \n      // Add a tool response to satisfy OpenAI's requirements\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Task steps generated.\",\n        tool_call_id: toolCall.id\n      };\n      \n      const updatedMessages = [...messages, toolResponse];\n\n      // Move to the process_steps_node which will handle the interrupt and final response\n      return new Command({\n        goto: \"process_steps_node\",\n        update: {\n          messages: updatedMessages,\n          steps: state.steps,\n        }\n      });\n    }\n  }\n  \n  // If no tool calls or not plan_execution_steps, return to END with the updated messages\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      steps: state.steps,\n    }\n  });\n}\n\nasync function processStepsNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * This node handles the user interrupt for step customization and generates the final response.\n   */\n\n  let userResponse: string;\n\n  // Check if we already have a user_response in the state\n  // This happens when the node restarts after an interrupt\n  if (state.user_response) {\n    userResponse = state.user_response;\n  } else {\n    // Use LangGraph interrupt to get user input on steps\n    // This will pause execution and wait for user input in the frontend\n    userResponse = interrupt({ steps: state.steps });\n    // Store the user response in state for when the node restarts\n    state.user_response = userResponse;\n  }\n  \n  // Generate the creative completion response\n  const finalPrompt = `\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    `;\n  \n  const finalResponse = await new ChatOpenAI({ model: \"gpt-4o\" }).invoke([\n    new SystemMessage({ content: finalPrompt }),\n    { role: \"user\", content: userResponse }\n  ], config);\n\n  // Add the final response to messages\n  const messages = [...state.messages, finalResponse];\n  \n  // Clear the user_response from state to prepare for future interactions\n  const newState = { ...state };\n  delete newState.user_response;\n  \n  // Return to END with the updated messages\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      steps: state.steps,\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph(AgentStateAnnotation);\n\n// Add nodes\nworkflow.addNode(\"start_flow\", startFlow);\nworkflow.addNode(\"chat_node\", chatNode);\nworkflow.addNode(\"process_steps_node\", processStepsNode);\n\n// Add edges\nworkflow.setEntryPoint(\"start_flow\");\nworkflow.addEdge(START, \"start_flow\");\nworkflow.addEdge(\"start_flow\", \"chat_node\");\nworkflow.addEdge(\"process_steps_node\", END);\n\n// Add conditional edges from chat_node\nworkflow.addConditionalEdges(\n  \"chat_node\",\n  (state: AgentState) => {\n    // This would be determined by the Command returned from chat_node\n    // For now, we'll assume the logic is handled in the Command's goto property\n    return \"continue\";\n  },\n  {\n    \"process_steps_node\": \"process_steps_node\",\n    \"continue\": END,\n  }\n);\n\n// Compile the graph\nexport const humanInTheLoopGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-typescript::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n  const chatTitle = \"AI Document Editor\";\n  const chatDescription = \"Ask me to create or edit a document\";\n  const initialLabel = \"Hi 👋 How can I help with your document?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  suggestions={[\n                    {\n                      title: \"Write a pirate story\",\n                      message: \"Please write a story about a pirate named Candy Beard.\",\n                    },\n                    {\n                      title: \"Write a mermaid story\",\n                      message: \"Please write a story about a mermaid named Luna.\",\n                    },\n                    { title: \"Add character\", message: \"Please add a character named Courage.\" },\n                  ]}\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            suggestions={[\n              {\n                title: \"Write a pirate story\",\n                message: \"Please write a story about a pirate named Candy Beard.\",\n              },\n              {\n                title: \"Write a mermaid story\",\n                message: \"Please write a story about a mermaid named Luna.\",\n              },\n              { title: \"Add character\", message: \"Please add a character named Courage.\" },\n            ]}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n        <DocumentEditor />\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction(\n    {\n      name: \"confirm_changes\",\n      renderAndWaitForResponse: ({ args, respond, status }) => (\n        <ConfirmChanges\n          args={args}\n          respond={respond}\n          status={status}\n          onReject={() => {\n            editor?.commands.setContent(fromMarkdown(currentDocument));\n            setAgentState({ document: currentDocument });\n          }}\n          onConfirm={() => {\n            editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n            setCurrentDocument(agentState?.document || \"\");\n            setAgentState({ document: agentState?.document || \"\" });\n          }}\n        />\n      ),\n    },\n    [agentState?.document],\n  );\n\n  // Action to write the document.\n  useCopilotAction(\n    {\n      name: \"write_document\",\n      description: `Present the proposed changes to the user for review`,\n      parameters: [\n        {\n          name: \"document\",\n          type: \"string\",\n          description: \"The full updated document in markdown format\",\n        },\n      ],\n      renderAndWaitForResponse({ args, status, respond }) {\n        if (status === \"executing\") {\n          return (\n            <ConfirmChanges\n              args={args}\n              respond={respond}\n              status={status}\n              onReject={() => {\n                editor?.commands.setContent(fromMarkdown(currentDocument));\n                setAgentState({ document: currentDocument });\n              }}\n              onConfirm={() => {\n                editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n                setCurrentDocument(agentState?.document || \"\");\n                setAgentState({ document: agentState?.document || \"\" });\n              }}\n            />\n          );\n        }\n        return <></>;\n      },\n    },\n    [agentState?.document],\n  );\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div\n      data-testid=\"confirm-changes-modal\"\n      className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\"\n    >\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            data-testid=\"reject-button\"\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            data-testid=\"confirm-button\"\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div\n            data-testid=\"status-display\"\n            className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\"\n          >\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of predictive state updates using LangGraph.\n\"\"\"\n\nimport uuid\nfrom typing import List, Any, Optional\nimport os\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\nfrom langchain_openai import ChatOpenAI\n\n@tool\ndef write_document_local(document: str): # pylint: disable=unused-argument\n    \"\"\"\n    Write a document. Use markdown formatting to format the document.\n    It's good to format the document extensively so it's easy to read.\n    You can use all kinds of markdown.\n    However, do not use italic or strike-through formatting, it's reserved for another purpose.\n    You MUST write the full document, even when changing only a few words.\n    When making edits to the document, try to make them minimal - do not change every word.\n    Keep stories SHORT!\n    \"\"\"\n    return document\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n    tools: List[Any]\n\n\nasync def start_node(state: AgentState, config: RunnableConfig): # pylint: disable=unused-argument\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n    return Command(\n        goto=\"chat_node\"\n    )\n\n\nasync def chat_node(state: AgentState, config: Optional[RunnableConfig] = None):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n\n    system_prompt = f\"\"\"\n    You are a helpful assistant for writing documents.\n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message.\n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n {state.get('document')}\\n-----\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"document\",\n        \"tool\": \"write_document_local\",\n        \"tool_argument\": \"document\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            write_document_local\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"write_document_local\":\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Document written.\",\n                \"tool_call_id\": tool_call_id\n            }\n\n            # Add confirmation tool call\n            confirm_tool_call = {\n                \"role\": \"assistant\",\n                \"content\": \"\",\n                \"tool_calls\": [{\n                    \"id\": str(uuid.uuid4()),\n                    \"function\": {\n                        \"name\": \"confirm_changes\",\n                        \"arguments\": \"{}\"\n                    }\n                }]\n            }\n\n            messages = messages + [tool_response, confirm_tool_call]\n\n            # Return Command to route to end\n            return Command(\n                goto=END,\n                update={\n                    \"messages\": messages,\n                    \"document\": tool_call_args[\"document\"]\n                }\n            )\n\n    # If no tool was called, go to end\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A demo of predictive state updates using LangGraph.\n */\n\nimport { v4 as uuidv4 } from \"uuid\";\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Command, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\nconst WRITE_DOCUMENT_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"write_document_local\",\n    description: [\n      \"Write a document. Use markdown formatting to format the document.\",\n      \"It's good to format the document extensively so it's easy to read.\",\n      \"You can use all kinds of markdown.\",\n      \"However, do not use italic or strike-through formatting, it's reserved for another purpose.\",\n      \"You MUST write the full document, even when changing only a few words.\",\n      \"When making edits to the document, try to make them minimal - do not change every word.\",\n      \"Keep stories SHORT!\"\n    ].join(\" \"),\n    parameters: {\n      type: \"object\",\n      properties: {\n        document: {\n          type: \"string\",\n          description: \"The document to write\"\n        },\n      },\n    }\n  }\n};\n\nexport const AgentStateAnnotation = Annotation.Root({\n  document: Annotation<string | undefined>({\n    reducer: (x, y) => y ?? x,\n    default: () => undefined\n  }),\n  tools: Annotation<any[]>(),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * Standard chat node.\n   */\n\n  const systemPrompt = `\n    You are a helpful assistant for writing documents.\n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message.\n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n ${state.document || ''}\\n-----\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  // Define config for the model with emit_intermediate_state to stream tool calls to frontend\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"document\",\n    tool: \"write_document_local\",\n    tool_argument: \"document\"\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      WRITE_DOCUMENT_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model to generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  // Update messages with the response\n  const messages = [...state.messages, response];\n\n  // Extract any tool calls from the response\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n\n    if (toolCall.name === \"write_document_local\") {\n      // Add the tool response to messages\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Document written.\",\n        tool_call_id: toolCall.id\n      };\n\n      // Add confirmation tool call\n      const confirmToolCall = {\n        role: \"assistant\" as const,\n        content: \"\",\n        tool_calls: [{\n          id: uuidv4(),\n          type: \"function\" as const,\n          function: {\n            name: \"confirm_changes\",\n            arguments: \"{}\"\n          }\n        }]\n      };\n\n      const updatedMessages = [...messages, toolResponse, confirmToolCall];\n\n      // Return Command to route to end\n      return new Command({\n        goto: END,\n        update: {\n          messages: updatedMessages,\n          document: toolCall.args.document\n        }\n      });\n    }\n  }\n\n  // If no tool was called, go to end\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph(AgentStateAnnotation);\n\n// Add nodes\nworkflow.addNode(\"chat_node\", chatNode);\n\n// Add edges\nworkflow.addEdge(START, \"chat_node\");\nworkflow.addEdge(\"chat_node\", END);\n\n// Compile the graph\nexport const predictiveStateUpdatesGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-typescript::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit using LangGraph.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import Dict, List, Any, Optional\nimport os\n\n# LangGraph imports\nfrom pydantic import BaseModel, Field\nfrom langchain_core.runnables import RunnableConfig\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.tools import tool\nfrom langchain_openai import ChatOpenAI\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\nclass SpecialPreferences(str, Enum):\n    \"\"\"\n    Special preferences for the recipe.\n    \"\"\"\n    HIGH_PROTEIN = \"High Protein\"\n    LOW_CARB = \"Low Carb\"\n    SPICY = \"Spicy\"\n    BUDGET_FRIENDLY = \"Budget-Friendly\"\n    ONE_POT_MEAL = \"One-Pot Meal\"\n    VEGETARIAN = \"Vegetarian\"\n    VEGAN = \"Vegan\"\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\nclass Ingredient(BaseModel):\n    \"\"\"\n    An ingredient.\n    \"\"\"\n    icon: str = Field(\n        description=\"Icon: the actual emoji like 🥕\"\n    )\n    name: str = Field(description=\"The name of the ingredient\")\n    amount: str = Field(description=\"The amount of the ingredient\")\n\nclass Recipe(BaseModel):\n    \"\"\"\n    A recipe.\n    \"\"\"\n    skill_level: SkillLevel = \\\n        Field(description=\"The skill level required for the recipe\")\n    special_preferences: List[SpecialPreferences] = \\\n        Field(description=\"A list of special preferences for the recipe\")\n    cooking_time: CookingTime = \\\n        Field(description=\"The cooking time of the recipe\")\n    ingredients: List[Ingredient] = \\\n        Field(description=\n              \"\"\"Entire list of ingredients for the recipe, including the new ingredients\n              and the ones that are already in the recipe: Icon: the actual emoji like 🥕,\n              name and amount.\n              Like so: 🥕 Carrots (250g)\"\"\"\n        )\n    instructions: List[str] = \\\n        Field(description=\n              \"\"\"Entire list of instructions for the recipe,\n              including the new instructions and the ones that are already there\"\"\"\n        )\n    changes: str = \\\n        Field(description=\"A description of the changes made to the recipe\")\n\nclass GenerateRecipeArgs(BaseModel): # pylint: disable=missing-class-docstring\n    recipe: Recipe\n\n@tool(args_schema=GenerateRecipeArgs)\ndef generate_recipe(recipe: Recipe): # pylint: disable=unused-argument\n    \"\"\"\n    Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it.\n    Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\n    \"\"\"\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Dict[str, Any]] = None\n    tools: List[Any]\n\n\nasync def start_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize recipe if not exists\n    if \"recipe\" not in state or state[\"recipe\"] is None:\n        state[\"recipe\"] = {\n            \"skill_level\": SkillLevel.BEGINNER.value,\n            \"special_preferences\": [],\n            \"cooking_time\": CookingTime.FIFTEEN_MIN.value,\n            \"ingredients\": [{\"icon\": \"🍴\", \"name\": \"Sample Ingredient\", \"amount\": \"1 unit\"}],\n            \"instructions\": [\"First step instruction\"]\n        }\n        # Emit the initial state to ensure it's properly shared with the frontend\n        await adispatch_custom_event(\n            \"manually_emit_intermediate_state\",\n            state,\n            config=config,\n        )\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    # Create a safer serialization of the recipe\n    recipe_json = \"No recipe yet\"\n    if \"recipe\" in state and state[\"recipe\"] is not None:\n        try:\n            recipe_json = json.dumps(state[\"recipe\"], indent=2)\n        except Exception as e: # pylint: disable=broad-exception-caught\n            recipe_json = f\"Error serializing recipe: {str(e)}\"\n\n    system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: {recipe_json}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n\n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"recipe\",\n        \"tool\": \"generate_recipe\",\n        \"tool_argument\": \"recipe\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            generate_recipe\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        # Handle dicts or object (backward compatibility)\n        tool_call = (response.tool_calls[0]\n                     if isinstance(response.tool_calls[0], dict)\n                     else vars(response.tool_calls[0]))\n\n        # Check if args is already a dict or needs to be parsed\n        tool_call_args = (tool_call[\"args\"]\n                          if isinstance(tool_call[\"args\"], dict)\n                          else json.loads(tool_call[\"args\"]))\n\n        if tool_call[\"name\"] == \"generate_recipe\":\n            # Update recipe state with tool_call_args\n            recipe_data = tool_call_args[\"recipe\"]\n\n            # If we have an existing recipe, update it\n            if \"recipe\" in state and state[\"recipe\"] is not None:\n                recipe = state[\"recipe\"]\n                for key, value in recipe_data.items():\n                    if value is not None:  # Only update fields that were provided\n                        recipe[key] = value\n            else:\n                # Create a new recipe\n                recipe = {\n                    \"skill_level\": recipe_data.get(\"skill_level\", SkillLevel.BEGINNER.value),\n                    \"special_preferences\": recipe_data.get(\"special_preferences\", []),\n                    \"cooking_time\": recipe_data.get(\"cooking_time\", CookingTime.FIFTEEN_MIN.value),\n                    \"ingredients\": recipe_data.get(\"ingredients\", []),\n                    \"instructions\": recipe_data.get(\"instructions\", [])\n                }\n\n            # Add tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Recipe generated.\",\n                \"tool_call_id\": tool_call[\"id\"]\n            }\n\n            messages = messages + [tool_response]\n\n            # Explicitly emit the updated state to ensure it's shared with frontend\n            state[\"recipe\"] = recipe\n            await adispatch_custom_event(\n                \"manually_emit_intermediate_state\",\n                state,\n                config=config,\n            )\n\n            # Return command with updated recipe\n            return Command(\n                goto=\"start_node\",\n                update={\n                    \"messages\": messages,\n                    \"recipe\": recipe\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"start_node\", start_node)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"start_node\")\nworkflow.add_edge(START, \"start_node\")\nworkflow.add_edge(\"start_node\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A demo of shared state between the agent and CopilotKit using LangGraph.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { dispatchCustomEvent } from \"@langchain/core/callbacks/dispatch\";\nimport { Command, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\"\n}\n\nenum SpecialPreferences {\n  HIGH_PROTEIN = \"High Protein\",\n  LOW_CARB = \"Low Carb\",\n  SPICY = \"Spicy\",\n  BUDGET_FRIENDLY = \"Budget-Friendly\",\n  ONE_POT_MEAL = \"One-Pot Meal\",\n  VEGETARIAN = \"Vegetarian\",\n  VEGAN = \"Vegan\"\n}\n\nenum CookingTime {\n  FIVE_MIN = \"5 min\",\n  FIFTEEN_MIN = \"15 min\",\n  THIRTY_MIN = \"30 min\",\n  FORTY_FIVE_MIN = \"45 min\",\n  SIXTY_PLUS_MIN = \"60+ min\"\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  skill_level: SkillLevel;\n  special_preferences: SpecialPreferences[];\n  cooking_time: CookingTime;\n  ingredients: Ingredient[];\n  instructions: string[];\n  changes?: string;\n}\n\nconst GENERATE_RECIPE_TOOL = {\n  type: \"function\",\n  function: {\n    name: \"generate_recipe\",\n    description: \"Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it. Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        recipe: {\n          type: \"object\",\n          properties: {\n            skill_level: {\n              type: \"string\",\n              enum: Object.values(SkillLevel),\n              description: \"The skill level required for the recipe\"\n            },\n            special_preferences: {\n              type: \"array\",\n              items: {\n                type: \"string\",\n                enum: Object.values(SpecialPreferences)\n              },\n              description: \"A list of special preferences for the recipe\"\n            },\n            cooking_time: {\n              type: \"string\",\n              enum: Object.values(CookingTime),\n              description: \"The cooking time of the recipe\"\n            },\n            ingredients: {\n              type: \"array\",\n              items: {\n                type: \"object\",\n                properties: {\n                  icon: { type: \"string\", description: \"The icon emoji (not emoji code like '\\\\u1f35e', but the actual emoji like 🥕) of the ingredient\" },\n                  name: { type: \"string\" },\n                  amount: { type: \"string\" }\n                }\n              },\n              description: \"Entire list of ingredients for the recipe, including the new ingredients and the ones that are already in the recipe\"\n            },\n            instructions: {\n              type: \"array\",\n              items: { type: \"string\" },\n              description: \"Entire list of instructions for the recipe, including the new instructions and the ones that are already there\"\n            },\n            changes: {\n              type: \"string\",\n              description: \"A description of the changes made to the recipe\"\n            }\n          },\n        }\n      },\n      required: [\"recipe\"]\n    }\n  }\n};\n\nexport const AgentStateAnnotation = Annotation.Root({\n  recipe: Annotation<Recipe | undefined>(),\n  tools: Annotation<any[]>(),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function startFlow(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * This is the entry point for the flow.\n   */\n\n  // Initialize recipe if not exists\n  if (!state.recipe) {\n    state.recipe = {\n      skill_level: SkillLevel.BEGINNER,\n      special_preferences: [],\n      cooking_time: CookingTime.FIFTEEN_MIN,\n      ingredients: [{ icon: \"🍴\", name: \"Sample Ingredient\", amount: \"1 unit\" }],\n      instructions: [\"First step instruction\"]\n    };\n    // Emit the initial state to ensure it's properly shared with the frontend\n    await dispatchCustomEvent(\"manually_emit_intermediate_state\", state, config);\n  }\n  \n  return new Command({\n    goto: \"chat_node\",\n    update: {\n      messages: state.messages,\n      recipe: state.recipe\n    }\n  });\n}\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  /**\n   * Standard chat node.\n   */\n  // Create a safer serialization of the recipe\n  let recipeJson = \"No recipe yet\";\n  if (state.recipe) {\n    try {\n      recipeJson = JSON.stringify(state.recipe, null, 2);\n    } catch (e) {\n      recipeJson = `Error serializing recipe: ${e}`;\n    }\n  }\n\n  const systemPrompt = `You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: ${recipeJson}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o-mini\" });\n  \n  // Define config for the model\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Use \"predict_state\" metadata to set up streaming for the write_document tool\n  if (!config.metadata) config.metadata = {};\n  config.metadata.predict_state = [{\n    state_key: \"recipe\",\n    tool: \"generate_recipe\",\n    tool_argument: \"recipe\"\n  }];\n\n  // Bind the tools to the model\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools,\n      GENERATE_RECIPE_TOOL\n    ],\n    {\n      // Disable parallel tool calls to avoid race conditions\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Run the model and generate a response\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  // Update messages with the response\n  const messages = [...state.messages, response];\n  \n  // Handle tool calls\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n    \n    if (toolCall.name === \"generate_recipe\") {\n      // Update recipe state with tool_call_args\n      const recipeData = toolCall.args.recipe;\n      let recipe: Recipe;\n      // If we have an existing recipe, update it\n      if (state.recipe) {\n        recipe = { ...state.recipe };\n        for (const [key, value] of Object.entries(recipeData)) {\n          if (value !== null && value !== undefined) {  // Only update fields that were provided\n            (recipe as any)[key] = value;\n          }\n        }\n      } else {\n        // Create a new recipe\n        recipe = {\n          skill_level: recipeData.skill_level || SkillLevel.BEGINNER,\n          special_preferences: recipeData.special_preferences || [],\n          cooking_time: recipeData.cooking_time || CookingTime.FIFTEEN_MIN,\n          ingredients: recipeData.ingredients || [],\n          instructions: recipeData.instructions || []\n        };\n      }\n      \n      // Add tool response to messages\n      const toolResponse = {\n        role: \"tool\" as const,\n        content: \"Recipe generated.\",\n        tool_call_id: toolCall.id\n      };\n      \n      const updatedMessages = [...messages, toolResponse];\n      \n      // Explicitly emit the updated state to ensure it's shared with frontend\n      state.recipe = recipe;\n      await dispatchCustomEvent(\"manually_emit_intermediate_state\", state, config);\n      \n      // Return command with updated recipe\n      return new Command({\n        goto: \"start_flow\",\n        update: {\n          messages: updatedMessages,\n          recipe: recipe\n        }\n      });\n    }\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      messages: messages,\n      recipe: state.recipe\n    }\n  });\n}\n\n// Define the graph\nconst workflow = new StateGraph<AgentState>(AgentStateAnnotation);\n\n// Add nodes\nworkflow.addNode(\"start_flow\", startFlow);\nworkflow.addNode(\"chat_node\", chatNode);\n\n// Add edges\nworkflow.setEntryPoint(\"start_flow\");\nworkflow.addEdge(START, \"start_flow\");\nworkflow.addEdge(\"start_flow\", \"chat_node\");\nworkflow.addEdge(\"chat_node\", END);\n\n// Compile the graph\nexport const sharedStateGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-typescript::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI using LangGraph.\n\"\"\"\n\nimport os\nfrom typing import Any, List\nfrom typing_extensions import Literal\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.prebuilt import ToolNode\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    State of the agent.\n    \"\"\"\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig) -> Command[Literal[\"tool_node\", \"__end__\"]]:\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see:\n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    model_with_tools = model.bind_tools(\n        [\n            *state.get(\"tools\", []), # bind tools defined by ag-ui\n        ],\n        parallel_tool_calls=False,\n    )\n\n    system_message = SystemMessage(\n        content=f\"Help the user with writing Haikus. If the user asks for a haiku, use the generate_haiku tool to display the haiku to the user.\"\n    )\n\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": [response],\n        }\n    )\n\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\n# This is required even though we don't have any backend tools to pass in.\nworkflow.add_node(\"tool_node\", ToolNode(tools=[]))\nworkflow.set_entry_point(\"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * An example demonstrating tool-based generative UI using LangGraph.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { Command, Annotation, MessagesAnnotation, StateGraph, END, START } from \"@langchain/langgraph\";\n\n\nexport const AgentStateAnnotation = Annotation.Root({\n  tools: Annotation<any[]>(),\n  ...MessagesAnnotation.spec,\n});\nexport type AgentState = typeof AgentStateAnnotation.State;\n\nasync function chatNode(state: AgentState, config?: RunnableConfig): Promise<Command> {\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  const modelWithTools = model.bindTools(\n    [\n      ...state.tools || []\n    ],\n    { parallel_tool_calls: false }\n  );\n\n  const systemMessage = new SystemMessage({\n     content: 'Help the user with writing Haikus. If the user asks for a haiku, use the generate_haiku tool to display the haiku to the user.'\n  });\n\n  const response = await modelWithTools.invoke([\n    systemMessage,\n    ...state.messages,\n  ], config);\n\n  return new Command({\n    goto: END,\n    update: {\n      messages: [response]\n    }\n  });\n}\n\nconst workflow = new StateGraph<AgentState>(AgentStateAnnotation);\nworkflow.addNode(\"chat_node\", chatNode);\n\nworkflow.addEdge(START, \"chat_node\");\n\nexport const toolBasedGenerativeUiGraph = workflow.compile();",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph-typescript::subgraphs": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SubgraphsProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\n// Travel planning data types\ninterface Flight {\n  airline: string;\n  arrival: string;\n  departure: string;\n  duration: string;\n  price: string;\n}\n\ninterface Hotel {\n  location: string;\n  name: string;\n  price_per_night: string;\n  rating: string;\n}\n\ninterface Experience {\n  name: string;\n  description: string;\n  location: string;\n  type: string;\n}\n\ninterface Itinerary {\n  hotel?: Hotel;\n  flight?: Flight;\n  experiences?: Experience[];\n}\n\ntype AvailableAgents = 'flights' | 'hotels' | 'experiences' | 'supervisor'\n\ninterface TravelAgentState {\n  experiences: Experience[],\n  flights: Flight[],\n  hotels: Hotel[],\n  itinerary: Itinerary\n  planning_step: string\n  active_agent: AvailableAgents\n}\n\nconst INITIAL_STATE: TravelAgentState = {\n  itinerary: {},\n  experiences: [],\n  flights: [],\n  hotels: [],\n  planning_step: \"start\",\n  active_agent: 'supervisor'\n};\n\ninterface InterruptEvent<TAgent extends AvailableAgents> {\n  message: string;\n  options: TAgent extends 'flights' ? Flight[] : TAgent extends 'hotels' ? Hotel[] : never,\n  recommendation: TAgent extends 'flights' ? Flight : TAgent extends 'hotels' ? Hotel : never,\n  agent: TAgent\n}\n\nfunction InterruptHumanInTheLoop<TAgent extends AvailableAgents>({\n  event,\n  resolve,\n}: {\n  event: { value: InterruptEvent<TAgent> };\n  resolve: (value: string) => void;\n}) {\n  const { message, options, agent, recommendation } = event.value;\n\n  // Format agent name with emoji\n  const formatAgentName = (agent: string) => {\n    switch (agent) {\n      case 'flights': return 'Flights Agent';\n      case 'hotels': return 'Hotels Agent';\n      case 'experiences': return 'Experiences Agent';\n      default: return `${agent} Agent`;\n    }\n  };\n\n  const handleOptionSelect = (option: any) => {\n    resolve(JSON.stringify(option));\n  };\n\n  return (\n    <div className=\"interrupt-container\">\n      <p>{formatAgentName(agent)}: {message}</p>\n\n      <div className=\"interrupt-options\">\n        {options.map((opt, idx) => {\n          if ('airline' in opt) {\n            const isRecommended = (recommendation as Flight).airline === opt.airline;\n            // Flight options\n            return (\n              <button\n                key={idx}\n                className={`option-card flight-option ${isRecommended ? 'recommended' : ''}`}\n                onClick={() => handleOptionSelect(opt)}\n              >\n                {isRecommended && <span className=\"recommendation-badge\">⭐ Recommended</span>}\n                <div className=\"option-header\">\n                  <span className=\"airline-name\">{opt.airline}</span>\n                  <span className=\"price\">{opt.price}</span>\n                </div>\n                <div className=\"route-info\">\n                  {opt.departure} → {opt.arrival}\n                </div>\n                <div className=\"duration-info\">\n                  {opt.duration}\n                </div>\n              </button>\n            );\n          }\n          const isRecommended = (recommendation as Hotel).name === opt.name;\n\n          // Hotel options\n          return (\n            <button\n              key={idx}\n              className={`option-card hotel-option ${isRecommended ? 'recommended' : ''}`}\n              onClick={() => handleOptionSelect(opt)}\n            >\n              {isRecommended && <span className=\"recommendation-badge\">⭐ Recommended</span>}\n              <div className=\"option-header\">\n                <span className=\"hotel-name\">{opt.name}</span>\n                <span className=\"rating\">{opt.rating}</span>\n              </div>\n              <div className=\"location-info\">\n                📍 {opt.location}\n              </div>\n              <div className=\"price-info\">\n                {opt.price_per_night}\n              </div>\n            </button>\n          );\n        })}\n      </div>\n    </div>\n  )\n}\n\nexport default function Subgraphs({ params }: SubgraphsProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const {\n    isChatOpen,\n    setChatHeight,\n    setIsChatOpen,\n    isDragging,\n    chatHeight,\n    handleDragStart\n  } = useMobileChat(defaultChatHeight);\n\n  const chatTitle = 'Travel Planning Assistant';\n  const chatDescription = 'Plan your perfect trip with AI specialists';\n  const initialLabel = 'Hi! ✈️ Ready to plan an amazing trip? Try saying \"Plan a trip to Paris\" or \"Find me flights to Tokyo\"';\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"subgraphs\"\n    >\n      <div className=\"travel-planner-container\">\n        <TravelPlanner />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight);\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div className={`transform transition-transform duration-300 ${isChatOpen ? 'rotate-180' : ''}`}>\n                  <svg className=\"w-6 h-6 text-gray-400\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                    <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M5 15l7-7 7 7\" />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? 'translate-y-0' : 'translate-y-full'\n              } ${isDragging ? 'transition-none' : ''}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: 'env(safe-area-inset-bottom)'\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg className=\"w-5 h-5 text-gray-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M6 18L18 6M6 6l12 12\" />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotSidebar\n                  defaultOpen={true}\n                  labels={{\n                    title: chatTitle,\n                    initial: initialLabel,\n                  }}\n                  clickOutsideToClose={false}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div\n                className=\"fixed inset-0 z-30\"\n                onClick={() => setIsChatOpen(false)}\n              />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction TravelPlanner() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, nodeName } = useCoAgent<TravelAgentState>({\n    name: \"subgraphs\",\n    initialState: INITIAL_STATE,\n    config: {\n      streamSubgraphs: true,\n    }\n  });\n\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n\n  // Current itinerary strip\n  const ItineraryStrip = () => {\n    const selectedFlight = agentState?.itinerary?.flight;\n    const selectedHotel = agentState?.itinerary?.hotel;\n    const hasExperiences = agentState?.experiences?.length > 0;\n\n    return (\n      <div className=\"itinerary-strip\">\n        <div className=\"itinerary-label\">Current Itinerary:</div>\n        <div className=\"itinerary-items\">\n          <div className=\"itinerary-item\">\n            <span className=\"item-icon\">📍</span>\n            <span>Amsterdam → San Francisco</span>\n          </div>\n          {selectedFlight && (\n            <div className=\"itinerary-item\" data-testid=\"selected-flight\">\n              <span className=\"item-icon\">✈️</span>\n              <span>{selectedFlight.airline} - {selectedFlight.price}</span>\n            </div>\n          )}\n          {selectedHotel && (\n            <div className=\"itinerary-item\" data-testid=\"selected-hotel\">\n              <span className=\"item-icon\">🏨</span>\n              <span>{selectedHotel.name}</span>\n            </div>\n          )}\n          {hasExperiences && (\n            <div className=\"itinerary-item\">\n              <span className=\"item-icon\">🎯</span>\n              <span>{agentState.experiences.length} experiences planned</span>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  // Compact agent status\n  const AgentStatus = () => {\n    let activeAgent = 'supervisor';\n    if (nodeName?.includes('flights_agent')) {\n      activeAgent = 'flights';\n    }\n    if (nodeName?.includes('hotels_agent')) {\n      activeAgent = 'hotels';\n    }\n    if (nodeName?.includes('experiences_agent')) {\n      activeAgent = 'experiences';\n    }\n    return (\n      <div className=\"agent-status\">\n        <div className=\"status-label\">Active Agent:</div>\n        <div className=\"agent-indicators\">\n          <div className={`agent-indicator ${activeAgent === 'supervisor' ? 'active' : ''}`} data-testid=\"supervisor-indicator\">\n            <span>👨‍💼</span>\n            <span>Supervisor</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'flights' ? 'active' : ''}`} data-testid=\"flights-agent-indicator\">\n            <span>✈️</span>\n            <span>Flights</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'hotels' ? 'active' : ''}`} data-testid=\"hotels-agent-indicator\">\n            <span>🏨</span>\n            <span>Hotels</span>\n          </div>\n          <div className={`agent-indicator ${activeAgent === 'experiences' ? 'active' : ''}`} data-testid=\"experiences-agent-indicator\">\n            <span>🎯</span>\n            <span>Experiences</span>\n          </div>\n        </div>\n      </div>\n    )\n  };\n\n  // Travel details component\n  const TravelDetails = () => (\n    <div className=\"travel-details\">\n      <div className=\"details-section\">\n        <h4>✈️ Flight Options</h4>\n        <div className=\"detail-items\">\n          {agentState?.flights?.length > 0 ? (\n            agentState.flights.map((flight, index) => (\n              <div key={index} className=\"detail-item\">\n                <strong>{flight.airline}:</strong>\n                <span>{flight.departure} → {flight.arrival} ({flight.duration}) - {flight.price}</span>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No flights found yet</p>\n          )}\n          {agentState?.itinerary?.flight && (\n            <div className=\"detail-tips\">\n              <strong>Selected:</strong> {agentState.itinerary.flight.airline} - {agentState.itinerary.flight.price}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"details-section\">\n        <h4>🏨 Hotel Options</h4>\n        <div className=\"detail-items\">\n          {agentState?.hotels?.length > 0 ? (\n            agentState.hotels.map((hotel, index) => (\n              <div key={index} className=\"detail-item\">\n                <strong>{hotel.name}:</strong>\n                <span>{hotel.location} - {hotel.price_per_night} ({hotel.rating})</span>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No hotels found yet</p>\n          )}\n          {agentState?.itinerary?.hotel && (\n            <div className=\"detail-tips\">\n              <strong>Selected:</strong> {agentState.itinerary.hotel.name} - {agentState.itinerary.hotel.price_per_night}\n            </div>\n          )}\n        </div>\n      </div>\n\n      <div className=\"details-section\">\n        <h4>🎯 Experiences</h4>\n        <div className=\"detail-items\">\n          {agentState?.experiences?.length > 0 ? (\n            agentState.experiences.map((experience, index) => (\n              <div key={index} className=\"activity-item\">\n                <div className=\"activity-name\">{experience.name}</div>\n                <div className=\"activity-category\">{experience.type}</div>\n                <div className=\"activity-description\">{experience.description}</div>\n                <div className=\"activity-meta\">Location: {experience.location}</div>\n              </div>\n            ))\n          ) : (\n            <p className=\"no-activities\">No experiences planned yet</p>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n\n  return (\n    <div className=\"travel-content\">\n      <ItineraryStrip />\n      <AgentStatus />\n      <TravelDetails />\n    </div>\n  );\n}",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Travel Planning Subgraphs Demo Styles */\n/* Essential styles that cannot be achieved with Tailwind classes */\n\n/* Main container with CopilotSidebar layout */\n.travel-planner-container {\n  min-height: 100vh;\n  padding: 2rem;\n  background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);\n}\n\n/* Travel content area styles */\n.travel-content {\n  max-width: 1200px;\n  margin: 0 auto;\n  padding: 0 1rem;\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n}\n\n/* Itinerary strip */\n.itinerary-strip {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.itinerary-label {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #6b7280;\n  margin-bottom: 0.5rem;\n}\n\n.itinerary-items {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 1rem;\n}\n\n.itinerary-item {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  background: #f9fafb;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n}\n\n.item-icon {\n  font-size: 1rem;\n}\n\n/* Agent status */\n.agent-status {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.status-label {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #6b7280;\n  margin-bottom: 0.5rem;\n}\n\n.agent-indicators {\n  display: flex;\n  gap: 0.75rem;\n}\n\n.agent-indicator {\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n  padding: 0.5rem 0.75rem;\n  border-radius: 0.375rem;\n  font-size: 0.875rem;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  transition: all 0.2s ease;\n}\n\n.agent-indicator.active {\n  background: #dbeafe;\n  border-color: #3b82f6;\n  color: #1d4ed8;\n  box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);\n}\n\n/* Travel details sections */\n.travel-details {\n  background: white;\n  border-radius: 0.5rem;\n  padding: 1rem;\n  border: 1px solid #e5e7eb;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  display: grid;\n  gap: 1rem;\n}\n\n.details-section h4 {\n  font-size: 1rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 0.5rem;\n  display: flex;\n  align-items: center;\n  gap: 0.5rem;\n}\n\n.detail-items {\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n}\n\n.detail-item {\n  padding: 0.5rem;\n  background: #f9fafb;\n  border-radius: 0.25rem;\n  font-size: 0.875rem;\n  display: flex;\n  justify-content: space-between;\n}\n\n.detail-item strong {\n  color: #6b7280;\n  font-weight: 500;\n}\n\n.detail-tips {\n  padding: 0.5rem;\n  background: #eff6ff;\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  color: #1d4ed8;\n}\n\n.activity-item {\n  padding: 0.75rem;\n  background: #f0f9ff;\n  border-radius: 0.25rem;\n  border-left: 2px solid #0ea5e9;\n}\n\n.activity-name {\n  font-weight: 600;\n  color: #1f2937;\n  font-size: 0.875rem;\n  margin-bottom: 0.25rem;\n}\n\n.activity-category {\n  font-size: 0.75rem;\n  color: #0ea5e9;\n  margin-bottom: 0.25rem;\n}\n\n.activity-description {\n  color: #4b5563;\n  font-size: 0.75rem;\n  margin-bottom: 0.25rem;\n}\n\n.activity-meta {\n  font-size: 0.75rem;\n  color: #6b7280;\n}\n\n.no-activities {\n  text-align: center;\n  color: #9ca3af;\n  font-style: italic;\n  padding: 1rem;\n  font-size: 0.875rem;\n}\n\n/* Interrupt UI for Chat Sidebar (Generative UI) */\n.interrupt-container {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  max-width: 100%;\n  padding-top: 34px;\n}\n\n.interrupt-header {\n  margin-bottom: 0.5rem;\n}\n\n.agent-name {\n  font-size: 0.875rem;\n  font-weight: 600;\n  color: #1f2937;\n  margin: 0 0 0.25rem 0;\n}\n\n.agent-message {\n  font-size: 0.75rem;\n  color: #6b7280;\n  margin: 0;\n  line-height: 1.4;\n}\n\n.interrupt-options {\n    padding: 0.75rem;\n  display: flex;\n  flex-direction: column;\n  gap: 0.5rem;\n  max-height: 300px;\n  overflow-y: auto;\n}\n\n.option-card {\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  padding: 0.75rem;\n  background: #f9fafb;\n  border: 1px solid #e5e7eb;\n  border-radius: 0.5rem;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  text-align: left;\n  position: relative;\n  min-height: auto;\n}\n\n.option-card:hover {\n  background: #f3f4f6;\n  border-color: #d1d5db;\n}\n\n.option-card:active {\n  background: #e5e7eb;\n}\n\n.option-card.recommended {\n  background: #eff6ff;\n  border-color: #3b82f6;\n  box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.1);\n}\n\n.option-card.recommended:hover {\n  background: #dbeafe;\n}\n\n.recommendation-badge {\n  position: absolute;\n  top: -2px;\n  right: -2px;\n  background: #3b82f6;\n  color: white;\n  font-size: 0.625rem;\n  padding: 0.125rem 0.375rem;\n  border-radius: 0.75rem;\n  font-weight: 500;\n}\n\n.option-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.125rem;\n}\n\n.airline-name, .hotel-name {\n  font-weight: 600;\n  font-size: 0.8rem;\n  color: #1f2937;\n}\n\n.price, .rating {\n  font-weight: 600;\n  font-size: 0.75rem;\n  color: #059669;\n}\n\n.route-info, .location-info {\n  font-size: 0.7rem;\n  color: #6b7280;\n  margin-bottom: 0.125rem;\n}\n\n.duration-info, .price-info {\n  font-size: 0.7rem;\n  color: #9ca3af;\n}\n\n/* Mobile responsive adjustments */\n@media (max-width: 768px) {\n  .travel-planner-container {\n    padding: 0.5rem;\n    padding-bottom: 120px; /* Space for mobile chat */\n  }\n  \n  .travel-content {\n    padding: 0;\n    gap: 0.75rem;\n  }\n  \n  .itinerary-items {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .agent-indicators {\n    flex-direction: column;\n    gap: 0.5rem;\n  }\n  \n  .agent-indicator {\n    padding: 0.75rem;\n  }\n  \n  .travel-details {\n    padding: 0.75rem;\n  }\n\n  .interrupt-container {\n    padding: 0.5rem;\n  }\n\n  .option-card {\n    padding: 0.625rem;\n  }\n\n  .interrupt-options {\n    max-height: 250px;\n  }\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# LangGraph Subgraphs Demo: Travel Planning Assistant ✈️\n\nThis demo showcases **LangGraph subgraphs** through an interactive travel planning assistant. Watch as specialized AI agents collaborate to plan your perfect trip!\n\n## What are LangGraph Subgraphs? 🤖\n\n**Subgraphs** are the key to building modular, scalable AI systems in LangGraph. A subgraph is essentially \"a graph that is used as a node in another graph\" - enabling powerful encapsulation and reusability.\nFor more info, check out the [LangGraph docs](https://langchain-ai.github.io/langgraph/concepts/subgraphs/).\n\n### Key Concepts\n\n- **Encapsulation**: Each subgraph handles a specific domain with its own expertise\n- **Modularity**: Subgraphs can be developed, tested, and maintained independently  \n- **Reusability**: The same subgraph can be used across multiple parent graphs\n- **State Communication**: Subgraphs can share state or use different schemas with transformations\n\n## Demo Architecture 🗺️\n\nThis travel planner demonstrates **supervisor-coordinated subgraphs** with **human-in-the-loop** decision making:\n\n### Parent Graph: Travel Supervisor\n- **Role**: Coordinates the travel planning process and routes to specialized agents\n- **State Management**: Maintains a shared itinerary object across all subgraphs\n- **Intelligence**: Determines what's needed and when each agent should be called\n\n### Subgraph 1: ✈️ Flights Agent\n- **Specialization**: Finding and booking flight options\n- **Process**: Presents flight options from Amsterdam to San Francisco with recommendations\n- **Interaction**: Uses interrupts to let users choose their preferred flight\n- **Data**: Static flight options (KLM, United) with pricing and duration\n\n### Subgraph 2: 🏨 Hotels Agent  \n- **Specialization**: Finding and booking accommodation\n- **Process**: Shows hotel options in San Francisco with different price points\n- **Interaction**: Uses interrupts for user to select their preferred hotel\n- **Data**: Static hotel options (Hotel Zephyr, Ritz-Carlton, Hotel Zoe)\n\n### Subgraph 3: 🎯 Experiences Agent\n- **Specialization**: Curating restaurants and activities\n- **Process**: AI-powered recommendations based on selected flights and hotels\n- **Features**: Combines 2 restaurants and 2 activities with location-aware suggestions\n- **Data**: Static experiences (Pier 39, Golden Gate Bridge, Swan Oyster Depot, Tartine Bakery)\n\n## How It Works 🔄\n\n1. **User Request**: \"Help me plan a trip to San Francisco\"\n2. **Supervisor Analysis**: Determines what travel components are needed\n3. **Sequential Routing**: Routes to each agent in logical order:\n   - First: Flights Agent (get transportation sorted)\n   - Then: Hotels Agent (book accommodation)  \n   - Finally: Experiences Agent (plan activities)\n4. **Human Decisions**: Each agent presents options and waits for user choice via interrupts\n5. **State Building**: Selected choices are stored in the shared itinerary object\n6. **Completion**: All agents report back to supervisor for final coordination\n\n## State Communication Patterns 📊\n\n### Shared State Schema\nAll subgraph agents share and contribute to a common state object. When any agent updates the shared state, these changes are immediately reflected in the frontend through real-time syncing. This ensures that:\n\n- **Flight selections** from the Flights Agent are visible to subsequent agents\n- **Hotel choices** influence the Experiences Agent's recommendations  \n- **All updates** are synchronized with the frontend UI in real-time\n- **State persistence** maintains the travel itinerary throughout the workflow\n\n### Human-in-the-Loop Pattern\nTwo of the specialist agents use **interrupts** to pause execution and gather user preferences:\n\n- **Flights Agent**: Presents options → interrupt → waits for selection → continues\n- **Hotels Agent**: Shows hotels → interrupt → waits for choice → continues\n\n## Try These Examples! 💡\n\n### Getting Started\n- \"Help me plan a trip to San Francisco\"\n- \"I want to visit San Francisco from Amsterdam\"\n- \"Plan my travel itinerary\"\n\n### During the Process\nWhen the Flights Agent presents options:\n- Choose between KLM ($650, 11h 30m) or United ($720, 12h 15m)\n\nWhen the Hotels Agent shows accommodations:\n- Select from Hotel Zephyr, The Ritz-Carlton, or Hotel Zoe\n\nThe Experiences Agent will then provide tailored recommendations based on your choices!\n\n## Frontend Capabilities 👁️\n\n- **Human-in-the-loop with interrupts** from subgraphs for user decision making\n- **Subgraphs detection and streaming** to show which agent is currently active\n- **Real-time state updates** as the shared itinerary is built across agents\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA travel agent supervisor demo showcasing multi-agent architecture with subgraphs.\nThe supervisor coordinates specialized agents: flights finder, hotels finder, and experiences finder.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional, Annotated, Union\nfrom dataclasses import dataclass\nimport json\nimport os\nfrom pydantic import BaseModel, Field\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\n\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage, AIMessage\n\ndef create_interrupt(message: str, options: List[Any], recommendation: Any, agent: str):\n    return interrupt({\n        \"message\": message,\n        \"options\": options,\n        \"recommendation\": recommendation,\n        \"agent\": agent,\n    })\n\n# State schema for travel planning\n@dataclass\nclass Flight:\n    airline: str\n    departure: str\n    arrival: str\n    price: str\n    duration: str\n\n@dataclass\nclass Hotel:\n    name: str\n    location: str\n    price_per_night: str\n    rating: str\n\n@dataclass\nclass Experience:\n    name: str\n    type: str  # \"restaurant\" or \"activity\"\n    description: str\n    location: str\n\ndef merge_itinerary(left: Union[dict, None] = None, right: Union[dict, None] = None) -> dict:\n    \"\"\"Custom reducer to merge shopping cart updates.\"\"\"\n    if not left:\n        left = {}\n    if not right:\n        right = {}\n\n    return {**left, **right}\n\nclass TravelAgentState(MessagesState):\n    \"\"\"Shared state for the travel agent system\"\"\"\n    # Travel request details\n    origin: str = \"\"\n    destination: str = \"\"\n\n    # Results from each agent\n    flights: List[Flight] = None\n    hotels: List[Hotel] = None\n    experiences: List[Experience] = None\n\n    itinerary: Annotated[dict, merge_itinerary] = None\n\n    # Tools available to all agents\n    tools: List[Any] = None\n\n    # Supervisor routing\n    next_agent: Optional[str] = None\n\n# Static data for demonstration\nSTATIC_FLIGHTS = [\n    Flight(\"KLM\", \"Amsterdam (AMS)\", \"San Francisco (SFO)\", \"$650\", \"11h 30m\"),\n    Flight(\"United\", \"Amsterdam (AMS)\", \"San Francisco (SFO)\", \"$720\", \"12h 15m\")\n]\n\nSTATIC_HOTELS = [\n    Hotel(\"Hotel Zephyr\", \"Fisherman's Wharf\", \"$280/night\", \"4.2 stars\"),\n    Hotel(\"The Ritz-Carlton\", \"Nob Hill\", \"$550/night\", \"4.8 stars\"),\n    Hotel(\"Hotel Zoe\", \"Union Square\", \"$320/night\", \"4.4 stars\")\n]\n\nSTATIC_EXPERIENCES = [\n    Experience(\"Pier 39\", \"activity\", \"Iconic waterfront destination with shops and sea lions\", \"Fisherman's Wharf\"),\n    Experience(\"Golden Gate Bridge\", \"activity\", \"World-famous suspension bridge with stunning views\", \"Golden Gate\"),\n    Experience(\"Swan Oyster Depot\", \"restaurant\", \"Historic seafood counter serving fresh oysters\", \"Polk Street\"),\n    Experience(\"Tartine Bakery\", \"restaurant\", \"Artisanal bakery famous for bread and pastries\", \"Mission District\")\n]\n\n# Flights finder subgraph\nasync def flights_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds flight options\"\"\"\n\n    # Simulate flight search with static data\n    flights = STATIC_FLIGHTS\n\n    selected_flight = state.get('itinerary', {}).get('flight', None)\n    if not selected_flight:\n        selected_flight = create_interrupt(\n            message=f\"\"\"\n        Found {len(flights)} flight options from {state.get('origin', 'Amsterdam')} to {state.get('destination', 'San Francisco')}.\n        I recommend choosing the flight by {flights[0].airline} since it's known to be on time and cheaper.\n        \"\"\",\n            options=flights,\n            recommendation=flights[0],\n            agent=\"flights\"\n        )\n\n    if isinstance(selected_flight, str):\n        selected_flight = json.loads(selected_flight)\n    return Command(\n        goto=END,\n        update={\n            \"flights\": flights,\n            \"itinerary\": {\n                \"flight\": selected_flight\n            },\n            \"messages\": state[\"messages\"] + [{\n                \"role\": \"assistant\",\n                \"content\": f\"Flights Agent: Great. I'll book you the {selected_flight[\"airline\"]} flight from {selected_flight[\"departure\"]} to {selected_flight[\"arrival\"]}.\"\n            }]\n        }\n    )\n\n# Hotels finder subgraph\nasync def hotels_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds hotel options\"\"\"\n\n    # Simulate hotel search with static data\n    hotels = STATIC_HOTELS\n    selected_hotel = state.get('itinerary', {}).get('hotel', None)\n    if not selected_hotel:\n        selected_hotel = create_interrupt(\n            message=f\"\"\"\n        Found {len(hotels)} accommodation options in {state.get('destination', 'San Francisco')}.\n        I recommend choosing the {hotels[2].name} since it strikes the balance between rating, price, and location.\n        \"\"\",\n            options=hotels,\n            recommendation=hotels[2],\n            agent=\"hotels\"\n        )\n\n    if isinstance(selected_hotel, str):\n        selected_hotel = json.loads(selected_hotel)\n    return Command(\n            goto=END,\n            update={\n                \"hotels\": hotels,\n                \"itinerary\": {\n                    \"hotel\": selected_hotel\n                },\n                \"messages\": state[\"messages\"] + [{\n                    \"role\": \"assistant\",\n                    \"content\": f\"Hotels Agent: Excellent choice! You'll like {selected_hotel[\"name\"]}.\"\n                }]\n            }\n        )\n\n# Experiences finder subgraph\nasync def experiences_finder(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Subgraph that finds restaurant and activity recommendations\"\"\"\n\n    # Filter experiences (2 restaurants, 2 activities)\n    restaurants = [exp for exp in STATIC_EXPERIENCES if exp.type == \"restaurant\"][:2]\n    activities = [exp for exp in STATIC_EXPERIENCES if exp.type == \"activity\"][:2]\n    experiences = restaurants + activities\n\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    itinerary = state.get(\"itinerary\", {})\n\n    system_prompt = f\"\"\"\n    You are the experiences agent. Your job is to find restaurants and activities for the user.\n    You already went ahead and found a bunch of experiences. All you have to do now, is to let the user know of your findings.\n    \n    Current status:\n    - Origin: {state.get('origin', 'Amsterdam')}\n    - Destination: {state.get('destination', 'San Francisco')}\n    - Flight chosen: {itinerary.get(\"hotel\", None)}\n    - Hotel chosen: {itinerary.get(\"hotel\", None)}\n    - activities found: {activities}\n    - restaurants found: {restaurants}\n    \"\"\"\n\n    # Get supervisor decision\n    response = await model.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    return Command(\n        goto=END,\n        update={\n            \"experiences\": experiences,\n            \"messages\": state[\"messages\"] + [response]\n        }\n    )\n\nclass SupervisorResponseFormatter(BaseModel):\n    \"\"\"Always use this tool to structure your response to the user.\"\"\"\n    answer: str = Field(description=\"The answer to the user\")\n    next_agent: str | None = Field(description=\"The agent to go to. Not required if you do not want to route to another agent.\")\n\n# Supervisor agent\nasync def supervisor_agent(state: TravelAgentState, config: RunnableConfig):\n    \"\"\"Main supervisor that coordinates all subgraphs\"\"\"\n\n    itinerary = state.get(\"itinerary\", {})\n\n    # Check what's already completed\n    has_flights = itinerary.get(\"flight\", None) is not None\n    has_hotels = itinerary.get(\"hotel\", None) is not None\n    has_experiences = state.get(\"experiences\", None) is not None\n\n    system_prompt = f\"\"\"\n    You are a travel planning supervisor. Your job is to coordinate specialized agents to help plan a trip.\n    \n    Current status:\n    - Origin: {state.get('origin', 'Amsterdam')}\n    - Destination: {state.get('destination', 'San Francisco')}\n    - Flights found: {has_flights}\n    - Hotels found: {has_hotels}\n    - Experiences found: {has_experiences}\n    - Itinerary (Things that the user has already confirmed selection on): {json.dumps(itinerary, indent=2)}\n    \n    Available agents:\n    - flights_agent: Finds flight options\n    - hotels_agent: Finds hotel options  \n    - experiences_agent: Finds restaurant and activity recommendations\n    - {END}: Mark task as complete when all information is gathered\n    \n    You must route to the appropriate agent based on what's missing. Once all agents have completed their tasks, route to 'complete'.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Bind the routing tool\n    model_with_tools = model.bind_tools(\n        [SupervisorResponseFormatter],\n        parallel_tool_calls=False,\n    )\n\n    # Get supervisor decision\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls for routing\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        if isinstance(tool_call, dict):\n            tool_call_args = tool_call[\"args\"]\n        else:\n            tool_call_args = tool_call.args\n\n        next_agent = tool_call_args[\"next_agent\"]\n\n        # Add tool response\n        tool_response = {\n            \"role\": \"tool\",\n            \"content\": f\"Routing to {next_agent} and providing the answer\",\n            \"tool_call_id\": tool_call.id if hasattr(tool_call, 'id') else tool_call[\"id\"]\n        }\n\n        messages = messages + [tool_response, AIMessage(content=tool_call_args[\"answer\"])]\n\n        if next_agent is not None:\n            return Command(goto=next_agent)\n\n    # Fallback if no tool call\n    return Command(\n        goto=END,\n        update={\"messages\": messages}\n    )\n\n# Create subgraphs\nflights_graph = StateGraph(TravelAgentState)\nflights_graph.add_node(\"flights_agent_chat_node\", flights_finder)\nflights_graph.set_entry_point(\"flights_agent_chat_node\")\nflights_graph.add_edge(START, \"flights_agent_chat_node\")\nflights_graph.add_edge(\"flights_agent_chat_node\", END)\nflights_subgraph = flights_graph.compile()\n\nhotels_graph = StateGraph(TravelAgentState)\nhotels_graph.add_node(\"hotels_agent_chat_node\", hotels_finder)\nhotels_graph.set_entry_point(\"hotels_agent_chat_node\")\nhotels_graph.add_edge(START, \"hotels_agent_chat_node\")\nhotels_graph.add_edge(\"hotels_agent_chat_node\", END)\nhotels_subgraph = hotels_graph.compile()\n\nexperiences_graph = StateGraph(TravelAgentState)\nexperiences_graph.add_node(\"experiences_agent_chat_node\", experiences_finder)\nexperiences_graph.set_entry_point(\"experiences_agent_chat_node\")\nexperiences_graph.add_edge(START, \"experiences_agent_chat_node\")\nexperiences_graph.add_edge(\"experiences_agent_chat_node\", END)\nexperiences_subgraph = experiences_graph.compile()\n\n# Main supervisor workflow\nworkflow = StateGraph(TravelAgentState)\n\n# Add supervisor and subgraphs as nodes\nworkflow.add_node(\"supervisor\", supervisor_agent)\nworkflow.add_node(\"flights_agent\", flights_subgraph)\nworkflow.add_node(\"hotels_agent\", hotels_subgraph)\nworkflow.add_node(\"experiences_agent\", experiences_subgraph)\n\n# Set entry point\nworkflow.set_entry_point(\"supervisor\")\nworkflow.add_edge(START, \"supervisor\")\n\n# Add edges back to supervisor after each subgraph\nworkflow.add_edge(\"flights_agent\", \"supervisor\")\nworkflow.add_edge(\"hotels_agent\", \"supervisor\")\nworkflow.add_edge(\"experiences_agent\", \"supervisor\")\n\n# Conditionally use a checkpointer based on the environment\n# Check for multiple indicators that we're running in LangGraph dev/API mode\nis_fast_api = os.environ.get(\"LANGGRAPH_FAST_API\", \"false\").lower() == \"true\"\n\n# Compile the graph\nif is_fast_api:\n    # For CopilotKit and other contexts, use MemorySaver\n    from langgraph.checkpoint.memory import MemorySaver\n    memory = MemorySaver()\n    graph = workflow.compile(checkpointer=memory)\nelse:\n    # When running in LangGraph API/dev, don't use a custom checkpointer\n    graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    },
    {
      "name": "agent.ts",
      "content": "/**\n * A travel agent supervisor demo showcasing multi-agent architecture with subgraphs.\n * The supervisor coordinates specialized agents: flights finder, hotels finder, and experiences finder.\n */\n\nimport { ChatOpenAI } from \"@langchain/openai\";\nimport { SystemMessage, AIMessage, ToolMessage } from \"@langchain/core/messages\";\nimport { RunnableConfig } from \"@langchain/core/runnables\";\nimport { \n  Annotation, \n  MessagesAnnotation, \n  StateGraph, \n  Command, \n  START, \n  END, \n  interrupt \n} from \"@langchain/langgraph\";\n\n// Travel data interfaces\ninterface Flight {\n  airline: string;\n  departure: string;\n  arrival: string;\n  price: string;\n  duration: string;\n}\n\ninterface Hotel {\n  name: string;\n  location: string;\n  price_per_night: string;\n  rating: string;\n}\n\ninterface Experience {\n  name: string;\n  type: \"restaurant\" | \"activity\";\n  description: string;\n  location: string;\n}\n\ninterface Itinerary {\n  flight?: Flight;\n  hotel?: Hotel;\n}\n\n// Custom reducer to merge itinerary updates\nfunction mergeItinerary(left: Itinerary | null, right?: Itinerary | null): Itinerary {\n  if (!left) left = {};\n  if (!right) right = {};\n  return { ...left, ...right };\n}\n\n// State annotation for travel agent system\nexport const TravelAgentStateAnnotation = Annotation.Root({\n  origin: Annotation<string>(),\n  destination: Annotation<string>(),\n  flights: Annotation<Flight[] | null>(),\n  hotels: Annotation<Hotel[] | null>(),\n  experiences: Annotation<Experience[] | null>(),\n\n  // Itinerary with custom merger\n  itinerary: Annotation<Itinerary | null>({\n    reducer: mergeItinerary,\n    default: () => null\n  }),\n\n  // Tools available to all agents\n  tools: Annotation<any[]>({\n    reducer: (x, y) => y ?? x,\n    default: () => []\n  }),\n\n  // Supervisor routing\n  next_agent: Annotation<string | null>(),\n  ...MessagesAnnotation.spec,\n});\n\nexport type TravelAgentState = typeof TravelAgentStateAnnotation.State;\n\n// Static data for demonstration\nconst STATIC_FLIGHTS: Flight[] = [\n  { airline: \"KLM\", departure: \"Amsterdam (AMS)\", arrival: \"San Francisco (SFO)\", price: \"$650\", duration: \"11h 30m\" },\n  { airline: \"United\", departure: \"Amsterdam (AMS)\", arrival: \"San Francisco (SFO)\", price: \"$720\", duration: \"12h 15m\" }\n];\n\nconst STATIC_HOTELS: Hotel[] = [\n  { name: \"Hotel Zephyr\", location: \"Fisherman's Wharf\", price_per_night: \"$280/night\", rating: \"4.2 stars\" },\n  { name: \"The Ritz-Carlton\", location: \"Nob Hill\", price_per_night: \"$550/night\", rating: \"4.8 stars\" },\n  { name: \"Hotel Zoe\", location: \"Union Square\", price_per_night: \"$320/night\", rating: \"4.4 stars\" }\n];\n\nconst STATIC_EXPERIENCES: Experience[] = [\n  { name: \"Pier 39\", type: \"activity\", description: \"Iconic waterfront destination with shops and sea lions\", location: \"Fisherman's Wharf\" },\n  { name: \"Golden Gate Bridge\", type: \"activity\", description: \"World-famous suspension bridge with stunning views\", location: \"Golden Gate\" },\n  { name: \"Swan Oyster Depot\", type: \"restaurant\", description: \"Historic seafood counter serving fresh oysters\", location: \"Polk Street\" },\n  { name: \"Tartine Bakery\", type: \"restaurant\", description: \"Artisanal bakery famous for bread and pastries\", location: \"Mission District\" }\n];\n\nfunction createInterrupt(message: string, options: any[], recommendation: any, agent: string) {\n  return interrupt({\n    message,\n    options,\n    recommendation,\n    agent,\n  });\n}\n\n// Flights finder subgraph\nasync function flightsFinder(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  // Simulate flight search with static data\n  const flights = STATIC_FLIGHTS;\n\n  const selectedFlight = state.itinerary?.flight;\n  \n  let flightChoice: Flight;\n  const message = `Found ${flights.length} flight options from ${state.origin || 'Amsterdam'} to ${state.destination || 'San Francisco'}.\\n` +\n    `I recommend choosing the flight by ${flights[0].airline} since it's known to be on time and cheaper.`\n  if (!selectedFlight) {\n    const interruptResult = createInterrupt(\n      message,\n      flights,\n      flights[0],\n      \"flights\"\n    );\n    \n    // Parse the interrupt result if it's a string\n    flightChoice = typeof interruptResult === 'string' ? JSON.parse(interruptResult) : interruptResult;\n  } else {\n    flightChoice = selectedFlight;\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      flights: flights,\n      itinerary: {\n        flight: flightChoice\n      },\n      // Return all \"messages\" that the agent was sending\n      messages: [\n        ...state.messages,\n        new AIMessage({\n          content: message,\n        }),\n        new AIMessage({\n          content: `Flights Agent: Great. I'll book you the ${flightChoice.airline} flight from ${flightChoice.departure} to ${flightChoice.arrival}.`,\n        }),\n      ]\n    }\n  });\n}\n\n// Hotels finder subgraph\nasync function hotelsFinder(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  // Simulate hotel search with static data\n  const hotels = STATIC_HOTELS;\n  const selectedHotel = state.itinerary?.hotel;\n  \n  let hotelChoice: Hotel;\n  const message = `Found ${hotels.length} accommodation options in ${state.destination || 'San Francisco'}.\\n\n    I recommend choosing the ${hotels[2].name} since it strikes the balance between rating, price, and location.`\n  if (!selectedHotel) {\n    const interruptResult = createInterrupt(\n      message,\n      hotels,\n      hotels[2],\n      \"hotels\"\n    );\n    \n    // Parse the interrupt result if it's a string\n    hotelChoice = typeof interruptResult === 'string' ? JSON.parse(interruptResult) : interruptResult;\n  } else {\n    hotelChoice = selectedHotel;\n  }\n\n  return new Command({\n    goto: END,\n    update: {\n      hotels: hotels,\n      itinerary: {\n        hotel: hotelChoice\n      },\n      // Return all \"messages\" that the agent was sending\n      messages: [\n        ...state.messages,\n        new AIMessage({\n          content: message,\n        }),\n        new AIMessage({\n          content: `Hotels Agent: Excellent choice! You'll like ${hotelChoice.name}.`\n        }),\n      ]\n    }\n  });\n}\n\n// Experiences finder subgraph\nasync function experiencesFinder(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  // Filter experiences (2 restaurants, 2 activities)\n  const restaurants = STATIC_EXPERIENCES.filter(exp => exp.type === \"restaurant\").slice(0, 2);\n  const activities = STATIC_EXPERIENCES.filter(exp => exp.type === \"activity\").slice(0, 2);\n  const experiences = [...restaurants, ...activities];\n\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  const itinerary = state.itinerary || {};\n\n  const systemPrompt = `\n    You are the experiences agent. Your job is to find restaurants and activities for the user.\n    You already went ahead and found a bunch of experiences. All you have to do now, is to let the user know of your findings.\n    \n    Current status:\n    - Origin: ${state.origin || 'Amsterdam'}\n    - Destination: ${state.destination || 'San Francisco'}\n    - Flight chosen: ${JSON.stringify(itinerary.flight) || 'None'}\n    - Hotel chosen: ${JSON.stringify(itinerary.hotel) || 'None'}\n    - Activities found: ${JSON.stringify(activities)}\n    - Restaurants found: ${JSON.stringify(restaurants)}\n    `;\n\n  // Get experiences response\n  const response = await model.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  return new Command({\n    goto: END,\n    update: {\n      experiences: experiences,\n      messages: [...state.messages, response]\n    }\n  });\n}\n\n// Supervisor response tool\nconst SUPERVISOR_RESPONSE_TOOL = {\n  type: \"function\" as const,\n  function: {\n    name: \"supervisor_response\",\n    description: \"Always use this tool to structure your response to the user.\",\n    parameters: {\n      type: \"object\",\n      properties: {\n        answer: {\n          type: \"string\",\n          description: \"The answer to the user\"\n        },\n        next_agent: {\n          type: \"string\",\n          enum: [\"flights_agent\", \"hotels_agent\", \"experiences_agent\", \"complete\"],\n          description: \"The agent to go to. Not required if you do not want to route to another agent.\"\n        }\n      },\n      required: [\"answer\"]\n    }\n  }\n};\n\n// Supervisor agent\nasync function supervisorAgent(state: TravelAgentState, config?: RunnableConfig): Promise<Command> {\n  const itinerary = state.itinerary || {};\n\n  // Check what's already completed\n  const hasFlights = itinerary.flight !== undefined;\n  const hasHotels = itinerary.hotel !== undefined;\n  const hasExperiences = state.experiences !== null;\n\n  const systemPrompt = `\n    You are a travel planning supervisor. Your job is to coordinate specialized agents to help plan a trip.\n    \n    Current status:\n    - Origin: ${state.origin || 'Amsterdam'}\n    - Destination: ${state.destination || 'San Francisco'}\n    - Flights found: ${hasFlights}\n    - Hotels found: ${hasHotels}\n    - Experiences found: ${hasExperiences}\n    - Itinerary (Things that the user has already confirmed selection on): ${JSON.stringify(itinerary, null, 2)}\n    \n    Available agents:\n    - flights_agent: Finds flight options\n    - hotels_agent: Finds hotel options  \n    - experiences_agent: Finds restaurant and activity recommendations\n    - complete: Mark task as complete when all information is gathered\n    \n    You must route to the appropriate agent based on what's missing. Once all agents have completed their tasks, route to 'complete'.\n    `;\n\n  // Define the model\n  const model = new ChatOpenAI({ model: \"gpt-4o\" });\n\n  if (!config) {\n    config = { recursionLimit: 25 };\n  }\n\n  // Bind the routing tool\n  const modelWithTools = model.bindTools(\n    [SUPERVISOR_RESPONSE_TOOL],\n    {\n      parallel_tool_calls: false,\n    }\n  );\n\n  // Get supervisor decision\n  const response = await modelWithTools.invoke([\n    new SystemMessage({ content: systemPrompt }),\n    ...state.messages,\n  ], config);\n\n  let messages = [...state.messages, response];\n\n  // Handle tool calls for routing\n  if (response.tool_calls && response.tool_calls.length > 0) {\n    const toolCall = response.tool_calls[0];\n    const toolCallArgs = toolCall.args;\n    const nextAgent = toolCallArgs.next_agent;\n\n    const toolResponse = new ToolMessage({\n      tool_call_id: toolCall.id!,\n      content: `Routing to ${nextAgent} and providing the answer`,\n    });\n\n    messages = [\n      ...messages, \n      toolResponse, \n      new AIMessage({ content: toolCallArgs.answer })\n    ];\n\n    if (nextAgent && nextAgent !== \"complete\") {\n      return new Command({ goto: nextAgent });\n    }\n  }\n\n  // Fallback if no tool call or complete\n  return new Command({\n    goto: END,\n    update: { messages }\n  });\n}\n\n// Create subgraphs\nconst flightsGraph = new StateGraph(TravelAgentStateAnnotation);\nflightsGraph.addNode(\"flights_agent_chat_node\", flightsFinder);\nflightsGraph.setEntryPoint(\"flights_agent_chat_node\");\nflightsGraph.addEdge(START, \"flights_agent_chat_node\");\nflightsGraph.addEdge(\"flights_agent_chat_node\", END);\nconst flightsSubgraph = flightsGraph.compile();\n\nconst hotelsGraph = new StateGraph(TravelAgentStateAnnotation);\nhotelsGraph.addNode(\"hotels_agent_chat_node\", hotelsFinder);\nhotelsGraph.setEntryPoint(\"hotels_agent_chat_node\");\nhotelsGraph.addEdge(START, \"hotels_agent_chat_node\");\nhotelsGraph.addEdge(\"hotels_agent_chat_node\", END);\nconst hotelsSubgraph = hotelsGraph.compile();\n\nconst experiencesGraph = new StateGraph(TravelAgentStateAnnotation);\nexperiencesGraph.addNode(\"experiences_agent_chat_node\", experiencesFinder);\nexperiencesGraph.setEntryPoint(\"experiences_agent_chat_node\");\nexperiencesGraph.addEdge(START, \"experiences_agent_chat_node\");\nexperiencesGraph.addEdge(\"experiences_agent_chat_node\", END);\nconst experiencesSubgraph = experiencesGraph.compile();\n\n// Main supervisor workflow\nconst workflow = new StateGraph(TravelAgentStateAnnotation);\n\n// Add supervisor and subgraphs as nodes\nworkflow.addNode(\"supervisor\", supervisorAgent, { ends: ['flights_agent', 'hotels_agent', 'experiences_agent', END] });\nworkflow.addNode(\"flights_agent\", flightsSubgraph);\nworkflow.addNode(\"hotels_agent\", hotelsSubgraph);\nworkflow.addNode(\"experiences_agent\", experiencesSubgraph);\n\n// Set entry point\nworkflow.setEntryPoint(\"supervisor\");\nworkflow.addEdge(START, \"supervisor\");\n\n// Add edges back to supervisor after each subgraph\nworkflow.addEdge(\"flights_agent\", \"supervisor\");\nworkflow.addEdge(\"hotels_agent\", \"supervisor\");\nworkflow.addEdge(\"experiences_agent\", \"supervisor\");\n\n// Compile the graph\nexport const subGraphsAgentGraph = workflow.compile();\n",
      "language": "ts",
      "type": "file"
    }
  ],
  "agno::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    }
  ],
  "agno::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    }
  ],
  "llama-index::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "from llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\nfrom typing import Annotated\n\n\n# This tool has a client-side version that is actually called to change the background\ndef change_background(\n    background: Annotated[str, \"The background. Prefer gradients.\"],\n) -> str:\n    \"\"\"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\"\"\"\n    return f\"Changing background to {background}\"\n\nagentic_chat_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[change_background],\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "from typing import Literal, List\nfrom pydantic import BaseModel\n\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\n\n\n\nclass Step(BaseModel):\n    description: str\n    status: Literal[\"enabled\", \"disabled\", \"executing\"]\n\n\ndef generate_task_steps(steps: List[Step]) -> str:\n    return f\"Generated {len(steps)} steps\"\n\n\nhuman_in_the_loop_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[generate_task_steps],\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "import asyncio\nimport copy\nimport jsonpatch\nfrom pydantic import BaseModel\n\nfrom llama_index.core.workflow import Context\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\nfrom llama_index.protocols.ag_ui.events import StateDeltaWorkflowEvent, StateSnapshotWorkflowEvent\n\nclass Step(BaseModel):\n    description: str\n\nclass Task(BaseModel):\n    steps: list[Step]\n\n# Genrative UI demo\nasync def run_task(\n    ctx: Context, task: Task,\n) -> str:\n    \"\"\"Execute any list of steps needed to complete a task. Useful for anything the user wants to do.\"\"\"\n\n    async with ctx.store.edit_state() as global_state:\n        state = global_state.get(\"state\", {})\n        task = Task.model_validate(task)\n\n        state = {\n            \"steps\": [\n                {\n                    \"description\": step.description,\n                    \"status\": \"pending\"\n                }\n                for step in task.steps\n            ]\n        }\n\n        # Send initial state snapshot\n        ctx.write_event_to_stream(\n            StateSnapshotWorkflowEvent(\n                snapshot=state\n            )\n        )\n\n        # Sleep for 1 second\n        await asyncio.sleep(1.0)\n\n        # Create a copy to track changes for JSON patches\n        previous_state = copy.deepcopy(state)\n\n        # Update each step and send deltas\n        for i, step in enumerate(state[\"steps\"]):\n            step[\"status\"] = \"completed\"\n            \n            # Generate JSON patch from previous state to current state\n            patch = jsonpatch.make_patch(previous_state, state)\n            \n            # Send state delta event\n            ctx.write_event_to_stream(\n                StateDeltaWorkflowEvent(\n                    delta=patch.patch\n                )\n            )\n            \n            # Update previous state for next iteration\n            previous_state = copy.deepcopy(state)\n            \n            # Sleep for 1 second\n            await asyncio.sleep(1.0)\n\n        # Optionally send a final snapshot to the client\n        ctx.write_event_to_stream(\n            StateSnapshotWorkflowEvent(\n                snapshot=state\n            )\n        )\n\n        global_state[\"state\"] = state\n\n    return \"Task Done!\"\n\n\nagentic_generative_ui_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    backend_tools=[run_task],\n    initial_state={},\n    system_prompt=(\n        \"You are a helpful assistant that can help the user with their task. \"\n        \"If the user asks you to do any task, use the run_task tool to do it. \"\n        \"Use your best judgement to describe the steps.\"\n    )\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "from typing import Literal, List\nfrom pydantic import BaseModel\n\nfrom llama_index.core.workflow import Context\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.events import StateSnapshotWorkflowEvent\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\n\n\nclass Ingredient(BaseModel):\n    icon: str\n    name: str\n    amount: str\n\nclass Recipe(BaseModel):\n    skill_level: str\n    special_preferences: List[str]\n    cooking_time: str\n    ingredients: List[Ingredient]\n    instructions: List[str]\n\n\nasync def update_recipe(ctx: Context, recipe: Recipe) -> str:\n    \"\"\"Useful for recording a recipe to shared state.\"\"\"\n    recipe = Recipe.model_validate(recipe)\n\n    async with ctx.store.edit_state() as global_state:\n        state = global_state.get(\"state\", {})\n        if state is None:\n            state = {}\n\n        state[\"recipe\"] = recipe.model_dump()\n\n        ctx.write_event_to_stream(\n            StateSnapshotWorkflowEvent(\n                snapshot=state\n            )\n        )\n\n        global_state[\"state\"] = state\n\n    return \"Recipe updated!\"\n\n\nshared_state_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[update_recipe],\n    initial_state={\n        \"recipe\": None,\n    }\n)\n\n\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::backend_tool_rendering": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"backend_tool_rendering\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  useCopilotAction({\n    name: \"get_weather\",\n    available: \"disabled\",\n    parameters: [{ name: \"location\", type: \"string\", required: true }],\n    render: ({ args, result, status }) => {\n      if (status !== \"complete\") {\n        return (\n          <div className=\" bg-[#667eea] text-white p-4 rounded-lg max-w-md\">\n            <span className=\"animate-spin\">⚙️ Retrieving weather...</span>\n          </div>\n        );\n      }\n\n      const weatherResult: WeatherToolResult = {\n        temperature: result.temperature || 0,\n        conditions: result.conditions || \"clear\",\n        humidity: result.humidity || 0,\n        windSpeed: result.wind_speed || 0,\n        feelsLike: result.feels_like || result.temperature || 0,\n      };\n\n      const themeColor = getThemeColor(weatherResult.conditions);\n\n      return (\n        <WeatherCard\n          location={args.location}\n          themeColor={themeColor}\n          result={weatherResult}\n          status={status || \"complete\"}\n        />\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi! I can look up the weather for you. Just ask!\" }}\n          suggestions={[\n            {\n              title: \"Weather in San Francisco\",\n              message: \"What's the weather like in San Francisco?\",\n            },\n            {\n              title: \"Weather in New York\",\n              message: \"Tell me about the weather in New York.\",\n            },\n            {\n              title: \"Weather in Tokyo\",\n              message: \"How's the weather in Tokyo today?\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\ninterface WeatherToolResult {\n  temperature: number;\n  conditions: string;\n  humidity: number;\n  windSpeed: number;\n  feelsLike: number;\n}\n\nfunction getThemeColor(conditions: string): string {\n  const conditionLower = conditions.toLowerCase();\n  if (conditionLower.includes(\"clear\") || conditionLower.includes(\"sunny\")) {\n    return \"#667eea\";\n  }\n  if (conditionLower.includes(\"rain\") || conditionLower.includes(\"storm\")) {\n    return \"#4A5568\";\n  }\n  if (conditionLower.includes(\"cloud\")) {\n    return \"#718096\";\n  }\n  if (conditionLower.includes(\"snow\")) {\n    return \"#63B3ED\";\n  }\n  return \"#764ba2\";\n}\n\nfunction WeatherCard({\n  location,\n  themeColor,\n  result,\n  status,\n}: {\n  location?: string;\n  themeColor: string;\n  result: WeatherToolResult;\n  status: \"inProgress\" | \"executing\" | \"complete\";\n}) {\n  return (\n    <div\n      data-testid=\"weather-card\"\n      style={{ backgroundColor: themeColor }}\n      className=\"rounded-xl mt-6 mb-4 max-w-md w-full\"\n    >\n      <div className=\"bg-white/20 p-4 w-full\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h3 data-testid=\"weather-city\" className=\"text-xl font-bold text-white capitalize\">\n              {location}\n            </h3>\n            <p className=\"text-white\">Current Weather</p>\n          </div>\n          <WeatherIcon conditions={result.conditions} />\n        </div>\n\n        <div className=\"mt-4 flex items-end justify-between\">\n          <div className=\"text-3xl font-bold text-white\">\n            <span className=\"\">{result.temperature}° C</span>\n            <span className=\"text-sm text-white/50\">\n              {\" / \"}\n              {((result.temperature * 9) / 5 + 32).toFixed(1)}° F\n            </span>\n          </div>\n          <div className=\"text-sm text-white capitalize\">{result.conditions}</div>\n        </div>\n\n        <div className=\"mt-4 pt-4 border-t border-white\">\n          <div className=\"grid grid-cols-3 gap-2 text-center\">\n            <div data-testid=\"weather-humidity\">\n              <p className=\"text-white text-xs\">Humidity</p>\n              <p className=\"text-white font-medium\">{result.humidity}%</p>\n            </div>\n            <div data-testid=\"weather-wind\">\n              <p className=\"text-white text-xs\">Wind</p>\n              <p className=\"text-white font-medium\">{result.windSpeed} mph</p>\n            </div>\n            <div data-testid=\"weather-feels-like\">\n              <p className=\"text-white text-xs\">Feels Like</p>\n              <p className=\"text-white font-medium\">{result.feelsLike}°</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nfunction WeatherIcon({ conditions }: { conditions: string }) {\n  if (!conditions) return null;\n\n  if (conditions.toLowerCase().includes(\"clear\") || conditions.toLowerCase().includes(\"sunny\")) {\n    return <SunIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"rain\") ||\n    conditions.toLowerCase().includes(\"drizzle\") ||\n    conditions.toLowerCase().includes(\"snow\") ||\n    conditions.toLowerCase().includes(\"thunderstorm\")\n  ) {\n    return <RainIcon />;\n  }\n\n  if (\n    conditions.toLowerCase().includes(\"fog\") ||\n    conditions.toLowerCase().includes(\"cloud\") ||\n    conditions.toLowerCase().includes(\"overcast\")\n  ) {\n    return <CloudIcon />;\n  }\n\n  return <CloudIcon />;\n}\n\n// Simple sun icon for the weather card\nfunction SunIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-yellow-200\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"5\" />\n      <path\n        d=\"M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42\"\n        strokeWidth=\"2\"\n        stroke=\"currentColor\"\n      />\n    </svg>\n  );\n}\n\nfunction RainIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-blue-200\"\n    >\n      {/* Cloud */}\n      <path\n        d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\"\n        fill=\"currentColor\"\n        opacity=\"0.8\"\n      />\n      {/* Rain drops */}\n      <path\n        d=\"M8 18l2 4M12 18l2 4M16 18l2 4\"\n        stroke=\"currentColor\"\n        strokeWidth=\"2\"\n        strokeLinecap=\"round\"\n        fill=\"none\"\n      />\n    </svg>\n  );\n}\n\nfunction CloudIcon() {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"currentColor\"\n      className=\"w-14 h-14 text-gray-200\"\n    >\n      <path d=\"M7 15a4 4 0 0 1 0-8 5 5 0 0 1 10 0 4 4 0 0 1 0 8H7z\" fill=\"currentColor\" />\n    </svg>\n  );\n}\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "backend_tool_rendering.py",
      "content": "\"\"\"Backend Tool Rendering feature.\"\"\"\n\nfrom __future__ import annotations\n\nfrom datetime import datetime\nimport json\nfrom textwrap import dedent\nfrom zoneinfo import ZoneInfo\n\nimport httpx\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\n\n\ndef get_weather_condition(code: int) -> str:\n    \"\"\"Map weather code to human-readable condition.\n\n    Args:\n        code: WMO weather code.\n\n    Returns:\n        Human-readable weather condition string.\n    \"\"\"\n    conditions = {\n        0: \"Clear sky\",\n        1: \"Mainly clear\",\n        2: \"Partly cloudy\",\n        3: \"Overcast\",\n        45: \"Foggy\",\n        48: \"Depositing rime fog\",\n        51: \"Light drizzle\",\n        53: \"Moderate drizzle\",\n        55: \"Dense drizzle\",\n        56: \"Light freezing drizzle\",\n        57: \"Dense freezing drizzle\",\n        61: \"Slight rain\",\n        63: \"Moderate rain\",\n        65: \"Heavy rain\",\n        66: \"Light freezing rain\",\n        67: \"Heavy freezing rain\",\n        71: \"Slight snow fall\",\n        73: \"Moderate snow fall\",\n        75: \"Heavy snow fall\",\n        77: \"Snow grains\",\n        80: \"Slight rain showers\",\n        81: \"Moderate rain showers\",\n        82: \"Violent rain showers\",\n        85: \"Slight snow showers\",\n        86: \"Heavy snow showers\",\n        95: \"Thunderstorm\",\n        96: \"Thunderstorm with slight hail\",\n        99: \"Thunderstorm with heavy hail\",\n    }\n    return conditions.get(code, \"Unknown\")\n\n\nasync def get_weather(location: str) -> str:\n    \"\"\"Get current weather for a location.\n\n    Args:\n        location: City name.\n\n    Returns:\n        Dictionary with weather information including temperature, feels like,\n        humidity, wind speed, wind gust, conditions, and location name.\n    \"\"\"\n    async with httpx.AsyncClient() as client:\n        # Geocode the location\n        geocoding_url = (\n            f\"https://geocoding-api.open-meteo.com/v1/search?name={location}&count=1\"\n        )\n        geocoding_response = await client.get(geocoding_url)\n        geocoding_data = geocoding_response.json()\n\n        if not geocoding_data.get(\"results\"):\n            raise ValueError(f\"Location '{location}' not found\")\n\n        result = geocoding_data[\"results\"][0]\n        latitude = result[\"latitude\"]\n        longitude = result[\"longitude\"]\n        name = result[\"name\"]\n\n        # Get weather data\n        weather_url = (\n            f\"https://api.open-meteo.com/v1/forecast?\"\n            f\"latitude={latitude}&longitude={longitude}\"\n            f\"&current=temperature_2m,apparent_temperature,relative_humidity_2m,\"\n            f\"wind_speed_10m,wind_gusts_10m,weather_code\"\n        )\n        weather_response = await client.get(weather_url)\n        weather_data = weather_response.json()\n\n        current = weather_data[\"current\"]\n\n        return json.dumps({\n            \"temperature\": current[\"temperature_2m\"],\n            \"feelsLike\": current[\"apparent_temperature\"],\n            \"humidity\": current[\"relative_humidity_2m\"],\n            \"windSpeed\": current[\"wind_speed_10m\"],\n            \"windGust\": current[\"wind_gusts_10m\"],\n            \"conditions\": get_weather_condition(current[\"weather_code\"]),\n            \"location\": name,\n        })\n\n\n# Create the router with weather tools\nbackend_tool_rendering_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4o-mini\"),\n    backend_tools=[get_weather],\n    system_prompt=dedent(\n        \"\"\"\n        You are a helpful weather assistant that provides accurate weather information.\n\n      Your primary function is to help users get weather details for specific locations. When responding:\n      - Always ask for a location if none is provided\n      - If the location name isn’t in English, please translate it\n      - If giving a location with multiple parts (e.g. \"New York, NY\"), use the most relevant part (e.g. \"New York\")\n      - Include relevant details like humidity, wind conditions, and precipitation\n      - Keep responses concise but informative\n\n      Use the get_weather tool to fetch current weather data.\n        \"\"\"\n    ),\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients. Only use when asked.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div\n      className=\"flex justify-center items-center h-full w-full\"\n      data-testid=\"background-container\"\n      style={{ background }}\n    >\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n          suggestions={[\n            {\n              title: \"Change background\",\n              message: \"Change the background to something new.\",\n            },\n            {\n              title: \"Generate sonnet\",\n              message: \"Write a short sonnet about AI.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "\"\"\"\nA simple agentic chat flow.\n\"\"\"\n\nfrom crewai.flow.flow import Flow, start\nfrom litellm import completion\nfrom ..sdk import copilotkit_stream, CopilotKitState\n\nclass AgenticChatFlow(Flow[CopilotKitState]):\n\n    @start()\n    async def chat(self):\n        system_prompt = \"You are a helpful assistant.\"\n\n        # 1. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 1.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 1.2 Bind the available tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                ],\n\n                # 1.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 2. Append the message to the messages in state\n        self.state.messages.append(message)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat integrationId={integrationId} />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\n\n// Shared UI Components\nconst StepContainer = ({ theme, children }: { theme?: string; children: React.ReactNode }) => (\n  <div data-testid=\"select-steps\" className=\"flex\">\n    <div\n      className={`relative rounded-xl w-[600px] p-6 shadow-lg backdrop-blur-sm ${\n        theme === \"dark\"\n          ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n          : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n      }`}\n    >\n      {children}\n    </div>\n  </div>\n);\n\nconst StepHeader = ({\n  theme,\n  enabledCount,\n  totalCount,\n  status,\n  showStatus = false,\n}: {\n  theme?: string;\n  enabledCount: number;\n  totalCount: number;\n  status?: string;\n  showStatus?: boolean;\n}) => (\n  <div className=\"mb-5\">\n    <div className=\"flex items-center justify-between mb-3\">\n      <h2 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n        Select Steps\n      </h2>\n      <div className=\"flex items-center gap-3\">\n        <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n          {enabledCount}/{totalCount} Selected\n        </div>\n        {showStatus && (\n          <div\n            className={`text-xs px-2 py-1 rounded-full font-medium ${\n              status === \"executing\"\n                ? theme === \"dark\"\n                  ? \"bg-blue-900/30 text-blue-300 border border-blue-500/30\"\n                  : \"bg-blue-50 text-blue-600 border border-blue-200\"\n                : theme === \"dark\"\n                  ? \"bg-slate-700 text-slate-300\"\n                  : \"bg-gray-100 text-gray-600\"\n            }`}\n          >\n            {status === \"executing\" ? \"Ready\" : \"Waiting\"}\n          </div>\n        )}\n      </div>\n    </div>\n\n    <div\n      className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n    >\n      <div\n        className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-500 ease-out\"\n        style={{ width: `${totalCount > 0 ? (enabledCount / totalCount) * 100 : 0}%` }}\n      />\n    </div>\n  </div>\n);\n\nconst StepItem = ({\n  step,\n  theme,\n  status,\n  onToggle,\n  disabled = false,\n}: {\n  step: { description: string; status: string };\n  theme?: string;\n  status?: string;\n  onToggle: () => void;\n  disabled?: boolean;\n}) => (\n  <div\n    className={`flex items-center p-3 rounded-lg transition-all duration-300 ${\n      step.status === \"enabled\"\n        ? theme === \"dark\"\n          ? \"bg-gradient-to-r from-blue-900/20 to-purple-900/10 border border-blue-500/30\"\n          : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60\"\n        : theme === \"dark\"\n          ? \"bg-slate-800/30 border border-slate-600/30\"\n          : \"bg-gray-50/50 border border-gray-200/40\"\n    }`}\n  >\n    <label data-testid=\"step-item\" className=\"flex items-center cursor-pointer w-full\">\n      <div className=\"relative\">\n        <input\n          type=\"checkbox\"\n          checked={step.status === \"enabled\"}\n          onChange={onToggle}\n          className=\"sr-only\"\n          disabled={disabled}\n        />\n        <div\n          className={`w-5 h-5 rounded border-2 flex items-center justify-center transition-all duration-200 ${\n            step.status === \"enabled\"\n              ? \"bg-gradient-to-br from-blue-500 to-purple-600 border-blue-500\"\n              : theme === \"dark\"\n                ? \"border-slate-400 bg-slate-700\"\n                : \"border-gray-300 bg-white\"\n          } ${disabled ? \"opacity-60\" : \"\"}`}\n        >\n          {step.status === \"enabled\" && (\n            <svg\n              className=\"w-3 h-3 text-white\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={3}\n                d=\"M5 13l4 4L19 7\"\n              />\n            </svg>\n          )}\n        </div>\n      </div>\n      <span\n        data-testid=\"step-text\"\n        className={`ml-3 font-medium transition-all duration-300 ${\n          step.status !== \"enabled\" && status != \"inProgress\"\n            ? `line-through ${theme === \"dark\" ? \"text-slate-500\" : \"text-gray-400\"}`\n            : theme === \"dark\"\n              ? \"text-white\"\n              : \"text-gray-800\"\n        } ${disabled ? \"opacity-60\" : \"\"}`}\n      >\n        {step.description}\n      </span>\n    </label>\n  </div>\n);\n\nconst ActionButton = ({\n  variant,\n  theme,\n  disabled,\n  onClick,\n  children,\n}: {\n  variant: \"primary\" | \"secondary\" | \"success\" | \"danger\";\n  theme?: string;\n  disabled?: boolean;\n  onClick: () => void;\n  children: React.ReactNode;\n}) => {\n  const baseClasses = \"px-6 py-3 rounded-lg font-semibold transition-all duration-200\";\n  const enabledClasses = \"hover:scale-105 shadow-md hover:shadow-lg\";\n  const disabledClasses = \"opacity-50 cursor-not-allowed\";\n\n  const variantClasses = {\n    primary:\n      \"bg-gradient-to-r from-purple-500 to-purple-700 hover:from-purple-600 hover:to-purple-800 text-white shadow-lg hover:shadow-xl\",\n    secondary:\n      theme === \"dark\"\n        ? \"bg-slate-700 hover:bg-slate-600 text-white border border-slate-600 hover:border-slate-500\"\n        : \"bg-gray-100 hover:bg-gray-200 text-gray-800 border border-gray-300 hover:border-gray-400\",\n    success:\n      \"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white shadow-lg hover:shadow-xl\",\n    danger:\n      \"bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white shadow-lg hover:shadow-xl\",\n  };\n\n  return (\n    <button\n      className={`${baseClasses} ${disabled ? disabledClasses : enabledClasses} ${\n        disabled && variant === \"secondary\"\n          ? \"bg-gray-200 text-gray-500\"\n          : disabled && variant === \"success\"\n            ? \"bg-gray-400\"\n            : variantClasses[variant]\n      }`}\n      disabled={disabled}\n      onClick={onClick}\n    >\n      {children}\n    </button>\n  );\n};\n\nconst DecorativeElements = ({\n  theme,\n  variant = \"default\",\n}: {\n  theme?: string;\n  variant?: \"default\" | \"success\" | \"danger\";\n}) => (\n  <>\n    <div\n      className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n        variant === \"success\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n            : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n          : variant === \"danger\"\n            ? theme === \"dark\"\n              ? \"bg-gradient-to-br from-red-500/10 to-pink-500/10\"\n              : \"bg-gradient-to-br from-red-200/30 to-pink-200/30\"\n            : theme === \"dark\"\n              ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n              : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n      }`}\n    />\n    <div\n      className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n        variant === \"default\"\n          ? theme === \"dark\"\n            ? \"bg-gradient-to-br from-purple-500/10 to-pink-500/10\"\n            : \"bg-gradient-to-br from-purple-200/30 to-pink-200/30\"\n          : \"opacity-50\"\n      }`}\n    />\n  </>\n);\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  const { theme } = useTheme();\n\n  // Parse and initialize steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n  const enabledCount = localSteps.filter((step) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handlePerformSteps = () => {\n    const selectedSteps = localSteps\n      .filter((step) => step.status === \"enabled\")\n      .map((step) => step.description);\n    resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader theme={theme} enabledCount={enabledCount} totalCount={localSteps.length} />\n\n      <div className=\"space-y-3 mb-6\">\n        {localSteps.map((step, index) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            onToggle={() => handleStepToggle(index)}\n          />\n        ))}\n      </div>\n\n      <div className=\"flex justify-center\">\n        <ActionButton variant=\"primary\" theme={theme} onClick={handlePerformSteps}>\n          <span className=\"text-lg\">✨</span>\n          Perform Steps\n          <span\n            className={`ml-1 px-2 py-1 rounded-full text-xs font-bold ${\n              theme === \"dark\" ? \"bg-purple-800/50\" : \"bg-purple-600/20\"\n            }`}\n          >\n            {enabledCount}\n          </span>\n        </ActionButton>\n      </div>\n\n      <DecorativeElements theme={theme} />\n    </StepContainer>\n  );\n};\n\nconst Chat = ({ integrationId }: { integrationId: string }) => {\n  // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n  // This hook won't do anything for other integrations.\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    // Langgraph uses it's own hook to handle human-in-the-loop interactions via langgraph interrupts,\n    // so don't use this action for langgraph integration.\n    available: [\"langgraph\", \"langgraph-fastapi\", \"langgraph-typescript\"].includes(integrationId)\n      ? \"disabled\"\n      : \"enabled\",\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          suggestions={[\n            { title: \"Simple plan\", message: \"Please plan a trip to mars in 5 steps.\" },\n            { title: \"Complex plan\", message: \"Please plan a pastra dish in 10 steps.\" },\n          ]}\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const { theme } = useTheme();\n  const [localSteps, setLocalSteps] = useState<Step[]>([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n  const enabledCount = steps.filter((step: any) => step.status === \"enabled\").length;\n\n  const handleStepToggle = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? { ...step, status: step.status === \"enabled\" ? \"disabled\" : \"enabled\" }\n          : step,\n      ),\n    );\n  };\n\n  const handleReject = () => {\n    if (respond) {\n      setAccepted(false);\n      respond({ accepted: false });\n    }\n  };\n\n  const handleConfirm = () => {\n    if (respond) {\n      setAccepted(true);\n      respond({ accepted: true, steps: localSteps.filter((step) => step.status === \"enabled\") });\n    }\n  };\n\n  return (\n    <StepContainer theme={theme}>\n      <StepHeader\n        theme={theme}\n        enabledCount={enabledCount}\n        totalCount={steps.length}\n        status={status}\n        showStatus={true}\n      />\n\n      <div className=\"space-y-3 mb-6\">\n        {steps.map((step: any, index: any) => (\n          <StepItem\n            key={index}\n            step={step}\n            theme={theme}\n            status={status}\n            onToggle={() => handleStepToggle(index)}\n            disabled={status !== \"executing\"}\n          />\n        ))}\n      </div>\n\n      {/* Action Buttons - Different logic from InterruptHumanInTheLoop */}\n      {accepted === null && (\n        <div className=\"flex justify-center gap-4\">\n          <ActionButton\n            variant=\"secondary\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleReject}\n          >\n            <span className=\"mr-2\">✗</span>\n            Reject\n          </ActionButton>\n          <ActionButton\n            variant=\"success\"\n            theme={theme}\n            disabled={status !== \"executing\"}\n            onClick={handleConfirm}\n          >\n            <span className=\"mr-2\">✓</span>\n            Confirm\n            <span\n              className={`ml-2 px-2 py-1 rounded-full text-xs font-bold ${\n                theme === \"dark\" ? \"bg-green-800/50\" : \"bg-green-600/20\"\n              }`}\n            >\n              {enabledCount}\n            </span>\n          </ActionButton>\n        </div>\n      )}\n\n      {/* Result State - Unique to StepsFeedback */}\n      {accepted !== null && (\n        <div className=\"flex justify-center\">\n          <div\n            className={`px-6 py-3 rounded-lg font-semibold flex items-center gap-2 ${\n              accepted\n                ? theme === \"dark\"\n                  ? \"bg-green-900/30 text-green-300 border border-green-500/30\"\n                  : \"bg-green-50 text-green-700 border border-green-200\"\n                : theme === \"dark\"\n                  ? \"bg-red-900/30 text-red-300 border border-red-500/30\"\n                  : \"bg-red-50 text-red-700 border border-red-200\"\n            }`}\n          >\n            <span className=\"text-lg\">{accepted ? \"✓\" : \"✗\"}</span>\n            {accepted ? \"Accepted\" : \"Rejected\"}\n          </div>\n        </div>\n      )}\n\n      <DecorativeElements\n        theme={theme}\n        variant={accepted === true ? \"success\" : accepted === false ? \"danger\" : \"default\"}\n      />\n    </StepContainer>\n  );\n};\n\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI.\n\"\"\"\n\nfrom crewai.flow.flow import Flow, start, router, listen\nfrom litellm import completion\nfrom pydantic import BaseModel\nfrom typing import Literal, List\nfrom ..sdk import (\n  copilotkit_stream,\n  CopilotKitState,\n)\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nDEFINE_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in imperative form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"enabled\"],\n                                \"description\": \"The status of the step, always 'enabled'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nclass TaskStep(BaseModel):\n    description: str\n    status: Literal[\"enabled\", \"disabled\"]\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    Here we define the state of the agent\n\n    In this instance, we're inheriting from CopilotKitState, which will bring in\n    the CopilotKitState fields. We're also adding a custom field, `steps`,\n    which will be used to store the steps of the task.\n    \"\"\"\n    steps: List[TaskStep] = []\n\n\nclass HumanInTheLoopFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that uses the CopilotKit framework to create a chat agent.\n    \"\"\"\n\n    @start()\n    @listen(\"route_follow_up\")\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n\n    @router(start_flow)\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n        system_prompt = \"\"\"\n        You are a helpful assistant that can perform any task.\n        You MUST call the `generate_task_steps` function when the user asks you to perform a task.\n        When the function `generate_task_steps` is called, the user will decide to enable or disable a step.\n        After the user has decided which steps to perform, provide a textual description of how you are performing the task.\n        If the user has disabled a step, you are not allowed to perform that step.\n        However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n        some humor in the description of how you are performing the task.\n        Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n        \"\"\"\n\n        # 1. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 1.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 1.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    DEFINE_TASK_TOOL\n                ],\n\n                # 1.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 2. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        return \"route_end\"\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotSidebar, CopilotPopup } from \"@copilotkit/react-ui\";\nimport {\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselNext,\n  CarouselPrevious,\n} from \"@/components/ui/carousel\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\ninterface Haiku {\n  japanese: string[];\n  english: string[];\n  image_name: string | null;\n  gradient: string;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  const chatProps = {\n    defaultOpen: true,\n    labels: {\n      title: \"Haiku Generator\",\n      initial: \"I'm a haiku generator 👋. How can I help you?\",\n    },\n    clickOutsideToClose: false,\n    suggestions: [\n      { title: \"Nature Haiku\", message: \"Write me a haiku about nature.\" },\n      { title: \"Ocean Haiku\", message: \"Create a haiku about the ocean.\" },\n      { title: \"Spring Haiku\", message: \"Generate a haiku about spring.\" },\n    ],\n  };\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      agent=\"tool_based_generative_ui\"\n    >\n      <CopilotSidebar {...chatProps} />\n      <HaikuDisplay />\n    </CopilotKit>\n  );\n}\n\nconst VALID_IMAGE_NAMES = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\",\n];\n\nfunction HaikuDisplay() {\n  const [activeIndex, setActiveIndex] = useState(0);\n  const [haikus, setHaikus] = useState<Haiku[]>([\n    {\n      japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n      english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n      image_name: null,\n      gradient: \"\",\n    },\n  ]);\n\n  useCopilotAction(\n    {\n      name: \"generate_haiku\",\n      parameters: [\n        {\n          name: \"japanese\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku in Japanese\",\n        },\n        {\n          name: \"english\",\n          type: \"string[]\",\n          required: true,\n          description: \"3 lines of haiku translated to English\",\n        },\n        {\n          name: \"image_name\",\n          type: \"string\",\n          required: true,\n          description: `One relevant image name from: ${VALID_IMAGE_NAMES.join(\", \")}`,\n        },\n        {\n          name: \"gradient\",\n          type: \"string\",\n          required: true,\n          description: \"CSS Gradient color for the background\",\n        },\n      ],\n      followUp: false,\n      handler: async ({ japanese, english, image_name, gradient }) => {\n        const newHaiku: Haiku = {\n          japanese: japanese || [],\n          english: english || [],\n          image_name: image_name || null,\n          gradient: gradient || \"\",\n        };\n        setHaikus((prev) => [\n          newHaiku,\n          ...prev.filter((h) => h.english[0] !== \"A placeholder verse—\"),\n        ]);\n        setActiveIndex(0);\n        return \"Haiku generated!\";\n      },\n      render: ({ args }) => {\n        if (!args.japanese) return <></>;\n        return <HaikuCard haiku={args as Haiku} />;\n      },\n    },\n    [haikus],\n  );\n\n  const currentHaiku = haikus[activeIndex];\n\n  return (\n    <div className=\"relative flex items-center justify-center h-full w-full\">\n      <div className=\"px-20 py-12 w-full max-w-4xl\">\n        <Carousel className=\"w-full\" data-testid=\"haiku-carousel\">\n          <CarouselContent>\n            {haikus.map((haiku, index) => (\n              <CarouselItem key={index} data-testid={`carousel-item-${index}`}>\n                <HaikuCard haiku={haiku} />\n              </CarouselItem>\n            ))}\n          </CarouselContent>\n          {haikus.length > 1 && (\n            <>\n              <CarouselPrevious />\n              <CarouselNext />\n            </>\n          )}\n        </Carousel>\n      </div>\n    </div>\n  );\n}\n\nfunction HaikuCard({ haiku }: { haiku: Partial<Haiku> }) {\n  return (\n    <div\n      data-testid=\"haiku-card\"\n      style={{ background: haiku.gradient }}\n      className=\"relative bg-gradient-to-br from-slate-50 to-blue-50 dark:from-slate-900 dark:to-blue-950 rounded-2xl my-6 p-8 max-w-2xl border border-slate-200 dark:border-slate-700 overflow-hidden\"\n    >\n      {/* Decorative background elements */}\n      <div className=\"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0\" />\n      <div className=\"absolute bottom-0 left-0 w-48 h-48 bg-gradient-to-tr from-indigo-400/10 to-pink-400/10 rounded-full blur-3xl -z-0\" />\n\n      {/* Haiku Text */}\n      <div className=\"relative z-10 flex flex-col items-center space-y-6\">\n        {haiku.japanese?.map((line, index) => (\n          <div\n            key={index}\n            className=\"flex flex-col items-center text-center space-y-2 animate-in fade-in slide-in-from-bottom-4\"\n            style={{ animationDelay: `${index * 100}ms` }}\n          >\n            <p\n              data-testid=\"haiku-japanese-line\"\n              className=\"font-serif font-bold text-4xl md:text-5xl bg-gradient-to-r from-slate-800 to-slate-600 dark:from-slate-100 dark:to-slate-300 bg-clip-text text-transparent tracking-wide\"\n            >\n              {line}\n            </p>\n            <p\n              data-testid=\"haiku-english-line\"\n              className=\"font-light text-base md:text-lg text-slate-600 dark:text-slate-400 italic max-w-md\"\n            >\n              {haiku.english?.[index]}\n            </p>\n          </div>\n        ))}\n      </div>\n\n      {/* Image */}\n      {haiku.image_name && (\n        <div className=\"relative z-10 mt-8 pt-8 border-t border-slate-200 dark:border-slate-700\">\n          <div className=\"relative group overflow-hidden rounded-2xl shadow-xl\">\n            <img\n              data-testid=\"haiku-image\"\n              src={`/images/${haiku.image_name}`}\n              alt={haiku.image_name}\n              className=\"object-cover w-full h-64 md:h-80 transform transition-transform duration-500 group-hover:scale-105\"\n            />\n            <div className=\"absolute inset-0 bg-gradient-to-t from-black/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n}\n\n.page-background {\n  /* Darker gradient background */\n  background: linear-gradient(170deg, #e9ecef 0%, #ced4da 100%);\n}\n\n@keyframes fade-scale-in {\n  from {\n    opacity: 0;\n    transform: translateY(10px) scale(0.98);\n  }\n  to {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Updated card entry animation */\n@keyframes pop-in {\n  0% {\n    opacity: 0;\n    transform: translateY(15px) scale(0.95);\n  }\n  70% {\n    opacity: 1;\n    transform: translateY(-2px) scale(1.02);\n  }\n  100% {\n    opacity: 1;\n    transform: translateY(0) scale(1);\n  }\n}\n\n/* Animation for subtle background gradient movement */\n@keyframes animated-gradient {\n  0% {\n    background-position: 0% 50%;\n  }\n  50% {\n    background-position: 100% 50%;\n  }\n  100% {\n    background-position: 0% 50%;\n  }\n}\n\n/* Animation for flash effect on apply */\n@keyframes flash-border-glow {\n  0% {\n    /* Start slightly intensified */\n    border-top-color: #ff5b4a !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 25px rgba(255, 91, 74, 0.5);\n  }\n  50% {\n    /* Peak intensity */\n    border-top-color: #ff4733 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 35px rgba(255, 71, 51, 0.7);\n  }\n  100% {\n    /* Return to default state appearance */\n    border-top-color: #ff6f61 !important;\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n    inset 0 1px 2px rgba(0, 0, 0, 0.01),\n    0 0 10px rgba(255, 111, 97, 0.15);\n  }\n}\n\n/* Existing animation for haiku lines */\n@keyframes fade-slide-in {\n  from {\n    opacity: 0;\n    transform: translateX(-15px);\n  }\n  to {\n    opacity: 1;\n    transform: translateX(0);\n  }\n}\n\n.animated-fade-in {\n  /* Use the new pop-in animation */\n  animation: pop-in 0.6s ease-out forwards;\n}\n\n.haiku-card {\n  /* Subtle animated gradient background */\n  background: linear-gradient(120deg, #ffffff 0%, #fdfdfd 50%, #ffffff 100%);\n  background-size: 200% 200%;\n  animation: animated-gradient 10s ease infinite;\n\n  /* === Explicit Border Override Attempt === */\n  /* 1. Set the default grey border for all sides */\n  border: 1px solid #dee2e6;\n\n  /* 2. Explicitly override the top border immediately after */\n  border-top: 10px solid #ff6f61 !important; /* Orange top - Added !important */\n  /* === End Explicit Border Override Attempt === */\n\n  padding: 2.5rem 3rem;\n  border-radius: 20px;\n\n  /* Default glow intensity */\n  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.07),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 15px rgba(255, 111, 97, 0.25);\n  text-align: left;\n  max-width: 745px;\n  margin: 3rem auto;\n  min-width: 600px;\n\n  /* Transition */\n  transition: transform 0.35s ease, box-shadow 0.35s ease, border-top-width 0.35s ease, border-top-color 0.35s ease;\n}\n\n.haiku-card:hover {\n  transform: translateY(-8px) scale(1.03);\n  /* Enhanced shadow + Glow */\n  box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1),\n  inset 0 1px 2px rgba(0, 0, 0, 0.01),\n  0 0 25px rgba(255, 91, 74, 0.5);\n  /* Modify only top border properties */\n  border-top-width: 14px !important; /* Added !important */\n  border-top-color: #ff5b4a !important; /* Added !important */\n}\n\n.haiku-card .flex {\n  margin-bottom: 1.5rem;\n}\n\n.haiku-card .flex.haiku-line { /* Target the lines specifically */\n  margin-bottom: 1.5rem;\n  opacity: 0; /* Start hidden for animation */\n  animation: fade-slide-in 0.5s ease-out forwards;\n  /* animation-delay is set inline in page.tsx */\n}\n\n/* Remove previous explicit color overrides - rely on Tailwind */\n/* .haiku-card p.text-4xl {\n  color: #212529;\n}\n\n.haiku-card p.text-base {\n  color: #495057;\n} */\n\n.haiku-card.applied-flash {\n  /* Apply the flash animation once */\n  /* Note: animation itself has !important on border-top-color */\n  animation: flash-border-glow 0.6s ease-out forwards;\n}\n\n/* Styling for images within the main haiku card */\n.haiku-card-image {\n  width: 9.5rem; /* Increased size (approx w-48) */\n  height: 9.5rem; /* Increased size (approx h-48) */\n  object-fit: cover;\n  border-radius: 1.5rem; /* rounded-xl */\n  border: 1px solid #e5e7eb;\n  /* Enhanced shadow with subtle orange hint */\n  box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1),\n  0 3px 6px rgba(0, 0, 0, 0.08),\n  0 0 10px rgba(255, 111, 97, 0.2);\n  /* Inherit animation delay from inline style */\n  animation-name: fadeIn;\n  animation-duration: 0.5s;\n  animation-fill-mode: both;\n}\n\n/* Styling for images within the suggestion card */\n.suggestion-card-image {\n  width: 6.5rem; /* Increased slightly (w-20) */\n  height: 6.5rem; /* Increased slightly (h-20) */\n  object-fit: cover;\n  border-radius: 1rem; /* Equivalent to rounded-md */\n  border: 1px solid #d1d5db; /* Equivalent to border (using Tailwind gray-300) */\n  margin-top: 0.5rem;\n  /* Added shadow for suggestion images */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1),\n  0 2px 4px rgba(0, 0, 0, 0.06);\n  transition: all 0.2s ease-in-out; /* Added for smooth deselection */\n}\n\n/* Styling for the focused suggestion card image */\n.suggestion-card-image-focus {\n  width: 6.5rem;\n  height: 6.5rem;\n  object-fit: cover;\n  border-radius: 1rem;\n  margin-top: 0.5rem;\n  /* Highlight styles */\n  border: 2px solid #ff6f61; /* Thicker, themed border */\n  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1), /* Base shadow for depth */\n  0 0 12px rgba(255, 111, 97, 0.6); /* Orange glow */\n  transform: scale(1.05); /* Slightly scale up */\n  transition: all 0.2s ease-in-out; /* Smooth transition for focus */\n}\n\n/* Styling for the suggestion card container in the sidebar */\n.suggestion-card {\n  border: 1px solid #dee2e6; /* Same default border as haiku-card */\n  border-top: 10px solid #ff6f61; /* Same orange top border */\n  border-radius: 0.375rem; /* Default rounded-md */\n  /* Note: background-color is set by Tailwind bg-gray-100 */\n  /* Other styles like padding, margin, flex are handled by Tailwind */\n}\n\n.suggestion-image-container {\n  display: flex;\n  gap: 1rem;\n  justify-content: space-between;\n  width: 100%;\n  height: 6.5rem;\n}\n\n/* Mobile responsive styles - matches useMobileView hook breakpoint */\n@media (max-width: 767px) {\n  .haiku-card {\n    padding: 1rem 1.5rem; /* Reduced from 2.5rem 3rem */\n    min-width: auto; /* Remove min-width constraint */\n    max-width: 100%; /* Full width on mobile */\n    margin: 1rem auto; /* Reduced margin */\n  }\n\n  .haiku-card-image {\n    width: 5.625rem; /* 90px - smaller on mobile */\n    height: 5.625rem; /* 90px - smaller on mobile */\n  }\n\n  .suggestion-card-image {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n\n  .suggestion-card-image-focus {\n    width: 5rem; /* Slightly smaller on mobile */\n    height: 5rem; /* Slightly smaller on mobile */\n  }\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "tool_based_generative_ui.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI.\n\"\"\"\n\nfrom crewai.flow.flow import Flow, start\nfrom litellm import completion\nfrom ..sdk import copilotkit_stream, CopilotKitState\n\n\n# This tool generates a haiku on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nGENERATE_HAIKU_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_haiku\",\n        \"description\": \"Generate a haiku in Japanese and its English translation\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"japanese\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in Japanese\"\n                },\n                \"english\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in English\"\n                },\n                \"image_names\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"Names of 3 relevant images from the provided list\"\n                }\n            },\n            \"required\": [\"japanese\", \"english\", \"image_names\"]\n        }\n    }\n}\n\n\nclass ToolBasedGenerativeUIFlow(Flow[CopilotKitState]):\n    \"\"\"\n    A flow that demonstrates tool-based generative UI.\n    \"\"\"\n\n    @start()\n    async def chat(self):\n        \"\"\"\n        The main function handling chat and tool calls.\n        \"\"\"\n        system_prompt = \"You assist the user in generating a haiku. When generating a haiku using the 'generate_haiku' tool, you MUST also select exactly 3 image filenames from the following list that are most relevant to the haiku's content or theme. Return the filenames in the 'image_names' parameter. Dont provide the relavent image names in your final response to the user. \"\n\n\n        # 1. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 1.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 1.2 Bind the available tools to the model\n                tools=[ GENERATE_HAIKU_TOOL ],\n\n                # 1.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n        message = response.choices[0].message\n\n        # 2. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 3. If there are tool calls, append a tool message to the messages in state\n        if message.tool_calls:\n            self.state.messages.append(\n                {\n                    \"tool_call_id\": message.tool_calls[0].id,\n                    \"role\": \"tool\",\n                    \"content\": \"Haiku generated.\"\n                }\n            )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\nimport { useTheme } from \"next-themes\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  const { theme } = useTheme();\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      const completedCount = state.steps.filter((step) => step.status === \"completed\").length;\n      const progressPercentage = (completedCount / state.steps.length) * 100;\n\n      return (\n        <div className=\"flex\">\n          <div\n            data-testid=\"task-progress\"\n            className={`relative rounded-xl w-[700px] p-6 shadow-lg backdrop-blur-sm ${\n              theme === \"dark\"\n                ? \"bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 text-white border border-slate-700/50 shadow-2xl\"\n                : \"bg-gradient-to-br from-white via-gray-50 to-white text-gray-800 border border-gray-200/80\"\n            }`}\n          >\n            {/* Header */}\n            <div className=\"mb-5\">\n              <div className=\"flex items-center justify-between mb-3\">\n                <h3 className=\"text-xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent\">\n                  Task Progress\n                </h3>\n                <div className={`text-sm ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-500\"}`}>\n                  {completedCount}/{state.steps.length} Complete\n                </div>\n              </div>\n\n              {/* Progress Bar */}\n              <div\n                className={`relative h-2 rounded-full overflow-hidden ${theme === \"dark\" ? \"bg-slate-700\" : \"bg-gray-200\"}`}\n              >\n                <div\n                  className=\"absolute top-0 left-0 h-full bg-gradient-to-r from-blue-500 to-purple-500 rounded-full transition-all duration-1000 ease-out\"\n                  style={{ width: `${progressPercentage}%` }}\n                />\n                <div\n                  className={`absolute top-0 left-0 h-full w-full bg-gradient-to-r from-transparent to-transparent animate-pulse ${\n                    theme === \"dark\" ? \"via-white/20\" : \"via-white/40\"\n                  }`}\n                />\n              </div>\n            </div>\n\n            {/* Steps */}\n            <div className=\"space-y-2\">\n              {state.steps.map((step, index) => {\n                const isCompleted = step.status === \"completed\";\n                const isCurrentPending =\n                  step.status === \"pending\" &&\n                  index === state.steps.findIndex((s) => s.status === \"pending\");\n                const isFuturePending = step.status === \"pending\" && !isCurrentPending;\n\n                return (\n                  <div\n                    key={index}\n                    className={`relative flex items-center p-2.5 rounded-lg transition-all duration-500 ${\n                      isCompleted\n                        ? theme === \"dark\"\n                          ? \"bg-gradient-to-r from-green-900/30 to-emerald-900/20 border border-green-500/30\"\n                          : \"bg-gradient-to-r from-green-50 to-emerald-50 border border-green-200/60\"\n                        : isCurrentPending\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-r from-blue-900/40 to-purple-900/30 border border-blue-500/50 shadow-lg shadow-blue-500/20\"\n                            : \"bg-gradient-to-r from-blue-50 to-purple-50 border border-blue-200/60 shadow-md shadow-blue-200/50\"\n                          : theme === \"dark\"\n                            ? \"bg-slate-800/50 border border-slate-600/30\"\n                            : \"bg-gray-50/50 border border-gray-200/60\"\n                    }`}\n                  >\n                    {/* Connector Line */}\n                    {index < state.steps.length - 1 && (\n                      <div\n                        className={`absolute left-5 top-full w-0.5 h-2 bg-gradient-to-b ${\n                          theme === \"dark\"\n                            ? \"from-slate-500 to-slate-600\"\n                            : \"from-gray-300 to-gray-400\"\n                        }`}\n                      />\n                    )}\n\n                    {/* Status Icon */}\n                    <div\n                      className={`flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mr-2 ${\n                        isCompleted\n                          ? theme === \"dark\"\n                            ? \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30\"\n                            : \"bg-gradient-to-br from-green-500 to-emerald-600 shadow-md shadow-green-200\"\n                          : isCurrentPending\n                            ? theme === \"dark\"\n                              ? \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-lg shadow-blue-500/30\"\n                              : \"bg-gradient-to-br from-blue-500 to-purple-600 shadow-md shadow-blue-200\"\n                            : theme === \"dark\"\n                              ? \"bg-slate-700 border border-slate-600\"\n                              : \"bg-gray-300 border border-gray-400\"\n                      }`}\n                    >\n                      {isCompleted ? (\n                        <CheckIcon />\n                      ) : isCurrentPending ? (\n                        <SpinnerIcon />\n                      ) : (\n                        <ClockIcon theme={theme} />\n                      )}\n                    </div>\n\n                    {/* Step Content */}\n                    <div className=\"flex-1 min-w-0\">\n                      <div\n                        data-testid=\"task-step-text\"\n                        className={`font-semibold transition-all duration-300 text-sm ${\n                          isCompleted\n                            ? theme === \"dark\"\n                              ? \"text-green-300\"\n                              : \"text-green-700\"\n                            : isCurrentPending\n                              ? theme === \"dark\"\n                                ? \"text-blue-300 text-base\"\n                                : \"text-blue-700 text-base\"\n                              : theme === \"dark\"\n                                ? \"text-slate-400\"\n                                : \"text-gray-500\"\n                        }`}\n                      >\n                        {step.description}\n                      </div>\n                      {isCurrentPending && (\n                        <div\n                          className={`text-sm mt-1 animate-pulse ${\n                            theme === \"dark\" ? \"text-blue-400\" : \"text-blue-600\"\n                          }`}\n                        >\n                          Processing...\n                        </div>\n                      )}\n                    </div>\n\n                    {/* Animated Background for Current Step */}\n                    {isCurrentPending && (\n                      <div\n                        className={`absolute inset-0 rounded-lg bg-gradient-to-r animate-pulse ${\n                          theme === \"dark\"\n                            ? \"from-blue-500/10 to-purple-500/10\"\n                            : \"from-blue-100/50 to-purple-100/50\"\n                        }`}\n                      />\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n\n            {/* Decorative Elements */}\n            <div\n              className={`absolute top-3 right-3 w-16 h-16 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-blue-500/10 to-purple-500/10\"\n                  : \"bg-gradient-to-br from-blue-200/30 to-purple-200/30\"\n              }`}\n            />\n            <div\n              className={`absolute bottom-3 left-3 w-12 h-12 rounded-full blur-xl ${\n                theme === \"dark\"\n                  ? \"bg-gradient-to-br from-green-500/10 to-emerald-500/10\"\n                  : \"bg-gradient-to-br from-green-200/30 to-emerald-200/30\"\n              }`}\n            />\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"h-full w-full md:w-8/10 md:h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl max-w-6xl mx-auto\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n          suggestions={[\n            {\n              title: \"Simple plan\",\n              message: \"Please build a plan to go to mars in 5 steps.\",\n            },\n            {\n              title: \"Complex plan\",\n              message: \"Please build a plan to go to make pizza in 10 steps.\",\n            },\n          ]}\n        />\n      </div>\n    </div>\n  );\n};\n\n// Enhanced Icons\nfunction CheckIcon() {\n  return (\n    <svg className=\"w-4 h-4 text-white\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={3} d=\"M5 13l4 4L19 7\" />\n    </svg>\n  );\n}\n\nfunction SpinnerIcon() {\n  return (\n    <svg\n      className=\"w-4 h-4 animate-spin text-white\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle className=\"opacity-25\" cx=\"12\" cy=\"12\" r=\"10\" stroke=\"currentColor\" strokeWidth=\"4\" />\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      />\n    </svg>\n  );\n}\n\nfunction ClockIcon({ theme }: { theme?: string }) {\n  return (\n    <svg\n      className={`w-3 h-3 ${theme === \"dark\" ? \"text-slate-400\" : \"text-gray-600\"}`}\n      fill=\"none\"\n      stroke=\"currentColor\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle cx=\"12\" cy=\"12\" r=\"10\" strokeWidth=\"2\" />\n      <polyline points=\"12,6 12,12 16,14\" strokeWidth=\"2\" />\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI.\n\"\"\"\n\nimport json\nimport asyncio\nfrom crewai.flow.flow import Flow, start, router, listen, or_\nfrom litellm import completion\nfrom pydantic import BaseModel\nfrom typing import Literal, List\n\nfrom ..sdk import (\n  copilotkit_stream,\n  CopilotKitState,\n  copilotkit_predict_state,\n  copilotkit_emit_state\n)\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nPERFORM_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in gerund form (i.e. Digging hole, opening door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in gerund form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"pending\"],\n                                \"description\": \"The status of the step, always 'pending'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nclass TaskStep(BaseModel):\n    description: str\n    status: Literal[\"pending\", \"completed\"]\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    Here we define the state of the agent\n\n    In this instance, we're inheriting from CopilotKitState, which will bring in\n    the CopilotKitState fields. We're also adding a custom field, `steps`,\n    which will be used to store the steps of the task.\n    \"\"\"\n    steps: List[TaskStep] = []\n\n\nclass AgenticGenerativeUIFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that uses the CopilotKit framework to create a chat agent.\n    \"\"\"\n\n    \n    @start()\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n        self.state.steps = []\n\n    @router(or_(start_flow, \"simulate_task\"))\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n        system_prompt = \"\"\"\n        You are a helpful assistant assisting with any task. \n        When asked to do something, you MUST call the function `generate_task_steps`\n        that was provided to you.\n        If you called the function, you MUST NOT repeat the steps in your next response to the user.\n        Just give a very brief summary (one sentence) of what you did with some emojis. \n        Always say you actually did the steps, not merely generated them.\n        \"\"\"\n\n        # 1. Here we specify that we want to stream the tool call to generate_task_steps\n        #    to the frontend as state.\n        await copilotkit_predict_state({\n            \"steps\": {\n                \"tool_name\": \"generate_task_steps\",\n                \"tool_argument\": \"steps\"\n            }\n        })\n\n        # 2. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 2.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 2.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    PERFORM_TASK_TOOL\n                ],\n\n                # 2.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 3. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 4. Handle tool call\n        if message.get(\"tool_calls\"):\n            tool_call = message[\"tool_calls\"][0]\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"function\"][\"name\"]\n            tool_call_args = json.loads(tool_call[\"function\"][\"arguments\"])\n\n            if tool_call_name == \"generate_task_steps\":\n                # Convert each step in the JSON array to a TaskStep instance\n                self.state.steps = [TaskStep(**step) for step in tool_call_args[\"steps\"]]\n\n                # 4.1 Append the result to the messages in state\n                self.state.messages.append({\n                    \"role\": \"tool\",\n                    \"content\": \"Steps executed.\",\n                    \"tool_call_id\": tool_call_id\n                })\n                return \"route_simulate_task\"\n\n        # 5. If our tool was not called, return to the end route\n        return \"route_end\"\n\n    @listen(\"route_simulate_task\")\n    async def simulate_task(self):\n        \"\"\"\n        Simulate the task.\n        \"\"\"\n        for step in self.state.steps:\n            # simulate executing the step\n            await asyncio.sleep(1)\n            step.status = \"completed\"\n            await copilotkit_emit_state(self.state)\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n\n  const chatTitle = \"AI Recipe Assistant\";\n  const chatDescription = \"Ask me to craft recipes\";\n  const initialLabel = \"Hi 👋 How can I help with your recipe?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div className=\"min-h-screen w-full flex items-center justify-center\">\n        <Recipe />\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { isMobile } = useMobileView();\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form\n      data-testid=\"recipe-card\"\n      style={isMobile ? { marginBottom: \"100px\" } : {}}\n      className=\"recipe-card\"\n    >\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button\n            data-testid=\"add-ingredient-button\"\n            type=\"button\"\n            className=\"add-button\"\n            onClick={addIngredient}\n          >\n            + Add Ingredient\n          </button>\n        </div>\n        <div data-testid=\"ingredients-container\" className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} data-testid=\"ingredient-card\" className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div data-testid=\"instructions-container\" className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          data-testid=\"improve-button\"\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import List, Optional\nfrom litellm import completion\nfrom pydantic import BaseModel, Field\nfrom crewai.flow.flow import Flow, start, router, listen\nfrom ..sdk import (\n  copilotkit_stream, \n  copilotkit_predict_state,\n  CopilotKitState\n)\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\nclass Ingredient(BaseModel):\n    \"\"\"\n    An ingredient with its details.\n    \"\"\"\n    icon: str = Field(..., description=\"Emoji icon representing the ingredient.\")\n    name: str = Field(..., description=\"Name of the ingredient.\")\n    amount: str = Field(..., description=\"Amount or quantity of the ingredient.\")\n\nGENERATE_RECIPE_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_recipe\",\n        \"description\": \" \".join(\"\"\"Generate or modify an existing recipe. \n        When creating a new recipe, specify all fields. \n        When modifying, only fill optional fields if they need changes; \n        otherwise, leave them empty.\"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"recipe\": {\n                    \"description\": \"The recipe object containing all details.\",\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"title\": {\n                            \"type\": \"string\",\n                            \"description\": \"The title of the recipe.\"\n                        },\n                        \"skill_level\": {\n                            \"type\": \"string\",\n                            \"enum\": [level.value for level in SkillLevel],\n                            \"description\": \"The skill level required for the recipe.\"\n                        },\n                        \"special_preferences\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"string\"\n                            },\n                            \"description\": \"A list of dietary preferences (e.g., Vegetarian, Gluten-free).\"\n                        },\n                        \"cooking_time\": {\n                            \"type\": \"string\",\n                            \"enum\": [time.value for time in CookingTime],\n                            \"description\": \"The estimated cooking time for the recipe.\"\n                        },\n                        \"ingredients\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"object\",\n                                \"properties\": {\n                                    \"icon\": {\"type\": \"string\", \"description\": \"Emoji icon for the ingredient.\"},\n                                    \"name\": {\"type\": \"string\", \"description\": \"Name of the ingredient.\"},\n                                    \"amount\": {\"type\": \"string\", \"description\": \"Amount/quantity of the ingredient.\"}\n                                },\n                                \"required\": [\"icon\", \"name\", \"amount\"]\n                            },\n                            \"description\": \"A list of ingredients required for the recipe.\"\n                        },\n                        \"instructions\": {\n                            \"type\": \"array\",\n                            \"items\": {\"type\": \"string\"},\n                            \"description\": \"Step-by-step instructions for preparing the recipe.\"\n                        }\n                    },\n                    \"required\": [\"title\", \"skill_level\", \"cooking_time\", \"special_preferences\", \"ingredients\", \"instructions\"]\n                }\n            },\n            \"required\": [\"recipe\"]\n        }\n    }\n}\n\nclass Recipe(BaseModel):\n    \"\"\"\n    A recipe.\n    \"\"\"\n    title: str\n    skill_level: SkillLevel\n    special_preferences: List[str] = Field(default_factory=list)\n    cooking_time: CookingTime\n    ingredients: List[Ingredient] = Field(default_factory=list)\n    instructions: List[str] = Field(default_factory=list)\n\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Recipe] = None\n\nclass SharedStateFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that demonstrates shared state between the agent and CopilotKit.\n    \"\"\"\n\n    @start()\n    @listen(\"route_follow_up\")\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n        print(f\"start_flow\")\n        print(f\"self.state: {self.state}\")\n\n    @router(start_flow)\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n \n        system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n        This is the current state of the recipe: {self.state.model_dump_json(indent=2)}\n        You can modify the recipe by calling the generate_recipe tool.\n        If you have just created or modified the recipe, just answer in one sentence what you did.\n        \"\"\"\n\n        # 1. Here we specify that we want to stream the tool call to generate_recipe\n        #    to the frontend as state.\n        await copilotkit_predict_state({\n            \"recipe\": {\n                \"tool_name\": \"generate_recipe\",\n                \"tool_argument\": \"recipe\"\n            }\n        })\n\n        # 2. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 2.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 2.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    GENERATE_RECIPE_TOOL\n                ],\n\n                # 2.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 3. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 4. Handle tool call\n        if message.get(\"tool_calls\"):\n            tool_call = message[\"tool_calls\"][0]\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"function\"][\"name\"]\n            tool_call_args = json.loads(tool_call[\"function\"][\"arguments\"])\n\n            if tool_call_name == \"generate_recipe\":\n                # Attempt to update the recipe state using the data from the tool call\n                try:\n                    updated_recipe_data = tool_call_args[\"recipe\"]\n                    # Validate and update the state. Pydantic will raise an error if the structure is wrong.\n                    self.state.recipe = Recipe(**updated_recipe_data)\n\n                    # 4.1 Append the result to the messages in state\n                    self.state.messages.append({\n                        \"role\": \"tool\",\n                        \"content\": \"Recipe updated.\", # More accurate message\n                        \"tool_call_id\": tool_call_id\n                    })\n                    return \"route_follow_up\"\n                except Exception as e:\n                    # Handle validation or other errors during update\n                    print(f\"Error updating recipe state: {e}\") # Log the error server-side\n                    # Optionally inform the user via a tool message, though it might be noisy\n                    # self.state.messages.append({\"role\": \"tool\", \"content\": f\"Error processing recipe update: {e}\", \"tool_call_id\": tool_call_id})\n                    return \"route_end\" # End the flow on error for now\n\n        # 5. If our tool was not called, return to the end route\n        return \"route_end\"\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useMobileView } from \"@/utils/use-mobile-view\";\nimport { useMobileChat } from \"@/utils/use-mobile-chat\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n  const { isMobile } = useMobileView();\n  const defaultChatHeight = 50;\n  const { isChatOpen, setChatHeight, setIsChatOpen, isDragging, chatHeight, handleDragStart } =\n    useMobileChat(defaultChatHeight);\n  const chatTitle = \"AI Document Editor\";\n  const chatDescription = \"Ask me to create or edit a document\";\n  const initialLabel = \"Hi 👋 How can I help with your document?\";\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        {isMobile ? (\n          <>\n            {/* Chat Toggle Button */}\n            <div className=\"fixed bottom-0 left-0 right-0 z-50\">\n              <div className=\"bg-gradient-to-t from-white via-white to-transparent h-6\"></div>\n              <div\n                className=\"bg-white border-t border-gray-200 px-4 py-3 flex items-center justify-between cursor-pointer shadow-lg\"\n                onClick={() => {\n                  if (!isChatOpen) {\n                    setChatHeight(defaultChatHeight); // Reset to good default when opening\n                  }\n                  setIsChatOpen(!isChatOpen);\n                }}\n              >\n                <div className=\"flex items-center gap-3\">\n                  <div>\n                    <div className=\"font-medium text-gray-900\">{chatTitle}</div>\n                    <div className=\"text-sm text-gray-500\">{chatDescription}</div>\n                  </div>\n                </div>\n                <div\n                  className={`transform transition-transform duration-300 ${isChatOpen ? \"rotate-180\" : \"\"}`}\n                >\n                  <svg\n                    className=\"w-6 h-6 text-gray-400\"\n                    fill=\"none\"\n                    stroke=\"currentColor\"\n                    viewBox=\"0 0 24 24\"\n                  >\n                    <path\n                      strokeLinecap=\"round\"\n                      strokeLinejoin=\"round\"\n                      strokeWidth={2}\n                      d=\"M5 15l7-7 7 7\"\n                    />\n                  </svg>\n                </div>\n              </div>\n            </div>\n\n            {/* Pull-Up Chat Container */}\n            <div\n              className={`fixed inset-x-0 bottom-0 z-40 bg-white rounded-t-2xl shadow-[0px_0px_20px_0px_rgba(0,0,0,0.15)] transform transition-all duration-300 ease-in-out flex flex-col ${\n                isChatOpen ? \"translate-y-0\" : \"translate-y-full\"\n              } ${isDragging ? \"transition-none\" : \"\"}`}\n              style={{\n                height: `${chatHeight}vh`,\n                paddingBottom: \"env(safe-area-inset-bottom)\", // Handle iPhone bottom padding\n              }}\n            >\n              {/* Drag Handle Bar */}\n              <div\n                className=\"flex justify-center pt-3 pb-2 flex-shrink-0 cursor-grab active:cursor-grabbing\"\n                onMouseDown={handleDragStart}\n              >\n                <div className=\"w-12 h-1 bg-gray-400 rounded-full hover:bg-gray-500 transition-colors\"></div>\n              </div>\n\n              {/* Chat Header */}\n              <div className=\"px-4 py-3 border-b border-gray-100 flex-shrink-0\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <h3 className=\"font-semibold text-gray-900\">{chatTitle}</h3>\n                  </div>\n                  <button\n                    onClick={() => setIsChatOpen(false)}\n                    className=\"p-2 hover:bg-gray-100 rounded-full transition-colors\"\n                  >\n                    <svg\n                      className=\"w-5 h-5 text-gray-500\"\n                      fill=\"none\"\n                      stroke=\"currentColor\"\n                      viewBox=\"0 0 24 24\"\n                    >\n                      <path\n                        strokeLinecap=\"round\"\n                        strokeLinejoin=\"round\"\n                        strokeWidth={2}\n                        d=\"M6 18L18 6M6 6l12 12\"\n                      />\n                    </svg>\n                  </button>\n                </div>\n              </div>\n\n              {/* Chat Content - Flexible container for messages and input */}\n              <div className=\"flex-1 flex flex-col min-h-0 overflow-hidden pb-16\">\n                <CopilotChat\n                  className=\"h-full flex flex-col\"\n                  suggestions={[\n                    {\n                      title: \"Write a pirate story\",\n                      message: \"Please write a story about a pirate named Candy Beard.\",\n                    },\n                    {\n                      title: \"Write a mermaid story\",\n                      message: \"Please write a story about a mermaid named Luna.\",\n                    },\n                    { title: \"Add character\", message: \"Please add a character named Courage.\" },\n                  ]}\n                  labels={{\n                    initial: initialLabel,\n                  }}\n                />\n              </div>\n            </div>\n\n            {/* Backdrop */}\n            {isChatOpen && (\n              <div className=\"fixed inset-0 z-30\" onClick={() => setIsChatOpen(false)} />\n            )}\n          </>\n        ) : (\n          <CopilotSidebar\n            defaultOpen={true}\n            suggestions={[\n              {\n                title: \"Write a pirate story\",\n                message: \"Please write a story about a pirate named Candy Beard.\",\n              },\n              {\n                title: \"Write a mermaid story\",\n                message: \"Please write a story about a mermaid named Luna.\",\n              },\n              { title: \"Add character\", message: \"Please add a character named Courage.\" },\n            ]}\n            labels={{\n              title: chatTitle,\n              initial: initialLabel,\n            }}\n            clickOutsideToClose={false}\n          />\n        )}\n        <DocumentEditor />\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction(\n    {\n      name: \"confirm_changes\",\n      renderAndWaitForResponse: ({ args, respond, status }) => (\n        <ConfirmChanges\n          args={args}\n          respond={respond}\n          status={status}\n          onReject={() => {\n            editor?.commands.setContent(fromMarkdown(currentDocument));\n            setAgentState({ document: currentDocument });\n          }}\n          onConfirm={() => {\n            editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n            setCurrentDocument(agentState?.document || \"\");\n            setAgentState({ document: agentState?.document || \"\" });\n          }}\n        />\n      ),\n    },\n    [agentState?.document],\n  );\n\n  // Action to write the document.\n  useCopilotAction(\n    {\n      name: \"write_document\",\n      description: `Present the proposed changes to the user for review`,\n      parameters: [\n        {\n          name: \"document\",\n          type: \"string\",\n          description: \"The full updated document in markdown format\",\n        },\n      ],\n      renderAndWaitForResponse({ args, status, respond }) {\n        if (status === \"executing\") {\n          return (\n            <ConfirmChanges\n              args={args}\n              respond={respond}\n              status={status}\n              onReject={() => {\n                editor?.commands.setContent(fromMarkdown(currentDocument));\n                setAgentState({ document: currentDocument });\n              }}\n              onConfirm={() => {\n                editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n                setCurrentDocument(agentState?.document || \"\");\n                setAgentState({ document: agentState?.document || \"\" });\n              }}\n            />\n          );\n        }\n        return <></>;\n      },\n    },\n    [agentState?.document],\n  );\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div\n      data-testid=\"confirm-changes-modal\"\n      className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\"\n    >\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            data-testid=\"reject-button\"\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            data-testid=\"confirm-button\"\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div\n            data-testid=\"status-display\"\n            className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\"\n          >\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "predictive_state_updates.py",
      "content": "\"\"\"\nA demo of predictive state updates.\n\"\"\"\n\nimport json\nimport uuid\nfrom typing import Optional\nfrom litellm import completion\nfrom crewai.flow.flow import Flow, start, router, listen\nfrom ..sdk import (\n  copilotkit_stream, \n  copilotkit_predict_state,\n  CopilotKitState\n)\n\nWRITE_DOCUMENT_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"write_document_local\",\n        \"description\": \" \".join(\"\"\"\n            Write a document. Use markdown formatting to format the document.\n            It's good to format the document extensively so it's easy to read.\n            You can use all kinds of markdown.\n            However, do not use italic or strike-through formatting, it's reserved for another purpose.\n            You MUST write the full document, even when changing only a few words.\n            When making edits to the document, try to make them minimal - do not change every word.\n            Keep stories SHORT!\n            \"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"document\": {\n                    \"type\": \"string\",\n                    \"description\": \"The document to write\"\n                },\n            },\n        }\n    }\n}\n\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n\nclass PredictiveStateUpdatesFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that demonstrates predictive state updates.\n    \"\"\"\n\n    @start()\n    @listen(\"route_follow_up\")\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n\n    @router(start_flow)\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n        system_prompt = f\"\"\"\n        You are a helpful assistant for writing documents.\n        To write the document, you MUST use the write_document_local tool.\n        You MUST write the full document, even when changing only a few words.\n        When you wrote the document, DO NOT repeat it as a message. \n        Just briefly summarize the changes you made. 2 sentences max.\n        This is the current state of the document: ----\\n {self.state.document}\\n-----\n        \"\"\"\n\n        # 1. Here we specify that we want to stream the tool call to write_document_local\n        #    to the frontend as state.\n        await copilotkit_predict_state({\n            \"document\": {\n                \"tool_name\": \"write_document_local\",\n                \"tool_argument\": \"document\"\n            }\n        })\n\n        # 2. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 2.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 2.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    WRITE_DOCUMENT_TOOL\n                ],\n\n                # 2.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 3. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 4. Handle tool call\n        if message.get(\"tool_calls\"):\n            tool_call = message[\"tool_calls\"][0]\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"function\"][\"name\"]\n            tool_call_args = json.loads(tool_call[\"function\"][\"arguments\"])\n\n            if tool_call_name == \"write_document_local\":\n                self.state.document = tool_call_args[\"document\"]\n\n                # 4.1 Append the result to the messages in state\n                self.state.messages.append({\n                    \"role\": \"tool\",\n                    \"content\": \"Document written.\",\n                    \"tool_call_id\": tool_call_id\n                })\n\n                # 4.2 Append a tool call to confirm changes\n                self.state.messages.append({\n                    \"role\": \"assistant\",\n                    \"content\": \"\",\n                    \"tool_calls\": [{\n                        \"id\": str(uuid.uuid4()),\n                        \"function\": {\n                            \"name\": \"confirm_changes\",\n                            \"arguments\": \"{}\"\n                        }\n                    }]\n                })\n\n                return \"route_end\"\n\n        # 5. If our tool was not called, return to the end route\n        return \"route_end\"\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ]
}