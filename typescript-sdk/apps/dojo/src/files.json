{
  "middleware-starter::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "index.ts",
      "content": "import { AbstractAgent, BaseEvent, EventType, RunAgentInput } from \"@ag-ui/client\";\nimport { Observable } from \"rxjs\";\n\nexport class MiddlewareStarterAgent extends AbstractAgent {\n  protected run(input: RunAgentInput): Observable<BaseEvent> {\n    const messageId = Date.now().toString();\n    return new Observable<BaseEvent>((observer) => {\n      observer.next({\n        type: EventType.RUN_STARTED,\n        threadId: input.threadId,\n        runId: input.runId,\n      } as any);\n\n      observer.next({\n        type: EventType.TEXT_MESSAGE_START,\n        messageId,\n      } as any);\n\n      observer.next({\n        type: EventType.TEXT_MESSAGE_CONTENT,\n        messageId,\n        delta: \"Hello world!\",\n      } as any);\n\n      observer.next({\n        type: EventType.TEXT_MESSAGE_END,\n        messageId,\n      } as any);\n\n      observer.next({\n        type: EventType.RUN_FINISHED,\n        threadId: input.threadId,\n        runId: input.runId,\n      } as any);\n\n      observer.complete();\n    });\n  }\n}\n",
      "language": "ts",
      "type": "file"
    }
  ],
  "pydantic-ai::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "pydantic-ai::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      return (\n        <div className=\"flex\">\n          <div className=\"bg-gray-100 rounded-lg w-[800px] p-4 text-black space-y-2\">\n            {state.steps.map((step, index) => {\n              if (step.status === \"completed\") {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    ✓ {step.description}\n                  </div>\n                );\n              } else if (\n                step.status === \"pending\" &&\n                index === state.steps.findIndex((s) => s.status === \"pending\")\n              ) {\n                return (\n                  <div key={index} className=\"text-2xl font-bold text-slate-700\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              } else {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              }\n            })}\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "pydantic-ai::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  // Ensure we have valid steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\"text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {localSteps.map((step, index) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={step.status === \"enabled\"}\n                onChange={() => handleCheckboxChange(index)}\n                className=\"mr-2\"\n              />\n              <span className={step.status !== \"enabled\" ? \"line-through\" : \"\"}>\n                {step.description}\n              </span>\n            </label>\n          </div>\n        ))}\n        <button\n          className=\"mt-4 bg-gradient-to-r from-purple-400 to-purple-600 text-white py-2 px-4 rounded cursor-pointer w-48 font-bold\"\n          onClick={() => {\n            const selectedSteps = localSteps\n              .filter((step) => step.status === \"enabled\")\n              .map((step) => step.description);\n            resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n          }}\n        >\n          ✨ Perform Steps\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst Chat = () => {\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const [localSteps, setLocalSteps] = useState<\n    {\n      description: string;\n      status: \"disabled\" | \"enabled\" | \"executing\";\n    }[]\n  >([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\" text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {steps.map((step: any, index: any) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <input\n              type=\"checkbox\"\n              checked={step.status === \"enabled\"}\n              onChange={() => handleCheckboxChange(index)}\n              className=\"mr-2\"\n            />\n            <span\n              className={step.status !== \"enabled\" && status != \"inProgress\" ? \"line-through\" : \"\"}\n            >\n              {step.description}\n            </span>\n          </div>\n        ))}\n      </div>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                respond({ accepted: true, steps: localSteps.filter(step => step.status === \"enabled\")});\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "pydantic-ai::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Document Editor\",\n            initial: \"Hi 👋 How can I help with your document?\",\n          }}\n          clickOutsideToClose={false}\n        >\n          <DocumentEditor />\n        </CopilotSidebar>\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction({\n    name: \"confirm_changes\",\n    renderAndWaitForResponse: ({ args, respond, status }) => (\n      <ConfirmChanges\n        args={args}\n        respond={respond}\n        status={status}\n        onReject={() => {\n          editor?.commands.setContent(fromMarkdown(currentDocument));\n          setAgentState({ document: currentDocument });\n        }}\n        onConfirm={() => {\n          editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n          setCurrentDocument(agentState?.document || \"\");\n          setAgentState({ document: agentState?.document || \"\" });\n        }}\n      />\n    ),\n  });\n\n  // Action to write the document.\n  useCopilotAction({\n    name: \"write_document\",\n    description: `Present the proposed changes to the user for review`,\n    parameters: [\n      {\n        name: \"document\",\n        type: \"string\",\n        description: \"The full updated document in markdown format\",\n      },\n    ],\n    renderAndWaitForResponse({ args, status, respond }) {\n      if (status === \"executing\") {\n        return (\n          <ConfirmChanges\n            args={args}\n            respond={respond}\n            status={status}\n            onReject={() => {\n              editor?.commands.setContent(fromMarkdown(currentDocument));\n              setAgentState({ document: currentDocument });\n            }}\n            onConfirm={() => {\n              editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n              setCurrentDocument(agentState?.document || \"\");\n              setAgentState({ document: agentState?.document || \"\" });\n            }}\n          />\n        );\n      }\n      return <></>;\n    },\n  });\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\">\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "pydantic-ai::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div\n        className=\"min-h-screen w-full flex items-center justify-center\"\n        style={\n          {\n            backgroundImage: \"url('/shared_state_background.png')\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"center\",\n            backgroundRepeat: \"no-repeat\",\n          } as React.CSSProperties\n        }\n      >\n        <Recipe />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Recipe Assistant\",\n            initial: \"Hi 👋 How can I help with your recipe?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form className=\"recipe-card\">\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button type=\"button\" className=\"add-button\" onClick={addIngredient}>\n            + Add Ingredient\n          </button>\n        </div>\n        <div className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "pydantic-ai::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotKitCSSProperties, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport React from \"react\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"tool_based_generative_ui\"\n    >\n      <div\n        className=\"min-h-full w-full flex items-center justify-center\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as CopilotKitCSSProperties\n        }\n      >\n        <Haiku />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"Haiku Generator\",\n            initial: \"I'm a haiku generator 👋. How can I help you?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction Haiku() {\n  const [haiku, setHaiku] = useState<{\n    japanese: string[];\n    english: string[];\n  }>({\n    japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n    english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n  });\n\n  useCopilotAction({\n    name: \"generate_haiku\",\n    parameters: [\n      {\n        name: \"japanese\",\n        type: \"string[]\",\n      },\n      {\n        name: \"english\",\n        type: \"string[]\",\n      },\n    ],\n    followUp: false,\n    handler: async () => {\n      return \"Haiku generated.\";\n    },\n    render: ({ args: generatedHaiku, result, status }) => {\n      return <HaikuApproval setHaiku={setHaiku} generatedHaiku={generatedHaiku} status={status} />;\n    },\n  });\n  return (\n    <>\n      <div className=\"text-left\">\n        {haiku?.japanese.map((line, index) => (\n          <div className=\"flex items-center gap-6 mb-2\" key={index}>\n            <p className=\"text-4xl font-bold text-gray-500\">{line}</p>\n            <p className=\"text-base font-light\">{haiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n\ninterface HaikuApprovalProps {\n  setHaiku: any;\n  status: any;\n  generatedHaiku: any;\n}\n\nfunction HaikuApproval({ setHaiku, status, generatedHaiku }: HaikuApprovalProps) {\n  const [isApplied, setIsApplied] = useState(false);\n  if (!generatedHaiku || !generatedHaiku.japanese || !generatedHaiku.japanese.length) {\n    return <></>;\n  }\n\n  return (\n    <div className=\"text-left rounded-md p-4 mt-4 mb-4 flex flex-col bg-gray-100 dark:bg-zinc-900\">\n      <div className={status === \"complete\" ? \"border-b border-gray-300 mb-4\" : \"\"}>\n        {generatedHaiku?.japanese?.map((line: string, index: number) => (\n          <div className=\"flex items-center gap-3 mb-2 pb-2\" key={index}>\n            <p className=\"text-lg font-bold\">{line}</p>\n            <p className=\"text-sm font-light\">{generatedHaiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n      {status === \"complete\" && (\n        <button\n          onClick={() => {\n            setHaiku(generatedHaiku);\n            setIsApplied(true);\n          }}\n          className=\"ml-auto px-3 py-1 bg-white dark:bg-black text-black dark:text-white text-sm rounded cursor-pointer font-sm border \"\n        >\n          {isApplied ? \"Applied ✓\" : \"Apply\"}\n        </button>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "server-starter::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "__init__.py",
      "content": "\"\"\"\nExample server for the AG-UI protocol.\n\"\"\"\n\nimport os\nimport uvicorn\nimport uuid\nfrom fastapi import FastAPI, Request\nfrom fastapi.responses import StreamingResponse\nfrom ag_ui.core import (\n    RunAgentInput,\n    EventType,\n    RunStartedEvent,\n    RunFinishedEvent,\n    TextMessageStartEvent,\n    TextMessageContentEvent,\n    TextMessageEndEvent,\n)\nfrom ag_ui.encoder import EventEncoder\n\napp = FastAPI(title=\"AG-UI Endpoint\")\n\n@app.post(\"/\")\nasync def agentic_chat_endpoint(input_data: RunAgentInput, request: Request):\n    \"\"\"Agentic chat endpoint\"\"\"\n    # Get the accept header from the request\n    accept_header = request.headers.get(\"accept\")\n\n    # Create an event encoder to properly format SSE events\n    encoder = EventEncoder(accept=accept_header)\n\n    async def event_generator():\n\n        # Send run started event\n        yield encoder.encode(\n          RunStartedEvent(\n            type=EventType.RUN_STARTED,\n            thread_id=input_data.thread_id,\n            run_id=input_data.run_id\n          ),\n        )\n\n        message_id = str(uuid.uuid4())\n\n        yield encoder.encode(\n            TextMessageStartEvent(\n                type=EventType.TEXT_MESSAGE_START,\n                message_id=message_id,\n                role=\"assistant\"\n            )\n        )\n\n        yield encoder.encode(\n            TextMessageContentEvent(\n                type=EventType.TEXT_MESSAGE_CONTENT,\n                message_id=message_id,\n                delta=\"Hello world!\"\n            )\n        )\n\n        yield encoder.encode(\n            TextMessageEndEvent(\n                type=EventType.TEXT_MESSAGE_END,\n                message_id=message_id\n            )\n        )\n\n        # Send run finished event\n        yield encoder.encode(\n          RunFinishedEvent(\n            type=EventType.RUN_FINISHED,\n            thread_id=input_data.thread_id,\n            run_id=input_data.run_id\n          ),\n        )\n\n    return StreamingResponse(\n        event_generator(),\n        media_type=encoder.get_content_type()\n    )\n\ndef main():\n    \"\"\"Run the uvicorn server.\"\"\"\n    port = int(os.getenv(\"PORT\", \"8000\"))\n    uvicorn.run(\n        \"example_server:app\",\n        host=\"0.0.0.0\",\n        port=port,\n        reload=True\n    )\n",
      "language": "python",
      "type": "file"
    }
  ],
  "server-starter-all-features::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "server-starter-all-features::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  // Ensure we have valid steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\"text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {localSteps.map((step, index) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={step.status === \"enabled\"}\n                onChange={() => handleCheckboxChange(index)}\n                className=\"mr-2\"\n              />\n              <span className={step.status !== \"enabled\" ? \"line-through\" : \"\"}>\n                {step.description}\n              </span>\n            </label>\n          </div>\n        ))}\n        <button\n          className=\"mt-4 bg-gradient-to-r from-purple-400 to-purple-600 text-white py-2 px-4 rounded cursor-pointer w-48 font-bold\"\n          onClick={() => {\n            const selectedSteps = localSteps\n              .filter((step) => step.status === \"enabled\")\n              .map((step) => step.description);\n            resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n          }}\n        >\n          ✨ Perform Steps\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst Chat = () => {\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const [localSteps, setLocalSteps] = useState<\n    {\n      description: string;\n      status: \"disabled\" | \"enabled\" | \"executing\";\n    }[]\n  >([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\" text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {steps.map((step: any, index: any) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <input\n              type=\"checkbox\"\n              checked={step.status === \"enabled\"}\n              onChange={() => handleCheckboxChange(index)}\n              className=\"mr-2\"\n            />\n            <span\n              className={step.status !== \"enabled\" && status != \"inProgress\" ? \"line-through\" : \"\"}\n            >\n              {step.description}\n            </span>\n          </div>\n        ))}\n      </div>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                respond({ accepted: true, steps: localSteps.filter(step => step.status === \"enabled\")});\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "server-starter-all-features::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      return (\n        <div className=\"flex\">\n          <div className=\"bg-gray-100 rounded-lg w-[800px] p-4 text-black space-y-2\">\n            {state.steps.map((step, index) => {\n              if (step.status === \"completed\") {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    ✓ {step.description}\n                  </div>\n                );\n              } else if (\n                step.status === \"pending\" &&\n                index === state.steps.findIndex((s) => s.status === \"pending\")\n              ) {\n                return (\n                  <div key={index} className=\"text-2xl font-bold text-slate-700\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              } else {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              }\n            })}\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "server-starter-all-features::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotKitCSSProperties, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport React from \"react\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"tool_based_generative_ui\"\n    >\n      <div\n        className=\"min-h-full w-full flex items-center justify-center\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as CopilotKitCSSProperties\n        }\n      >\n        <Haiku />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"Haiku Generator\",\n            initial: \"I'm a haiku generator 👋. How can I help you?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction Haiku() {\n  const [haiku, setHaiku] = useState<{\n    japanese: string[];\n    english: string[];\n  }>({\n    japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n    english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n  });\n\n  useCopilotAction({\n    name: \"generate_haiku\",\n    parameters: [\n      {\n        name: \"japanese\",\n        type: \"string[]\",\n      },\n      {\n        name: \"english\",\n        type: \"string[]\",\n      },\n    ],\n    followUp: false,\n    handler: async () => {\n      return \"Haiku generated.\";\n    },\n    render: ({ args: generatedHaiku, result, status }) => {\n      return <HaikuApproval setHaiku={setHaiku} generatedHaiku={generatedHaiku} status={status} />;\n    },\n  });\n  return (\n    <>\n      <div className=\"text-left\">\n        {haiku?.japanese.map((line, index) => (\n          <div className=\"flex items-center gap-6 mb-2\" key={index}>\n            <p className=\"text-4xl font-bold text-gray-500\">{line}</p>\n            <p className=\"text-base font-light\">{haiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n\ninterface HaikuApprovalProps {\n  setHaiku: any;\n  status: any;\n  generatedHaiku: any;\n}\n\nfunction HaikuApproval({ setHaiku, status, generatedHaiku }: HaikuApprovalProps) {\n  const [isApplied, setIsApplied] = useState(false);\n  if (!generatedHaiku || !generatedHaiku.japanese || !generatedHaiku.japanese.length) {\n    return <></>;\n  }\n\n  return (\n    <div className=\"text-left rounded-md p-4 mt-4 mb-4 flex flex-col bg-gray-100 dark:bg-zinc-900\">\n      <div className={status === \"complete\" ? \"border-b border-gray-300 mb-4\" : \"\"}>\n        {generatedHaiku?.japanese?.map((line: string, index: number) => (\n          <div className=\"flex items-center gap-3 mb-2 pb-2\" key={index}>\n            <p className=\"text-lg font-bold\">{line}</p>\n            <p className=\"text-sm font-light\">{generatedHaiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n      {status === \"complete\" && (\n        <button\n          onClick={() => {\n            setHaiku(generatedHaiku);\n            setIsApplied(true);\n          }}\n          className=\"ml-auto px-3 py-1 bg-white dark:bg-black text-black dark:text-white text-sm rounded cursor-pointer font-sm border \"\n        >\n          {isApplied ? \"Applied ✓\" : \"Apply\"}\n        </button>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "server-starter-all-features::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div\n        className=\"min-h-screen w-full flex items-center justify-center\"\n        style={\n          {\n            backgroundImage: \"url('/shared_state_background.png')\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"center\",\n            backgroundRepeat: \"no-repeat\",\n          } as React.CSSProperties\n        }\n      >\n        <Recipe />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Recipe Assistant\",\n            initial: \"Hi 👋 How can I help with your recipe?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form className=\"recipe-card\">\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button type=\"button\" className=\"add-button\" onClick={addIngredient}>\n            + Add Ingredient\n          </button>\n        </div>\n        <div className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "server-starter-all-features::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Document Editor\",\n            initial: \"Hi 👋 How can I help with your document?\",\n          }}\n          clickOutsideToClose={false}\n        >\n          <DocumentEditor />\n        </CopilotSidebar>\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction({\n    name: \"confirm_changes\",\n    renderAndWaitForResponse: ({ args, respond, status }) => (\n      <ConfirmChanges\n        args={args}\n        respond={respond}\n        status={status}\n        onReject={() => {\n          editor?.commands.setContent(fromMarkdown(currentDocument));\n          setAgentState({ document: currentDocument });\n        }}\n        onConfirm={() => {\n          editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n          setCurrentDocument(agentState?.document || \"\");\n          setAgentState({ document: agentState?.document || \"\" });\n        }}\n      />\n    ),\n  });\n\n  // Action to write the document.\n  useCopilotAction({\n    name: \"write_document\",\n    description: `Present the proposed changes to the user for review`,\n    parameters: [\n      {\n        name: \"document\",\n        type: \"string\",\n        description: \"The full updated document in markdown format\",\n      },\n    ],\n    renderAndWaitForResponse({ args, status, respond }) {\n      if (status === \"executing\") {\n        return (\n          <ConfirmChanges\n            args={args}\n            respond={respond}\n            status={status}\n            onReject={() => {\n              editor?.commands.setContent(fromMarkdown(currentDocument));\n              setAgentState({ document: currentDocument });\n            }}\n            onConfirm={() => {\n              editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n              setCurrentDocument(agentState?.document || \"\");\n              setAgentState({ document: agentState?.document || \"\" });\n            }}\n          />\n        );\n      }\n      return <></>;\n    },\n  });\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\">\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "vercel-ai-sdk::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "index.ts",
      "content": "import {\n  AgentConfig,\n  AbstractAgent,\n  EventType,\n  BaseEvent,\n  Message,\n  AssistantMessage,\n  RunAgentInput,\n  MessagesSnapshotEvent,\n  RunFinishedEvent,\n  RunStartedEvent,\n  TextMessageChunkEvent,\n  ToolCallArgsEvent,\n  ToolCallEndEvent,\n  ToolCallStartEvent,\n  ToolCall,\n  ToolMessage,\n} from \"@ag-ui/client\";\nimport { Observable } from \"rxjs\";\nimport {\n  CoreMessage,\n  LanguageModelV1,\n  processDataStream,\n  streamText,\n  tool as createVercelAISDKTool,\n  ToolChoice,\n  ToolSet,\n} from \"ai\";\nimport { randomUUID } from \"crypto\";\nimport { z } from \"zod\";\n\ntype ProcessedEvent =\n  | MessagesSnapshotEvent\n  | RunFinishedEvent\n  | RunStartedEvent\n  | TextMessageChunkEvent\n  | ToolCallArgsEvent\n  | ToolCallEndEvent\n  | ToolCallStartEvent;\n\ninterface VercelAISDKAgentConfig extends AgentConfig {\n  model: LanguageModelV1;\n  maxSteps?: number;\n  toolChoice?: ToolChoice<Record<string, unknown>>;\n}\n\nexport class VercelAISDKAgent extends AbstractAgent {\n  model: LanguageModelV1;\n  maxSteps: number;\n  toolChoice: ToolChoice<Record<string, unknown>>;\n  constructor({ model, maxSteps, toolChoice, ...rest }: VercelAISDKAgentConfig) {\n    super({ ...rest });\n    this.model = model;\n    this.maxSteps = maxSteps ?? 1;\n    this.toolChoice = toolChoice ?? \"auto\";\n  }\n\n  protected run(input: RunAgentInput): Observable<BaseEvent> {\n    const finalMessages: Message[] = input.messages;\n\n    return new Observable<ProcessedEvent>((subscriber) => {\n      subscriber.next({\n        type: EventType.RUN_STARTED,\n        threadId: input.threadId,\n        runId: input.runId,\n      } as RunStartedEvent);\n\n      const response = streamText({\n        model: this.model,\n        messages: convertMessagesToVercelAISDKMessages(input.messages),\n        tools: convertToolToVerlAISDKTools(input.tools),\n        maxSteps: this.maxSteps,\n        toolChoice: this.toolChoice,\n      });\n\n      let messageId = randomUUID();\n      let assistantMessage: AssistantMessage = {\n        id: messageId,\n        role: \"assistant\",\n        content: \"\",\n        toolCalls: [],\n      };\n      finalMessages.push(assistantMessage);\n\n      processDataStream({\n        stream: response.toDataStreamResponse().body!,\n        onTextPart: (text) => {\n          assistantMessage.content += text;\n          const event: TextMessageChunkEvent = {\n            type: EventType.TEXT_MESSAGE_CHUNK,\n            role: \"assistant\",\n            messageId,\n            delta: text,\n          };\n          subscriber.next(event);\n        },\n        onFinishMessagePart: () => {\n          // Emit message snapshot\n          const event: MessagesSnapshotEvent = {\n            type: EventType.MESSAGES_SNAPSHOT,\n            messages: finalMessages,\n          };\n          subscriber.next(event);\n\n          // Emit run finished event\n          subscriber.next({\n            type: EventType.RUN_FINISHED,\n            threadId: input.threadId,\n            runId: input.runId,\n          } as RunFinishedEvent);\n\n          // Complete the observable\n          subscriber.complete();\n        },\n        onToolCallPart(streamPart) {\n          let toolCall: ToolCall = {\n            id: streamPart.toolCallId,\n            type: \"function\",\n            function: {\n              name: streamPart.toolName,\n              arguments: JSON.stringify(streamPart.args),\n            },\n          };\n          assistantMessage.toolCalls!.push(toolCall);\n\n          const startEvent: ToolCallStartEvent = {\n            type: EventType.TOOL_CALL_START,\n            parentMessageId: messageId,\n            toolCallId: streamPart.toolCallId,\n            toolCallName: streamPart.toolName,\n          };\n          subscriber.next(startEvent);\n\n          const argsEvent: ToolCallArgsEvent = {\n            type: EventType.TOOL_CALL_ARGS,\n            toolCallId: streamPart.toolCallId,\n            delta: JSON.stringify(streamPart.args),\n          };\n          subscriber.next(argsEvent);\n\n          const endEvent: ToolCallEndEvent = {\n            type: EventType.TOOL_CALL_END,\n            toolCallId: streamPart.toolCallId,\n          };\n          subscriber.next(endEvent);\n        },\n        onToolResultPart(streamPart) {\n          const toolMessage: ToolMessage = {\n            role: \"tool\",\n            id: randomUUID(),\n            toolCallId: streamPart.toolCallId,\n            content: JSON.stringify(streamPart.result),\n          };\n          finalMessages.push(toolMessage);\n        },\n        onErrorPart(streamPart) {\n          subscriber.error(streamPart);\n        },\n      }).catch((error) => {\n        console.error(\"catch error\", error);\n        // Handle error\n        subscriber.error(error);\n      });\n\n      return () => {};\n    });\n  }\n}\n\nexport function convertMessagesToVercelAISDKMessages(messages: Message[]): CoreMessage[] {\n  const result: CoreMessage[] = [];\n\n  for (const message of messages) {\n    if (message.role === \"assistant\") {\n      const parts: any[] = message.content ? [{ type: \"text\", text: message.content }] : [];\n      for (const toolCall of message.toolCalls ?? []) {\n        parts.push({\n          type: \"tool-call\",\n          toolCallId: toolCall.id,\n          toolName: toolCall.function.name,\n          args: JSON.parse(toolCall.function.arguments),\n        });\n      }\n      result.push({\n        role: \"assistant\",\n        content: parts,\n      });\n    } else if (message.role === \"user\") {\n      result.push({\n        role: \"user\",\n        content: message.content || \"\",\n      });\n    } else if (message.role === \"tool\") {\n      let toolName = \"unknown\";\n      for (const msg of messages) {\n        if (msg.role === \"assistant\") {\n          for (const toolCall of msg.toolCalls ?? []) {\n            if (toolCall.id === message.toolCallId) {\n              toolName = toolCall.function.name;\n              break;\n            }\n          }\n        }\n      }\n      result.push({\n        role: \"tool\",\n        content: [\n          {\n            type: \"tool-result\",\n            toolCallId: message.toolCallId,\n            toolName: toolName,\n            result: message.content,\n          },\n        ],\n      });\n    }\n  }\n\n  return result;\n}\n\nexport function convertJsonSchemaToZodSchema(jsonSchema: any, required: boolean): z.ZodSchema {\n  if (jsonSchema.type === \"object\") {\n    const spec: { [key: string]: z.ZodSchema } = {};\n\n    if (!jsonSchema.properties || !Object.keys(jsonSchema.properties).length) {\n      return !required ? z.object(spec).optional() : z.object(spec);\n    }\n\n    for (const [key, value] of Object.entries(jsonSchema.properties)) {\n      spec[key] = convertJsonSchemaToZodSchema(\n        value,\n        jsonSchema.required ? jsonSchema.required.includes(key) : false,\n      );\n    }\n    let schema = z.object(spec).describe(jsonSchema.description);\n    return required ? schema : schema.optional();\n  } else if (jsonSchema.type === \"string\") {\n    let schema = z.string().describe(jsonSchema.description);\n    return required ? schema : schema.optional();\n  } else if (jsonSchema.type === \"number\") {\n    let schema = z.number().describe(jsonSchema.description);\n    return required ? schema : schema.optional();\n  } else if (jsonSchema.type === \"boolean\") {\n    let schema = z.boolean().describe(jsonSchema.description);\n    return required ? schema : schema.optional();\n  } else if (jsonSchema.type === \"array\") {\n    let itemSchema = convertJsonSchemaToZodSchema(jsonSchema.items, true);\n    let schema = z.array(itemSchema).describe(jsonSchema.description);\n    return required ? schema : schema.optional();\n  }\n  throw new Error(\"Invalid JSON schema\");\n}\n\nexport function convertToolToVerlAISDKTools(tools: RunAgentInput[\"tools\"]): ToolSet {\n  return tools.reduce(\n    (acc: ToolSet, tool: RunAgentInput[\"tools\"][number]) => ({\n      ...acc,\n      [tool.name]: createVercelAISDKTool({\n        description: tool.description,\n        parameters: convertJsonSchemaToZodSchema(tool.parameters, true),\n      }),\n    }),\n    {},\n  );\n}\n",
      "language": "ts",
      "type": "file"
    }
  ],
  "langgraph::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\nfrom typing_extensions import Literal\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nclass AgentState(MessagesState):\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see: \n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n    \n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=f\"You are a helpful assistant. .\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\nagentic_chat_graph = workflow.compile()",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      return (\n        <div className=\"flex\">\n          <div className=\"bg-gray-100 rounded-lg w-[800px] p-4 text-black space-y-2\">\n            {state.steps.map((step, index) => {\n              if (step.status === \"completed\") {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    ✓ {step.description}\n                  </div>\n                );\n              } else if (\n                step.status === \"pending\" &&\n                index === state.steps.findIndex((s) => s.status === \"pending\")\n              ) {\n                return (\n                  <div key={index} className=\"text-2xl font-bold text-slate-700\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              } else {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              }\n            })}\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI using LangGraph.\n\"\"\"\n\nimport json\nimport asyncio\nfrom typing import Dict, List, Any, Optional, Literal\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langgraph.graph import MessagesState\n\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nPERFORM_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps_generative_ui\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in gerund form (i.e. Digging hole, opening door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in gerund form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"pending\"],\n                                \"description\": \"The status of the step, always 'pending'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\n\nclass AgentState(MessagesState):\n    steps: List[dict] = []\n    tools: List[Any]\n\n\nasync def start_flow(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function `generate_task_steps_generative_ui`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps_generative_ui\",\n        \"tool_argument\": \"steps\",\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            PERFORM_TASK_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        tool_call = response.tool_calls[0]\n        \n        # Handle tool_call as a dictionary rather than an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"generate_task_steps_generative_ui\":\n            steps = [{\"description\": step[\"description\"], \"status\": step[\"status\"]} for step in tool_call_args[\"steps\"]]\n            \n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Steps executed.\",\n                \"tool_call_id\": tool_call_id\n            }\n\n            messages = messages + [tool_response]\n\n            # Return Command to route to simulate_task_node\n            for i, step in enumerate(steps):\n            # simulate executing the step\n                await asyncio.sleep(1)\n                steps[i][\"status\"] = \"completed\"\n                # Update the state with the completed step - using config as first parameter\n                state[\"steps\"] = steps\n                await adispatch_custom_event(\n                    \"manually_emit_state\",\n                    state,\n                    config=config,\n                )\n            \n            return Command(\n                goto='start_flow',\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"]\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges (equivalent to the routing in CrewAI)\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\ngraph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  // Ensure we have valid steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\"text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {localSteps.map((step, index) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={step.status === \"enabled\"}\n                onChange={() => handleCheckboxChange(index)}\n                className=\"mr-2\"\n              />\n              <span className={step.status !== \"enabled\" ? \"line-through\" : \"\"}>\n                {step.description}\n              </span>\n            </label>\n          </div>\n        ))}\n        <button\n          className=\"mt-4 bg-gradient-to-r from-purple-400 to-purple-600 text-white py-2 px-4 rounded cursor-pointer w-48 font-bold\"\n          onClick={() => {\n            const selectedSteps = localSteps\n              .filter((step) => step.status === \"enabled\")\n              .map((step) => step.description);\n            resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n          }}\n        >\n          ✨ Perform Steps\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst Chat = () => {\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const [localSteps, setLocalSteps] = useState<\n    {\n      description: string;\n      status: \"disabled\" | \"enabled\" | \"executing\";\n    }[]\n  >([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\" text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {steps.map((step: any, index: any) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <input\n              type=\"checkbox\"\n              checked={step.status === \"enabled\"}\n              onChange={() => handleCheckboxChange(index)}\n              className=\"mr-2\"\n            />\n            <span\n              className={step.status !== \"enabled\" && status != \"inProgress\" ? \"line-through\" : \"\"}\n            >\n              {step.description}\n            </span>\n          </div>\n        ))}\n      </div>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                respond({ accepted: true, steps: localSteps.filter(step => step.status === \"enabled\")});\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA LangGraph implementation of the human-in-the-loop agent.\n\"\"\"\n\nimport json\nfrom typing import Dict, List, Any\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\n\nfrom copilotkit.langgraph import copilotkit_emit_state, copilotkit_interrupt\n\n# LLM imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nDEFINE_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in imperative form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"enabled\"],\n                                \"description\": \"The status of the step, always 'enabled'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nclass AgentState(MessagesState):\n    steps: List[Dict[str, str]] = []\n    tools: List[Any]\n\nasync def start_flow(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize steps list if not exists\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    \n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node where the agent processes messages and generates responses.\n    If task steps are defined, the user can enable/disable them using interrupts.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant that can perform any task.\n    You MUST call the `generate_task_steps` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps\",\n        \"tool_argument\": \"steps\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            DEFINE_TASK_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n    \n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        tool_call = response.tool_calls[0]\n        # Extract tool call information\n        if hasattr(tool_call, \"id\"):\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args if not isinstance(tool_call.args, str) else json.loads(tool_call.args)\n        else:\n            tool_call_id = tool_call.get(\"id\", \"\")\n            tool_call_name = tool_call.get(\"name\", \"\")\n            args = tool_call.get(\"args\", {})\n            tool_call_args = args if not isinstance(args, str) else json.loads(args)\n\n        if tool_call_name == \"generate_task_steps\":\n            # Get the steps from the tool call\n            steps_raw = tool_call_args.get(\"steps\", [])\n            \n            # Set initial status to \"enabled\" for all steps\n            steps_data = []\n            \n            # Handle different potential formats of steps data\n            if isinstance(steps_raw, list):\n                for step in steps_raw:\n                    if isinstance(step, dict) and \"description\" in step:\n                        steps_data.append({\n                            \"description\": step[\"description\"],\n                            \"status\": \"enabled\"\n                        })\n                    elif isinstance(step, str):\n                        steps_data.append({\n                            \"description\": step,\n                            \"status\": \"enabled\"\n                        })\n            \n            # If no steps were processed correctly, return to END with the updated messages\n            if not steps_data:\n                return Command(\n                    goto=END,\n                    update={\n                        \"messages\": messages,\n                        \"steps\": state[\"steps\"],\n                    }\n                )\n            # Update steps in state and emit to frontend\n            state[\"steps\"] = steps_data\n            \n            # Add a tool response to satisfy OpenAI's requirements\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Task steps generated.\",\n                \"tool_call_id\": tool_call_id\n            }\n            \n            messages = messages + [tool_response]\n\n            # Move to the process_steps_node which will handle the interrupt and final response\n            return Command(\n                goto=\"process_steps_node\",\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"],\n                }\n            )\n    \n    # If no tool calls or not generate_task_steps, return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def process_steps_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This node handles the user interrupt for step customization and generates the final response.\n    \"\"\"\n\n    # Check if we already have a user_response in the state\n    # This happens when the node restarts after an interrupt\n    if \"user_response\" in state and state[\"user_response\"]:\n        user_response = state[\"user_response\"]\n    else:\n        # Use LangGraph interrupt to get user input on steps\n        # This will pause execution and wait for user input in the frontend\n        user_response = interrupt({\"steps\": state[\"steps\"]})\n        # Store the user response in state for when the node restarts\n        state[\"user_response\"] = user_response\n    \n    # Generate the creative completion response\n    final_prompt = \"\"\"\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    \"\"\"\n    \n    final_response = await ChatOpenAI(model=\"gpt-4o\").ainvoke([\n        SystemMessage(content=final_prompt),\n        {\"role\": \"user\", \"content\": user_response}\n    ], config)\n\n    # Add the final response to messages\n    messages = state[\"messages\"] + [final_response]\n    \n    # Clear the user_response from state to prepare for future interactions\n    if \"user_response\" in state:\n        state.pop(\"user_response\")\n    \n    # Return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.add_node(\"process_steps_node\", process_steps_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\n# workflow.add_edge(\"chat_node\", \"process_steps_node\") # Removed unconditional edge\nworkflow.add_edge(\"process_steps_node\", END)\n# workflow.add_edge(\"chat_node\", END)                 # Removed unconditional edge\n\n# Add conditional edges from chat_node\ndef should_continue(command: Command):\n    if command.goto == \"process_steps_node\":\n        return \"process_steps_node\"\n    else:\n        return END\n\nworkflow.add_conditional_edges(\n    \"chat_node\",\n    should_continue,\n    {\n        \"process_steps_node\": \"process_steps_node\",\n        END: END,\n    },\n)\n\n# Compile the graph\nhuman_in_the_loop_graph = workflow.compile()",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Document Editor\",\n            initial: \"Hi 👋 How can I help with your document?\",\n          }}\n          clickOutsideToClose={false}\n        >\n          <DocumentEditor />\n        </CopilotSidebar>\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction({\n    name: \"confirm_changes\",\n    renderAndWaitForResponse: ({ args, respond, status }) => (\n      <ConfirmChanges\n        args={args}\n        respond={respond}\n        status={status}\n        onReject={() => {\n          editor?.commands.setContent(fromMarkdown(currentDocument));\n          setAgentState({ document: currentDocument });\n        }}\n        onConfirm={() => {\n          editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n          setCurrentDocument(agentState?.document || \"\");\n          setAgentState({ document: agentState?.document || \"\" });\n        }}\n      />\n    ),\n  });\n\n  // Action to write the document.\n  useCopilotAction({\n    name: \"write_document\",\n    description: `Present the proposed changes to the user for review`,\n    parameters: [\n      {\n        name: \"document\",\n        type: \"string\",\n        description: \"The full updated document in markdown format\",\n      },\n    ],\n    renderAndWaitForResponse({ args, status, respond }) {\n      if (status === \"executing\") {\n        return (\n          <ConfirmChanges\n            args={args}\n            respond={respond}\n            status={status}\n            onReject={() => {\n              editor?.commands.setContent(fromMarkdown(currentDocument));\n              setAgentState({ document: currentDocument });\n            }}\n            onConfirm={() => {\n              editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n              setCurrentDocument(agentState?.document || \"\");\n              setAgentState({ document: agentState?.document || \"\" });\n            }}\n          />\n        );\n      }\n      return <></>;\n    },\n  });\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\">\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of predictive state updates using LangGraph.\n\"\"\"\n\nimport json\nimport uuid\nfrom typing import Dict, List, Any, Optional\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nWRITE_DOCUMENT_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"write_document_local\",\n        \"description\": \" \".join(\"\"\"\n            Write a document. Use markdown formatting to format the document.\n            It's good to format the document extensively so it's easy to read.\n            You can use all kinds of markdown.\n            However, do not use italic or strike-through formatting, it's reserved for another purpose.\n            You MUST write the full document, even when changing only a few words.\n            When making edits to the document, try to make them minimal - do not change every word.\n            Keep stories SHORT!\n            \"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"document\": {\n                    \"type\": \"string\",\n                    \"description\": \"The document to write\"\n                },\n            },\n        }\n    }\n}\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n    tools: List[Any]\n\n\nasync def start_flow(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n    return Command(\n        goto=\"chat_node\"\n    )\n\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n\n    system_prompt = f\"\"\"\n    You are a helpful assistant for writing documents.\n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message.\n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n {state.get('document')}\\n-----\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n\n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"document\",\n        \"tool\": \"write_document_local\",\n        \"tool_argument\": \"document\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            WRITE_DOCUMENT_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n\n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"write_document_local\":\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Document written.\",\n                \"tool_call_id\": tool_call_id\n            }\n\n            # Add confirmation tool call\n            confirm_tool_call = {\n                \"role\": \"assistant\",\n                \"content\": \"\",\n                \"tool_calls\": [{\n                    \"id\": str(uuid.uuid4()),\n                    \"function\": {\n                        \"name\": \"confirm_changes\",\n                        \"arguments\": \"{}\"\n                    }\n                }]\n            }\n\n            messages = messages + [tool_response, confirm_tool_call]\n\n            # Return Command to route to end\n            return Command(\n                goto=END,\n                update={\n                    \"messages\": messages,\n                    \"document\": tool_call_args[\"document\"]\n                }\n            )\n\n    # If no tool was called, go to end\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\npredictive_state_updates_graph = workflow.compile()\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div\n        className=\"min-h-screen w-full flex items-center justify-center\"\n        style={\n          {\n            backgroundImage: \"url('/shared_state_background.png')\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"center\",\n            backgroundRepeat: \"no-repeat\",\n          } as React.CSSProperties\n        }\n      >\n        <Recipe />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Recipe Assistant\",\n            initial: \"Hi 👋 How can I help with your recipe?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form className=\"recipe-card\">\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button type=\"button\" className=\"add-button\" onClick={addIngredient}>\n            + Add Ingredient\n          </button>\n        </div>\n        <div className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit using LangGraph.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import Dict, List, Any, Optional\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langgraph.graph import MessagesState\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\n\nclass SpecialPreferences(str, Enum):\n    \"\"\"\n    Special preferences for the recipe.\n    \"\"\"\n    HIGH_PROTEIN = \"High Protein\"\n    LOW_CARB = \"Low Carb\"\n    SPICY = \"Spicy\"\n    BUDGET_FRIENDLY = \"Budget-Friendly\"\n    ONE_POT_MEAL = \"One-Pot Meal\"\n    VEGETARIAN = \"Vegetarian\"\n    VEGAN = \"Vegan\"\n\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\n\nGENERATE_RECIPE_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_recipe\",\n        \"description\": \" \".join(\"\"\"Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it.\n        Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"recipe\": {\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"skill_level\": {\n                            \"type\": \"string\",\n                            \"enum\": [level.value for level in SkillLevel],\n                            \"description\": \"The skill level required for the recipe\"\n                        },\n                        \"special_preferences\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"string\",\n                                \"enum\": [preference.value for preference in SpecialPreferences]\n                            },\n                            \"description\": \"A list of special preferences for the recipe\"\n                        },\n                        \"cooking_time\": {\n                            \"type\": \"string\",\n                            \"enum\": [time.value for time in CookingTime],\n                            \"description\": \"The cooking time of the recipe\"\n                        },\n                        \"ingredients\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"object\",\n                                \"properties\": {\n                                    \"icon\": {\"type\": \"string\", \"description\": \"The icon emoji (not emoji code like '\\x1f35e', but the actual emoji like 🥕) of the ingredient\"},\n                                    \"name\": {\"type\": \"string\"},\n                                    \"amount\": {\"type\": \"string\"}\n                                }\n                            },\n                            \"description\": \"Entire list of ingredients for the recipe, including the new ingredients and the ones that are already in the recipe\"\n                        },\n                        \"instructions\": {\n                            \"type\": \"array\",\n                            \"items\": {\"type\": \"string\"},\n                            \"description\": \"Entire list of instructions for the recipe, including the new instructions and the ones that are already there\"\n                        },\n                        \"changes\": {\n                            \"type\": \"string\",\n                            \"description\": \"A description of the changes made to the recipe\"\n                        }\n                    },\n                }\n            },\n            \"required\": [\"recipe\"]\n        }\n    }\n}\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Dict[str, Any]] = None\n    tools: List[Any]\n\n\nasync def start_flow(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize recipe if not exists\n    if \"recipe\" not in state or state[\"recipe\"] is None:\n        state[\"recipe\"] = {\n            \"skill_level\": SkillLevel.BEGINNER.value,\n            \"special_preferences\": [],\n            \"cooking_time\": CookingTime.FIFTEEN_MIN.value,\n            \"ingredients\": [{\"icon\": \"🍴\", \"name\": \"Sample Ingredient\", \"amount\": \"1 unit\"}],\n            \"instructions\": [\"First step instruction\"]\n        }\n        # Emit the initial state to ensure it's properly shared with the frontend\n        await adispatch_custom_event(\n            \"manually_emit_intermediate_state\",\n            state,\n            config=config,\n        )\n    \n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    # Create a safer serialization of the recipe\n    recipe_json = \"No recipe yet\"\n    if \"recipe\" in state and state[\"recipe\"] is not None:\n        try:\n            recipe_json = json.dumps(state[\"recipe\"], indent=2)\n        except Exception as e:\n            recipe_json = f\"Error serializing recipe: {str(e)}\"\n    \n    system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: {recipe_json}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"recipe\",\n        \"tool\": \"generate_recipe\",\n        \"tool_argument\": \"recipe\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            GENERATE_RECIPE_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n    \n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n        \n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            # Check if args is already a dict or needs to be parsed\n            if isinstance(tool_call[\"args\"], dict):\n                tool_call_args = tool_call[\"args\"]\n            else:\n                tool_call_args = json.loads(tool_call[\"args\"])\n        else:\n            # Handle as an object\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            # Check if args is already a dict or needs to be parsed\n            if isinstance(tool_call.args, dict):\n                tool_call_args = tool_call.args\n            else:\n                tool_call_args = json.loads(tool_call.args)\n\n        if tool_call_name == \"generate_recipe\":\n            # Update recipe state with tool_call_args\n            recipe_data = tool_call_args[\"recipe\"]\n            \n            # If we have an existing recipe, update it\n            if \"recipe\" in state and state[\"recipe\"] is not None:\n                recipe = state[\"recipe\"]\n                for key, value in recipe_data.items():\n                    if value is not None:  # Only update fields that were provided\n                        recipe[key] = value\n            else:\n                # Create a new recipe\n                recipe = {\n                    \"skill_level\": recipe_data.get(\"skill_level\", SkillLevel.BEGINNER.value),\n                    \"special_preferences\": recipe_data.get(\"special_preferences\", []),\n                    \"cooking_time\": recipe_data.get(\"cooking_time\", CookingTime.FIFTEEN_MIN.value),\n                    \"ingredients\": recipe_data.get(\"ingredients\", []),\n                    \"instructions\": recipe_data.get(\"instructions\", [])\n                }\n            \n            # Add tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Recipe generated.\",\n                \"tool_call_id\": tool_call_id\n            }\n            \n            messages = messages + [tool_response]\n            \n            # Explicitly emit the updated state to ensure it's shared with frontend\n            state[\"recipe\"] = recipe\n            await adispatch_custom_event(\n                \"manually_emit_intermediate_state\",\n                state,\n                config=config,\n            )\n            \n            # Return command with updated recipe\n            return Command(\n                goto=\"start_flow\",\n                update={\n                    \"messages\": messages,\n                    \"recipe\": recipe\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\nshared_state_graph = workflow.compile()",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotKitCSSProperties, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport React from \"react\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"tool_based_generative_ui\"\n    >\n      <div\n        className=\"min-h-full w-full flex items-center justify-center\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as CopilotKitCSSProperties\n        }\n      >\n        <Haiku />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"Haiku Generator\",\n            initial: \"I'm a haiku generator 👋. How can I help you?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction Haiku() {\n  const [haiku, setHaiku] = useState<{\n    japanese: string[];\n    english: string[];\n  }>({\n    japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n    english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n  });\n\n  useCopilotAction({\n    name: \"generate_haiku\",\n    parameters: [\n      {\n        name: \"japanese\",\n        type: \"string[]\",\n      },\n      {\n        name: \"english\",\n        type: \"string[]\",\n      },\n    ],\n    followUp: false,\n    handler: async () => {\n      return \"Haiku generated.\";\n    },\n    render: ({ args: generatedHaiku, result, status }) => {\n      return <HaikuApproval setHaiku={setHaiku} generatedHaiku={generatedHaiku} status={status} />;\n    },\n  });\n  return (\n    <>\n      <div className=\"text-left\">\n        {haiku?.japanese.map((line, index) => (\n          <div className=\"flex items-center gap-6 mb-2\" key={index}>\n            <p className=\"text-4xl font-bold text-gray-500\">{line}</p>\n            <p className=\"text-base font-light\">{haiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n\ninterface HaikuApprovalProps {\n  setHaiku: any;\n  status: any;\n  generatedHaiku: any;\n}\n\nfunction HaikuApproval({ setHaiku, status, generatedHaiku }: HaikuApprovalProps) {\n  const [isApplied, setIsApplied] = useState(false);\n  if (!generatedHaiku || !generatedHaiku.japanese || !generatedHaiku.japanese.length) {\n    return <></>;\n  }\n\n  return (\n    <div className=\"text-left rounded-md p-4 mt-4 mb-4 flex flex-col bg-gray-100 dark:bg-zinc-900\">\n      <div className={status === \"complete\" ? \"border-b border-gray-300 mb-4\" : \"\"}>\n        {generatedHaiku?.japanese?.map((line: string, index: number) => (\n          <div className=\"flex items-center gap-3 mb-2 pb-2\" key={index}>\n            <p className=\"text-lg font-bold\">{line}</p>\n            <p className=\"text-sm font-light\">{generatedHaiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n      {status === \"complete\" && (\n        <button\n          onClick={() => {\n            setHaiku(generatedHaiku);\n            setIsApplied(true);\n          }}\n          className=\"ml-auto px-3 py-1 bg-white dark:bg-black text-black dark:text-white text-sm rounded cursor-pointer font-sm border \"\n        >\n          {isApplied ? \"Applied ✓\" : \"Apply\"}\n        </button>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agent.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI using LangGraph.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\n\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\n# List of available images (modify path if needed)\nIMAGE_LIST = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\"\n]\n\n# This tool generates a haiku on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nGENERATE_HAIKU_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_haiku\",\n        \"description\": \"Generate a haiku in Japanese and its English translation. Also select exactly 3 relevant images from the provided list based on the haiku's theme.\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"japanese\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in Japanese\"\n                },\n                \"english\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in English\"\n                },\n                \"image_names\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of EXACTLY THREE image filenames from the provided list that are most relevant to the haiku.\"\n                }\n            },\n            \"required\": [\"japanese\", \"english\", \"image_names\"]\n        }\n    }\n}\n\nclass AgentState(MessagesState):\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    The main function handling chat and tool calls.\n    \"\"\"\n    # Prepare the image list string for the prompt\n    image_list_str = \"\\n\".join([f\"- {img}\" for img in IMAGE_LIST])\n\n    system_prompt = f\"\"\"\n        You assist the user in generating a haiku.\n        When generating a haiku using the 'generate_haiku' tool, you MUST also select exactly 3 image filenames from the following list that are most relevant to the haiku's content or theme. Return the filenames in the 'image_names' parameter.\n        \n        Available images:\n        {image_list_str}\n        \n        Dont provide the relavent image names in your final response to the user.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [GENERATE_HAIKU_TOOL],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Return Command to end with updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": state[\"messages\"] + [response]\n        }\n    )\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"chat_node\")\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\ntool_based_generative_ui_graph = workflow.compile()\n\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "\"\"\"\nA simple agentic chat flow using LangGraph instead of CrewAI.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional\n\n# Updated imports for LangGraph\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.graph import MessagesState\nfrom langgraph.types import Command\nfrom typing_extensions import Literal\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\nfrom langgraph.checkpoint.memory import MemorySaver\n\nclass AgentState(MessagesState):\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    Standard chat node based on the ReAct design pattern. It handles:\n    - The model to use (and binds in CopilotKit actions and the tools defined above)\n    - The system prompt\n    - Getting a response from the model\n    - Handling tool calls\n\n    For more about the ReAct design pattern, see: \n    https://www.perplexity.ai/search/react-agents-NcXLQhreS0WDzpVaS4m9Cg\n    \"\"\"\n    \n    # 1. Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # 2. Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            # your_tool_here\n        ],\n\n        # 2.1 Disable parallel tool calls to avoid race conditions,\n        #     enable this for faster performance if you want to manage\n        #     the complexity of running tool calls in parallel.\n        parallel_tool_calls=False,\n    )\n\n    # 3. Define the system message by which the chat model will be run\n    system_message = SystemMessage(\n        content=f\"You are a helpful assistant. .\"\n    )\n\n    # 4. Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        system_message,\n        *state[\"messages\"],\n    ], config)\n\n    # 6. We've handled all tool calls, so we can end the graph.\n    return Command(\n        goto=END,\n        update={\n            \"messages\": response\n        }\n    )\n\n# Define a new graph\nworkflow = StateGraph(AgentState)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.set_entry_point(\"chat_node\")\n\n# Add explicit edges, matching the pattern in other examples\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\nagentic_chat_graph = workflow.compile(checkpointer=MemorySaver())",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      return (\n        <div className=\"flex\">\n          <div className=\"bg-gray-100 rounded-lg w-[800px] p-4 text-black space-y-2\">\n            {state.steps.map((step, index) => {\n              if (step.status === \"completed\") {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    ✓ {step.description}\n                  </div>\n                );\n              } else if (\n                step.status === \"pending\" &&\n                index === state.steps.findIndex((s) => s.status === \"pending\")\n              ) {\n                return (\n                  <div key={index} className=\"text-2xl font-bold text-slate-700\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              } else {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              }\n            })}\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI using LangGraph.\n\"\"\"\n\nimport json\nimport asyncio\nfrom typing import Dict, List, Any, Optional, Literal\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nPERFORM_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps_generative_ui\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in gerund form (i.e. Digging hole, opening door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in gerund form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"pending\"],\n                                \"description\": \"The status of the step, always 'pending'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\n\nclass AgentState(MessagesState):\n    steps: List[dict] = []\n    tools: List[Any]\n\n\nasync def start_flow(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant assisting with any task. \n    When asked to do something, you MUST call the function `generate_task_steps_generative_ui`\n    that was provided to you.\n    If you called the function, you MUST NOT repeat the steps in your next response to the user.\n    Just give a very brief summary (one sentence) of what you did with some emojis. \n    Always say you actually did the steps, not merely generated them.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps_generative_ui\",\n        \"tool_argument\": \"steps\",\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            PERFORM_TASK_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    messages = state[\"messages\"] + [response]\n\n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        tool_call = response.tool_calls[0]\n        \n        # Handle tool_call as a dictionary rather than an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"generate_task_steps_generative_ui\":\n            steps = [{\"description\": step[\"description\"], \"status\": step[\"status\"]} for step in tool_call_args[\"steps\"]]\n            \n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Steps executed.\",\n                \"tool_call_id\": tool_call_id\n            }\n\n            messages = messages + [tool_response]\n\n            # Return Command to route to simulate_task_node\n            for i, step in enumerate(steps):\n            # simulate executing the step\n                await asyncio.sleep(1)\n                steps[i][\"status\"] = \"completed\"\n                # Update the state with the completed step - using config as first parameter\n                state[\"steps\"] = steps\n                await adispatch_custom_event(\n                    \"manually_emit_state\",\n                    state,\n                    config=config,\n                )\n            \n            return Command(\n                goto='start_flow',\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"]\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges (equivalent to the routing in CrewAI)\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\ngraph = workflow.compile(checkpointer=MemorySaver())\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  // Ensure we have valid steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\"text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {localSteps.map((step, index) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={step.status === \"enabled\"}\n                onChange={() => handleCheckboxChange(index)}\n                className=\"mr-2\"\n              />\n              <span className={step.status !== \"enabled\" ? \"line-through\" : \"\"}>\n                {step.description}\n              </span>\n            </label>\n          </div>\n        ))}\n        <button\n          className=\"mt-4 bg-gradient-to-r from-purple-400 to-purple-600 text-white py-2 px-4 rounded cursor-pointer w-48 font-bold\"\n          onClick={() => {\n            const selectedSteps = localSteps\n              .filter((step) => step.status === \"enabled\")\n              .map((step) => step.description);\n            resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n          }}\n        >\n          ✨ Perform Steps\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst Chat = () => {\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const [localSteps, setLocalSteps] = useState<\n    {\n      description: string;\n      status: \"disabled\" | \"enabled\" | \"executing\";\n    }[]\n  >([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\" text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {steps.map((step: any, index: any) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <input\n              type=\"checkbox\"\n              checked={step.status === \"enabled\"}\n              onChange={() => handleCheckboxChange(index)}\n              className=\"mr-2\"\n            />\n            <span\n              className={step.status !== \"enabled\" && status != \"inProgress\" ? \"line-through\" : \"\"}\n            >\n              {step.description}\n            </span>\n          </div>\n        ))}\n      </div>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                respond({ accepted: true, steps: localSteps.filter(step => step.status === \"enabled\")});\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "\"\"\"\nA LangGraph implementation of the human-in-the-loop agent.\n\"\"\"\n\nimport json\nfrom typing import Dict, List, Any\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command, interrupt\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n\n# LLM imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nDEFINE_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in imperative form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"enabled\"],\n                                \"description\": \"The status of the step, always 'enabled'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nclass AgentState(MessagesState):\n    steps: List[Dict[str, str]] = []\n    tools: List[Any]\n\nasync def start_flow(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize steps list if not exists\n    if \"steps\" not in state:\n        state[\"steps\"] = []\n\n    \n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node where the agent processes messages and generates responses.\n    If task steps are defined, the user can enable/disable them using interrupts.\n    \"\"\"\n    system_prompt = \"\"\"\n    You are a helpful assistant that can perform any task.\n    You MUST call the `generate_task_steps` function when the user asks you to perform a task.\n    Always make sure you will provide tasks based on the user query\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"steps\",\n        \"tool\": \"generate_task_steps\",\n        \"tool_argument\": \"steps\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            DEFINE_TASK_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n    \n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls and len(response.tool_calls) > 0:\n        tool_call = response.tool_calls[0]\n        # Extract tool call information\n        if hasattr(tool_call, \"id\"):\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args if not isinstance(tool_call.args, str) else json.loads(tool_call.args)\n        else:\n            tool_call_id = tool_call.get(\"id\", \"\")\n            tool_call_name = tool_call.get(\"name\", \"\")\n            args = tool_call.get(\"args\", {})\n            tool_call_args = args if not isinstance(args, str) else json.loads(args)\n\n        if tool_call_name == \"generate_task_steps\":\n            # Get the steps from the tool call\n            steps_raw = tool_call_args.get(\"steps\", [])\n            \n            # Set initial status to \"enabled\" for all steps\n            steps_data = []\n            \n            # Handle different potential formats of steps data\n            if isinstance(steps_raw, list):\n                for step in steps_raw:\n                    if isinstance(step, dict) and \"description\" in step:\n                        steps_data.append({\n                            \"description\": step[\"description\"],\n                            \"status\": \"enabled\"\n                        })\n                    elif isinstance(step, str):\n                        steps_data.append({\n                            \"description\": step,\n                            \"status\": \"enabled\"\n                        })\n            \n            # If no steps were processed correctly, return to END with the updated messages\n            if not steps_data:\n                return Command(\n                    goto=END,\n                    update={\n                        \"messages\": messages,\n                        \"steps\": state[\"steps\"],\n                    }\n                )\n            # Update steps in state and emit to frontend\n            state[\"steps\"] = steps_data\n            \n            # Add a tool response to satisfy OpenAI's requirements\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Task steps generated.\",\n                \"tool_call_id\": tool_call_id\n            }\n            \n            messages = messages + [tool_response]\n\n            # Move to the process_steps_node which will handle the interrupt and final response\n            return Command(\n                goto=\"process_steps_node\",\n                update={\n                    \"messages\": messages,\n                    \"steps\": state[\"steps\"],\n                }\n            )\n    \n    # If no tool calls or not generate_task_steps, return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\nasync def process_steps_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This node handles the user interrupt for step customization and generates the final response.\n    \"\"\"\n\n    # Check if we already have a user_response in the state\n    # This happens when the node restarts after an interrupt\n    if \"user_response\" in state and state[\"user_response\"]:\n        user_response = state[\"user_response\"]\n    else:\n        # Use LangGraph interrupt to get user input on steps\n        # This will pause execution and wait for user input in the frontend\n        user_response = interrupt({\"steps\": state[\"steps\"]})\n        # Store the user response in state for when the node restarts\n        state[\"user_response\"] = user_response\n    \n    # Generate the creative completion response\n    final_prompt = \"\"\"\n    Provide a textual description of how you are performing the task.\n    If the user has disabled a step, you are not allowed to perform that step.\n    However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n    some humor in the description of how you are performing the task.\n    Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n    \"\"\"\n    \n    final_response = await ChatOpenAI(model=\"gpt-4o\").ainvoke([\n        SystemMessage(content=final_prompt),\n        {\"role\": \"user\", \"content\": user_response}\n    ], config)\n\n    # Add the final response to messages\n    messages = state[\"messages\"] + [final_response]\n    \n    # Clear the user_response from state to prepare for future interactions\n    if \"user_response\" in state:\n        state.pop(\"user_response\")\n    \n    # Return to END with the updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"steps\": state[\"steps\"],\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\nworkflow.add_node(\"process_steps_node\", process_steps_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\n# workflow.add_edge(\"chat_node\", \"process_steps_node\") # Removed unconditional edge\nworkflow.add_edge(\"process_steps_node\", END)\n# workflow.add_edge(\"chat_node\", END)                 # Removed unconditional edge\n\n# Add conditional edges from chat_node\ndef should_continue(command: Command):\n    if command.goto == \"process_steps_node\":\n        return \"process_steps_node\"\n    else:\n        return END\n\nworkflow.add_conditional_edges(\n    \"chat_node\",\n    should_continue,\n    {\n        \"process_steps_node\": \"process_steps_node\",\n        END: END,\n    },\n)\n\n# Compile the graph\nhuman_in_the_loop_graph = workflow.compile(checkpointer=MemorySaver())",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Document Editor\",\n            initial: \"Hi 👋 How can I help with your document?\",\n          }}\n          clickOutsideToClose={false}\n        >\n          <DocumentEditor />\n        </CopilotSidebar>\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction({\n    name: \"confirm_changes\",\n    renderAndWaitForResponse: ({ args, respond, status }) => (\n      <ConfirmChanges\n        args={args}\n        respond={respond}\n        status={status}\n        onReject={() => {\n          editor?.commands.setContent(fromMarkdown(currentDocument));\n          setAgentState({ document: currentDocument });\n        }}\n        onConfirm={() => {\n          editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n          setCurrentDocument(agentState?.document || \"\");\n          setAgentState({ document: agentState?.document || \"\" });\n        }}\n      />\n    ),\n  });\n\n  // Action to write the document.\n  useCopilotAction({\n    name: \"write_document\",\n    description: `Present the proposed changes to the user for review`,\n    parameters: [\n      {\n        name: \"document\",\n        type: \"string\",\n        description: \"The full updated document in markdown format\",\n      },\n    ],\n    renderAndWaitForResponse({ args, status, respond }) {\n      if (status === \"executing\") {\n        return (\n          <ConfirmChanges\n            args={args}\n            respond={respond}\n            status={status}\n            onReject={() => {\n              editor?.commands.setContent(fromMarkdown(currentDocument));\n              setAgentState({ document: currentDocument });\n            }}\n            onConfirm={() => {\n              editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n              setCurrentDocument(agentState?.document || \"\");\n              setAgentState({ document: agentState?.document || \"\" });\n            }}\n          />\n        );\n      }\n      return <></>;\n    },\n  });\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\">\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "predictive_state_updates.py",
      "content": "\"\"\"\nA demo of predictive state updates using LangGraph.\n\"\"\"\n\nimport json\nimport uuid\nfrom typing import Dict, List, Any, Optional\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nWRITE_DOCUMENT_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"write_document_local\",\n        \"description\": \" \".join(\"\"\"\n            Write a document. Use markdown formatting to format the document.\n            It's good to format the document extensively so it's easy to read.\n            You can use all kinds of markdown.\n            However, do not use italic or strike-through formatting, it's reserved for another purpose.\n            You MUST write the full document, even when changing only a few words.\n            When making edits to the document, try to make them minimal - do not change every word.\n            Keep stories SHORT!\n            \"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"document\": {\n                    \"type\": \"string\",\n                    \"description\": \"The document to write\"\n                },\n            },\n        }\n    }\n}\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n    tools: List[Any]\n\n\nasync def start_flow(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n    return Command(\n        goto=\"chat_node\"\n    )\n\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n\n    system_prompt = f\"\"\"\n    You are a helpful assistant for writing documents. \n    To write the document, you MUST use the write_document_local tool.\n    You MUST write the full document, even when changing only a few words.\n    When you wrote the document, DO NOT repeat it as a message. \n    Just briefly summarize the changes you made. 2 sentences max.\n    This is the current state of the document: ----\\n {state.get('document')}\\n-----\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model with emit_intermediate_state to stream tool calls to frontend\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document_local tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"document\",\n        \"tool\": \"write_document_local\",\n        \"tool_argument\": \"document\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            WRITE_DOCUMENT_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n    \n    # Extract any tool calls from the response\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n        \n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            tool_call_args = tool_call[\"args\"]\n        else:\n            # Handle as an object (backward compatibility)\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            tool_call_args = tool_call.args\n\n        if tool_call_name == \"write_document_local\":\n            # Add the tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Document written.\",\n                \"tool_call_id\": tool_call_id\n            }\n            \n            # Add confirmation tool call\n            confirm_tool_call = {\n                \"role\": \"assistant\",\n                \"content\": \"\",\n                \"tool_calls\": [{\n                    \"id\": str(uuid.uuid4()),\n                    \"function\": {\n                        \"name\": \"confirm_changes\",\n                        \"arguments\": \"{}\"\n                    }\n                }]\n            }\n            \n            messages = messages + [tool_response, confirm_tool_call]\n            \n            # Return Command to route to end\n            return Command(\n                goto=END,\n                update={\n                    \"messages\": messages,\n                    \"document\": tool_call_args[\"document\"]\n                }\n            )\n    \n    # If no tool was called, go to end\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\npredictive_state_updates_graph = workflow.compile(checkpointer=MemorySaver())\n",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div\n        className=\"min-h-screen w-full flex items-center justify-center\"\n        style={\n          {\n            backgroundImage: \"url('/shared_state_background.png')\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"center\",\n            backgroundRepeat: \"no-repeat\",\n          } as React.CSSProperties\n        }\n      >\n        <Recipe />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Recipe Assistant\",\n            initial: \"Hi 👋 How can I help with your recipe?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form className=\"recipe-card\">\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button type=\"button\" className=\"add-button\" onClick={addIngredient}>\n            + Add Ingredient\n          </button>\n        </div>\n        <div className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit using LangGraph.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import Dict, List, Any, Optional\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langchain_core.callbacks.manager import adispatch_custom_event\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\n\nclass SpecialPreferences(str, Enum):\n    \"\"\"\n    Special preferences for the recipe.\n    \"\"\"\n    HIGH_PROTEIN = \"High Protein\"\n    LOW_CARB = \"Low Carb\"\n    SPICY = \"Spicy\"\n    BUDGET_FRIENDLY = \"Budget-Friendly\"\n    ONE_POT_MEAL = \"One-Pot Meal\"\n    VEGETARIAN = \"Vegetarian\"\n    VEGAN = \"Vegan\"\n\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\n\nGENERATE_RECIPE_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_recipe\",\n        \"description\": \" \".join(\"\"\"Using the existing (if any) ingredients and instructions, proceed with the recipe to finish it.\n        Make sure the recipe is complete. ALWAYS provide the entire recipe, not just the changes.\"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"recipe\": {\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"skill_level\": {\n                            \"type\": \"string\",\n                            \"enum\": [level.value for level in SkillLevel],\n                            \"description\": \"The skill level required for the recipe\"\n                        },\n                        \"special_preferences\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"string\",\n                                \"enum\": [preference.value for preference in SpecialPreferences]\n                            },\n                            \"description\": \"A list of special preferences for the recipe\"\n                        },\n                        \"cooking_time\": {\n                            \"type\": \"string\",\n                            \"enum\": [time.value for time in CookingTime],\n                            \"description\": \"The cooking time of the recipe\"\n                        },\n                        \"ingredients\": {\n                            \"type\": \"array\",\n                            \"items\": {\"icon\": \"string\", \"name\": \"string\", \"amount\": \"string\"},\n                            \"description\": \"Entire list of ingredients for the recipe, including the new ingredients and the ones that are already in the recipe: Icon: the actual emoji (not emoji code like '\\x1f35e', but the actual emoji like 🥕), name and amount. Like so: 🥕 Carrots (250g)\"\n                        },\n                        \"instructions\": {\n                            \"type\": \"array\",\n                            \"items\": {\"type\": \"string\"},\n                            \"description\": \"Entire list of instructions for the recipe, including the new instructions and the ones that are already there\"\n                        },\n                        \"changes\": {\n                            \"type\": \"string\",\n                            \"description\": \"A description of the changes made to the recipe\"\n                        }\n                    },\n                }\n            },\n            \"required\": [\"recipe\"]\n        }\n    }\n}\n\n\nclass AgentState(MessagesState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Dict[str, Any]] = None\n    tools: List[Any]\n\n\nasync def start_flow(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    This is the entry point for the flow.\n    \"\"\"\n\n    # Initialize recipe if not exists\n    if \"recipe\" not in state or state[\"recipe\"] is None:\n        state[\"recipe\"] = {\n            \"skill_level\": SkillLevel.BEGINNER.value,\n            \"special_preferences\": [],\n            \"cooking_time\": CookingTime.FIFTEEN_MIN.value,\n            \"ingredients\": [{\"icon\": \"🍴\", \"name\": \"Sample Ingredient\", \"amount\": \"1 unit\"}],\n            \"instructions\": [\"First step instruction\"]\n        }\n        # Emit the initial state to ensure it's properly shared with the frontend\n        await adispatch_custom_event(\n            \"manually_emit_intermediate_state\",\n            state,\n            config=config,\n        )\n    \n    return Command(\n        goto=\"chat_node\",\n        update={\n            \"messages\": state[\"messages\"],\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\nasync def chat_node(state: Dict[str, Any], config: RunnableConfig):\n    \"\"\"\n    Standard chat node.\n    \"\"\"\n    # Create a safer serialization of the recipe\n    recipe_json = \"No recipe yet\"\n    if \"recipe\" in state and state[\"recipe\"] is not None:\n        try:\n            recipe_json = json.dumps(state[\"recipe\"], indent=2)\n        except Exception as e:\n            recipe_json = f\"Error serializing recipe: {str(e)}\"\n    \n    system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n    This is the current state of the recipe: {recipe_json}\n    You can improve the recipe by calling the generate_recipe tool.\n    \n    IMPORTANT:\n    1. Create a recipe using the existing ingredients and instructions. Make sure the recipe is complete.\n    2. For ingredients, append new ingredients to the existing ones.\n    3. For instructions, append new steps to the existing ones.\n    4. 'ingredients' is always an array of objects with 'icon', 'name', and 'amount' fields\n    5. 'instructions' is always an array of strings\n\n    If you have just created or modified the recipe, just answer in one sentence what you did. dont describe the recipe, just say what you did.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o-mini\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Use \"predict_state\" metadata to set up streaming for the write_document tool\n    config[\"metadata\"][\"predict_state\"] = [{\n        \"state_key\": \"recipe\",\n        \"tool\": \"generate_recipe\",\n        \"tool_argument\": \"recipe\"\n    }]\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [\n            *state[\"tools\"],\n            GENERATE_RECIPE_TOOL\n        ],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model and generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Update messages with the response\n    messages = state[\"messages\"] + [response]\n\n    # Handle tool calls\n    if hasattr(response, \"tool_calls\") and response.tool_calls:\n        tool_call = response.tool_calls[0]\n        \n        # Handle tool_call as a dictionary or an object\n        if isinstance(tool_call, dict):\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"name\"]\n            # Check if args is already a dict or needs to be parsed\n            if isinstance(tool_call[\"args\"], dict):\n                tool_call_args = tool_call[\"args\"]\n            else:\n                tool_call_args = json.loads(tool_call[\"args\"])\n        else:\n            # Handle as an object\n            tool_call_id = tool_call.id\n            tool_call_name = tool_call.name\n            # Check if args is already a dict or needs to be parsed\n            if isinstance(tool_call.args, dict):\n                tool_call_args = tool_call.args\n            else:\n                tool_call_args = json.loads(tool_call.args)\n\n        if tool_call_name == \"generate_recipe\":\n            # Update recipe state with tool_call_args\n            recipe_data = tool_call_args[\"recipe\"]\n            \n            # If we have an existing recipe, update it\n            if \"recipe\" in state and state[\"recipe\"] is not None:\n                recipe = state[\"recipe\"]\n                for key, value in recipe_data.items():\n                    if value is not None:  # Only update fields that were provided\n                        recipe[key] = value\n            else:\n                # Create a new recipe\n                recipe = {\n                    \"skill_level\": recipe_data.get(\"skill_level\", SkillLevel.BEGINNER.value),\n                    \"special_preferences\": recipe_data.get(\"special_preferences\", []),\n                    \"cooking_time\": recipe_data.get(\"cooking_time\", CookingTime.FIFTEEN_MIN.value),\n                    \"ingredients\": recipe_data.get(\"ingredients\", []),\n                    \"instructions\": recipe_data.get(\"instructions\", [])\n                }\n            \n            # Add tool response to messages\n            tool_response = {\n                \"role\": \"tool\",\n                \"content\": \"Recipe generated.\",\n                \"tool_call_id\": tool_call_id\n            }\n            \n            messages = messages + [tool_response]\n            \n            # Explicitly emit the updated state to ensure it's shared with frontend\n            state[\"recipe\"] = recipe\n            await adispatch_custom_event(\n                \"manually_emit_intermediate_state\",\n                state,\n                config=config,\n            )\n            \n            # Return command with updated recipe\n            return Command(\n                goto=\"start_flow\",\n                update={\n                    \"messages\": messages,\n                    \"recipe\": recipe\n                }\n            )\n\n    return Command(\n        goto=END,\n        update={\n            \"messages\": messages,\n            \"recipe\": state[\"recipe\"]\n        }\n    )\n\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"start_flow\", start_flow)\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"start_flow\")\nworkflow.add_edge(START, \"start_flow\")\nworkflow.add_edge(\"start_flow\", \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\nshared_state_graph = workflow.compile(checkpointer=MemorySaver())",
      "language": "python",
      "type": "file"
    }
  ],
  "langgraph-fastapi::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotKitCSSProperties, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport React from \"react\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"tool_based_generative_ui\"\n    >\n      <div\n        className=\"min-h-full w-full flex items-center justify-center\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as CopilotKitCSSProperties\n        }\n      >\n        <Haiku />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"Haiku Generator\",\n            initial: \"I'm a haiku generator 👋. How can I help you?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction Haiku() {\n  const [haiku, setHaiku] = useState<{\n    japanese: string[];\n    english: string[];\n  }>({\n    japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n    english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n  });\n\n  useCopilotAction({\n    name: \"generate_haiku\",\n    parameters: [\n      {\n        name: \"japanese\",\n        type: \"string[]\",\n      },\n      {\n        name: \"english\",\n        type: \"string[]\",\n      },\n    ],\n    followUp: false,\n    handler: async () => {\n      return \"Haiku generated.\";\n    },\n    render: ({ args: generatedHaiku, result, status }) => {\n      return <HaikuApproval setHaiku={setHaiku} generatedHaiku={generatedHaiku} status={status} />;\n    },\n  });\n  return (\n    <>\n      <div className=\"text-left\">\n        {haiku?.japanese.map((line, index) => (\n          <div className=\"flex items-center gap-6 mb-2\" key={index}>\n            <p className=\"text-4xl font-bold text-gray-500\">{line}</p>\n            <p className=\"text-base font-light\">{haiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n\ninterface HaikuApprovalProps {\n  setHaiku: any;\n  status: any;\n  generatedHaiku: any;\n}\n\nfunction HaikuApproval({ setHaiku, status, generatedHaiku }: HaikuApprovalProps) {\n  const [isApplied, setIsApplied] = useState(false);\n  if (!generatedHaiku || !generatedHaiku.japanese || !generatedHaiku.japanese.length) {\n    return <></>;\n  }\n\n  return (\n    <div className=\"text-left rounded-md p-4 mt-4 mb-4 flex flex-col bg-gray-100 dark:bg-zinc-900\">\n      <div className={status === \"complete\" ? \"border-b border-gray-300 mb-4\" : \"\"}>\n        {generatedHaiku?.japanese?.map((line: string, index: number) => (\n          <div className=\"flex items-center gap-3 mb-2 pb-2\" key={index}>\n            <p className=\"text-lg font-bold\">{line}</p>\n            <p className=\"text-sm font-light\">{generatedHaiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n      {status === \"complete\" && (\n        <button\n          onClick={() => {\n            setHaiku(generatedHaiku);\n            setIsApplied(true);\n          }}\n          className=\"ml-auto px-3 py-1 bg-white dark:bg-black text-black dark:text-white text-sm rounded cursor-pointer font-sm border \"\n        >\n          {isApplied ? \"Applied ✓\" : \"Apply\"}\n        </button>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "tool_based_generative_ui.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI using LangGraph.\n\"\"\"\n\nfrom typing import Dict, List, Any, Optional\n\n# LangGraph imports\nfrom langchain_core.runnables import RunnableConfig\nfrom langgraph.graph import StateGraph, END, START\nfrom langgraph.types import Command\nfrom langgraph.graph import MessagesState\nfrom langgraph.checkpoint.memory import MemorySaver\n# OpenAI imports\nfrom langchain_openai import ChatOpenAI\nfrom langchain_core.messages import SystemMessage\n\n# List of available images (modify path if needed)\nIMAGE_LIST = [\n  \"Osaka_Castle_Turret_Stone_Wall_Pine_Trees_Daytime.jpg\",\n  \"Tokyo_Skyline_Night_Tokyo_Tower_Mount_Fuji_View.jpg\",\n  \"Itsukushima_Shrine_Miyajima_Floating_Torii_Gate_Sunset_Long_Exposure.jpg\",\n  \"Takachiho_Gorge_Waterfall_River_Lush_Greenery_Japan.jpg\",\n  \"Bonsai_Tree_Potted_Japanese_Art_Green_Foliage.jpeg\",\n  \"Shirakawa-go_Gassho-zukuri_Thatched_Roof_Village_Aerial_View.jpg\",\n  \"Ginkaku-ji_Silver_Pavilion_Kyoto_Japanese_Garden_Pond_Reflection.jpg\",\n  \"Senso-ji_Temple_Asakusa_Cherry_Blossoms_Kimono_Umbrella.jpg\",\n  \"Cherry_Blossoms_Sakura_Night_View_City_Lights_Japan.jpg\",\n  \"Mount_Fuji_Lake_Reflection_Cherry_Blossoms_Sakura_Spring.jpg\"\n]\n\n# This tool generates a haiku on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nGENERATE_HAIKU_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_haiku\",\n        \"description\": \"Generate a haiku in Japanese and its English translation. Also select exactly 3 relevant images from the provided list based on the haiku's theme.\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"japanese\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in Japanese\"\n                },\n                \"english\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in English\"\n                },\n                \"image_names\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of EXACTLY THREE image filenames from the provided list that are most relevant to the haiku.\"\n                }\n            },\n            \"required\": [\"japanese\", \"english\", \"image_names\"]\n        }\n    }\n}\n\nclass AgentState(MessagesState):\n    tools: List[Any]\n\nasync def chat_node(state: AgentState, config: RunnableConfig):\n    \"\"\"\n    The main function handling chat and tool calls.\n    \"\"\"\n    # Prepare the image list string for the prompt\n    image_list_str = \"\\n\".join([f\"- {img}\" for img in IMAGE_LIST])\n\n    system_prompt = f\"\"\"\n        You assist the user in generating a haiku.\n        When generating a haiku using the 'generate_haiku' tool, you MUST also select exactly 3 image filenames from the following list that are most relevant to the haiku's content or theme. Return the filenames in the 'image_names' parameter.\n        \n        Available images:\n        {image_list_str}\n        \n        Dont provide the relavent image names in your final response to the user.\n    \"\"\"\n\n    # Define the model\n    model = ChatOpenAI(model=\"gpt-4o\")\n    \n    # Define config for the model\n    if config is None:\n        config = RunnableConfig(recursion_limit=25)\n\n    # Bind the tools to the model\n    model_with_tools = model.bind_tools(\n        [GENERATE_HAIKU_TOOL],\n        # Disable parallel tool calls to avoid race conditions\n        parallel_tool_calls=False,\n    )\n\n    # Run the model to generate a response\n    response = await model_with_tools.ainvoke([\n        SystemMessage(content=system_prompt),\n        *state[\"messages\"],\n    ], config)\n\n    # Return Command to end with updated messages\n    return Command(\n        goto=END,\n        update={\n            \"messages\": state[\"messages\"] + [response]\n        }\n    )\n\n# Define the graph\nworkflow = StateGraph(AgentState)\n\n# Add nodes\nworkflow.add_node(\"chat_node\", chat_node)\n\n# Add edges\nworkflow.set_entry_point(\"chat_node\")\nworkflow.add_edge(START, \"chat_node\")\nworkflow.add_edge(\"chat_node\", END)\n\n# Compile the graph\ntool_based_generative_ui_graph = workflow.compile(checkpointer=MemorySaver())\n\n",
      "language": "python",
      "type": "file"
    }
  ],
  "agno::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {}
  ],
  "llama-index::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "from llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\nfrom typing import Annotated\n\n\n# This tool has a client-side version that is actually called to change the background\ndef change_background(\n    background: Annotated[str, \"The background. Prefer gradients.\"],\n) -> str:\n    \"\"\"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\"\"\"\n    return f\"Changing background to {background}\"\n\nagentic_chat_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[change_background],\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  // Ensure we have valid steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\"text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {localSteps.map((step, index) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={step.status === \"enabled\"}\n                onChange={() => handleCheckboxChange(index)}\n                className=\"mr-2\"\n              />\n              <span className={step.status !== \"enabled\" ? \"line-through\" : \"\"}>\n                {step.description}\n              </span>\n            </label>\n          </div>\n        ))}\n        <button\n          className=\"mt-4 bg-gradient-to-r from-purple-400 to-purple-600 text-white py-2 px-4 rounded cursor-pointer w-48 font-bold\"\n          onClick={() => {\n            const selectedSteps = localSteps\n              .filter((step) => step.status === \"enabled\")\n              .map((step) => step.description);\n            resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n          }}\n        >\n          ✨ Perform Steps\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst Chat = () => {\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const [localSteps, setLocalSteps] = useState<\n    {\n      description: string;\n      status: \"disabled\" | \"enabled\" | \"executing\";\n    }[]\n  >([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\" text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {steps.map((step: any, index: any) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <input\n              type=\"checkbox\"\n              checked={step.status === \"enabled\"}\n              onChange={() => handleCheckboxChange(index)}\n              className=\"mr-2\"\n            />\n            <span\n              className={step.status !== \"enabled\" && status != \"inProgress\" ? \"line-through\" : \"\"}\n            >\n              {step.description}\n            </span>\n          </div>\n        ))}\n      </div>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                respond({ accepted: true, steps: localSteps.filter(step => step.status === \"enabled\")});\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "from typing import Literal, List\nfrom pydantic import BaseModel\n\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\n\n\n\nclass Step(BaseModel):\n    description: str\n    status: Literal[\"enabled\", \"disabled\", \"executing\"]\n\n\ndef generate_task_steps(steps: List[Step]) -> str:\n    return f\"Generated {len(steps)} steps\"\n\n\nhuman_in_the_loop_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[generate_task_steps],\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      return (\n        <div className=\"flex\">\n          <div className=\"bg-gray-100 rounded-lg w-[800px] p-4 text-black space-y-2\">\n            {state.steps.map((step, index) => {\n              if (step.status === \"completed\") {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    ✓ {step.description}\n                  </div>\n                );\n              } else if (\n                step.status === \"pending\" &&\n                index === state.steps.findIndex((s) => s.status === \"pending\")\n              ) {\n                return (\n                  <div key={index} className=\"text-2xl font-bold text-slate-700\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              } else {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              }\n            })}\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "import asyncio\nimport copy\nimport jsonpatch\nfrom pydantic import BaseModel\n\nfrom llama_index.core.workflow import Context\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\nfrom llama_index.protocols.ag_ui.events import StateDeltaWorkflowEvent, StateSnapshotWorkflowEvent\n\nclass Step(BaseModel):\n    description: str\n\nclass Task(BaseModel):\n    steps: list[Step]\n\n# Genrative UI demo\nasync def run_task(\n    ctx: Context, task: Task,\n) -> str:\n    \"\"\"Execute any list of steps needed to complete a task. Useful for anything the user wants to do.\"\"\"\n    state = await ctx.get(\"state\", default={})\n    task = Task.model_validate(task)\n\n    state = {\n        \"steps\": [\n            {\n                \"description\": step.description,\n                \"status\": \"pending\"\n            }\n            for step in task.steps\n        ]\n    }\n\n    # Send initial state snapshot\n    ctx.write_event_to_stream(\n        StateSnapshotWorkflowEvent(\n            snapshot=state\n        )\n    )\n\n    # Sleep for 1 second\n    await asyncio.sleep(1.0)\n\n    # Create a copy to track changes for JSON patches\n    previous_state = copy.deepcopy(state)\n\n    # Update each step and send deltas\n    for i, step in enumerate(state[\"steps\"]):\n        step[\"status\"] = \"completed\"\n        \n        # Generate JSON patch from previous state to current state\n        patch = jsonpatch.make_patch(previous_state, state)\n        \n        # Send state delta event\n        ctx.write_event_to_stream(\n            StateDeltaWorkflowEvent(\n                delta=patch.patch\n            )\n        )\n        \n        # Update previous state for next iteration\n        previous_state = copy.deepcopy(state)\n        \n        # Sleep for 1 second\n        await asyncio.sleep(1.0)\n\n    # Optionally send a final snapshot to the client\n    ctx.write_event_to_stream(\n        StateSnapshotWorkflowEvent(\n            snapshot=state\n        )\n    )\n\n    return \"Done!\"\n\n\nagentic_generative_ui_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[run_task],\n    initial_state={},\n    system_prompt=(\n        \"You are a helpful assistant that can help the user with their task. \"\n        \"If the user asks you to do any task, use the run_task tool to do it. \"\n        \"Use your best judgement to describe the steps.\"\n    )\n)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "llama-index::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div\n        className=\"min-h-screen w-full flex items-center justify-center\"\n        style={\n          {\n            backgroundImage: \"url('/shared_state_background.png')\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"center\",\n            backgroundRepeat: \"no-repeat\",\n          } as React.CSSProperties\n        }\n      >\n        <Recipe />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Recipe Assistant\",\n            initial: \"Hi 👋 How can I help with your recipe?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form className=\"recipe-card\">\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button type=\"button\" className=\"add-button\" onClick={addIngredient}>\n            + Add Ingredient\n          </button>\n        </div>\n        <div className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "from typing import Literal, List\nfrom pydantic import BaseModel\n\nfrom llama_index.core.workflow import Context\nfrom llama_index.llms.openai import OpenAI\nfrom llama_index.protocols.ag_ui.events import StateSnapshotWorkflowEvent\nfrom llama_index.protocols.ag_ui.router import get_ag_ui_workflow_router\n\n\nclass Ingredient(BaseModel):\n    icon: str\n    name: str\n    amount: str\n\nclass Recipe(BaseModel):\n    skill_level: str\n    special_preferences: List[str]\n    cooking_time: str\n    ingredients: List[Ingredient]\n    instructions: List[str]\n\n\nasync def update_recipe(ctx: Context, recipe: Recipe) -> str:\n    \"\"\"Useful for recording a recipe to shared state.\"\"\"\n    recipe = Recipe.model_validate(recipe)\n\n    state = await ctx.get(\"state\")\n    if state is None:\n        state = {}\n\n    state[\"recipe\"] = recipe.model_dump()\n\n    ctx.write_event_to_stream(\n        StateSnapshotWorkflowEvent(\n            snapshot=state\n        )\n    )\n\n    await ctx.set(\"state\", state)\n\n    return \"Recipe updated!\"\n\n\nshared_state_router = get_ag_ui_workflow_router(\n    llm=OpenAI(model=\"gpt-4.1\"),\n    frontend_tools=[update_recipe],\n    initial_state={\n        \"recipe\": None,\n    }\n)\n\n\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::agentic_chat": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticChatProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticChat: React.FC<AgenticChatProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_chat\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\nconst Chat = () => {\n  const [background, setBackground] = useState<string>(\"--copilot-kit-background-color\");\n\n  useCopilotAction({\n    name: \"change_background\",\n    description:\n      \"Change the background color of the chat. Can be anything that the CSS background attribute accepts. Regular colors, linear of radial gradients etc.\",\n    parameters: [\n      {\n        name: \"background\",\n        type: \"string\",\n        description: \"The background. Prefer gradients.\",\n      },\n    ],\n    handler: ({ background }) => {\n      setBackground(background);\n      return {\n        status: \"success\",\n        message: `Background changed to ${background}`,\n      };\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\" style={{ background }}>\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{ initial: \"Hi, I'm an agent. Want to chat?\" }}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default AgenticChat;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n  \n.copilotKitChat {\n  background-color: #fff !important;\n}\n  ",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤖 Agentic Chat with Frontend Tools\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic chat** capabilities with **frontend\ntool integration**:\n\n1. **Natural Conversation**: Chat with your Copilot in a familiar chat interface\n2. **Frontend Tool Execution**: The Copilot can directly interacts with your UI\n   by calling frontend functions\n3. **Seamless Integration**: Tools defined in the frontend and automatically\n   discovered and made available to the agent\n\n## How to Interact\n\nTry asking your Copilot to:\n\n- \"Can you change the background color to something more vibrant?\"\n- \"Make the background a blue to purple gradient\"\n- \"Set the background to a sunset-themed gradient\"\n- \"Change it back to a simple light color\"\n\nYou can also chat about other topics - the agent will respond conversationally\nwhile having the ability to use your UI tools when appropriate.\n\n## ✨ Frontend Tool Integration in Action\n\n**What's happening technically:**\n\n- The React component defines a frontend function using `useCopilotAction`\n- CopilotKit automatically exposes this function to the agent\n- When you make a request, the agent determines whether to use the tool\n- The agent calls the function with the appropriate parameters\n- The UI immediately updates in response\n\n**What you'll see in this demo:**\n\n- The Copilot understands requests to change the background\n- It generates CSS values for colors and gradients\n- When it calls the tool, the background changes instantly\n- The agent provides a conversational response about the changes it made\n\nThis technique of exposing frontend functions to your Copilot can be extended to\nany UI manipulation you want to enable, from theme changes to data filtering,\nnavigation, or complex UI state management!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_chat.py",
      "content": "\"\"\"\nA simple agentic chat flow.\n\"\"\"\n\nfrom crewai.flow.flow import Flow, start\nfrom litellm import completion\nfrom ..sdk import copilotkit_stream, CopilotKitState\n\nclass AgenticChatFlow(Flow[CopilotKitState]):\n\n    @start()\n    async def chat(self):\n        system_prompt = \"You are a helpful assistant.\"\n\n        # 1. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 1.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 1.2 Bind the available tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                ],\n\n                # 1.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 2. Append the message to the messages in state\n        self.state.messages.append(message)\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::human_in_the_loop": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React, { useState, useEffect } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCopilotAction, useLangGraphInterrupt } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface HumanInTheLoopProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst HumanInTheLoop: React.FC<HumanInTheLoopProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"human_in_the_loop\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface Step {\n  description: string;\n  status: \"disabled\" | \"enabled\" | \"executing\";\n}\nconst InterruptHumanInTheLoop: React.FC<{\n  event: { value: { steps: Step[] } };\n  resolve: (value: string) => void;\n}> = ({ event, resolve }) => {\n  // Ensure we have valid steps data\n  let initialSteps: Step[] = [];\n  if (event.value && event.value.steps && Array.isArray(event.value.steps)) {\n    initialSteps = event.value.steps.map((step: any) => ({\n      description: typeof step === \"string\" ? step : step.description || \"\",\n      status: typeof step === \"object\" && step.status ? step.status : \"enabled\",\n    }));\n  }\n\n  const [localSteps, setLocalSteps] = useState<Step[]>(initialSteps);\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\"text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {localSteps.map((step, index) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <label className=\"flex items-center cursor-pointer\">\n              <input\n                type=\"checkbox\"\n                checked={step.status === \"enabled\"}\n                onChange={() => handleCheckboxChange(index)}\n                className=\"mr-2\"\n              />\n              <span className={step.status !== \"enabled\" ? \"line-through\" : \"\"}>\n                {step.description}\n              </span>\n            </label>\n          </div>\n        ))}\n        <button\n          className=\"mt-4 bg-gradient-to-r from-purple-400 to-purple-600 text-white py-2 px-4 rounded cursor-pointer w-48 font-bold\"\n          onClick={() => {\n            const selectedSteps = localSteps\n              .filter((step) => step.status === \"enabled\")\n              .map((step) => step.description);\n            resolve(\"The user selected the following steps: \" + selectedSteps.join(\", \"));\n          }}\n        >\n          ✨ Perform Steps\n        </button>\n      </div>\n    </div>\n  );\n};\n\nconst Chat = () => {\n  useLangGraphInterrupt({\n    render: ({ event, resolve }) => <InterruptHumanInTheLoop event={event} resolve={resolve} />,\n  });\n  useCopilotAction({\n    name: \"generate_task_steps\",\n    description: \"Generates a list of steps for the user to perform\",\n    parameters: [\n      {\n        name: \"steps\",\n        type: \"object[]\",\n        attributes: [\n          {\n            name: \"description\",\n            type: \"string\",\n          },\n          {\n            name: \"status\",\n            type: \"string\",\n            enum: [\"enabled\", \"disabled\", \"executing\"],\n          },\n        ],\n      },\n    ],\n    renderAndWaitForResponse: ({ args, respond, status }) => {\n      return <StepsFeedback args={args} respond={respond} status={status} />;\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent specialized in helping you with your tasks. How can I help you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nconst StepsFeedback = ({ args, respond, status }: { args: any; respond: any; status: any }) => {\n  const [localSteps, setLocalSteps] = useState<\n    {\n      description: string;\n      status: \"disabled\" | \"enabled\" | \"executing\";\n    }[]\n  >([]);\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n\n  useEffect(() => {\n    if (status === \"executing\" && localSteps.length === 0) {\n      setLocalSteps(args.steps);\n    }\n  }, [status, args.steps, localSteps]);\n\n  if (args.steps === undefined || args.steps.length === 0) {\n    return <></>;\n  }\n\n  const steps = localSteps.length > 0 ? localSteps : args.steps;\n\n  const handleCheckboxChange = (index: number) => {\n    setLocalSteps((prevSteps) =>\n      prevSteps.map((step, i) =>\n        i === index\n          ? {\n              ...step,\n              status: step.status === \"enabled\" ? \"disabled\" : \"enabled\",\n            }\n          : step,\n      ),\n    );\n  };\n\n  return (\n    <div className=\"flex flex-col gap-4 w-[500px] bg-gray-100 rounded-lg p-8 mb-4\">\n      <div className=\" text-black space-y-2\">\n        <h2 className=\"text-lg font-bold mb-4\">Select Steps</h2>\n        {steps.map((step: any, index: any) => (\n          <div key={index} className=\"text-sm flex items-center\">\n            <input\n              type=\"checkbox\"\n              checked={step.status === \"enabled\"}\n              onChange={() => handleCheckboxChange(index)}\n              className=\"mr-2\"\n            />\n            <span\n              className={step.status !== \"enabled\" && status != \"inProgress\" ? \"line-through\" : \"\"}\n            >\n              {step.description}\n            </span>\n          </div>\n        ))}\n      </div>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                respond({ accepted: true, steps: localSteps.filter(step => step.status === \"enabled\")});\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\nexport default HumanInTheLoop;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🤝 Human-in-the-Loop Task Planner\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **human-in-the-loop** capabilities:\n\n1. **Collaborative Planning**: The Copilot generates task steps and lets you\n   decide which ones to perform\n2. **Interactive Decision Making**: Select or deselect steps to customize the\n   execution plan\n3. **Adaptive Responses**: The Copilot adapts its execution based on your\n   choices, even handling missing steps\n\n## How to Interact\n\nTry these steps to experience the demo:\n\n1. Ask your Copilot to help with a task, such as:\n\n   - \"Make me a sandwich\"\n   - \"Plan a weekend trip\"\n   - \"Organize a birthday party\"\n   - \"Start a garden\"\n\n2. Review the suggested steps provided by your Copilot\n\n3. Select or deselect steps using the checkboxes to customize the plan\n\n   - Try removing essential steps to see how the Copilot adapts!\n\n4. Click \"Execute Plan\" to see the outcome based on your selections\n\n## ✨ Human-in-the-Loop Magic in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and breaks it down into logical steps\n- These steps are presented to you through a dynamic UI component\n- Your selections are captured as user input\n- The agent considers your choices when executing the plan\n- The agent adapts to missing steps with creative problem-solving\n\n**What you'll see in this demo:**\n\n- The Copilot provides a detailed, step-by-step plan for your task\n- You have complete control over which steps to include\n- If you remove essential steps, the Copilot provides entertaining and creative\n  workarounds\n- The final execution reflects your choices, showing how human input shapes the\n  outcome\n- Each response is tailored to your specific selections\n\nThis human-in-the-loop pattern creates a powerful collaborative experience where\nboth human judgment and AI capabilities work together to achieve better results\nthan either could alone!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "human_in_the_loop.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI.\n\"\"\"\n\nfrom crewai.flow.flow import Flow, start, router, listen\nfrom litellm import completion\nfrom pydantic import BaseModel\nfrom typing import Literal, List\nfrom ..sdk import (\n  copilotkit_stream,\n  CopilotKitState,\n)\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nDEFINE_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in imperative form (i.e. Dig hole, Open door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in imperative form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"enabled\"],\n                                \"description\": \"The status of the step, always 'enabled'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nclass TaskStep(BaseModel):\n    description: str\n    status: Literal[\"enabled\", \"disabled\"]\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    Here we define the state of the agent\n\n    In this instance, we're inheriting from CopilotKitState, which will bring in\n    the CopilotKitState fields. We're also adding a custom field, `steps`,\n    which will be used to store the steps of the task.\n    \"\"\"\n    steps: List[TaskStep] = []\n\n\nclass HumanInTheLoopFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that uses the CopilotKit framework to create a chat agent.\n    \"\"\"\n\n    @start()\n    @listen(\"route_follow_up\")\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n\n    @router(start_flow)\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n        system_prompt = \"\"\"\n        You are a helpful assistant that can perform any task.\n        You MUST call the `generate_task_steps` function when the user asks you to perform a task.\n        When the function `generate_task_steps` is called, the user will decide to enable or disable a step.\n        After the user has decided which steps to perform, provide a textual description of how you are performing the task.\n        If the user has disabled a step, you are not allowed to perform that step.\n        However, you should find a creative workaround to perform the task, and if an essential step is disabled, you can even use\n        some humor in the description of how you are performing the task.\n        Don't just repeat a list of steps, come up with a creative but short description (3 sentences max) of how you are performing the task.\n        \"\"\"\n\n        # 1. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 1.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 1.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    DEFINE_TASK_TOOL\n                ],\n\n                # 1.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 2. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        return \"route_end\"\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::tool_based_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCopilotAction } from \"@copilotkit/react-core\";\nimport { CopilotKitCSSProperties, CopilotSidebar } from \"@copilotkit/react-ui\";\nimport { useState } from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport React from \"react\";\n\ninterface ToolBasedGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function ToolBasedGenerativeUI({ params }: ToolBasedGenerativeUIProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"tool_based_generative_ui\"\n    >\n      <div\n        className=\"min-h-full w-full flex items-center justify-center\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as CopilotKitCSSProperties\n        }\n      >\n        <Haiku />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"Haiku Generator\",\n            initial: \"I'm a haiku generator 👋. How can I help you?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nfunction Haiku() {\n  const [haiku, setHaiku] = useState<{\n    japanese: string[];\n    english: string[];\n  }>({\n    japanese: [\"仮の句よ\", \"まっさらながら\", \"花を呼ぶ\"],\n    english: [\"A placeholder verse—\", \"even in a blank canvas,\", \"it beckons flowers.\"],\n  });\n\n  useCopilotAction({\n    name: \"generate_haiku\",\n    parameters: [\n      {\n        name: \"japanese\",\n        type: \"string[]\",\n      },\n      {\n        name: \"english\",\n        type: \"string[]\",\n      },\n    ],\n    followUp: false,\n    handler: async () => {\n      return \"Haiku generated.\";\n    },\n    render: ({ args: generatedHaiku, result, status }) => {\n      return <HaikuApproval setHaiku={setHaiku} generatedHaiku={generatedHaiku} status={status} />;\n    },\n  });\n  return (\n    <>\n      <div className=\"text-left\">\n        {haiku?.japanese.map((line, index) => (\n          <div className=\"flex items-center gap-6 mb-2\" key={index}>\n            <p className=\"text-4xl font-bold text-gray-500\">{line}</p>\n            <p className=\"text-base font-light\">{haiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n    </>\n  );\n}\n\ninterface HaikuApprovalProps {\n  setHaiku: any;\n  status: any;\n  generatedHaiku: any;\n}\n\nfunction HaikuApproval({ setHaiku, status, generatedHaiku }: HaikuApprovalProps) {\n  const [isApplied, setIsApplied] = useState(false);\n  if (!generatedHaiku || !generatedHaiku.japanese || !generatedHaiku.japanese.length) {\n    return <></>;\n  }\n\n  return (\n    <div className=\"text-left rounded-md p-4 mt-4 mb-4 flex flex-col bg-gray-100 dark:bg-zinc-900\">\n      <div className={status === \"complete\" ? \"border-b border-gray-300 mb-4\" : \"\"}>\n        {generatedHaiku?.japanese?.map((line: string, index: number) => (\n          <div className=\"flex items-center gap-3 mb-2 pb-2\" key={index}>\n            <p className=\"text-lg font-bold\">{line}</p>\n            <p className=\"text-sm font-light\">{generatedHaiku?.english?.[index]}</p>\n          </div>\n        ))}\n      </div>\n      {status === \"complete\" && (\n        <button\n          onClick={() => {\n            setHaiku(generatedHaiku);\n            setIsApplied(true);\n          }}\n          className=\"ml-auto px-3 py-1 bg-white dark:bg-black text-black dark:text-white text-sm rounded cursor-pointer font-sm border \"\n        >\n          {isApplied ? \"Applied ✓\" : \"Apply\"}\n        </button>\n      )}\n    </div>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🪶 Tool-Based Generative UI Haiku Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **tool-based generative UI** capabilities:\n\n1. **Frontend Rendering of Tool Calls**: Backend tool calls are automatically\n   rendered in the UI\n2. **Dynamic UI Generation**: The UI updates in real-time as the agent generates\n   content\n3. **Elegant Content Presentation**: Complex structured data (haikus) are\n   beautifully displayed\n\n## How to Interact\n\nChat with your Copilot and ask for haikus about different topics:\n\n- \"Create a haiku about nature\"\n- \"Write a haiku about technology\"\n- \"Generate a haiku about the changing seasons\"\n- \"Make a humorous haiku about programming\"\n\nEach request will trigger the agent to generate a haiku and display it in a\nvisually appealing card format in the UI.\n\n## ✨ Tool-Based Generative UI in Action\n\n**What's happening technically:**\n\n- The agent processes your request and determines it should create a haiku\n- It calls a backend tool that returns structured haiku data\n- CopilotKit automatically renders this tool call in the frontend\n- The rendering is handled by the registered tool component in your React app\n- No manual state management is required to display the results\n\n**What you'll see in this demo:**\n\n- As you request a haiku, a beautifully formatted card appears in the UI\n- The haiku follows the traditional 5-7-5 syllable structure\n- Each haiku is presented with consistent styling\n- Multiple haikus can be generated in sequence\n- The UI adapts to display each new piece of content\n\nThis pattern of tool-based generative UI can be extended to create any kind of\ndynamic content - from data visualizations to interactive components, all driven\nby your Copilot's tool calls!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "tool_based_generative_ui.py",
      "content": "\"\"\"\nAn example demonstrating tool-based generative UI.\n\"\"\"\n\nfrom crewai.flow.flow import Flow, start\nfrom litellm import completion\nfrom ..sdk import copilotkit_stream, CopilotKitState\n\n\n# This tool generates a haiku on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nGENERATE_HAIKU_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_haiku\",\n        \"description\": \"Generate a haiku in Japanese and its English translation\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"japanese\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in Japanese\"\n                },\n                \"english\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"An array of three lines of the haiku in English\"\n                },\n                \"image_names\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"string\"\n                    },\n                    \"description\": \"Names of 3 relevant images from the provided list\"\n                }\n            },\n            \"required\": [\"japanese\", \"english\", \"image_names\"]\n        }\n    }\n}\n\n\nclass ToolBasedGenerativeUIFlow(Flow[CopilotKitState]):\n    \"\"\"\n    A flow that demonstrates tool-based generative UI.\n    \"\"\"\n\n    @start()\n    async def chat(self):\n        \"\"\"\n        The main function handling chat and tool calls.\n        \"\"\"\n        system_prompt = \"You assist the user in generating a haiku. When generating a haiku using the 'generate_haiku' tool, you MUST also select exactly 3 image filenames from the following list that are most relevant to the haiku's content or theme. Return the filenames in the 'image_names' parameter. Dont provide the relavent image names in your final response to the user. \"\n\n\n        # 1. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 1.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 1.2 Bind the available tools to the model\n                tools=[ GENERATE_HAIKU_TOOL ],\n\n                # 1.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 2. Append the message to the messages in state\n        self.state.messages.append(message)\n\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::agentic_generative_ui": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport React from \"react\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\nimport { CopilotKit, useCoAgentStateRender } from \"@copilotkit/react-core\";\nimport { CopilotChat } from \"@copilotkit/react-ui\";\n\ninterface AgenticGenerativeUIProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nconst AgenticGenerativeUI: React.FC<AgenticGenerativeUIProps> = ({ params }) => {\n  const { integrationId } = React.use(params);\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"agentic_generative_ui\"\n    >\n      <Chat />\n    </CopilotKit>\n  );\n};\n\ninterface AgentState {\n  steps: {\n    description: string;\n    status: \"pending\" | \"completed\";\n  }[];\n}\n\nconst Chat = () => {\n  useCoAgentStateRender<AgentState>({\n    name: \"agentic_generative_ui\",\n    render: ({ state }) => {\n      if (!state.steps || state.steps.length === 0) {\n        return null;\n      }\n\n      return (\n        <div className=\"flex\">\n          <div className=\"bg-gray-100 rounded-lg w-[800px] p-4 text-black space-y-2\">\n            {state.steps.map((step, index) => {\n              if (step.status === \"completed\") {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    ✓ {step.description}\n                  </div>\n                );\n              } else if (\n                step.status === \"pending\" &&\n                index === state.steps.findIndex((s) => s.status === \"pending\")\n              ) {\n                return (\n                  <div key={index} className=\"text-2xl font-bold text-slate-700\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              } else {\n                return (\n                  <div key={index} className=\"text-sm\">\n                    <Spinner />\n                    {step.description}\n                  </div>\n                );\n              }\n            })}\n          </div>\n        </div>\n      );\n    },\n  });\n\n  return (\n    <div className=\"flex justify-center items-center h-full w-full\">\n      <div className=\"w-8/10 h-8/10 rounded-lg\">\n        <CopilotChat\n          className=\"h-full rounded-2xl\"\n          labels={{\n            initial:\n              \"Hi, I'm an agent! I can help you with anything you need and will show you progress as I work. What can I do for you?\",\n          }}\n        />\n      </div>\n    </div>\n  );\n};\n\nfunction Spinner() {\n  return (\n    <svg\n      className=\"mr-2 size-3 animate-spin text-slate-500\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n      fill=\"none\"\n      viewBox=\"0 0 24 24\"\n    >\n      <circle\n        className=\"opacity-25\"\n        cx=\"12\"\n        cy=\"12\"\n        r=\"10\"\n        stroke=\"currentColor\"\n        strokeWidth=\"4\"\n      ></circle>\n      <path\n        className=\"opacity-75\"\n        fill=\"currentColor\"\n        d=\"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z\"\n      ></path>\n    </svg>\n  );\n}\n\nexport default AgenticGenerativeUI;\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitInput {\n  border-bottom-left-radius: 0.75rem;\n  border-bottom-right-radius: 0.75rem;\n  border-top-left-radius: 0.75rem;\n  border-top-right-radius: 0.75rem;\n  border: 1px solid var(--copilot-kit-separator-color) !important;\n}\n\n.copilotKitChat {\n  background-color: #fff !important;\n}\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🚀 Agentic Generative UI Task Executor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **agentic generative UI** capabilities:\n\n1. **Real-time Status Updates**: The Copilot provides live feedback as it works\n   through complex tasks\n2. **Long-running Task Execution**: See how agents can handle extended processes\n   with continuous feedback\n3. **Dynamic UI Generation**: The interface updates in real-time to reflect the\n   agent's progress\n\n## How to Interact\n\nSimply ask your Copilot to perform any moderately complex task:\n\n- \"Make me a sandwich\"\n- \"Plan a vacation to Japan\"\n- \"Create a weekly workout routine\"\n\nThe Copilot will break down the task into steps and begin \"executing\" them,\nproviding real-time status updates as it progresses.\n\n## ✨ Agentic Generative UI in Action\n\n**What's happening technically:**\n\n- The agent analyzes your request and creates a detailed execution plan\n- Each step is processed sequentially with realistic timing\n- Status updates are streamed to the frontend using CopilotKit's streaming\n  capabilities\n- The UI dynamically renders these updates without page refreshes\n- The entire flow is managed by the agent, requiring no manual intervention\n\n**What you'll see in this demo:**\n\n- The Copilot breaks your task into logical steps\n- A status indicator shows the current progress\n- Each step is highlighted as it's being executed\n- Detailed status messages explain what's happening at each moment\n- Upon completion, you receive a summary of the task execution\n\nThis pattern of providing real-time progress for long-running tasks is perfect\nfor scenarios where users benefit from transparency into complex processes -\nfrom data analysis to content creation, system configurations, or multi-stage\nworkflows!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "agentic_generative_ui.py",
      "content": "\"\"\"\nAn example demonstrating agentic generative UI.\n\"\"\"\n\nimport json\nimport asyncio\nfrom crewai.flow.flow import Flow, start, router, listen, or_\nfrom litellm import completion\nfrom pydantic import BaseModel\nfrom typing import Literal, List\n\nfrom ..sdk import (\n  copilotkit_stream,\n  CopilotKitState,\n  copilotkit_predict_state,\n  copilotkit_emit_state\n)\n\n# This tool simulates performing a task on the server.\n# The tool call will be streamed to the frontend as it is being generated.\nPERFORM_TASK_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_task_steps\",\n        \"description\": \"Make up 10 steps (only a couple of words per step) that are required for a task. The step should be in gerund form (i.e. Digging hole, opening door, ...)\",\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"steps\": {\n                    \"type\": \"array\",\n                    \"items\": {\n                        \"type\": \"object\",\n                        \"properties\": {\n                            \"description\": {\n                                \"type\": \"string\",\n                                \"description\": \"The text of the step in gerund form\"\n                            },\n                            \"status\": {\n                                \"type\": \"string\",\n                                \"enum\": [\"pending\"],\n                                \"description\": \"The status of the step, always 'pending'\"\n                            }\n                        },\n                        \"required\": [\"description\", \"status\"]\n                    },\n                    \"description\": \"An array of 10 step objects, each containing text and status\"\n                }\n            },\n            \"required\": [\"steps\"]\n        }\n    }\n}\n\nclass TaskStep(BaseModel):\n    description: str\n    status: Literal[\"pending\", \"completed\"]\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    Here we define the state of the agent\n\n    In this instance, we're inheriting from CopilotKitState, which will bring in\n    the CopilotKitState fields. We're also adding a custom field, `steps`,\n    which will be used to store the steps of the task.\n    \"\"\"\n    steps: List[TaskStep] = []\n\n\nclass AgenticGenerativeUIFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that uses the CopilotKit framework to create a chat agent.\n    \"\"\"\n\n    \n    @start()\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n        self.state.steps = []\n\n    @router(or_(start_flow, \"simulate_task\"))\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n        system_prompt = \"\"\"\n        You are a helpful assistant assisting with any task. \n        When asked to do something, you MUST call the function `generate_task_steps`\n        that was provided to you.\n        If you called the function, you MUST NOT repeat the steps in your next response to the user.\n        Just give a very brief summary (one sentence) of what you did with some emojis. \n        Always say you actually did the steps, not merely generated them.\n        \"\"\"\n\n        # 1. Here we specify that we want to stream the tool call to generate_task_steps\n        #    to the frontend as state.\n        await copilotkit_predict_state({\n            \"steps\": {\n                \"tool_name\": \"generate_task_steps\",\n                \"tool_argument\": \"steps\"\n            }\n        })\n\n        # 2. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 2.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 2.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    PERFORM_TASK_TOOL\n                ],\n\n                # 2.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 3. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 4. Handle tool call\n        if message.get(\"tool_calls\"):\n            tool_call = message[\"tool_calls\"][0]\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"function\"][\"name\"]\n            tool_call_args = json.loads(tool_call[\"function\"][\"arguments\"])\n\n            if tool_call_name == \"generate_task_steps\":\n                # Convert each step in the JSON array to a TaskStep instance\n                self.state.steps = [TaskStep(**step) for step in tool_call_args[\"steps\"]]\n\n                # 4.1 Append the result to the messages in state\n                self.state.messages.append({\n                    \"role\": \"tool\",\n                    \"content\": \"Steps executed.\",\n                    \"tool_call_id\": tool_call_id\n                })\n                return \"route_simulate_task\"\n\n        # 5. If our tool was not called, return to the end route\n        return \"route_end\"\n\n    @listen(\"route_simulate_task\")\n    async def simulate_task(self):\n        \"\"\"\n        Simulate the task.\n        \"\"\"\n        for step in self.state.steps:\n            # simulate executing the step\n            await asyncio.sleep(1)\n            step.status = \"completed\"\n            await copilotkit_emit_state(self.state)\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::shared_state": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport { CopilotKit, useCoAgent, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { Role, TextMessage } from \"@copilotkit/runtime-client-gql\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\ninterface SharedStateProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function SharedState({ params }: SharedStateProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"shared_state\"\n    >\n      <div\n        className=\"min-h-screen w-full flex items-center justify-center\"\n        style={\n          {\n            backgroundImage: \"url('/shared_state_background.png')\",\n            backgroundSize: \"cover\",\n            backgroundPosition: \"center\",\n            backgroundRepeat: \"no-repeat\",\n          } as React.CSSProperties\n        }\n      >\n        <Recipe />\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Recipe Assistant\",\n            initial: \"Hi 👋 How can I help with your recipe?\",\n          }}\n          clickOutsideToClose={false}\n        />\n      </div>\n    </CopilotKit>\n  );\n}\n\nenum SkillLevel {\n  BEGINNER = \"Beginner\",\n  INTERMEDIATE = \"Intermediate\",\n  ADVANCED = \"Advanced\",\n}\n\nenum CookingTime {\n  FiveMin = \"5 min\",\n  FifteenMin = \"15 min\",\n  ThirtyMin = \"30 min\",\n  FortyFiveMin = \"45 min\",\n  SixtyPlusMin = \"60+ min\",\n}\n\nconst cookingTimeValues = [\n  { label: CookingTime.FiveMin, value: 0 },\n  { label: CookingTime.FifteenMin, value: 1 },\n  { label: CookingTime.ThirtyMin, value: 2 },\n  { label: CookingTime.FortyFiveMin, value: 3 },\n  { label: CookingTime.SixtyPlusMin, value: 4 },\n];\n\nenum SpecialPreferences {\n  HighProtein = \"High Protein\",\n  LowCarb = \"Low Carb\",\n  Spicy = \"Spicy\",\n  BudgetFriendly = \"Budget-Friendly\",\n  OnePotMeal = \"One-Pot Meal\",\n  Vegetarian = \"Vegetarian\",\n  Vegan = \"Vegan\",\n}\n\ninterface Ingredient {\n  icon: string;\n  name: string;\n  amount: string;\n}\n\ninterface Recipe {\n  title: string;\n  skill_level: SkillLevel;\n  cooking_time: CookingTime;\n  special_preferences: string[];\n  ingredients: Ingredient[];\n  instructions: string[];\n}\n\ninterface RecipeAgentState {\n  recipe: Recipe;\n}\n\nconst INITIAL_STATE: RecipeAgentState = {\n  recipe: {\n    title: \"Make Your Recipe\",\n    skill_level: SkillLevel.INTERMEDIATE,\n    cooking_time: CookingTime.FortyFiveMin,\n    special_preferences: [],\n    ingredients: [\n      { icon: \"🥕\", name: \"Carrots\", amount: \"3 large, grated\" },\n      { icon: \"🌾\", name: \"All-Purpose Flour\", amount: \"2 cups\" },\n    ],\n    instructions: [\"Preheat oven to 350°F (175°C)\"],\n  },\n};\n\nfunction Recipe() {\n  const { state: agentState, setState: setAgentState } = useCoAgent<RecipeAgentState>({\n    name: \"shared_state\",\n    initialState: INITIAL_STATE,\n  });\n\n  const [recipe, setRecipe] = useState(INITIAL_STATE.recipe);\n  const { appendMessage, isLoading } = useCopilotChat();\n  const [editingInstructionIndex, setEditingInstructionIndex] = useState<number | null>(null);\n  const newInstructionRef = useRef<HTMLTextAreaElement>(null);\n\n  const updateRecipe = (partialRecipe: Partial<Recipe>) => {\n    setAgentState({\n      ...agentState,\n      recipe: {\n        ...recipe,\n        ...partialRecipe,\n      },\n    });\n    setRecipe({\n      ...recipe,\n      ...partialRecipe,\n    });\n  };\n\n  const newRecipeState = { ...recipe };\n  const newChangedKeys = [];\n  const changedKeysRef = useRef<string[]>([]);\n\n  for (const key in recipe) {\n    if (\n      agentState &&\n      agentState.recipe &&\n      (agentState.recipe as any)[key] !== undefined &&\n      (agentState.recipe as any)[key] !== null\n    ) {\n      let agentValue = (agentState.recipe as any)[key];\n      const recipeValue = (recipe as any)[key];\n\n      // Check if agentValue is a string and replace \\n with actual newlines\n      if (typeof agentValue === \"string\") {\n        agentValue = agentValue.replace(/\\\\n/g, \"\\n\");\n      }\n\n      if (JSON.stringify(agentValue) !== JSON.stringify(recipeValue)) {\n        (newRecipeState as any)[key] = agentValue;\n        newChangedKeys.push(key);\n      }\n    }\n  }\n\n  if (newChangedKeys.length > 0) {\n    changedKeysRef.current = newChangedKeys;\n  } else if (!isLoading) {\n    changedKeysRef.current = [];\n  }\n\n  useEffect(() => {\n    setRecipe(newRecipeState);\n  }, [JSON.stringify(newRecipeState)]);\n\n  const handleTitleChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    updateRecipe({\n      title: event.target.value,\n    });\n  };\n\n  const handleSkillLevelChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      skill_level: event.target.value as SkillLevel,\n    });\n  };\n\n  const handleDietaryChange = (preference: string, checked: boolean) => {\n    if (checked) {\n      updateRecipe({\n        special_preferences: [...recipe.special_preferences, preference],\n      });\n    } else {\n      updateRecipe({\n        special_preferences: recipe.special_preferences.filter((p) => p !== preference),\n      });\n    }\n  };\n\n  const handleCookingTimeChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    updateRecipe({\n      cooking_time: cookingTimeValues[Number(event.target.value)].label,\n    });\n  };\n\n  const addIngredient = () => {\n    // Pick a random food emoji from our valid list\n    updateRecipe({\n      ingredients: [...recipe.ingredients, { icon: \"🍴\", name: \"\", amount: \"\" }],\n    });\n  };\n\n  const updateIngredient = (index: number, field: keyof Ingredient, value: string) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients[index] = {\n      ...updatedIngredients[index],\n      [field]: value,\n    };\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const removeIngredient = (index: number) => {\n    const updatedIngredients = [...recipe.ingredients];\n    updatedIngredients.splice(index, 1);\n    updateRecipe({ ingredients: updatedIngredients });\n  };\n\n  const addInstruction = () => {\n    const newIndex = recipe.instructions.length;\n    updateRecipe({\n      instructions: [...recipe.instructions, \"\"],\n    });\n    // Set the new instruction as the editing one\n    setEditingInstructionIndex(newIndex);\n\n    // Focus the new instruction after render\n    setTimeout(() => {\n      const textareas = document.querySelectorAll(\".instructions-container textarea\");\n      const newTextarea = textareas[textareas.length - 1] as HTMLTextAreaElement;\n      if (newTextarea) {\n        newTextarea.focus();\n      }\n    }, 50);\n  };\n\n  const updateInstruction = (index: number, value: string) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions[index] = value;\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  const removeInstruction = (index: number) => {\n    const updatedInstructions = [...recipe.instructions];\n    updatedInstructions.splice(index, 1);\n    updateRecipe({ instructions: updatedInstructions });\n  };\n\n  // Simplified icon handler that defaults to a fork/knife for any problematic icons\n  const getProperIcon = (icon: string | undefined): string => {\n    // If icon is undefined  return the default\n    if (!icon) {\n      return \"🍴\";\n    }\n\n    return icon;\n  };\n\n  return (\n    <form className=\"recipe-card\">\n      {/* Recipe Title */}\n      <div className=\"recipe-header\">\n        <input\n          type=\"text\"\n          value={recipe.title || \"\"}\n          onChange={handleTitleChange}\n          className=\"recipe-title-input\"\n        />\n\n        <div className=\"recipe-meta\">\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🕒</span>\n            <select\n              className=\"meta-select\"\n              value={cookingTimeValues.find((t) => t.label === recipe.cooking_time)?.value || 3}\n              onChange={handleCookingTimeChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {cookingTimeValues.map((time) => (\n                <option key={time.value} value={time.value}>\n                  {time.label}\n                </option>\n              ))}\n            </select>\n          </div>\n\n          <div className=\"meta-item\">\n            <span className=\"meta-icon\">🏆</span>\n            <select\n              className=\"meta-select\"\n              value={recipe.skill_level}\n              onChange={handleSkillLevelChange}\n              style={{\n                backgroundImage:\n                  \"url(\\\"data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%23555' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e\\\")\",\n                backgroundRepeat: \"no-repeat\",\n                backgroundPosition: \"right 0px center\",\n                backgroundSize: \"12px\",\n                appearance: \"none\",\n                WebkitAppearance: \"none\",\n              }}\n            >\n              {Object.values(SkillLevel).map((level) => (\n                <option key={level} value={level}>\n                  {level}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      </div>\n\n      {/* Dietary Preferences */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"special_preferences\") && <Ping />}\n        <h2 className=\"section-title\">Dietary Preferences</h2>\n        <div className=\"dietary-options\">\n          {Object.values(SpecialPreferences).map((option) => (\n            <label key={option} className=\"dietary-option\">\n              <input\n                type=\"checkbox\"\n                checked={recipe.special_preferences.includes(option)}\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\n                  handleDietaryChange(option, e.target.checked)\n                }\n              />\n              <span>{option}</span>\n            </label>\n          ))}\n        </div>\n      </div>\n\n      {/* Ingredients */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"ingredients\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Ingredients</h2>\n          <button type=\"button\" className=\"add-button\" onClick={addIngredient}>\n            + Add Ingredient\n          </button>\n        </div>\n        <div className=\"ingredients-container\">\n          {recipe.ingredients.map((ingredient, index) => (\n            <div key={index} className=\"ingredient-card\">\n              <div className=\"ingredient-icon\">{getProperIcon(ingredient.icon)}</div>\n              <div className=\"ingredient-content\">\n                <input\n                  type=\"text\"\n                  value={ingredient.name || \"\"}\n                  onChange={(e) => updateIngredient(index, \"name\", e.target.value)}\n                  placeholder=\"Ingredient name\"\n                  className=\"ingredient-name-input\"\n                />\n                <input\n                  type=\"text\"\n                  value={ingredient.amount || \"\"}\n                  onChange={(e) => updateIngredient(index, \"amount\", e.target.value)}\n                  placeholder=\"Amount\"\n                  className=\"ingredient-amount-input\"\n                />\n              </div>\n              <button\n                type=\"button\"\n                className=\"remove-button\"\n                onClick={() => removeIngredient(index)}\n                aria-label=\"Remove ingredient\"\n              >\n                ×\n              </button>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Instructions */}\n      <div className=\"section-container relative\">\n        {changedKeysRef.current.includes(\"instructions\") && <Ping />}\n        <div className=\"section-header\">\n          <h2 className=\"section-title\">Instructions</h2>\n          <button type=\"button\" className=\"add-step-button\" onClick={addInstruction}>\n            + Add Step\n          </button>\n        </div>\n        <div className=\"instructions-container\">\n          {recipe.instructions.map((instruction, index) => (\n            <div key={index} className=\"instruction-item\">\n              {/* Number Circle */}\n              <div className=\"instruction-number\">{index + 1}</div>\n\n              {/* Vertical Line */}\n              {index < recipe.instructions.length - 1 && <div className=\"instruction-line\" />}\n\n              {/* Instruction Content */}\n              <div\n                className={`instruction-content ${\n                  editingInstructionIndex === index\n                    ? \"instruction-content-editing\"\n                    : \"instruction-content-default\"\n                }`}\n                onClick={() => setEditingInstructionIndex(index)}\n              >\n                <textarea\n                  className=\"instruction-textarea\"\n                  value={instruction || \"\"}\n                  onChange={(e) => updateInstruction(index, e.target.value)}\n                  placeholder={!instruction ? \"Enter cooking instruction...\" : \"\"}\n                  onFocus={() => setEditingInstructionIndex(index)}\n                  onBlur={(e) => {\n                    // Only blur if clicking outside this instruction\n                    if (!e.relatedTarget || !e.currentTarget.contains(e.relatedTarget as Node)) {\n                      setEditingInstructionIndex(null);\n                    }\n                  }}\n                />\n\n                {/* Delete Button (only visible on hover) */}\n                <button\n                  type=\"button\"\n                  className={`instruction-delete-btn ${\n                    editingInstructionIndex === index\n                      ? \"instruction-delete-btn-editing\"\n                      : \"instruction-delete-btn-default\"\n                  } remove-button`}\n                  onClick={(e) => {\n                    e.stopPropagation(); // Prevent triggering parent onClick\n                    removeInstruction(index);\n                  }}\n                  aria-label=\"Remove instruction\"\n                >\n                  ×\n                </button>\n              </div>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Improve with AI Button */}\n      <div className=\"action-container\">\n        <button\n          className={isLoading ? \"improve-button loading\" : \"improve-button\"}\n          type=\"button\"\n          onClick={() => {\n            if (!isLoading) {\n              appendMessage(\n                new TextMessage({\n                  content: \"Improve the recipe\",\n                  role: Role.User,\n                }),\n              );\n            }\n          }}\n          disabled={isLoading}\n        >\n          {isLoading ? \"Please Wait...\" : \"Improve with AI\"}\n        </button>\n      </div>\n    </form>\n  );\n}\n\nfunction Ping() {\n  return (\n    <span className=\"ping-animation\">\n      <span className=\"ping-circle\"></span>\n      <span className=\"ping-dot\"></span>\n    </span>\n  );\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": ".copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n.copilotKitHeader {\n  border-top-left-radius: 5px !important;\n  background-color: #fff;\n  color: #000;\n  border-bottom: 0px;\n}\n\n/* Recipe App Styles */\n.app-container {\n  min-height: 100vh;\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-size: cover;\n  background-position: center;\n  background-repeat: no-repeat;\n  background-attachment: fixed;\n  position: relative;\n  overflow: auto;\n}\n\n.recipe-card {\n  background-color: rgba(255, 255, 255, 0.97);\n  border-radius: 16px;\n  box-shadow: 0 15px 30px rgba(0, 0, 0, 0.25), 0 5px 15px rgba(0, 0, 0, 0.15);\n  width: 100%;\n  max-width: 750px;\n  margin: 20px auto;\n  padding: 14px 32px;\n  position: relative;\n  z-index: 1;\n  backdrop-filter: blur(5px);\n  border: 1px solid rgba(255, 255, 255, 0.3);\n  transition: transform 0.2s ease, box-shadow 0.2s ease;\n  animation: fadeIn 0.5s ease-out forwards;\n  box-sizing: border-box;\n  overflow: hidden;\n}\n\n.recipe-card:hover {\n  transform: translateY(-5px);\n  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3), 0 10px 20px rgba(0, 0, 0, 0.2);\n}\n\n/* Recipe Header */\n.recipe-header {\n  margin-bottom: 24px;\n}\n\n.recipe-title-input {\n  width: 100%;\n  font-size: 24px;\n  font-weight: bold;\n  border: none;\n  outline: none;\n  padding: 8px 0;\n  margin-bottom: 0px;\n}\n\n.recipe-meta {\n  display: flex;\n  align-items: center;\n  gap: 20px;\n  margin-top: 5px;\n  margin-bottom: 14px;\n}\n\n.meta-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: #555;\n}\n\n.meta-icon {\n  font-size: 20px;\n  color: #777;\n}\n\n.meta-text {\n  font-size: 15px;\n}\n\n/* Recipe Meta Selects */\n.meta-item select {\n  border: none;\n  background: transparent;\n  font-size: 15px;\n  color: #555;\n  cursor: pointer;\n  outline: none;\n  padding-right: 18px;\n  transition: color 0.2s, transform 0.1s;\n  font-weight: 500;\n}\n\n.meta-item select:hover,\n.meta-item select:focus {\n  color: #FF5722;\n}\n\n.meta-item select:active {\n  transform: scale(0.98);\n}\n\n.meta-item select option {\n  color: #333;\n  background-color: white;\n  font-weight: normal;\n  padding: 8px;\n}\n\n/* Section Container */\n.section-container {\n  margin-bottom: 20px;\n  position: relative;\n  width: 100%;\n}\n\n.section-title {\n  font-size: 20px;\n  font-weight: 700;\n  margin-bottom: 20px;\n  color: #333;\n  position: relative;\n  display: inline-block;\n}\n\n.section-title:after {\n  content: \"\";\n  position: absolute;\n  bottom: -8px;\n  left: 0;\n  width: 40px;\n  height: 3px;\n  background-color: #ff7043;\n  border-radius: 3px;\n}\n\n/* Dietary Preferences */\n.dietary-options {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px 16px;\n  margin-bottom: 16px;\n  width: 100%;\n}\n\n.dietary-option {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  font-size: 14px;\n  cursor: pointer;\n  margin-bottom: 4px;\n}\n\n.dietary-option input {\n  cursor: pointer;\n}\n\n/* Ingredients */\n.ingredients-container {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n  margin-bottom: 15px;\n  width: 100%;\n  box-sizing: border-box;\n}\n\n.ingredient-card {\n  display: flex;\n  align-items: center;\n  background-color: rgba(255, 255, 255, 0.9);\n  border-radius: 12px;\n  padding: 12px;\n  margin-bottom: 10px;\n  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);\n  position: relative;\n  transition: all 0.2s ease;\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  width: calc(33.333% - 7px);\n  box-sizing: border-box;\n}\n\n.ingredient-card:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);\n}\n\n.ingredient-card .remove-button {\n  position: absolute;\n  right: 10px;\n  top: 10px;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 24px;\n  height: 24px;\n  line-height: 1;\n}\n\n.ingredient-card:hover .remove-button {\n  display: block;\n}\n\n.ingredient-icon {\n  font-size: 24px;\n  margin-right: 12px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 40px;\n  height: 40px;\n  background-color: #f7f7f7;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n.ingredient-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 3px;\n  min-width: 0;\n}\n\n.ingredient-name-input,\n.ingredient-amount-input {\n  border: none;\n  background: transparent;\n  outline: none;\n  width: 100%;\n  padding: 0;\n  text-overflow: ellipsis;\n  overflow: hidden;\n  white-space: nowrap;\n}\n\n.ingredient-name-input {\n  font-weight: 500;\n  font-size: 14px;\n}\n\n.ingredient-amount-input {\n  font-size: 13px;\n  color: #666;\n}\n\n.ingredient-name-input::placeholder,\n.ingredient-amount-input::placeholder {\n  color: #aaa;\n}\n\n.remove-button {\n  background: none;\n  border: none;\n  color: #999;\n  font-size: 20px;\n  cursor: pointer;\n  padding: 0;\n  width: 28px;\n  height: 28px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  margin-left: 10px;\n}\n\n.remove-button:hover {\n  color: #FF5722;\n}\n\n/* Instructions */\n.instructions-container {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n  position: relative;\n  margin-bottom: 12px;\n  width: 100%;\n}\n\n.instruction-item {\n  position: relative;\n  display: flex;\n  width: 100%;\n  box-sizing: border-box;\n  margin-bottom: 8px;\n  align-items: flex-start;\n}\n\n.instruction-number {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  min-width: 26px;\n  height: 26px;\n  background-color: #ff7043;\n  color: white;\n  border-radius: 50%;\n  font-weight: 600;\n  flex-shrink: 0;\n  box-shadow: 0 2px 4px rgba(255, 112, 67, 0.3);\n  z-index: 1;\n  font-size: 13px;\n  margin-top: 2px;\n}\n\n.instruction-line {\n  position: absolute;\n  left: 13px; /* Half of the number circle width */\n  top: 22px;\n  bottom: -18px;\n  width: 2px;\n  background: linear-gradient(to bottom, #ff7043 60%, rgba(255, 112, 67, 0.4));\n  z-index: 0;\n}\n\n.instruction-content {\n  background-color: white;\n  border-radius: 10px;\n  padding: 10px 14px;\n  margin-left: 12px;\n  flex-grow: 1;\n  transition: all 0.2s ease;\n  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.08);\n  border: 1px solid rgba(240, 240, 240, 0.8);\n  position: relative;\n  width: calc(100% - 38px);\n  box-sizing: border-box;\n  display: flex;\n  align-items: center;\n}\n\n.instruction-content-editing {\n  background-color: #fff9f6;\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12), 0 0 0 2px rgba(255, 112, 67, 0.2);\n}\n\n.instruction-content:hover {\n  transform: translateY(-2px);\n  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);\n}\n\n.instruction-textarea {\n  width: 100%;\n  background: transparent;\n  border: none;\n  resize: vertical;\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.4;\n  min-height: 20px;\n  outline: none;\n  padding: 0;\n  margin: 0;\n}\n\n.instruction-delete-btn {\n  position: absolute;\n  background: none;\n  border: none;\n  color: #ccc;\n  font-size: 16px;\n  cursor: pointer;\n  display: none;\n  padding: 0;\n  width: 20px;\n  height: 20px;\n  line-height: 1;\n  top: 50%;\n  transform: translateY(-50%);\n  right: 8px;\n}\n\n.instruction-content:hover .instruction-delete-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n/* Action Button */\n.action-container {\n  display: flex;\n  justify-content: center;\n  margin-top: 40px;\n  padding-bottom: 20px;\n  position: relative;\n}\n\n.improve-button {\n  background-color: #ff7043;\n  border: none;\n  color: white;\n  border-radius: 30px;\n  font-size: 18px;\n  font-weight: 600;\n  padding: 14px 28px;\n  cursor: pointer;\n  transition: all 0.3s ease;\n  box-shadow: 0 4px 15px rgba(255, 112, 67, 0.4);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n  position: relative;\n  min-width: 180px;\n}\n\n.improve-button:hover {\n  background-color: #ff5722;\n  transform: translateY(-2px);\n  box-shadow: 0 8px 20px rgba(255, 112, 67, 0.5);\n}\n\n.improve-button.loading {\n  background-color: #ff7043;\n  opacity: 0.8;\n  cursor: not-allowed;\n  padding-left: 42px; /* Reduced padding to bring text closer to icon */\n  padding-right: 22px; /* Balance the button */\n  justify-content: flex-start; /* Left align text for better alignment with icon */\n}\n\n.improve-button.loading:after {\n  content: \"\"; /* Add space between icon and text */\n  display: inline-block;\n  width: 8px; /* Width of the space */\n}\n\n.improve-button:before {\n  content: \"\";\n  background-image: url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpath d='M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83'/%3E%3C/svg%3E\");\n  width: 20px; /* Slightly smaller icon */\n  height: 20px;\n  background-repeat: no-repeat;\n  background-size: contain;\n  position: absolute;\n  left: 16px; /* Slightly adjusted */\n  top: 50%;\n  transform: translateY(-50%);\n  display: none;\n}\n\n.improve-button.loading:before {\n  display: block;\n  animation: spin 1.5s linear infinite;\n}\n\n@keyframes spin {\n  0% { transform: translateY(-50%) rotate(0deg); }\n  100% { transform: translateY(-50%) rotate(360deg); }\n}\n\n/* Ping Animation */\n.ping-animation {\n  position: absolute;\n  display: flex;\n  width: 12px;\n  height: 12px;\n  top: 0;\n  right: 0;\n}\n\n.ping-circle {\n  position: absolute;\n  display: inline-flex;\n  width: 100%;\n  height: 100%;\n  border-radius: 50%;\n  background-color: #38BDF8;\n  opacity: 0.75;\n  animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;\n}\n\n.ping-dot {\n  position: relative;\n  display: inline-flex;\n  width: 12px;\n  height: 12px;\n  border-radius: 50%;\n  background-color: #0EA5E9;\n}\n\n@keyframes ping {\n  75%, 100% {\n    transform: scale(2);\n    opacity: 0;\n  }\n}\n\n/* Instruction hover effects */\n.instruction-item:hover .instruction-delete-btn {\n  display: flex !important;\n}\n\n/* Add some subtle animations */\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(20px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n/* Better center alignment for the recipe card */\n.recipe-card-container {\n  display: flex;\n  justify-content: center;\n  width: 100%;\n  position: relative;\n  z-index: 1;\n  margin: 0 auto;\n  box-sizing: border-box;\n}\n\n/* Add Buttons */\n.add-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 8px;\n  padding: 10px 16px;\n  cursor: pointer;\n  font-weight: 500;\n  display: inline-block;\n  font-size: 14px;\n  margin-bottom: 0;\n}\n\n.add-step-button {\n  background-color: transparent;\n  color: #FF5722;\n  border: 1px dashed #FF5722;\n  border-radius: 6px;\n  padding: 6px 12px;\n  cursor: pointer;\n  font-weight: 500;\n  font-size: 13px;\n}\n\n/* Section Headers */\n.section-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 12px;\n}",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 🍳 Shared State Recipe Creator\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **shared state** functionality - a powerful\nfeature that enables bidirectional data flow between:\n\n1. **Frontend → Agent**: UI controls update the agent's context in real-time\n2. **Agent → Frontend**: The Copilot's recipe creations instantly update the UI\n   components\n\nIt's like having a cooking buddy who not only listens to what you want but also\nupdates your recipe card as you chat - no refresh needed! ✨\n\n## How to Interact\n\nMix and match any of these parameters (or none at all - it's up to you!):\n\n- **Skill Level**: Beginner to expert 👨‍🍳\n- **Cooking Time**: Quick meals or slow cooking ⏱️\n- **Special Preferences**: Dietary needs, flavor profiles, health goals 🥗\n- **Ingredients**: Items you want to include 🧅🥩🍄\n- **Instructions**: Any specific steps\n\nThen chat with your Copilot chef with prompts like:\n\n- \"I'm a beginner cook. Can you make me a quick dinner?\"\n- \"I need something spicy with chicken that takes under 30 minutes!\"\n\n## ✨ Shared State Magic in Action\n\n**What's happening technically:**\n\n- The UI and Copilot agent share the same state object (**Agent State = UI\n  State**)\n- Changes from either side automatically update the other\n- Neither side needs to manually request updates from the other\n\n**What you'll see in this demo:**\n\n- Set cooking time to 20 minutes in the UI and watch the Copilot immediately\n  respect your time constraint\n- Add ingredients through the UI and see them appear in your recipe\n- When the Copilot suggests new ingredients, watch them automatically appear in\n  the UI ingredients list\n- Change your skill level and see how the Copilot adapts its instructions in\n  real-time\n\nThis synchronized state creates a seamless experience where the agent always has\nyour current preferences, and any updates to the recipe are instantly reflected\nin both places.\n\nThis shared state pattern can be applied to any application where you want your\nUI and Copilot to work together in perfect harmony!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "shared_state.py",
      "content": "\"\"\"\nA demo of shared state between the agent and CopilotKit.\n\"\"\"\n\nimport json\nfrom enum import Enum\nfrom typing import List, Optional\nfrom litellm import completion\nfrom pydantic import BaseModel, Field\nfrom crewai.flow.flow import Flow, start, router, listen\nfrom ..sdk import (\n  copilotkit_stream, \n  copilotkit_predict_state,\n  CopilotKitState\n)\n\nclass SkillLevel(str, Enum):\n    \"\"\"\n    The level of skill required for the recipe.\n    \"\"\"\n    BEGINNER = \"Beginner\"\n    INTERMEDIATE = \"Intermediate\"\n    ADVANCED = \"Advanced\"\n\nclass CookingTime(str, Enum):\n    \"\"\"\n    The cooking time of the recipe.\n    \"\"\"\n    FIVE_MIN = \"5 min\"\n    FIFTEEN_MIN = \"15 min\"\n    THIRTY_MIN = \"30 min\"\n    FORTY_FIVE_MIN = \"45 min\"\n    SIXTY_PLUS_MIN = \"60+ min\"\n\nclass Ingredient(BaseModel):\n    \"\"\"\n    An ingredient with its details.\n    \"\"\"\n    icon: str = Field(..., description=\"Emoji icon representing the ingredient.\")\n    name: str = Field(..., description=\"Name of the ingredient.\")\n    amount: str = Field(..., description=\"Amount or quantity of the ingredient.\")\n\nGENERATE_RECIPE_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"generate_recipe\",\n        \"description\": \" \".join(\"\"\"Generate or modify an existing recipe. \n        When creating a new recipe, specify all fields. \n        When modifying, only fill optional fields if they need changes; \n        otherwise, leave them empty.\"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"recipe\": {\n                    \"description\": \"The recipe object containing all details.\",\n                    \"type\": \"object\",\n                    \"properties\": {\n                        \"title\": {\n                            \"type\": \"string\",\n                            \"description\": \"The title of the recipe.\"\n                        },\n                        \"skill_level\": {\n                            \"type\": \"string\",\n                            \"enum\": [level.value for level in SkillLevel],\n                            \"description\": \"The skill level required for the recipe.\"\n                        },\n                        \"special_preferences\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"string\"\n                            },\n                            \"description\": \"A list of dietary preferences (e.g., Vegetarian, Gluten-free).\"\n                        },\n                        \"cooking_time\": {\n                            \"type\": \"string\",\n                            \"enum\": [time.value for time in CookingTime],\n                            \"description\": \"The estimated cooking time for the recipe.\"\n                        },\n                        \"ingredients\": {\n                            \"type\": \"array\",\n                            \"items\": {\n                                \"type\": \"object\",\n                                \"properties\": {\n                                    \"icon\": {\"type\": \"string\", \"description\": \"Emoji icon for the ingredient.\"},\n                                    \"name\": {\"type\": \"string\", \"description\": \"Name of the ingredient.\"},\n                                    \"amount\": {\"type\": \"string\", \"description\": \"Amount/quantity of the ingredient.\"}\n                                },\n                                \"required\": [\"icon\", \"name\", \"amount\"]\n                            },\n                            \"description\": \"A list of ingredients required for the recipe.\"\n                        },\n                        \"instructions\": {\n                            \"type\": \"array\",\n                            \"items\": {\"type\": \"string\"},\n                            \"description\": \"Step-by-step instructions for preparing the recipe.\"\n                        }\n                    },\n                    \"required\": [\"title\", \"skill_level\", \"cooking_time\", \"special_preferences\", \"ingredients\", \"instructions\"]\n                }\n            },\n            \"required\": [\"recipe\"]\n        }\n    }\n}\n\nclass Recipe(BaseModel):\n    \"\"\"\n    A recipe.\n    \"\"\"\n    title: str\n    skill_level: SkillLevel\n    special_preferences: List[str] = Field(default_factory=list)\n    cooking_time: CookingTime\n    ingredients: List[Ingredient] = Field(default_factory=list)\n    instructions: List[str] = Field(default_factory=list)\n\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    The state of the recipe.\n    \"\"\"\n    recipe: Optional[Recipe] = None\n\nclass SharedStateFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that demonstrates shared state between the agent and CopilotKit.\n    \"\"\"\n\n    @start()\n    @listen(\"route_follow_up\")\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n        print(f\"start_flow\")\n        print(f\"self.state: {self.state}\")\n\n    @router(start_flow)\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n \n        system_prompt = f\"\"\"You are a helpful assistant for creating recipes. \n        This is the current state of the recipe: {self.state.model_dump_json(indent=2)}\n        You can modify the recipe by calling the generate_recipe tool.\n        If you have just created or modified the recipe, just answer in one sentence what you did.\n        \"\"\"\n\n        # 1. Here we specify that we want to stream the tool call to generate_recipe\n        #    to the frontend as state.\n        await copilotkit_predict_state({\n            \"recipe\": {\n                \"tool_name\": \"generate_recipe\",\n                \"tool_argument\": \"recipe\"\n            }\n        })\n\n        # 2. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 2.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 2.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    GENERATE_RECIPE_TOOL\n                ],\n\n                # 2.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 3. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 4. Handle tool call\n        if message.get(\"tool_calls\"):\n            tool_call = message[\"tool_calls\"][0]\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"function\"][\"name\"]\n            tool_call_args = json.loads(tool_call[\"function\"][\"arguments\"])\n\n            if tool_call_name == \"generate_recipe\":\n                # Attempt to update the recipe state using the data from the tool call\n                try:\n                    updated_recipe_data = tool_call_args[\"recipe\"]\n                    # Validate and update the state. Pydantic will raise an error if the structure is wrong.\n                    self.state.recipe = Recipe(**updated_recipe_data)\n\n                    # 4.1 Append the result to the messages in state\n                    self.state.messages.append({\n                        \"role\": \"tool\",\n                        \"content\": \"Recipe updated.\", # More accurate message\n                        \"tool_call_id\": tool_call_id\n                    })\n                    return \"route_follow_up\"\n                except Exception as e:\n                    # Handle validation or other errors during update\n                    print(f\"Error updating recipe state: {e}\") # Log the error server-side\n                    # Optionally inform the user via a tool message, though it might be noisy\n                    # self.state.messages.append({\"role\": \"tool\", \"content\": f\"Error processing recipe update: {e}\", \"tool_call_id\": tool_call_id})\n                    return \"route_end\" # End the flow on error for now\n\n        # 5. If our tool was not called, return to the end route\n        return \"route_end\"\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ],
  "crewai::predictive_state_updates": [
    {
      "name": "page.tsx",
      "content": "\"use client\";\nimport \"@copilotkit/react-ui/styles.css\";\nimport \"./style.css\";\n\nimport MarkdownIt from \"markdown-it\";\nimport React from \"react\";\n\nimport { diffWords } from \"diff\";\nimport { useEditor, EditorContent } from \"@tiptap/react\";\nimport StarterKit from \"@tiptap/starter-kit\";\nimport { useEffect, useState } from \"react\";\nimport { CopilotKit, useCoAgent, useCopilotAction, useCopilotChat } from \"@copilotkit/react-core\";\nimport { CopilotSidebar } from \"@copilotkit/react-ui\";\n\nconst extensions = [StarterKit];\n\ninterface PredictiveStateUpdatesProps {\n  params: Promise<{\n    integrationId: string;\n  }>;\n}\n\nexport default function PredictiveStateUpdates({ params }: PredictiveStateUpdatesProps) {\n  const { integrationId } = React.use(params);\n\n  return (\n    <CopilotKit\n      runtimeUrl={`/api/copilotkit/${integrationId}`}\n      showDevConsole={false}\n      // agent lock to the relevant agent\n      agent=\"predictive_state_updates\"\n    >\n      <div\n        className=\"min-h-screen w-full\"\n        style={\n          {\n            // \"--copilot-kit-primary-color\": \"#222\",\n            // \"--copilot-kit-separator-color\": \"#CCC\",\n          } as React.CSSProperties\n        }\n      >\n        <CopilotSidebar\n          defaultOpen={true}\n          labels={{\n            title: \"AI Document Editor\",\n            initial: \"Hi 👋 How can I help with your document?\",\n          }}\n          clickOutsideToClose={false}\n        >\n          <DocumentEditor />\n        </CopilotSidebar>\n      </div>\n    </CopilotKit>\n  );\n}\n\ninterface AgentState {\n  document: string;\n}\n\nconst DocumentEditor = () => {\n  const editor = useEditor({\n    extensions,\n    immediatelyRender: false,\n    editorProps: {\n      attributes: { class: \"min-h-screen p-10\" },\n    },\n  });\n  const [placeholderVisible, setPlaceholderVisible] = useState(false);\n  const [currentDocument, setCurrentDocument] = useState(\"\");\n  const { isLoading } = useCopilotChat();\n\n  const {\n    state: agentState,\n    setState: setAgentState,\n    nodeName,\n  } = useCoAgent<AgentState>({\n    name: \"predictive_state_updates\",\n    initialState: {\n      document: \"\",\n    },\n  });\n\n  useEffect(() => {\n    if (isLoading) {\n      setCurrentDocument(editor?.getText() || \"\");\n    }\n    editor?.setEditable(!isLoading);\n  }, [isLoading]);\n\n  useEffect(() => {\n    if (nodeName == \"end\") {\n      // set the text one final time when loading is done\n      if (currentDocument.trim().length > 0 && currentDocument !== agentState?.document) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument, true);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [nodeName]);\n\n  useEffect(() => {\n    if (isLoading) {\n      if (currentDocument.trim().length > 0) {\n        const newDocument = agentState?.document || \"\";\n        const diff = diffPartialText(currentDocument, newDocument);\n        const markdown = fromMarkdown(diff);\n        editor?.commands.setContent(markdown);\n      } else {\n        const markdown = fromMarkdown(agentState?.document || \"\");\n        editor?.commands.setContent(markdown);\n      }\n    }\n  }, [agentState?.document]);\n\n  const text = editor?.getText() || \"\";\n\n  useEffect(() => {\n    setPlaceholderVisible(text.length === 0);\n\n    if (!isLoading) {\n      setCurrentDocument(text);\n      setAgentState({\n        document: text,\n      });\n    }\n  }, [text]);\n\n  // TODO(steve): Remove this when all agents have been updated to use write_document tool.\n  useCopilotAction({\n    name: \"confirm_changes\",\n    renderAndWaitForResponse: ({ args, respond, status }) => (\n      <ConfirmChanges\n        args={args}\n        respond={respond}\n        status={status}\n        onReject={() => {\n          editor?.commands.setContent(fromMarkdown(currentDocument));\n          setAgentState({ document: currentDocument });\n        }}\n        onConfirm={() => {\n          editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n          setCurrentDocument(agentState?.document || \"\");\n          setAgentState({ document: agentState?.document || \"\" });\n        }}\n      />\n    ),\n  });\n\n  // Action to write the document.\n  useCopilotAction({\n    name: \"write_document\",\n    description: `Present the proposed changes to the user for review`,\n    parameters: [\n      {\n        name: \"document\",\n        type: \"string\",\n        description: \"The full updated document in markdown format\",\n      },\n    ],\n    renderAndWaitForResponse({ args, status, respond }) {\n      if (status === \"executing\") {\n        return (\n          <ConfirmChanges\n            args={args}\n            respond={respond}\n            status={status}\n            onReject={() => {\n              editor?.commands.setContent(fromMarkdown(currentDocument));\n              setAgentState({ document: currentDocument });\n            }}\n            onConfirm={() => {\n              editor?.commands.setContent(fromMarkdown(agentState?.document || \"\"));\n              setCurrentDocument(agentState?.document || \"\");\n              setAgentState({ document: agentState?.document || \"\" });\n            }}\n          />\n        );\n      }\n      return <></>;\n    },\n  });\n\n  return (\n    <div className=\"relative min-h-screen w-full\">\n      {placeholderVisible && (\n        <div className=\"absolute top-6 left-6 m-4 pointer-events-none text-gray-400\">\n          Write whatever you want here in Markdown format...\n        </div>\n      )}\n      <EditorContent editor={editor} />\n    </div>\n  );\n};\n\ninterface ConfirmChangesProps {\n  args: any;\n  respond: any;\n  status: any;\n  onReject: () => void;\n  onConfirm: () => void;\n}\n\nfunction ConfirmChanges({ args, respond, status, onReject, onConfirm }: ConfirmChangesProps) {\n  const [accepted, setAccepted] = useState<boolean | null>(null);\n  return (\n    <div className=\"bg-white p-6 rounded shadow-lg border border-gray-200 mt-5 mb-5\">\n      <h2 className=\"text-lg font-bold mb-4\">Confirm Changes</h2>\n      <p className=\"mb-6\">Do you want to accept the changes?</p>\n      {accepted === null && (\n        <div className=\"flex justify-end space-x-4\">\n          <button\n            className={`bg-gray-200 text-black py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(false);\n                onReject();\n                respond({ accepted: false });\n              }\n            }}\n          >\n            Reject\n          </button>\n          <button\n            className={`bg-black text-white py-2 px-4 rounded disabled:opacity-50 ${\n              status === \"executing\" ? \"cursor-pointer\" : \"cursor-default\"\n            }`}\n            disabled={status !== \"executing\"}\n            onClick={() => {\n              if (respond) {\n                setAccepted(true);\n                onConfirm();\n                respond({ accepted: true });\n              }\n            }}\n          >\n            Confirm\n          </button>\n        </div>\n      )}\n      {accepted !== null && (\n        <div className=\"flex justify-end\">\n          <div className=\"mt-4 bg-gray-200 text-black py-2 px-4 rounded inline-block\">\n            {accepted ? \"✓ Accepted\" : \"✗ Rejected\"}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction fromMarkdown(text: string) {\n  const md = new MarkdownIt({\n    typographer: true,\n    html: true,\n  });\n\n  return md.render(text);\n}\n\nfunction diffPartialText(oldText: string, newText: string, isComplete: boolean = false) {\n  let oldTextToCompare = oldText;\n  if (oldText.length > newText.length && !isComplete) {\n    // make oldText shorter\n    oldTextToCompare = oldText.slice(0, newText.length);\n  }\n\n  const changes = diffWords(oldTextToCompare, newText);\n\n  let result = \"\";\n  changes.forEach((part) => {\n    if (part.added) {\n      result += `<em>${part.value}</em>`;\n    } else if (part.removed) {\n      result += `<s>${part.value}</s>`;\n    } else {\n      result += part.value;\n    }\n  });\n\n  if (oldText.length > newText.length && !isComplete) {\n    result += oldText.slice(newText.length);\n  }\n\n  return result;\n}\n\nfunction isAlpha(text: string) {\n  return /[a-zA-Z\\u00C0-\\u017F]/.test(text.trim());\n}\n",
      "language": "typescript",
      "type": "file"
    },
    {
      "name": "style.css",
      "content": "/* Basic editor styles */\n.tiptap-container {\n  height: 100vh; /* Full viewport height */\n  width: 100vw; /* Full viewport width */\n  display: flex;\n  flex-direction: column;\n}\n\n.tiptap {\n  flex: 1; /* Take up remaining space */\n  overflow: auto; /* Allow scrolling if content overflows */\n}\n\n.tiptap :first-child {\n  margin-top: 0;\n}\n\n/* List styles */\n.tiptap ul,\n.tiptap ol {\n  padding: 0 1rem;\n  margin: 1.25rem 1rem 1.25rem 0.4rem;\n}\n\n.tiptap ul li p,\n.tiptap ol li p {\n  margin-top: 0.25em;\n  margin-bottom: 0.25em;\n}\n\n/* Heading styles */\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  line-height: 1.1;\n  margin-top: 2.5rem;\n  text-wrap: pretty;\n  font-weight: bold;\n}\n\n.tiptap h1,\n.tiptap h2,\n.tiptap h3,\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  margin-top: 3.5rem;\n  margin-bottom: 1.5rem;\n}\n\n.tiptap p {\n  margin-bottom: 1rem;\n}\n\n.tiptap h1 {\n  font-size: 1.4rem;\n}\n\n.tiptap h2 {\n  font-size: 1.2rem;\n}\n\n.tiptap h3 {\n  font-size: 1.1rem;\n}\n\n.tiptap h4,\n.tiptap h5,\n.tiptap h6 {\n  font-size: 1rem;\n}\n\n/* Code and preformatted text styles */\n.tiptap code {\n  background-color: var(--purple-light);\n  border-radius: 0.4rem;\n  color: var(--black);\n  font-size: 0.85rem;\n  padding: 0.25em 0.3em;\n}\n\n.tiptap pre {\n  background: var(--black);\n  border-radius: 0.5rem;\n  color: var(--white);\n  font-family: \"JetBrainsMono\", monospace;\n  margin: 1.5rem 0;\n  padding: 0.75rem 1rem;\n}\n\n.tiptap pre code {\n  background: none;\n  color: inherit;\n  font-size: 0.8rem;\n  padding: 0;\n}\n\n.tiptap blockquote {\n  border-left: 3px solid var(--gray-3);\n  margin: 1.5rem 0;\n  padding-left: 1rem;\n}\n\n.tiptap hr {\n  border: none;\n  border-top: 1px solid var(--gray-2);\n  margin: 2rem 0;\n}\n\n.tiptap s {\n  background-color: #f9818150;\n  padding: 2px;\n  font-weight: bold;\n  color: rgba(0, 0, 0, 0.7);\n}\n\n.tiptap em {\n  background-color: #b2f2bb;\n  padding: 2px;\n  font-weight: bold;\n  font-style: normal;\n}\n\n.copilotKitWindow {\n  box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);\n}\n\n",
      "language": "css",
      "type": "file"
    },
    {
      "name": "README.mdx",
      "content": "# 📝 Predictive State Updates Document Editor\n\n## What This Demo Shows\n\nThis demo showcases CopilotKit's **predictive state updates** for real-time\ndocument collaboration:\n\n1. **Live Document Editing**: Watch as your Copilot makes changes to a document\n   in real-time\n2. **Diff Visualization**: See exactly what's being changed as it happens\n3. **Streaming Updates**: Changes are displayed character-by-character as the\n   Copilot works\n\n## How to Interact\n\nTry these interactions with the collaborative document editor:\n\n- \"Fix the grammar and typos in this document\"\n- \"Make this text more professional\"\n- \"Add a section about [topic]\"\n- \"Summarize this content in bullet points\"\n- \"Change the tone to be more casual\"\n\nWatch as the Copilot processes your request and edits the document in real-time\nright before your eyes.\n\n## ✨ Predictive State Updates in Action\n\n**What's happening technically:**\n\n- The document state is shared between your UI and the Copilot\n- As the Copilot generates content, changes are streamed to the UI\n- Each modification is visualized with additions and deletions\n- The UI renders these changes progressively, without waiting for completion\n- All edits are tracked and displayed in a visually intuitive way\n\n**What you'll see in this demo:**\n\n- Text changes are highlighted in different colors (green for additions, red for\n  deletions)\n- The document updates character-by-character, creating a typing-like effect\n- You can see the Copilot's thought process as it refines the content\n- The final document seamlessly incorporates all changes\n- The experience feels collaborative, as if someone is editing alongside you\n\nThis pattern of real-time collaborative editing with diff visualization is\nperfect for document editors, code review tools, content creation platforms, or\nany application where users benefit from seeing exactly how content is being\ntransformed!\n",
      "language": "markdown",
      "type": "file"
    },
    {
      "name": "predictive_state_updates.py",
      "content": "\"\"\"\nA demo of predictive state updates.\n\"\"\"\n\nimport json\nimport uuid\nfrom typing import Optional\nfrom litellm import completion\nfrom crewai.flow.flow import Flow, start, router, listen\nfrom ..sdk import (\n  copilotkit_stream, \n  copilotkit_predict_state,\n  CopilotKitState\n)\n\nWRITE_DOCUMENT_TOOL = {\n    \"type\": \"function\",\n    \"function\": {\n        \"name\": \"write_document_local\",\n        \"description\": \" \".join(\"\"\"\n            Write a document. Use markdown formatting to format the document.\n            It's good to format the document extensively so it's easy to read.\n            You can use all kinds of markdown.\n            However, do not use italic or strike-through formatting, it's reserved for another purpose.\n            You MUST write the full document, even when changing only a few words.\n            When making edits to the document, try to make them minimal - do not change every word.\n            Keep stories SHORT!\n            \"\"\".split()),\n        \"parameters\": {\n            \"type\": \"object\",\n            \"properties\": {\n                \"document\": {\n                    \"type\": \"string\",\n                    \"description\": \"The document to write\"\n                },\n            },\n        }\n    }\n}\n\n\nclass AgentState(CopilotKitState):\n    \"\"\"\n    The state of the agent.\n    \"\"\"\n    document: Optional[str] = None\n\nclass PredictiveStateUpdatesFlow(Flow[AgentState]):\n    \"\"\"\n    This is a sample flow that demonstrates predictive state updates.\n    \"\"\"\n\n    @start()\n    @listen(\"route_follow_up\")\n    async def start_flow(self):\n        \"\"\"\n        This is the entry point for the flow.\n        \"\"\"\n\n    @router(start_flow)\n    async def chat(self):\n        \"\"\"\n        Standard chat node.\n        \"\"\"\n        system_prompt = f\"\"\"\n        You are a helpful assistant for writing documents.\n        To write the document, you MUST use the write_document_local tool.\n        You MUST write the full document, even when changing only a few words.\n        When you wrote the document, DO NOT repeat it as a message. \n        Just briefly summarize the changes you made. 2 sentences max.\n        This is the current state of the document: ----\\n {self.state.document}\\n-----\n        \"\"\"\n\n        # 1. Here we specify that we want to stream the tool call to write_document_local\n        #    to the frontend as state.\n        await copilotkit_predict_state({\n            \"document\": {\n                \"tool_name\": \"write_document_local\",\n                \"tool_argument\": \"document\"\n            }\n        })\n\n        # 2. Run the model and stream the response\n        #    Note: In order to stream the response, wrap the completion call in\n        #    copilotkit_stream and set stream=True.\n        response = await copilotkit_stream(\n            completion(\n\n                # 2.1 Specify the model to use\n                model=\"openai/gpt-4o\",\n                messages=[\n                    {\n                        \"role\": \"system\", \n                        \"content\": system_prompt\n                    },\n                    *self.state.messages\n                ],\n\n                # 2.2 Bind the tools to the model\n                tools=[\n                    *self.state.copilotkit.actions,\n                    WRITE_DOCUMENT_TOOL\n                ],\n\n                # 2.3 Disable parallel tool calls to avoid race conditions,\n                #     enable this for faster performance if you want to manage\n                #     the complexity of running tool calls in parallel.\n                parallel_tool_calls=False,\n                stream=True\n            )\n        )\n\n        message = response.choices[0].message\n\n        # 3. Append the message to the messages in state\n        self.state.messages.append(message)\n\n        # 4. Handle tool call\n        if message.get(\"tool_calls\"):\n            tool_call = message[\"tool_calls\"][0]\n            tool_call_id = tool_call[\"id\"]\n            tool_call_name = tool_call[\"function\"][\"name\"]\n            tool_call_args = json.loads(tool_call[\"function\"][\"arguments\"])\n\n            if tool_call_name == \"write_document_local\":\n                self.state.document = tool_call_args[\"document\"]\n\n                # 4.1 Append the result to the messages in state\n                self.state.messages.append({\n                    \"role\": \"tool\",\n                    \"content\": \"Document written.\",\n                    \"tool_call_id\": tool_call_id\n                })\n\n                # 4.2 Append a tool call to confirm changes\n                self.state.messages.append({\n                    \"role\": \"assistant\",\n                    \"content\": \"\",\n                    \"tool_calls\": [{\n                        \"id\": str(uuid.uuid4()),\n                        \"function\": {\n                            \"name\": \"confirm_changes\",\n                            \"arguments\": \"{}\"\n                        }\n                    }]\n                })\n\n                return \"route_end\"\n\n        # 5. If our tool was not called, return to the end route\n        return \"route_end\"\n\n    @listen(\"route_end\")\n    async def end(self):\n        \"\"\"\n        End the flow.\n        \"\"\"\n",
      "language": "python",
      "type": "file"
    }
  ]
}